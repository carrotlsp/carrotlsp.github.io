<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>day02-WebRTCçš„æ•´ä½“è®¤çŸ¥</title>
    <link href="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/"/>
    <url>/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€WebRTCå­¦ä¹ å‰è¨€"><a href="#ä¸€ã€WebRTCå­¦ä¹ å‰è¨€" class="headerlink" title="ä¸€ã€WebRTCå­¦ä¹ å‰è¨€"></a>ä¸€ã€WebRTCå­¦ä¹ å‰è¨€</h2><h3 id="1ã€WebRTCæºç çš„ä»£ç é‡æ˜¯ä»€ä¹ˆçº§åˆ«ï¼Ÿ"><a href="#1ã€WebRTCæºç çš„ä»£ç é‡æ˜¯ä»€ä¹ˆçº§åˆ«ï¼Ÿ" class="headerlink" title="1ã€WebRTCæºç çš„ä»£ç é‡æ˜¯ä»€ä¹ˆçº§åˆ«ï¼Ÿ"></a>1ã€WebRTCæºç çš„ä»£ç é‡æ˜¯ä»€ä¹ˆçº§åˆ«ï¼Ÿ</h3><ul><li>WebRTCæœ‰ <code>100å¤šä¸‡</code> è¡Œä»£ç </li></ul><h3 id="2ã€éŸ³è§†é¢‘çš„èµ·æºï¼Ÿ"><a href="#2ã€éŸ³è§†é¢‘çš„èµ·æºï¼Ÿ" class="headerlink" title="2ã€éŸ³è§†é¢‘çš„èµ·æºï¼Ÿ"></a>2ã€éŸ³è§†é¢‘çš„èµ·æºï¼Ÿ</h3><ul><li>åƒé‡Œçœ¼ä¸é¡ºé£è€³ï¼ˆæƒ³è±¡ï¼‰</li><li>1876å¹´è´å°”å‘æ˜äº†ç”µè¯ï¼ˆéŸ³é¢‘çš„èµ·æºï¼‰</li><li>1872å¹´â€œå¥”è·‘çš„é©¬â€ï¼ˆä¸ºäº†è¯æ˜ğŸ´åœ¨å¥”è·‘æ—¶ï¼Œå››æ¡è…¿æ˜¯å¦å‡ºç°è…¾ç©ºï¼Œå€ŸåŠ©ä¸€ç»„ç…§ç‰‡ï¼Œä¹Ÿæ˜¯è§†é¢‘çš„èµ·æºï¼‰</li></ul><h3 id="3ã€WebRTCç”±ä½•è€Œæ¥ï¼Ÿ"><a href="#3ã€WebRTCç”±ä½•è€Œæ¥ï¼Ÿ" class="headerlink" title="3ã€WebRTCç”±ä½•è€Œæ¥ï¼Ÿ"></a>3ã€WebRTCç”±ä½•è€Œæ¥ï¼Ÿ</h3><ul><li>ç¼˜èµ·GIPSçš„ç‹¬é—¨ç§˜ç±</li><li>Googleæ”¶è´­GIPSï¼Œä¸ºäº†å®ç°æµè§ˆå™¨ç›´æ’­çš„å®å¤§æ„¿æ™¯ï¼Œåˆ›å»ºäº†WebRTC</li><li>WebRTCç°åœ¨å°±æ˜¯éŸ³è§†é¢‘ç½‘ç»œä¼ è¾“ç•Œçš„éœ¸ä¸»</li></ul><h3 id="4ã€ã€é‡è¦ã€‘ä¼ ç»Ÿç›´æ’­å’Œå®æ—¶äº’åŠ¨ç›´æ’­çš„åŒºåˆ«ï¼ˆæŠ€æœ¯è·¯çº¿ã€æœ€ç»ˆå½¢æ€ä¸Šåˆ†æï¼‰ï¼Ÿ"><a href="#4ã€ã€é‡è¦ã€‘ä¼ ç»Ÿç›´æ’­å’Œå®æ—¶äº’åŠ¨ç›´æ’­çš„åŒºåˆ«ï¼ˆæŠ€æœ¯è·¯çº¿ã€æœ€ç»ˆå½¢æ€ä¸Šåˆ†æï¼‰ï¼Ÿ" class="headerlink" title="4ã€ã€é‡è¦ã€‘ä¼ ç»Ÿç›´æ’­å’Œå®æ—¶äº’åŠ¨ç›´æ’­çš„åŒºåˆ«ï¼ˆæŠ€æœ¯è·¯çº¿ã€æœ€ç»ˆå½¢æ€ä¸Šåˆ†æï¼‰ï¼Ÿ"></a>4ã€ã€é‡è¦ã€‘ä¼ ç»Ÿç›´æ’­å’Œå®æ—¶äº’åŠ¨ç›´æ’­çš„åŒºåˆ«ï¼ˆæŠ€æœ¯è·¯çº¿ã€æœ€ç»ˆå½¢æ€ä¸Šåˆ†æï¼‰ï¼Ÿ</h3><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727064848021.png" class="" title="image-20220727064848021"><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727065058365.png" class="" title="image-20220727065058365"><h3 id="5ã€ã€é‡è¦ã€‘ä¸¤ç§æŠ€æœ¯çš„å¯¹æ¯”ï¼Ÿ"><a href="#5ã€ã€é‡è¦ã€‘ä¸¤ç§æŠ€æœ¯çš„å¯¹æ¯”ï¼Ÿ" class="headerlink" title="5ã€ã€é‡è¦ã€‘ä¸¤ç§æŠ€æœ¯çš„å¯¹æ¯”ï¼Ÿ"></a>5ã€ã€é‡è¦ã€‘ä¸¤ç§æŠ€æœ¯çš„å¯¹æ¯”ï¼Ÿ</h3><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727065259838.png" class="" title="image-20220727065259838"><h2 id="äºŒã€å®æ—¶äº’åŠ¨ç›´æ’­çš„éš¾ç‚¹åœ¨å“ªé‡Œï¼Ÿ"><a href="#äºŒã€å®æ—¶äº’åŠ¨ç›´æ’­çš„éš¾ç‚¹åœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="äºŒã€å®æ—¶äº’åŠ¨ç›´æ’­çš„éš¾ç‚¹åœ¨å“ªé‡Œï¼Ÿ"></a>äºŒã€å®æ—¶äº’åŠ¨ç›´æ’­çš„éš¾ç‚¹åœ¨å“ªé‡Œï¼Ÿ</h2><h3 id="1ã€å¯¹å®æ—¶è¦æ±‚æ€§é«˜ï¼Œæ¯ä¸ªå»¶è¿Ÿåº¦è®©ç”¨æˆ·çš„ä½“éªŒå¦‚ä½•ï¼Ÿ"><a href="#1ã€å¯¹å®æ—¶è¦æ±‚æ€§é«˜ï¼Œæ¯ä¸ªå»¶è¿Ÿåº¦è®©ç”¨æˆ·çš„ä½“éªŒå¦‚ä½•ï¼Ÿ" class="headerlink" title="1ã€å¯¹å®æ—¶è¦æ±‚æ€§é«˜ï¼Œæ¯ä¸ªå»¶è¿Ÿåº¦è®©ç”¨æˆ·çš„ä½“éªŒå¦‚ä½•ï¼Ÿ"></a>1ã€å¯¹å®æ—¶è¦æ±‚æ€§é«˜ï¼Œæ¯ä¸ªå»¶è¿Ÿåº¦è®©ç”¨æˆ·çš„ä½“éªŒå¦‚ä½•ï¼Ÿ</h3><ul><li>ä¼ ç»Ÿç›´æ’­ï¼š<code>å¹³å‡å»¶è¿Ÿåœ¨3ç§’ä»¥ä¸Š</code></li><li>å®æ—¶äº’åŠ¨ç›´æ’­ï¼š<code>å»¶è¿Ÿåœ¨500æ¯«ç§’ä»¥å†…</code></li></ul><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727065501848.png" class="" title="image-20220727065501848"><h3 id="2ã€TCPä¸UDPä¹‹äº‰ï¼Ÿ"><a href="#2ã€TCPä¸UDPä¹‹äº‰ï¼Ÿ" class="headerlink" title="2ã€TCPä¸UDPä¹‹äº‰ï¼Ÿ"></a>2ã€TCPä¸UDPä¹‹äº‰ï¼Ÿ</h3><ul><li><p>å¦‚æœè¯´UDPåšåˆ°æè‡´æ˜¯ä¸æ˜¯å°±æ˜¯è‡ªå·±å®ç°äº†ä¸€å¥—TCPå‘¢ï¼Ÿ<code>å¦</code></p></li><li><p>tcpçš„<code>ackæœºåˆ¶å’Œè¶…æ—¶é‡ä¼ æœºåˆ¶</code>ï¼Œå°±é™åˆ¶äº†tcpæ˜¯æ— æ³•åšåˆ°500æ¯«ç§’ä»¥ä¸‹çš„å»¶è¿Ÿæ€§çš„</p></li><li><p>å› æ­¤å®æ—¶äº’åŠ¨ç›´æ’­éƒ½æ˜¯é€‰æ‹©å€ŸåŠ© <code>UDP</code> è¿›è¡ŒåŒ…ä¼ è¾“</p></li></ul><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727070001320.png" class="" title="image-20220727070001320"><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727070013911.png" class="" title="image-20220727070013911"><h3 id="3ã€éŸ³è§†é¢‘æœåŠ¡è´¨é‡ä¸å®æ—¶æ€§ä¹‹é—´çš„çŸ›ç›¾æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3ã€éŸ³è§†é¢‘æœåŠ¡è´¨é‡ä¸å®æ—¶æ€§ä¹‹é—´çš„çŸ›ç›¾æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3ã€éŸ³è§†é¢‘æœåŠ¡è´¨é‡ä¸å®æ—¶æ€§ä¹‹é—´çš„çŸ›ç›¾æ˜¯ä»€ä¹ˆï¼Ÿ"></a>3ã€éŸ³è§†é¢‘æœåŠ¡è´¨é‡ä¸å®æ—¶æ€§ä¹‹é—´çš„çŸ›ç›¾æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>å¦‚æœæƒ³è¦æé«˜éŸ³è§†é¢‘æœåŠ¡è´¨é‡ï¼Œé‚£ä¹ˆå°±è¦ä¿è¯æ•°æ®åŒ…çš„å®Œæ•´æ€§å’Œæ•°æ®è¶³å¤Ÿä¿çœŸï¼Œè€Œå°±ä¼šç»™å®æ—¶æ€§å¸¦æ¥å¾ˆå¤§æŒ‘æˆ˜ã€‚</li></ul><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727070211566.png" class="" title="image-20220727070211566"><h3 id="4ã€å®æ—¶äº’åŠ¨ç›´æ’­ä¸ºä»€ä¹ˆè¿˜è¦è§£å†³å›éŸ³ã€å™ªéŸ³ç­‰é—®é¢˜ï¼Ÿ"><a href="#4ã€å®æ—¶äº’åŠ¨ç›´æ’­ä¸ºä»€ä¹ˆè¿˜è¦è§£å†³å›éŸ³ã€å™ªéŸ³ç­‰é—®é¢˜ï¼Ÿ" class="headerlink" title="4ã€å®æ—¶äº’åŠ¨ç›´æ’­ä¸ºä»€ä¹ˆè¿˜è¦è§£å†³å›éŸ³ã€å™ªéŸ³ç­‰é—®é¢˜ï¼Ÿ"></a>4ã€å®æ—¶äº’åŠ¨ç›´æ’­ä¸ºä»€ä¹ˆè¿˜è¦è§£å†³å›éŸ³ã€å™ªéŸ³ç­‰é—®é¢˜ï¼Ÿ</h3><ul><li>å›éŸ³æ¶ˆé™¤ï¼ˆä¹‹å‰å¥½åƒå¯¹æ­¤è®¤è¯†å­˜åœ¨è¯¯åŒºï¼‰</li><li>é™å™ª</li><li>è‡ªåŠ¨å¢ç›Š</li></ul><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727070316704.png" class="" title="image-20220727070316704"><h3 id="5ã€ä¸¤ç§ç›´æ’­çš„æŠ€æœ¯è¦æ±‚å¯¹æ¯”ï¼Ÿ"><a href="#5ã€ä¸¤ç§ç›´æ’­çš„æŠ€æœ¯è¦æ±‚å¯¹æ¯”ï¼Ÿ" class="headerlink" title="5ã€ä¸¤ç§ç›´æ’­çš„æŠ€æœ¯è¦æ±‚å¯¹æ¯”ï¼Ÿ"></a>5ã€ä¸¤ç§ç›´æ’­çš„æŠ€æœ¯è¦æ±‚å¯¹æ¯”ï¼Ÿ</h3><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727070419012.png" class="" title="image-20220727070419012"><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727070444375.png" class="" title="image-20220727070444375"><h2 id="ä¸‰ã€å‡ ä¸ªé‡è¦æŒ‡æ ‡å’Œè¯„æµ‹æ–¹æ³•ï¼Ÿ"><a href="#ä¸‰ã€å‡ ä¸ªé‡è¦æŒ‡æ ‡å’Œè¯„æµ‹æ–¹æ³•ï¼Ÿ" class="headerlink" title="ä¸‰ã€å‡ ä¸ªé‡è¦æŒ‡æ ‡å’Œè¯„æµ‹æ–¹æ³•ï¼Ÿ"></a>ä¸‰ã€å‡ ä¸ªé‡è¦æŒ‡æ ‡å’Œè¯„æµ‹æ–¹æ³•ï¼Ÿ</h2><h3 id="1ã€å®æ—¶äº’åŠ¨ç›´æ’­çš„ä¸‰ä¸ªé‡è¦æŒ‡æ ‡ï¼Ÿ"><a href="#1ã€å®æ—¶äº’åŠ¨ç›´æ’­çš„ä¸‰ä¸ªé‡è¦æŒ‡æ ‡ï¼Ÿ" class="headerlink" title="1ã€å®æ—¶äº’åŠ¨ç›´æ’­çš„ä¸‰ä¸ªé‡è¦æŒ‡æ ‡ï¼Ÿ"></a>1ã€å®æ—¶äº’åŠ¨ç›´æ’­çš„ä¸‰ä¸ªé‡è¦æŒ‡æ ‡ï¼Ÿ</h3><ul><li>å®æ—¶é€šä¿¡å»¶è¿ŸæŒ‡æ ‡</li><li>éŸ³é¢‘æœåŠ¡è´¨é‡è¯„æµ‹æŒ‡æ ‡</li><li>è§†é¢‘æœåŠ¡è´¨é‡è¯„æµ‹æŒ‡æ ‡</li></ul><h3 id="2ã€å¯¹å®æ—¶é€šä¿¡å»¶è¿ŸæŒ‡æ ‡çš„ç†è§£ï¼Ÿ"><a href="#2ã€å¯¹å®æ—¶é€šä¿¡å»¶è¿ŸæŒ‡æ ‡çš„ç†è§£ï¼Ÿ" class="headerlink" title="2ã€å¯¹å®æ—¶é€šä¿¡å»¶è¿ŸæŒ‡æ ‡çš„ç†è§£ï¼Ÿ"></a>2ã€å¯¹å®æ—¶é€šä¿¡å»¶è¿ŸæŒ‡æ ‡çš„ç†è§£ï¼Ÿ</h3><ul><li><code>è°¨è®°ï¼š</code> å®æ—¶äº’åŠ¨ç›´æ’­ï¼Œç«¯åˆ°ç«¯çš„å»¶è¿Ÿè¯„ä¼°å¿…é¡»å°äº500æ¯«ç§’</li></ul><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727070636172.png" class="" title="image-20220727070636172"><h3 id="3ã€å®æ—¶æ€§æœ€ç®€å•çš„è¯„ä¼°æ–¹æ¡ˆï¼Ÿ"><a href="#3ã€å®æ—¶æ€§æœ€ç®€å•çš„è¯„ä¼°æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="3ã€å®æ—¶æ€§æœ€ç®€å•çš„è¯„ä¼°æ–¹æ¡ˆï¼Ÿ"></a>3ã€å®æ—¶æ€§æœ€ç®€å•çš„è¯„ä¼°æ–¹æ¡ˆï¼Ÿ</h3><ul><li>æ”¾ä¸€ä¸ªç”µå­è¡¨ï¼Œå¯¹æ¯”è§‚çœ‹ç«¯çœ‹åˆ°çš„æ—¶é—´å’ŒçœŸå®æ—¶é—´çš„å·®è·ï¼Œå°±èƒ½å¤§è‡´è¯„ä¼°å»¶è¿Ÿæ€§äº†ã€‚</li></ul><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727070906374.png" class="" title="image-20220727070906374"><h3 id="4ã€è§†é¢‘è´¨é‡è¯„æµ‹æ–¹æ¡ˆï¼Ÿ"><a href="#4ã€è§†é¢‘è´¨é‡è¯„æµ‹æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="4ã€è§†é¢‘è´¨é‡è¯„æµ‹æ–¹æ¡ˆï¼Ÿ"></a>4ã€è§†é¢‘è´¨é‡è¯„æµ‹æ–¹æ¡ˆï¼Ÿ</h3><ul><li>ä¹Ÿæ˜¯ä¸€èˆ¬å§‹ç»ˆä¸»è§‚è¯„æµ‹ï¼ŒåŒæ—¶å¯ä»¥å€ŸåŠ©ç æµå¤§å°è¾…åŠ©è¯„ä¼°</li></ul><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727071021231.png" class="" title="image-20220727071021231"><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727071029799.png" class="" title="image-20220727071029799"><h2 id="å››ã€ä¸ºä»€ä¹ˆå®æ—¶äº’åŠ¨ç›´æ’­éœ€è¦ä½¿ç”¨WebRTCï¼Ÿ"><a href="#å››ã€ä¸ºä»€ä¹ˆå®æ—¶äº’åŠ¨ç›´æ’­éœ€è¦ä½¿ç”¨WebRTCï¼Ÿ" class="headerlink" title="å››ã€ä¸ºä»€ä¹ˆå®æ—¶äº’åŠ¨ç›´æ’­éœ€è¦ä½¿ç”¨WebRTCï¼Ÿ"></a>å››ã€ä¸ºä»€ä¹ˆå®æ—¶äº’åŠ¨ç›´æ’­éœ€è¦ä½¿ç”¨WebRTCï¼Ÿ</h2><h3 id="1ã€è§†é¢‘ç›´æ’­æ¶æ„ï¼ˆå¤§æ–¹é¢ï¼‰"><a href="#1ã€è§†é¢‘ç›´æ’­æ¶æ„ï¼ˆå¤§æ–¹é¢ï¼‰" class="headerlink" title="1ã€è§†é¢‘ç›´æ’­æ¶æ„ï¼ˆå¤§æ–¹é¢ï¼‰"></a>1ã€è§†é¢‘ç›´æ’­æ¶æ„ï¼ˆå¤§æ–¹é¢ï¼‰</h3><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727071121779.png" class="" title="image-20220727071121779"><h3 id="2ã€ç»†åŒ–éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ"><a href="#2ã€ç»†åŒ–éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ" class="headerlink" title="2ã€ç»†åŒ–éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ"></a>2ã€ç»†åŒ–éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ</h3><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727071154392.png" class="" title="image-20220727071154392"><h3 id="3ã€è¿›ä¸€æ­¥ç»†åŒ–éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ"><a href="#3ã€è¿›ä¸€æ­¥ç»†åŒ–éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ" class="headerlink" title="3ã€è¿›ä¸€æ­¥ç»†åŒ–éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ"></a>3ã€è¿›ä¸€æ­¥ç»†åŒ–éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ</h3><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727071317662.png" class="" title="image-20220727071317662"><h3 id="4ã€æœ€ç»ˆç»†åŒ–åçš„éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ"><a href="#4ã€æœ€ç»ˆç»†åŒ–åçš„éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ" class="headerlink" title="4ã€æœ€ç»ˆç»†åŒ–åçš„éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ"></a>4ã€æœ€ç»ˆç»†åŒ–åçš„éŸ³è§†é¢‘ç›´æ’­æ¶æ„ï¼Ÿ</h3><ul><li><code>è¡¥å……</code>ï¼šç”µè¯ä½¿ç”¨çš„æ˜¯  g.711 ç¼–ç </li></ul><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727071341870.png" class="" title="image-20220727071341870"><h3 id="5ã€è‡ªç ”ç³»ç»Ÿä¸WebRTCçš„æ¯”è¾ƒï¼Ÿ"><a href="#5ã€è‡ªç ”ç³»ç»Ÿä¸WebRTCçš„æ¯”è¾ƒï¼Ÿ" class="headerlink" title="5ã€è‡ªç ”ç³»ç»Ÿä¸WebRTCçš„æ¯”è¾ƒï¼Ÿ"></a>5ã€è‡ªç ”ç³»ç»Ÿä¸WebRTCçš„æ¯”è¾ƒï¼Ÿ</h3><img src="/2022/07/25/WebRTC%E6%BA%90%E7%A0%81/day02-WebRTC%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/image-20220727071447890.png" class="" title="image-20220727071447890">]]></content>
    
    
    <categories>
      
      <category>WebRTCæºç </category>
      
    </categories>
    
    
    <tags>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day17-ã€å®æˆ˜ã€‘iOSç«¯çš„WebRTCä»£ç å®ç°æ€è·¯</title>
    <link href="/2022/07/18/WebRTC%E5%85%A5%E9%97%A8/day17iOS%E5%AE%9E%E7%8E%B0%E7%AB%AF%E5%AF%B9%E7%AB%AF/"/>
    <url>/2022/07/18/WebRTC%E5%85%A5%E9%97%A8/day17iOS%E5%AE%9E%E7%8E%B0%E7%AB%AF%E5%AF%B9%E7%AB%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€å•æ–¹é¢å‡†å¤‡é˜¶æ®µï¼ˆè®¾å¤‡Aï¼‰"><a href="#ä¸€ã€å•æ–¹é¢å‡†å¤‡é˜¶æ®µï¼ˆè®¾å¤‡Aï¼‰" class="headerlink" title="ä¸€ã€å•æ–¹é¢å‡†å¤‡é˜¶æ®µï¼ˆè®¾å¤‡Aï¼‰"></a>ä¸€ã€å•æ–¹é¢å‡†å¤‡é˜¶æ®µï¼ˆè®¾å¤‡Aï¼‰</h2><h3 id="1ã€åˆ›å»º-RTCPeerConnectionFactory-å·¥å‚ç±»"><a href="#1ã€åˆ›å»º-RTCPeerConnectionFactory-å·¥å‚ç±»" class="headerlink" title="1ã€åˆ›å»º RTCPeerConnectionFactory å·¥å‚ç±»"></a>1ã€åˆ›å»º <code>RTCPeerConnectionFactory</code> å·¥å‚ç±»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><pre><code class="hljs objective-c">- (void)createPeerConnectionFactory &#123;<br>    //è®¾ç½®SSLä¼ è¾“<br>    [RTCPeerConnectionFactory initialize];<br>    <br>    //å¦‚æœç‚¹å¯¹ç‚¹å·¥å‚ä¸ºç©º<br>    if (!factory)<br>    &#123;<br>        RTCDefaultVideoDecoderFactory* decoderFactory = [[RTCDefaultVideoDecoderFactory alloc] init];<br>        RTCDefaultVideoEncoderFactory* encoderFactory = [[RTCDefaultVideoEncoderFactory alloc] init];<br>        NSArray* codecs = [encoderFactory supportedCodecs];<br>        [encoderFactory setPreferredCodec:codecs[2]];<br>        <br>        factory = [[RTCPeerConnectionFactory alloc] initWithEncoderFactory: encoderFactory<br>                                                            decoderFactory: decoderFactory];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€åˆå§‹åŒ–æœ¬åœ°éŸ³è§†é¢‘æµ"><a href="#2ã€åˆå§‹åŒ–æœ¬åœ°éŸ³è§†é¢‘æµ" class="headerlink" title="2ã€åˆå§‹åŒ–æœ¬åœ°éŸ³è§†é¢‘æµ"></a>2ã€åˆå§‹åŒ–æœ¬åœ°éŸ³è§†é¢‘æµ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">- (void) captureLocalMedia &#123;<br>    NSDictionary* mandatoryConstraints = @&#123;&#125;;<br>    RTCMediaConstraints* constraints =<br>    [[RTCMediaConstraints alloc] initWithMandatoryConstraints:mandatoryConstraints<br>                                          optionalConstraints:nil];<br>    <br>    RTCAudioSource* audioSource = [factory audioSourceWithConstraints: constraints];<br>    //self.audioTrack = [factory audioTrackWithTrackId:@&quot;ARDAMSa0&quot;];<br>    audioTrack = [factory audioTrackWithSource:audioSource trackId:@&quot;ADRAMSa0&quot;];<br>    <br>    NSArray&lt;AVCaptureDevice* &gt;* captureDevices = [RTCCameraVideoCapturer captureDevices];<br>    AVCaptureDevicePosition position = AVCaptureDevicePositionFront;<br>    AVCaptureDevice* device = captureDevices[0];<br>    for (AVCaptureDevice* obj in captureDevices) &#123;<br>        if (obj.position == position) &#123;<br>            device = obj;<br>            break;<br>        &#125;<br>    &#125;<br>    <br>    //æ£€æµ‹æ‘„åƒå¤´æƒé™<br>    AVAuthorizationStatus authStatus = [AVCaptureDevice authorizationStatusForMediaType:AVMediaTypeVideo];<br>    if(authStatus == AVAuthorizationStatusRestricted || authStatus == AVAuthorizationStatusDenied) &#123;<br>        NSLog(@&quot;ç›¸æœºè®¿é—®å—é™&quot;);<br>        return;<br>    &#125;<br>    <br>    if (device) &#123;<br>        RTCVideoSource* videoSource = [factory videoSource];<br>        capture = [[RTCCameraVideoCapturer alloc] initWithDelegate:videoSource];<br>        AVCaptureDeviceFormat* format = [[RTCCameraVideoCapturer supportedFormatsForDevice:device] lastObject];<br>        CGFloat fps = [[format videoSupportedFrameRateRanges] firstObject].maxFrameRate;<br>        videoTrack = [factory videoTrackWithSource:videoSource trackId:@&quot;ARDAMSv0&quot;];<br>        self.localVideoView.captureSession = capture.captureSession;<br>        [capture startCaptureWithDevice:device<br>                                     format:format<br>                                        fps:fps];<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è¿™æ—¶å€™å±å¹•ä¸Šåº”è¯¥å¯ä»¥çœ‹åˆ°è‡ªå·±çš„è§†é¢‘æµåœ¨æ’­æ”¾äº†ã€‚</li></ul><h3 id="3ã€åˆå§‹åŒ–SocketIOï¼Œå¹¶-connect-è¿æ¥åˆ°ä¿¡ä»¤æœåŠ¡å™¨"><a href="#3ã€åˆå§‹åŒ–SocketIOï¼Œå¹¶-connect-è¿æ¥åˆ°ä¿¡ä»¤æœåŠ¡å™¨" class="headerlink" title="3ã€åˆå§‹åŒ–SocketIOï¼Œå¹¶ connect è¿æ¥åˆ°ä¿¡ä»¤æœåŠ¡å™¨"></a>3ã€åˆå§‹åŒ–SocketIOï¼Œå¹¶ <code>connect</code> è¿æ¥åˆ°ä¿¡ä»¤æœåŠ¡å™¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">- (void)createConnect: (NSString*) addr &#123;<br>    NSLog(@&quot;the server addr is %@&quot;, addr);<br>    /*<br>     log æ˜¯å¦æ‰“å°æ—¥å¿—<br>     forcePolling  æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨è½®è¯¢<br>     reconnectAttempts é‡è¿æ¬¡æ•°ï¼Œ-1è¡¨ç¤ºä¸€ç›´é‡è¿<br>     reconnectWait é‡è¿é—´éš”æ—¶é—´<br>     forceWebsockets æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨websocket<br>     */<br>    NSURL* url = [[NSURL alloc] initWithString:addr];<br>    manager = [[SocketManager alloc] initWithSocketURL:url<br>                                                config:@&#123;@&quot;log&quot;: @YES,<br>                                                         @&quot;forcePolling&quot;:@YES,<br>                                                         @&quot;forceWebsockets&quot;:@NO,<br>                                                         @&quot;reconnectAttempts&quot;:@(5),<br>                                                         @&quot;reconnectWait&quot;:@(1)<br>                                                         &#125;];<br>    socket = manager.defaultSocket;<br>    <br>    [socket on:@&quot;connect&quot; callback:^(NSArray* data, SocketAckEmitter* ack) &#123;<br>        NSLog(@&quot;socket connected&quot;);<br>        [self.delegate connected];<br>    &#125;];<br>    <br>    [socket on:@&quot;error&quot; callback:^(NSArray* data, SocketAckEmitter* ack) &#123;<br>        NSLog(@&quot;socket connect_error&quot;);<br>        [self.delegate connect_error];<br>    &#125;];<br>    <br>    [socket on:@&quot;reconnectAttempt&quot; callback:^(NSArray* data, SocketAckEmitter* ack) &#123;<br>        NSLog(@&quot;socket reconnectAttempt&quot;);<br>        [self.delegate reconnectAttempt];<br>    &#125;];<br>   <br>    [socket on:@&quot;joined&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        <br>        NSLog(@&quot;joined room(%@)&quot;, room);<br>        <br>        [self.delegate joined:room];<br>        <br>    &#125;];<br>    <br>    [socket on:@&quot;leaved&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        <br>        NSLog(@&quot;leaved room(%@)&quot;, room);<br>        <br>        [self.delegate leaved:room];<br>    &#125;];<br>    <br>    [socket on:@&quot;full&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        <br>        NSLog(@&quot;room(%@) is full&quot;, room);<br>        [self.delegate full:room];<br>    &#125;];<br>    <br>    [socket on:@&quot;otherjoin&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        NSString* uid = [data objectAtIndex:1];<br>        <br>        NSLog(@&quot;other user(%@) has been joined into room(%@)&quot;, room, uid);<br>        [self.delegate otherjoin:room User:uid];<br>    &#125;];<br>    <br>    [socket on:@&quot;bye&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        NSString* uid = [data objectAtIndex:1];<br>        <br>        NSLog(@&quot;user(%@) has leaved from room(%@)&quot;, room, uid);<br>        [self.delegate byeFrom:room User:uid];<br>    &#125;];<br>    <br>    [socket on:@&quot;message&quot; callback:^(NSArray * data, SocketAckEmitter * ack)&#123;<br>        NSString* room = [data objectAtIndex:0];<br>        NSDictionary* msg = [data objectAtIndex:1];<br>        <br>        NSLog(@&quot;onMessage, room(%@), data(%@)&quot;, room, msg);<br>        <br>        NSString* type = msg[@&quot;type&quot;];<br>        if( [type isEqualToString:@&quot;offer&quot;])&#123;<br>            [self.delegate offer: room message: msg];<br>        &#125;else if( [type isEqualToString:@&quot;answer&quot;])&#123;<br>            [self.delegate answer:room message: msg];<br>        &#125;else if( [type isEqualToString:@&quot;candidate&quot;])&#123;<br>            [self.delegate candidate:room message: msg];<br>        &#125;else &#123;<br>            NSLog(@&quot;the msg is invalid!&quot;);<br>        &#125;<br>    &#125;];<br>    <br>    // è¿æ¥è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º3ç§’<br>    [socket connectWithTimeoutAfter: 3.0 withHandler:^(void)&#123;<br>        NSLog(@&quot;socket connect_timeout 3.0s&quot;);<br>        [self.delegate connect_timeout];<br>    &#125;];<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ã€è®¾å¤‡Aå‘é€-join-æŒ‡ä»¤ç»™æœåŠ¡å™¨ï¼Œå¹¶æ”¶åˆ°-joined-æŒ‡ä»¤åï¼Œä¼šåˆ›å»º-RTCPeerConnection-å¯¹è±¡"><a href="#4ã€è®¾å¤‡Aå‘é€-join-æŒ‡ä»¤ç»™æœåŠ¡å™¨ï¼Œå¹¶æ”¶åˆ°-joined-æŒ‡ä»¤åï¼Œä¼šåˆ›å»º-RTCPeerConnection-å¯¹è±¡" class="headerlink" title="4ã€è®¾å¤‡Aå‘é€ join æŒ‡ä»¤ç»™æœåŠ¡å™¨ï¼Œå¹¶æ”¶åˆ° joined æŒ‡ä»¤åï¼Œä¼šåˆ›å»º RTCPeerConnection å¯¹è±¡"></a>4ã€è®¾å¤‡Aå‘é€ <code>join</code> æŒ‡ä»¤ç»™æœåŠ¡å™¨ï¼Œå¹¶æ”¶åˆ° <code>joined</code> æŒ‡ä»¤åï¼Œä¼šåˆ›å»º <code>RTCPeerConnection</code> å¯¹è±¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">- (RTCPeerConnection *)createPeerConnection &#123;<br>    //å¾—åˆ°ICEServer<br>    if (!ICEServers) &#123;<br>        ICEServers = [NSMutableArray array];<br>        [ICEServers addObject:[self defaultSTUNServer]];<br>    &#125;<br><br>    //ç”¨å·¥å‚æ¥åˆ›å»ºè¿æ¥<br>    RTCConfiguration* configuration = [[RTCConfiguration alloc] init];<br>    [configuration setIceServers:ICEServers];<br>    RTCPeerConnection* conn = [factory<br>                                     peerConnectionWithConfiguration:configuration<br>                                                         constraints:[self defaultPeerConnContraints]<br>                                                            delegate:self];<br>    <br>    NSArray&lt;NSString*&gt;* mediaStreamLabels = @[@&quot;ARDAMS&quot;];<br>    [conn addTrack:videoTrack streamIds:mediaStreamLabels];<br>    [conn addTrack:audioTrack streamIds:mediaStreamLabels];<br><br>    return conn;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äºŒã€æœ‰å¦ä¸€ä¸ªè®¾å¤‡ï¼ˆè®¾å¤‡Bï¼‰åŠ å…¥æˆ¿é—´é˜¶æ®µ-åª’ä½“åå•†"><a href="#äºŒã€æœ‰å¦ä¸€ä¸ªè®¾å¤‡ï¼ˆè®¾å¤‡Bï¼‰åŠ å…¥æˆ¿é—´é˜¶æ®µ-åª’ä½“åå•†" class="headerlink" title="äºŒã€æœ‰å¦ä¸€ä¸ªè®¾å¤‡ï¼ˆè®¾å¤‡Bï¼‰åŠ å…¥æˆ¿é—´é˜¶æ®µ - åª’ä½“åå•†"></a>äºŒã€æœ‰å¦ä¸€ä¸ªè®¾å¤‡ï¼ˆè®¾å¤‡Bï¼‰åŠ å…¥æˆ¿é—´é˜¶æ®µ - åª’ä½“åå•†</h2><h3 id="1ã€Aç«¯ä¼šè§¦å‘-otherjoin-ä¿¡ä»¤ï¼Œæ­¤åˆ»æœ‰ä¸¤ä¸ªpeerConnectionï¼Œè¿›å…¥åª’ä½“åå•†é˜¶æ®µï¼ˆåˆ›å»ºofferã€è®¾ç½®localOfferã€å‘é€offerï¼‰"><a href="#1ã€Aç«¯ä¼šè§¦å‘-otherjoin-ä¿¡ä»¤ï¼Œæ­¤åˆ»æœ‰ä¸¤ä¸ªpeerConnectionï¼Œè¿›å…¥åª’ä½“åå•†é˜¶æ®µï¼ˆåˆ›å»ºofferã€è®¾ç½®localOfferã€å‘é€offerï¼‰" class="headerlink" title="1ã€Aç«¯ä¼šè§¦å‘ otherjoin ä¿¡ä»¤ï¼Œæ­¤åˆ»æœ‰ä¸¤ä¸ªpeerConnectionï¼Œè¿›å…¥åª’ä½“åå•†é˜¶æ®µï¼ˆåˆ›å»ºofferã€è®¾ç½®localOfferã€å‘é€offerï¼‰"></a>1ã€Aç«¯ä¼šè§¦å‘ <code>otherjoin</code> ä¿¡ä»¤ï¼Œæ­¤åˆ»æœ‰ä¸¤ä¸ªpeerConnectionï¼Œè¿›å…¥åª’ä½“åå•†é˜¶æ®µï¼ˆåˆ›å»ºofferã€è®¾ç½®localOfferã€å‘é€offerï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">// çº¦æŸä¿¡æ¯<br>- (RTCMediaConstraints*)defaultPeerConnContraints &#123;<br>    RTCMediaConstraints* mediaConstraints =<br>    [[RTCMediaConstraints alloc] initWithMandatoryConstraints:@&#123;<br>                                                                kRTCMediaConstraintsOfferToReceiveAudio:kRTCMediaConstraintsValueTrue,<br>                                                                kRTCMediaConstraintsOfferToReceiveVideo:kRTCMediaConstraintsValueTrue<br>                                                                &#125;<br>                                          optionalConstraints:@&#123; @&quot;DtlsSrtpKeyAgreement&quot; : @&quot;true&quot; &#125;];<br>    return mediaConstraints;<br>&#125;<br><br>// åˆ›å»ºoffer<br>- (void)doStartCall &#123;<br>    NSLog(@&quot;Start Call, Wait ...&quot;);<br>    [self addLogToScreen: @&quot;Start Call, Wait ...&quot;];<br>    if (!peerConnection) &#123;<br>        peerConnection = [self createPeerConnection];<br>    &#125;<br>    <br>    [peerConnection offerForConstraints:[self defaultPeerConnContraints]<br>                      completionHandler:^(RTCSessionDescription * _Nullable sdp, NSError * _Nullable error) &#123;<br>                          if(error)&#123;<br>                              NSLog(@&quot;Failed to create offer SDP, err=%@&quot;, error);<br>                          &#125; else &#123;<br>                              __weak RTCPeerConnection* weakPeerConnction = self-&gt;peerConnection;<br>                              [self setLocalOffer: weakPeerConnction withSdp: sdp];<br>                          &#125;<br>                      &#125;];<br>&#125;<br><br>// å‘é€offerç»™å¯¹ç«¯<br>- (void)setLocalOffer:(RTCPeerConnection*)pc withSdp:(RTCSessionDescription*) sdp&#123;<br>    <br>    [pc setLocalDescription:sdp completionHandler:^(NSError * _Nullable error) &#123;<br>        if (!error) &#123;<br>            NSLog(@&quot;Successed to set local offer sdp!&quot;);<br>        &#125;else&#123;<br>            NSLog(@&quot;Failed to set local offer sdp, err=%@&quot;, error);<br>        &#125;<br>    &#125;];<br>    <br>    __weak NSString* weakMyRoom = myRoom;<br>    dispatch_async(dispatch_get_main_queue(), ^&#123;<br>        <br>        NSDictionary* dict = [[NSDictionary alloc] initWithObjects:@[@&quot;offer&quot;, sdp.sdp]<br>                                                           forKeys: @[@&quot;type&quot;, @&quot;sdp&quot;]];<br>        <br>        [[SignalClient getInstance] sendMessage: weakMyRoom<br>                                        withMsg: dict];<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€Bç«¯æ”¶åˆ°Offeråï¼Œä¼šåˆ›å»ºanswerï¼Œå¹¶ä¸”å‘é€ç»™Aç«¯ï¼›Aç«¯æ”¶åˆ°answerä¼šè§¦å‘å¦‚ä¸‹æµç¨‹"><a href="#2ã€Bç«¯æ”¶åˆ°Offeråï¼Œä¼šåˆ›å»ºanswerï¼Œå¹¶ä¸”å‘é€ç»™Aç«¯ï¼›Aç«¯æ”¶åˆ°answerä¼šè§¦å‘å¦‚ä¸‹æµç¨‹" class="headerlink" title="2ã€Bç«¯æ”¶åˆ°Offeråï¼Œä¼šåˆ›å»ºanswerï¼Œå¹¶ä¸”å‘é€ç»™Aç«¯ï¼›Aç«¯æ”¶åˆ°answerä¼šè§¦å‘å¦‚ä¸‹æµç¨‹"></a>2ã€Bç«¯æ”¶åˆ°Offeråï¼Œä¼šåˆ›å»ºanswerï¼Œå¹¶ä¸”å‘é€ç»™Aç«¯ï¼›Aç«¯æ”¶åˆ°answerä¼šè§¦å‘å¦‚ä¸‹æµç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">// Aç«¯æ”¶åˆ°æ¥è‡ªBç«¯çš„Answerï¼Œå¹¶è¿›è¡Œè®¾ç½®<br>- (void)answer:(NSString *)room message:(NSDictionary *)dict &#123;<br>    NSLog(@&quot;have received a answer message %@&quot;, dict);<br>    <br>    NSString *remoteAnswerSdp = dict[@&quot;sdp&quot;];<br>    RTCSessionDescription *remoteSdp = [[RTCSessionDescription alloc]<br>                                           initWithType:RTCSdpTypeAnswer<br>                                                    sdp: remoteAnswerSdp];<br>    [peerConnection setRemoteDescription:remoteSdp<br>                       completionHandler:^(NSError * _Nullable error) &#123;<br>        if(!error)&#123;<br>            NSLog(@&quot;Success to set remote Answer SDP&quot;);<br>        &#125;else&#123;<br>            NSLog(@&quot;Failure to set remote Answer SDP, err=%@&quot;, error);<br>        &#125;<br>    &#125;];<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€æœ‰å¦ä¸€ä¸ªè®¾å¤‡ï¼ˆè®¾å¤‡Bï¼‰åŠ å…¥æˆ¿é—´é˜¶æ®µ-å¿«é€ŸICEé˜¶æ®µ"><a href="#ä¸‰ã€æœ‰å¦ä¸€ä¸ªè®¾å¤‡ï¼ˆè®¾å¤‡Bï¼‰åŠ å…¥æˆ¿é—´é˜¶æ®µ-å¿«é€ŸICEé˜¶æ®µ" class="headerlink" title="ä¸‰ã€æœ‰å¦ä¸€ä¸ªè®¾å¤‡ï¼ˆè®¾å¤‡Bï¼‰åŠ å…¥æˆ¿é—´é˜¶æ®µ - å¿«é€ŸICEé˜¶æ®µ"></a>ä¸‰ã€æœ‰å¦ä¸€ä¸ªè®¾å¤‡ï¼ˆè®¾å¤‡Bï¼‰åŠ å…¥æˆ¿é—´é˜¶æ®µ - å¿«é€ŸICEé˜¶æ®µ</h2><h3 id="1ã€åˆ›å»ºpeerConnectionå¹¶ä¸”è®¾ç½®ICEServerä¹‹åï¼ŒWebRTCå°±ä¼šå»æ”¶é›†æœ¬è®¾å¤‡çš„candidateä¿¡æ¯ï¼Œå¹¶è§¦å‘å¦‚ä¸‹å›è°ƒ"><a href="#1ã€åˆ›å»ºpeerConnectionå¹¶ä¸”è®¾ç½®ICEServerä¹‹åï¼ŒWebRTCå°±ä¼šå»æ”¶é›†æœ¬è®¾å¤‡çš„candidateä¿¡æ¯ï¼Œå¹¶è§¦å‘å¦‚ä¸‹å›è°ƒ" class="headerlink" title="1ã€åˆ›å»ºpeerConnectionå¹¶ä¸”è®¾ç½®ICEServerä¹‹åï¼ŒWebRTCå°±ä¼šå»æ”¶é›†æœ¬è®¾å¤‡çš„candidateä¿¡æ¯ï¼Œå¹¶è§¦å‘å¦‚ä¸‹å›è°ƒ"></a>1ã€åˆ›å»ºpeerConnectionå¹¶ä¸”è®¾ç½®ICEServerä¹‹åï¼ŒWebRTCå°±ä¼šå»æ”¶é›†æœ¬è®¾å¤‡çš„candidateä¿¡æ¯ï¼Œå¹¶è§¦å‘å¦‚ä¸‹å›è°ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">/** é»˜é»˜æ”¶é›†candidateä¿¡æ¯ï¼Œç„¶åé€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€ç»™å¯¹ç«¯ */<br>/** New ice candidate has been found. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection<br>didGenerateIceCandidate:(RTCIceCandidate *)candidate&#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>    <br>    NSString* weakMyRoom = myRoom;<br>    dispatch_async(dispatch_get_main_queue(), ^&#123;<br>    <br>        NSDictionary* dict = [[NSDictionary alloc] initWithObjects:@[@&quot;candidate&quot;,<br>                                                                [NSString stringWithFormat:@&quot;%d&quot;, candidate.sdpMLineIndex],<br>                                                                candidate.sdpMid,<br>                                                                candidate.sdp]<br>                                                           forKeys:@[@&quot;type&quot;, @&quot;label&quot;, @&quot;id&quot;, @&quot;candidate&quot;]];<br>    <br>        [[SignalClient getInstance] sendMessage: weakMyRoom<br>                                    withMsg:dict];<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€å¯¹ç«¯æ”¶åˆ°ä¿¡ä»¤æœåŠ¡å™¨è½¬å‘è€Œæ¥çš„candidateï¼Œä¼šè§¦å‘å¦‚ä¸‹æ“ä½œï¼Œå®ŒæˆICEçš„candidateäº¤äº’æµç¨‹ã€‚åœ¨æ‰€æœ‰candidateäº¤äº’å®Œæˆåï¼Œä¼šè‡ªåŠ¨è¿›å…¥ICEé˜¶æ®µ"><a href="#2ã€å¯¹ç«¯æ”¶åˆ°ä¿¡ä»¤æœåŠ¡å™¨è½¬å‘è€Œæ¥çš„candidateï¼Œä¼šè§¦å‘å¦‚ä¸‹æ“ä½œï¼Œå®ŒæˆICEçš„candidateäº¤äº’æµç¨‹ã€‚åœ¨æ‰€æœ‰candidateäº¤äº’å®Œæˆåï¼Œä¼šè‡ªåŠ¨è¿›å…¥ICEé˜¶æ®µ" class="headerlink" title="2ã€å¯¹ç«¯æ”¶åˆ°ä¿¡ä»¤æœåŠ¡å™¨è½¬å‘è€Œæ¥çš„candidateï¼Œä¼šè§¦å‘å¦‚ä¸‹æ“ä½œï¼Œå®ŒæˆICEçš„candidateäº¤äº’æµç¨‹ã€‚åœ¨æ‰€æœ‰candidateäº¤äº’å®Œæˆåï¼Œä¼šè‡ªåŠ¨è¿›å…¥ICEé˜¶æ®µ"></a>2ã€å¯¹ç«¯æ”¶åˆ°ä¿¡ä»¤æœåŠ¡å™¨è½¬å‘è€Œæ¥çš„candidateï¼Œä¼šè§¦å‘å¦‚ä¸‹æ“ä½œï¼Œå®ŒæˆICEçš„candidateäº¤äº’æµç¨‹ã€‚åœ¨æ‰€æœ‰candidateäº¤äº’å®Œæˆåï¼Œä¼šè‡ªåŠ¨è¿›å…¥ICEé˜¶æ®µ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">//æ”¶åˆ°ä¿¡ä»¤æœåŠ¡å™¨è½¬å‘è€Œæ¥çš„candidate<br>- (void)candidate:(NSString *)room message:(NSDictionary *)dict &#123;<br>    NSLog(@&quot;have received a message %@&quot;, dict);<br>    <br>    NSString* desc = dict[@&quot;sdp&quot;];<br>    NSString* sdpMLineIndex = dict[@&quot;label&quot;];<br>    int index = [sdpMLineIndex intValue];<br>    NSString* sdpMid = dict[@&quot;id&quot;];<br>    <br>    <br>    RTCIceCandidate *candidate = [[RTCIceCandidate alloc] initWithSdp:desc<br>                                                        sdpMLineIndex:index<br>                                                               sdpMid:sdpMid];;<br>    [peerConnection addIceCandidate:candidate];<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è‡³æ­¤ <code>åª’ä½“åå•†</code> å’Œ <code>ICE</code> æµç¨‹éƒ½å·²ç»å®Œæˆ</li></ul><h2 id="å››ã€åª’ä½“æµä¼ è¾“é˜¶æ®µ"><a href="#å››ã€åª’ä½“æµä¼ è¾“é˜¶æ®µ" class="headerlink" title="å››ã€åª’ä½“æµä¼ è¾“é˜¶æ®µ"></a>å››ã€åª’ä½“æµä¼ è¾“é˜¶æ®µ</h2><h3 id="1ã€æ”¶åˆ°æ•°æ®æµå¦‚ä½•å±•ç¤ºï¼Ÿ"><a href="#1ã€æ”¶åˆ°æ•°æ®æµå¦‚ä½•å±•ç¤ºï¼Ÿ" class="headerlink" title="1ã€æ”¶åˆ°æ•°æ®æµå¦‚ä½•å±•ç¤ºï¼Ÿ"></a>1ã€æ”¶åˆ°æ•°æ®æµå¦‚ä½•å±•ç¤ºï¼Ÿ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">// åˆ›å»ºremoteTrackæ’­æ”¾çš„è§†å›¾<br>- (void)viewDidLoad &#123;<br>    [super viewDidLoad];<br>    self.remoteVideoView = [[RTCEAGLVideoView alloc] initWithFrame:self.view.bounds];<br>    self.remoteVideoView.delegate = self;<br>    [self.view addSubview:self.remoteVideoView];<br> &#125;<br><br>/** å½“æ¥æ”¶åˆ°è¿œç«¯çš„æ•°æ®æµæ—¶ï¼Œè¿›è¡Œæ’­æ”¾ */<br>/** Called when a receiver and its track are created. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection<br>        didAddReceiver:(RTCRtpReceiver *)rtpReceiver<br>               streams:(NSArray&lt;RTCMediaStream *&gt; *)mediaStreams &#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>    <br>    RTCMediaStreamTrack* track = rtpReceiver.track;<br>    if([track.kind isEqualToString:kRTCMediaStreamTrackKindVideo])&#123;<br>        if(!self.remoteVideoView)&#123;<br>            NSLog(@&quot;error:remoteVideoView have not been created!&quot;);<br>            return;<br>        &#125;<br>        <br>        remoteVideoTrack = (RTCVideoTrack*)track;<br>        [remoteVideoTrack addRenderer: self.remoteVideoView];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äº”ã€æ ¸å¿ƒä»£ç è®°å½•"><a href="#äº”ã€æ ¸å¿ƒä»£ç è®°å½•" class="headerlink" title="äº”ã€æ ¸å¿ƒä»£ç è®°å½•"></a>äº”ã€æ ¸å¿ƒä»£ç è®°å½•</h2><h3 id="1ã€å®ç°ä¸€ä¸ªæˆ¿é—´åŠ å…¥çš„è§†å›¾"><a href="#1ã€å®ç°ä¸€ä¸ªæˆ¿é—´åŠ å…¥çš„è§†å›¾" class="headerlink" title="1ã€å®ç°ä¸€ä¸ªæˆ¿é—´åŠ å…¥çš„è§†å›¾"></a>1ã€å®ç°ä¸€ä¸ªæˆ¿é—´åŠ å…¥çš„è§†å›¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">#import &quot;ViewController.h&quot;<br>#import &quot;CallViewController.h&quot;<br>#import &quot;SignalClient.h&quot;<br><br>@interface ViewController ()<br>&#123;<br>    SignalClient *sigclient;<br>&#125;<br><br>@property (strong, nonatomic) UILabel* addrLabel;<br>@property (strong, nonatomic) UITextField* addr;<br><br>@property (strong, nonatomic) UILabel* roomLabel;<br>@property (strong, nonatomic) UITextField* room;<br><br>@property (strong, nonatomic) UIButton* joinBtn;<br><br>@property (strong, nonatomic) CallViewController* call;<br><br>@end<br><br>@implementation ViewController<br><br>- (void)viewDidLoad &#123;<br>    [super viewDidLoad];<br>    // Do any additional setup after loading the view, typically from a nib.<br><br>    CGFloat width = self.view.bounds.size.width;<br>    <br>    self.addrLabel = [[UILabel alloc] init];<br>    [self.addrLabel setText:@&quot;ADDR:&quot;];<br>    [self.addrLabel setFrame:CGRectMake(20, 100, 60, 40)];<br>    [self.view addSubview:self.addrLabel];<br>    <br>    self.addr = [[UITextField alloc] init];<br>    [self.addr setText:@&quot;https://webrtc.runduck.cn&quot;];<br>    [self.addr setFrame:CGRectMake(80, 100, width-100, 40)];<br>    [self.addr setTextColor:[UIColor blackColor]];<br>    [self.addr setBorderStyle:UITextBorderStyleRoundedRect];<br>    [self.addr setEnabled:TRUE];<br>    [self.view addSubview:self.addr];<br>    <br>    self.roomLabel = [[UILabel alloc] init];<br>    [self.roomLabel setText:@&quot;ROOM:&quot;];<br>    [self.roomLabel setFrame:CGRectMake(20, 150, 60, 40)];<br>    [self.view addSubview:self.roomLabel];<br>    <br>    self.room = [[UITextField alloc] init];<br>    [self.room setText:@&quot;123123&quot;];<br>    [self.room setFrame:CGRectMake(80, 150, width-100, 40)];<br>    [self.room setTextColor:[UIColor blackColor]];<br>    [self.room setBorderStyle:UITextBorderStyleRoundedRect];<br>    [self.room setEnabled:TRUE];<br>    [self.view addSubview:self.room];<br>    <br>    self.joinBtn = [[UIButton alloc] init];<br>    [self.joinBtn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];<br>    [self.joinBtn setTintColor:[UIColor whiteColor]];<br>    [self.joinBtn setTitle:@&quot;join&quot; forState:UIControlStateNormal];<br>    [self.joinBtn setBackgroundColor:[UIColor grayColor]];<br>    [self.joinBtn setShowsTouchWhenHighlighted:YES];<br>    [self.joinBtn setFrame:CGRectMake(40, 200, width-80, 40)];<br>    <br>    [self.joinBtn addTarget:self action:@selector(btnClick:) forControlEvents:UIControlEventTouchUpInside];<br>    <br>    [self.view addSubview:self.joinBtn];<br>&#125;<br><br>/** ç‚¹å‡»ç©ºç™½å¤„å›æ”¶é”®ç›˜ */<br>- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches   withEvent:(UIEvent *)event<br>&#123;<br>    [self.view endEditing:YES];<br>&#125;<br><br>- (void)btnClick:(UIButton*)sender&#123;<br>    NSLog(@&quot;on click!&quot;);<br><br>    self.call = [[CallViewController alloc] initAddr:self.addr.text withRoom: self.room.text];<br>    [self.call.view setFrame:self.view.bounds];<br>    [self.call.view setBackgroundColor:[UIColor whiteColor]];<br><br>    [self addChildViewController:self.call];<br>    [self.call didMoveToParentViewController:self];<br>    <br>    [self.view addSubview:self.call.view];<br>    <br>    [[SignalClient getInstance] createConnect: self.addr.text];<br>&#125;<br><br>#pragma mark protocal EventNotify<br>- (void) leave &#123;<br>//    [self.view removeFromSuperview];<br>    <br>&#125;<br><br><br>@end<br></code></pre></td></tr></table></figure><h3 id="2ã€ä¿¡ä»¤æœåŠ¡å™¨ç›¸å…³ä»£ç "><a href="#2ã€ä¿¡ä»¤æœåŠ¡å™¨ç›¸å…³ä»£ç " class="headerlink" title="2ã€ä¿¡ä»¤æœåŠ¡å™¨ç›¸å…³ä»£ç "></a>2ã€ä¿¡ä»¤æœåŠ¡å™¨ç›¸å…³ä»£ç </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">#import &quot;SignalClient.h&quot;<br>@import SocketIO;<br><br>@interface SignalClient()<br>&#123;<br>    <br>    SocketManager* manager;<br>    SocketIOClient* socket;<br>    <br>    NSString* room;<br>&#125;<br><br>@end<br><br>@implementation SignalClient<br><br>static SignalClient* m_instance = nil;<br><br>+ (SignalClient*) getInstance &#123;<br>    <br>    static dispatch_once_t onceToken;<br>    dispatch_once(&amp;onceToken, ^&#123;<br>        m_instance = [[self alloc]init];<br>    &#125;);<br>    <br>    return m_instance;<br>&#125;<br><br>- (void) createConnect: (NSString*) addr &#123;<br>    NSLog(@&quot;the server addr is %@&quot;, addr);<br>    /*<br>     log æ˜¯å¦æ‰“å°æ—¥å¿—<br>     forcePolling  æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨è½®è¯¢<br>     reconnectAttempts é‡è¿æ¬¡æ•°ï¼Œ-1è¡¨ç¤ºä¸€ç›´é‡è¿<br>     reconnectWait é‡è¿é—´éš”æ—¶é—´<br>     forceWebsockets æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨websocket<br>     */<br>    NSURL* url = [[NSURL alloc] initWithString:addr];<br>    manager = [[SocketManager alloc] initWithSocketURL:url<br>                                                config:@&#123;@&quot;log&quot;: @YES,<br>                                                         @&quot;forcePolling&quot;:@YES,<br>                                                         @&quot;forceWebsockets&quot;:@NO,<br>                                                         @&quot;reconnectAttempts&quot;:@(5),<br>                                                         @&quot;reconnectWait&quot;:@(1)<br>                                                         &#125;];<br>    socket = manager.defaultSocket;<br>//    socket = [manager socketForNamespace:@&quot;/socket.io&quot;];<br>    <br>//    socket = [manager socketForNamespace:@&quot;&quot;];<br>    <br>    [socket on:@&quot;connect&quot; callback:^(NSArray* data, SocketAckEmitter* ack) &#123;<br>        NSLog(@&quot;socket connected&quot;);<br>        [self.delegate connected];<br>    &#125;];<br>    <br>    [socket on:@&quot;error&quot; callback:^(NSArray* data, SocketAckEmitter* ack) &#123;<br>        NSLog(@&quot;socket connect_error&quot;);<br>        [self.delegate connect_error];<br>    &#125;];<br>    <br>    [socket on:@&quot;reconnectAttempt&quot; callback:^(NSArray* data, SocketAckEmitter* ack) &#123;<br>        NSLog(@&quot;socket reconnectAttempt&quot;);<br>        [self.delegate reconnectAttempt];<br>    &#125;];<br>    //    [socket on:@&quot;currentAmount&quot; callback:^(NSArray* data, SocketAckEmitter* ack) &#123;<br>    //        double cur = [[data objectAtIndex:0] floatValue];<br>    //<br>    //        [[socket emitWithAck:@&quot;canUpdate&quot; with:@[@(cur)]] timingOutAfter:0 callback:^(NSArray* data) &#123;<br>    //            [socket emit:@&quot;update&quot; with:@[@&#123;@&quot;amount&quot;: @(cur + 2.50)&#125;]];<br>    //        &#125;];<br>    //<br>    //        [ack with:@[@&quot;Got your currentAmount, &quot;, @&quot;dude&quot;]];<br>    //    &#125;];<br>    <br>    [socket on:@&quot;joined&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        <br>        NSLog(@&quot;joined room(%@)&quot;, room);<br>        <br>        [self.delegate joined:room];<br>        <br>    &#125;];<br>    <br>    [socket on:@&quot;leaved&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        <br>        NSLog(@&quot;leaved room(%@)&quot;, room);<br>        <br>        [self.delegate leaved:room];<br>    &#125;];<br>    <br>    [socket on:@&quot;full&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        <br>        NSLog(@&quot;room(%@) is full&quot;, room);<br>        [self.delegate full:room];<br>    &#125;];<br>    <br>    [socket on:@&quot;otherjoin&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        NSString* uid = [data objectAtIndex:1];<br>        <br>        NSLog(@&quot;other user(%@) has been joined into room(%@)&quot;, room, uid);<br>        [self.delegate otherjoin:room User:uid];<br>    &#125;];<br>    <br>    [socket on:@&quot;bye&quot; callback:^(NSArray * data, SocketAckEmitter * ack) &#123;<br>        NSString* room = [data objectAtIndex:0];<br>        NSString* uid = [data objectAtIndex:1];<br>        <br>        NSLog(@&quot;user(%@) has leaved from room(%@)&quot;, room, uid);<br>        [self.delegate byeFrom:room User:uid];<br>    &#125;];<br>    <br>    [socket on:@&quot;message&quot; callback:^(NSArray * data, SocketAckEmitter * ack)&#123;<br>        NSString* room = [data objectAtIndex:0];<br>        NSDictionary* msg = [data objectAtIndex:1];<br>        <br>        NSLog(@&quot;onMessage, room(%@), data(%@)&quot;, room, msg);<br>        <br>        NSString* type = msg[@&quot;type&quot;];<br>        if( [type isEqualToString:@&quot;offer&quot;])&#123;<br>            [self.delegate offer: room message: msg];<br>        &#125;else if( [type isEqualToString:@&quot;answer&quot;])&#123;<br>            [self.delegate answer:room message: msg];<br>        &#125;else if( [type isEqualToString:@&quot;candidate&quot;])&#123;<br>            [self.delegate candidate:room message: msg];<br>        &#125;else &#123;<br>            NSLog(@&quot;the msg is invalid!&quot;);<br>        &#125;<br>    &#125;];<br>    <br>    // è¿æ¥è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º3ç§’<br>    [socket connectWithTimeoutAfter: 3.0 withHandler:^(void)&#123;<br>        NSLog(@&quot;socket connect_timeout 3.0s&quot;);<br>        [self.delegate connect_timeout];<br>    &#125;];<br>&#125;<br><br>- (void) joinRoom:(NSString*) room &#123;<br>    NSLog(@&quot;join room(%@)&quot;, room);<br>    <br>    if(socket.status == SocketIOStatusConnected)&#123;<br>        [socket emit:@&quot;join&quot; with:@[room]];<br>    &#125;<br>&#125;<br><br>- (void) leaveRoom:(NSString*) room &#123;<br>    NSLog(@&quot;leave room(%@)&quot;, room);<br>    <br>    if(socket.status == SocketIOStatusConnected)&#123;<br>        [socket emit:@&quot;leave&quot; with:@[room]];<br>    &#125;<br>&#125;<br><br>- (void) sendMessage: (NSString*) room withMsg:(NSDictionary*) msg &#123;<br>    if(socket.status == SocketIOStatusConnected) &#123;<br>        if(msg)&#123;<br>            NSLog(@&quot;json:%@&quot;, msg);<br>            [socket emit:@&quot;message&quot; with:@[room, msg]];<br>        &#125;else&#123;<br>            NSLog(@&quot;error: msg is nil!&quot;);<br>        &#125;<br>        <br>    &#125; else &#123;<br>        NSLog(@&quot;the socket has been disconnect!&quot;);<br>    &#125;<br>&#125;<br><br>@end<br><br></code></pre></td></tr></table></figure><h3 id="3ã€WebRTCç›¸å…³ä»£ç "><a href="#3ã€WebRTCç›¸å…³ä»£ç " class="headerlink" title="3ã€WebRTCç›¸å…³ä»£ç "></a>3ã€WebRTCç›¸å…³ä»£ç </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">#import &quot;CallViewController.h&quot;<br>#import &quot;SignalClient.h&quot;<br><br>#import &lt;WebRTC/WebRTC.h&gt;<br>#import &lt;MBProgressHUD/MBProgressHUD.h&gt;<br><br>@interface CallViewController() &lt;SignalEventNotify, RTCPeerConnectionDelegate, RTCVideoViewDelegate&gt;<br>&#123;<br>    <br>    NSString* myAddr;<br>    NSString* myRoom;<br>    <br>    NSString* myState;<br>    <br>    SignalClient* sigclient;<br>    <br>    RTCPeerConnectionFactory* factory;<br>    RTCCameraVideoCapturer* capture;<br>    //RTCMediaStream* localStream; //???<br>    RTCPeerConnection* peerConnection;<br>    <br>    RTCVideoTrack* videoTrack;<br>    RTCAudioTrack* audioTrack;<br>    <br>    RTCVideoTrack* remoteVideoTrack;<br>    CGSize remoteVideoSize;<br>    <br>    NSMutableArray* ICEServers;<br><br>&#125;<br><br>@property (strong, nonatomic) RTCEAGLVideoView *remoteVideoView;<br>@property (strong, nonatomic) RTCCameraPreviewView *localVideoView;<br><br>@property (strong, nonatomic) UIButton* leaveBtn;<br><br><br>@property (strong, nonatomic) dispatch_source_t timer;<br><br>@end<br><br>@implementation CallViewController<br><br>static CGFloat const kLocalVideoViewSize = 120;<br>static CGFloat const kLocalVideoViewPadding = 8;<br><br>//static NSString *const RTCSTUNServerURL = @&quot;stun:stun.l.google.com:19302&quot;;<br>//static NSString *const RTCSTUNServerURL = @&quot;turn:xxx.xxx.xxx:3478&quot;;<br>static NSString *const RTCSTUNServerURL = @&quot;turn:47.95.15.179:3478&quot;;<br>static int logY = 0;<br><br><br><br>- (instancetype) initAddr:(NSString*) addr withRoom:(NSString*) room &#123;<br>    self = [super init];<br>    if (self) &#123;<br>        myAddr = addr;<br>        myRoom = room;<br>    &#125;<br>    return self;<br>&#125;<br><br>- (void)viewDidLoad &#123;<br>    [super viewDidLoad];<br>    logY = 0;<br>    CGRect bounds = self.view.bounds;<br>    <br>    self.remoteVideoView = [[RTCEAGLVideoView alloc] initWithFrame:self.view.bounds];<br>    self.remoteVideoView.delegate = self;<br>    //[self.remoteVideoView set]<br>    //[self.remoteVideoView setBackgroundColor:[UIColor yellowColor]];<br>    [self.view addSubview:self.remoteVideoView];<br>    <br>    self.localVideoView = [[RTCCameraPreviewView alloc] initWithFrame:CGRectZero];<br>    [self.view addSubview:self.localVideoView];<br>    <br>    // Aspect fit local video view into a square box.<br>    CGRect localVideoFrame =<br>    CGRectMake(0, 0, kLocalVideoViewSize, kLocalVideoViewSize);<br>    // Place the view in the bottom right.<br>    localVideoFrame.origin.x = CGRectGetMaxX(bounds)<br>    - localVideoFrame.size.width - kLocalVideoViewPadding;<br>    localVideoFrame.origin.y = CGRectGetMaxY(bounds)<br>    - localVideoFrame.size.height - kLocalVideoViewPadding;<br>    [self.localVideoView setFrame: localVideoFrame];<br><br>    self.leaveBtn = [[UIButton alloc] init];<br>    [self.leaveBtn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];<br>    [self.leaveBtn setTintColor:[UIColor whiteColor]];<br>    [self.leaveBtn setTitle:@&quot;leave&quot; forState:UIControlStateNormal];<br>    [self.leaveBtn setBackgroundColor:[UIColor greenColor]];<br>    [self.leaveBtn setShowsTouchWhenHighlighted:YES];<br>    [self.leaveBtn.layer setCornerRadius:40];<br>    [self.leaveBtn.layer setBorderWidth:1];<br>    [self.leaveBtn setClipsToBounds:FALSE];<br>    [self.leaveBtn setFrame:CGRectMake(self.view.bounds.size.width/2-40,<br>                                       self.view.bounds.size.height-140,<br>                                       80,<br>                                       80)];<br>    <br>    [self.leaveBtn addTarget:self<br>                      action:@selector(leaveRoom:)<br>            forControlEvents:UIControlEventTouchUpInside];<br>    <br>    [self.view addSubview:self.leaveBtn];<br>    <br>    [self createPeerConnectionFactory];<br>    <br>    //[self startTimer];<br>    <br>    //åˆ›å»ºæœ¬åœ°æµ<br>    [self captureLocalMedia];<br><br>    sigclient = [SignalClient getInstance];<br>    sigclient.delegate = self;<br>    ////[sigclient createConnect:myAddr];<br>    <br>    myState = @&quot;init&quot;;<br>    <br>&#125;<br><br>-(void)addLogToScreen:(NSString *)format, ...&#123;<br>    <br>    va_list paramList;<br>    va_start(paramList,format);<br>    NSString* log = [[NSString alloc]initWithFormat:format arguments:paramList];<br>    va_end(paramList);<br>    <br>    CGRect labelRect = CGRectMake(0, logY++ * 20, 500, 200);<br>    UILabel *label = [[UILabel alloc] initWithFrame:labelRect];<br>    label.text = log;<br>    label.textColor = [UIColor redColor];<br>    [self.view addSubview:label];<br>&#125;<br><br>//- (void) startTimer &#123;<br>//    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);<br>//    dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);<br>//    self.timer = timer;<br>//    dispatch_source_set_timer(timer, DISPATCH_TIME_NOW, 200 * NSEC_PER_SEC, 0 * NSEC_PER_SEC);<br>//<br>//    __weak NSString* weakMyState = myState;<br>//    __weak NSString* weakMyRoom = myRoom;<br>//    dispatch_source_set_event_handler(timer, ^&#123;<br>//<br>//        dispatch_<br>//<br>//        if([weakMyState isEqualToString:@&quot;init&quot;]) &#123;<br>//            NSLog(@&quot;%@&quot;,[NSThread currentThread]);<br>//            [[SignalClient getInstance] joinRoom:weakMyRoom];<br>//        &#125;else &#123;<br>//            [timer ]<br>//        &#125;<br>//    &#125;);<br>//    dispatch_resume(timer);<br>//&#125;<br><br>- (void)layoutSubviews &#123;<br>    CGRect bounds = self.view.bounds;<br>    if (remoteVideoSize.width &gt; 0 &amp;&amp; remoteVideoSize.height &gt; 0) &#123;<br>        // Aspect fill remote video into bounds.<br>        CGRect remoteVideoFrame =<br>        AVMakeRectWithAspectRatioInsideRect(remoteVideoSize, bounds);<br>        CGFloat scale = 1;<br>        if (remoteVideoFrame.size.width &gt; remoteVideoFrame.size.height) &#123;<br>            // Scale by height.<br>            scale = bounds.size.height / remoteVideoFrame.size.height;<br>        &#125; else &#123;<br>            // Scale by width.<br>            scale = bounds.size.width / remoteVideoFrame.size.width;<br>        &#125;<br>        remoteVideoFrame.size.height *= scale;<br>        remoteVideoFrame.size.width *= scale;<br>        self.remoteVideoView.frame = remoteVideoFrame;<br>        self.remoteVideoView.center =<br>        CGPointMake(CGRectGetMidX(bounds), CGRectGetMidY(bounds));<br>    &#125; else &#123;<br>        self.remoteVideoView.frame = bounds;<br>    &#125;<br><br>&#125;<br><br>- (void) leaveRoom:(UIButton*) sender &#123;<br>   <br>    [self willMoveToParentViewController:nil];<br>    [self.view removeFromSuperview];<br>    [self removeFromParentViewController];<br>    <br>    if (!sigclient) &#123;<br>        sigclient = [SignalClient getInstance];<br>    &#125;<br>    <br>    if(![myState isEqualToString:@&quot;leaved&quot;])&#123;<br>        [sigclient leaveRoom: myRoom];<br>    &#125;<br>    <br>    if(peerConnection)&#123;<br>        [peerConnection close];<br>        peerConnection = nil;<br>    &#125;<br>    <br>    NSLog(@&quot;leave room(%@)&quot;, myRoom);<br>    [self addLogToScreen: @&quot;leave room(%@)&quot;, myRoom];<br>&#125;<br><br>#pragma mark - SignalEventNotify<br><br>- (void) leaved:(NSString *)room &#123;<br>    NSLog(@&quot;leaved room(%@) notify!&quot;, room);<br>    [self addLogToScreen: @&quot;leaved room(%@) notify!&quot;, room];<br>&#125;<br><br>- (void) joined:(NSString *)room &#123;<br>    NSLog(@&quot;joined room(%@) notify!&quot;, room);<br>    [self addLogToScreen: @&quot;joined room(%@) notify!&quot;, room];<br>    <br>    myState = @&quot;joined&quot;;<br>    <br>    //è¿™é‡Œåº”è¯¥åˆ›å»ºPeerConnection<br>    if (!peerConnection) &#123;<br>        peerConnection = [self createPeerConnection];<br>    &#125;<br>&#125;<br><br>- (void) otherjoin:(NSString *)room User:(NSString *)uid &#123;<br>    NSLog(@&quot;other user(%@) has been joined into room(%@) notify!&quot;, uid, room);<br>    [self addLogToScreen: @&quot;other user(%@) has been joined into room(%@) notify!&quot;, uid, room];<br>    if([myState isEqualToString:@&quot;joined_unbind&quot;])&#123;<br>        if (!peerConnection) &#123;<br>            peerConnection = [self createPeerConnection];<br>        &#125;<br>    &#125;<br>    <br>    myState =@&quot;joined_conn&quot;;<br>    //è°ƒç”¨callï¼Œ è¿›è¡Œåª’ä½“åå•†<br>    [self doStartCall];<br>    <br>&#125;<br><br>- (void) full:(NSString *)room &#123;<br>    NSLog(@&quot;the room(%@) is full notify!&quot;, room);<br>    [self addLogToScreen: @&quot;the room(%@) is full notify!&quot;, room];<br>    myState = @&quot;leaved&quot;;<br>    <br>    if(peerConnection) &#123;<br>        [peerConnection close];<br>        peerConnection = nil;<br>    &#125;<br>    <br>    //å¼¹å‡ºæé†’æ·»åŠ æˆåŠŸ<br>    MBProgressHUD *hud= [[MBProgressHUD alloc] initWithView:self.view];<br>    [hud setRemoveFromSuperViewOnHide:YES];<br>    hud.label.text = @&quot;æˆ¿é—´å·²æ»¡&quot;;<br>    UIView* view = [[UIView alloc] initWithFrame:CGRectMake(0,0, 50, 50)];<br>    [hud setCustomView:view];<br>    [hud setMode:MBProgressHUDModeCustomView];<br>    [self.view addSubview:hud];<br>    [hud showAnimated:YES];<br>    [hud hideAnimated:YES afterDelay:1.0]; //è®¾ç½®1ç§’é’Ÿåè‡ªåŠ¨æ¶ˆå¤±<br>    <br>    if(self.localVideoView) &#123;<br>        //[self.localVideoView removeFromSuperview];<br>        //self.localVideoView = nil;<br>    &#125;<br>    <br>    if(self.remoteVideoView) &#123;<br>        //[self.localVideoView removeFromSuperview];<br>        //self.remoteVideoView = nil;<br>    &#125;<br>    <br>    if(capture) &#123;<br>        [capture stopCapture];<br>        capture = nil;<br>    &#125;<br>    <br>    if(factory) &#123;<br>        factory = nil;<br>    &#125;<br>&#125;<br><br>- (void) byeFrom:(NSString *)room User:(NSString *)uid &#123;<br>    NSLog(@&quot;the user(%@) has leaved from room(%@) notify!&quot;, uid, room);<br>    [self addLogToScreen: @&quot;the user(%@) has leaved from room(%@) notify!&quot;, uid, room];<br>    myState = @&quot;joined_unbind&quot;;<br>    <br>    [peerConnection close];<br>    peerConnection = nil;<br>    <br>&#125;<br><br>- (void)answer:(NSString *)room message:(NSDictionary *)dict &#123;<br>    NSLog(@&quot;have received a answer message %@&quot;, dict);<br>    <br>    NSString *remoteAnswerSdp = dict[@&quot;sdp&quot;];<br>    RTCSessionDescription *remoteSdp = [[RTCSessionDescription alloc]<br>                                           initWithType:RTCSdpTypeAnswer<br>                                                    sdp: remoteAnswerSdp];<br>    [peerConnection setRemoteDescription:remoteSdp<br>                       completionHandler:^(NSError * _Nullable error) &#123;<br>        if(!error)&#123;<br>            NSLog(@&quot;Success to set remote Answer SDP&quot;);<br>        &#125;else&#123;<br>            NSLog(@&quot;Failure to set remote Answer SDP, err=%@&quot;, error);<br>        &#125;<br>    &#125;];<br>&#125;<br><br>- (void) setLocalAnswer: (RTCPeerConnection*)pc withSdp: (RTCSessionDescription*)sdp &#123;<br>    <br>    [pc setLocalDescription:sdp completionHandler:^(NSError * _Nullable error) &#123;<br>        if(!error)&#123;<br>            NSLog(@&quot;Successed to set local answer!&quot;);<br>        &#125;else &#123;<br>            NSLog(@&quot;Failed to set local answer, err=%@&quot;, error);<br>        &#125;<br>    &#125;];<br>    <br>    __weak NSString* weakMyRoom = myRoom;<br>    dispatch_async(dispatch_get_main_queue(), ^&#123;<br>        <br>        //send answer sdp<br>        NSDictionary* dict = [[NSDictionary alloc] initWithObjects:@[@&quot;answer&quot;, sdp.sdp]<br>                                                           forKeys: @[@&quot;type&quot;, @&quot;sdp&quot;]];<br>        <br>        [[SignalClient getInstance] sendMessage: weakMyRoom withMsg:dict];<br>    &#125;);<br>&#125;<br><br>- (void) getAnswer:(RTCPeerConnection*) pc &#123;<br>    <br>    NSLog(@&quot;Success to set remote offer SDP&quot;);<br>    <br>    [pc answerForConstraints:[self defaultPeerConnContraints]<br>                           completionHandler:^(RTCSessionDescription * _Nullable sdp, NSError * _Nullable error) &#123;<br>                               if(!error)&#123;<br>                                   NSLog(@&quot;Success to create local answer sdp!&quot;);<br>                                   __weak RTCPeerConnection* weakPeerConn = pc;<br>                                   [self setLocalAnswer:weakPeerConn withSdp:sdp];<br>                                   <br>                               &#125;else&#123;<br>                                   NSLog(@&quot;Failure to create local answer sdp!&quot;);<br>                               &#125;<br>                           &#125;];<br>&#125;<br><br>- (void) offer:(NSString *)room message:(NSDictionary *)dict &#123;<br>    NSLog(@&quot;have received a offer message %@&quot;, dict);<br>    <br>    NSString* remoteOfferSdp = dict[@&quot;sdp&quot;];<br>    RTCSessionDescription* remoteSdp = [[RTCSessionDescription alloc]<br>                                        initWithType:RTCSdpTypeOffer<br>                                        sdp: remoteOfferSdp];<br>    if(!peerConnection)&#123;<br>        peerConnection = [self createPeerConnection];<br>    &#125;<br>    <br>     __weak RTCPeerConnection* weakPeerConnection = peerConnection;<br>    [weakPeerConnection setRemoteDescription:remoteSdp completionHandler:^(NSError * _Nullable error) &#123;<br>        if(!error)&#123;<br>            [self getAnswer: weakPeerConnection];<br>        &#125;else&#123;<br>            NSLog(@&quot;Failure to set remote offer SDP, err=%@&quot;, error);<br>        &#125;<br>    &#125;];<br>&#125;<br><br>- (void)candidate:(NSString *)room message:(NSDictionary *)dict &#123;<br>    NSLog(@&quot;have received a message %@&quot;, dict);<br>    <br>    NSString* desc = dict[@&quot;sdp&quot;];<br>    NSString* sdpMLineIndex = dict[@&quot;label&quot;];<br>    int index = [sdpMLineIndex intValue];<br>    NSString* sdpMid = dict[@&quot;id&quot;];<br>    <br>    <br>    RTCIceCandidate *candidate = [[RTCIceCandidate alloc] initWithSdp:desc<br>                                                        sdpMLineIndex:index<br>                                                               sdpMid:sdpMid];;<br>    [peerConnection addIceCandidate:candidate];<br>&#125;<br><br>- (void)connected &#123;<br>    [[SignalClient getInstance]  joinRoom: myRoom];<br>    [self addLogToScreen: @&quot;socket connect success!&quot;];<br>    [self addLogToScreen: @&quot;joinRoom: %@&quot;, myRoom];<br>    <br><br>&#125;<br><br>- (void)connect_error &#123;<br>    //todo: notfiy UI<br>    [self addLogToScreen: @&quot;socket connect_error!&quot;];<br>&#125;<br><br>- (void)connect_timeout &#123;<br>    //todo: notfiy UI<br>    [self addLogToScreen: @&quot;socket connect_timeout!&quot;];<br>&#125;<br><br>- (void) reconnectAttempt&#123;<br>    [self addLogToScreen: @&quot;socket reconnectAttempt!&quot;];<br>&#125;<br>#pragma mark RTCPeerConnectionDelegate<br><br>/** Called when the SignalingState changed. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection<br>didChangeSignalingState:(RTCSignalingState)stateChanged&#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>&#125;<br><br>/** Called when media is received on a new stream from remote peer. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection didAddStream:(RTCMediaStream *)stream&#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>&#125;<br><br>/** Called when a remote peer closes a stream.<br> *  This is not called when RTCSdpSemanticsUnifiedPlan is specified.<br> */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection didRemoveStream:(RTCMediaStream *)stream&#123;<br>     NSLog(@&quot;%s&quot;,__func__);<br>&#125;<br><br>/** Called when negotiation is needed, for example ICE has restarted. */<br>- (void)peerConnectionShouldNegotiate:(RTCPeerConnection *)peerConnection &#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>&#125;<br><br>/** Called any time the IceConnectionState changes. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection<br>didChangeIceConnectionState:(RTCIceConnectionState)newState&#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>&#125;<br><br>/** Called any time the IceGatheringState changes. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection<br>didChangeIceGatheringState:(RTCIceGatheringState)newState&#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>&#125;<br><br>/** New ice candidate has been found. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection<br>didGenerateIceCandidate:(RTCIceCandidate *)candidate&#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>    <br>    NSString* weakMyRoom = myRoom;<br>    dispatch_async(dispatch_get_main_queue(), ^&#123;<br>    <br>        NSDictionary* dict = [[NSDictionary alloc] initWithObjects:@[@&quot;candidate&quot;,<br>                                                                [NSString stringWithFormat:@&quot;%d&quot;, candidate.sdpMLineIndex],<br>                                                                candidate.sdpMid,<br>                                                                candidate.sdp]<br>                                                           forKeys:@[@&quot;type&quot;, @&quot;label&quot;, @&quot;id&quot;, @&quot;candidate&quot;]];<br>    <br>        [[SignalClient getInstance] sendMessage: weakMyRoom<br>                                    withMsg:dict];<br>    &#125;);<br>&#125;<br><br>/** Called when a group of local Ice candidates have been removed. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection<br>didRemoveIceCandidates:(NSArray&lt;RTCIceCandidate *&gt; *)candidates &#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>&#125;<br><br>/** New data channel has been opened. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection<br>    didOpenDataChannel:(RTCDataChannel *)dataChannel &#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>&#125;<br><br>/** Called when a receiver and its track are created. */<br>- (void)peerConnection:(RTCPeerConnection *)peerConnection<br>        didAddReceiver:(RTCRtpReceiver *)rtpReceiver<br>               streams:(NSArray&lt;RTCMediaStream *&gt; *)mediaStreams &#123;<br>    NSLog(@&quot;%s&quot;,__func__);<br>    <br>    RTCMediaStreamTrack* track = rtpReceiver.track;<br>    if([track.kind isEqualToString:kRTCMediaStreamTrackKindVideo])&#123;<br>        if(!self.remoteVideoView)&#123;<br>            NSLog(@&quot;error:remoteVideoView have not been created!&quot;);<br>            return;<br>        &#125;<br>        <br>        remoteVideoTrack = (RTCVideoTrack*)track;<br>        <br>        //dispatch_async(dispatch_get_main_queue(), ^&#123;<br><br>            [remoteVideoTrack addRenderer: self.remoteVideoView];<br>        //&#125;);<br>        //[remoteVideoTrack setIsEnabled:true];<br>        <br>        //[self.view addSubview:self.remoteVideoView];<br>    &#125;<br>    <br>&#125;<br><br>#pragma mark webrtc<br><br><br>- (RTCMediaConstraints*) defaultPeerConnContraints &#123;<br>    RTCMediaConstraints* mediaConstraints =<br>    [[RTCMediaConstraints alloc] initWithMandatoryConstraints:@&#123;<br>                                                                kRTCMediaConstraintsOfferToReceiveAudio:kRTCMediaConstraintsValueTrue,<br>                                                                kRTCMediaConstraintsOfferToReceiveVideo:kRTCMediaConstraintsValueTrue<br>                                                                &#125;<br>                                          optionalConstraints:@&#123; @&quot;DtlsSrtpKeyAgreement&quot; : @&quot;true&quot; &#125;];<br>    return mediaConstraints;<br>&#125;<br><br><br>- (void)captureLocalMedia &#123;<br>    NSDictionary* mandatoryConstraints = @&#123;&#125;;<br>    RTCMediaConstraints* constraints =<br>    [[RTCMediaConstraints alloc] initWithMandatoryConstraints:mandatoryConstraints<br>                                          optionalConstraints:nil];<br>    <br>    RTCAudioSource* audioSource = [factory audioSourceWithConstraints: constraints];<br>    //self.audioTrack = [factory audioTrackWithTrackId:@&quot;ARDAMSa0&quot;];<br>    audioTrack = [factory audioTrackWithSource:audioSource trackId:@&quot;ADRAMSa0&quot;];<br>    <br>    NSArray&lt;AVCaptureDevice* &gt;* captureDevices = [RTCCameraVideoCapturer captureDevices];<br>    AVCaptureDevicePosition position = AVCaptureDevicePositionFront;<br>    AVCaptureDevice* device = captureDevices[0];<br>    for (AVCaptureDevice* obj in captureDevices) &#123;<br>        if (obj.position == position) &#123;<br>            device = obj;<br>            break;<br>        &#125;<br>    &#125;<br>    <br>    //æ£€æµ‹æ‘„åƒå¤´æƒé™<br>    AVAuthorizationStatus authStatus = [AVCaptureDevice authorizationStatusForMediaType:AVMediaTypeVideo];<br>    if(authStatus == AVAuthorizationStatusRestricted || authStatus == AVAuthorizationStatusDenied) &#123;<br>        NSLog(@&quot;ç›¸æœºè®¿é—®å—é™&quot;);<br>        return;<br>    &#125;<br>    <br>    if (device) &#123;<br>        RTCVideoSource* videoSource = [factory videoSource];<br>        capture = [[RTCCameraVideoCapturer alloc] initWithDelegate:videoSource];<br>        AVCaptureDeviceFormat* format = [[RTCCameraVideoCapturer supportedFormatsForDevice:device] lastObject];<br>        CGFloat fps = [[format videoSupportedFrameRateRanges] firstObject].maxFrameRate;<br>        videoTrack = [factory videoTrackWithSource:videoSource trackId:@&quot;ARDAMSv0&quot;];<br>        self.localVideoView.captureSession = capture.captureSession;<br>        [capture startCaptureWithDevice:device<br>                                     format:format<br>                                        fps:fps];<br>        <br>    &#125;<br>&#125;<br><br>//åˆå§‹åŒ–STUN Server ï¼ˆICE Serverï¼‰<br>- (RTCIceServer *)defaultSTUNServer &#123;<br>    return [[RTCIceServer alloc] initWithURLStrings:@[RTCSTUNServerURL]<br>                                           username:@&quot;carrot&quot;<br>                                         credential:@&quot;123456&quot;];<br>&#125;<br><br>- (void)createPeerConnectionFactory &#123;<br>    //è®¾ç½®SSLä¼ è¾“<br>    [RTCPeerConnectionFactory initialize];<br>    <br>    //å¦‚æœç‚¹å¯¹ç‚¹å·¥å‚ä¸ºç©º<br>    if (!factory)<br>    &#123;<br>        RTCDefaultVideoDecoderFactory* decoderFactory = [[RTCDefaultVideoDecoderFactory alloc] init];<br>        RTCDefaultVideoEncoderFactory* encoderFactory = [[RTCDefaultVideoEncoderFactory alloc] init];<br>        NSArray* codecs = [encoderFactory supportedCodecs];<br>        [encoderFactory setPreferredCodec:codecs[2]];<br>        <br>        factory = [[RTCPeerConnectionFactory alloc] initWithEncoderFactory: encoderFactory<br>                                                            decoderFactory: decoderFactory];<br>    &#125;<br>&#125;<br><br>- (RTCPeerConnection *)createPeerConnection &#123;<br>    //å¾—åˆ°ICEServer<br>    if (!ICEServers) &#123;<br>        ICEServers = [NSMutableArray array];<br>        [ICEServers addObject:[self defaultSTUNServer]];<br>    &#125;<br><br>    //ç”¨å·¥å‚æ¥åˆ›å»ºè¿æ¥<br>    RTCConfiguration* configuration = [[RTCConfiguration alloc] init];<br>    [configuration setIceServers:ICEServers];<br>    RTCPeerConnection* conn = [factory<br>                                     peerConnectionWithConfiguration:configuration<br>                                                         constraints:[self defaultPeerConnContraints]<br>                                                            delegate:self];<br>    <br>    NSArray&lt;NSString*&gt;* mediaStreamLabels = @[@&quot;ARDAMS&quot;];<br>    [conn addTrack:videoTrack streamIds:mediaStreamLabels];<br>    [conn addTrack:audioTrack streamIds:mediaStreamLabels];<br><br>    return conn;<br>&#125;<br><br>- (void)setLocalOffer:(RTCPeerConnection*)pc withSdp:(RTCSessionDescription*) sdp&#123;<br>    <br>    [pc setLocalDescription:sdp completionHandler:^(NSError * _Nullable error) &#123;<br>        if (!error) &#123;<br>            NSLog(@&quot;Successed to set local offer sdp!&quot;);<br>        &#125;else&#123;<br>            NSLog(@&quot;Failed to set local offer sdp, err=%@&quot;, error);<br>        &#125;<br>    &#125;];<br>    <br>    __weak NSString* weakMyRoom = myRoom;<br>    dispatch_async(dispatch_get_main_queue(), ^&#123;<br>        <br>        NSDictionary* dict = [[NSDictionary alloc] initWithObjects:@[@&quot;offer&quot;, sdp.sdp]<br>                                                           forKeys: @[@&quot;type&quot;, @&quot;sdp&quot;]];<br>        <br>        [[SignalClient getInstance] sendMessage: weakMyRoom<br>                                        withMsg: dict];<br>    &#125;);<br>&#125;<br><br>- (void)doStartCall &#123;<br>    NSLog(@&quot;Start Call, Wait ...&quot;);<br>    [self addLogToScreen: @&quot;Start Call, Wait ...&quot;];<br>    if (!peerConnection) &#123;<br>        peerConnection = [self createPeerConnection];<br>    &#125;<br>    <br>    [peerConnection offerForConstraints:[self defaultPeerConnContraints]<br>                      completionHandler:^(RTCSessionDescription * _Nullable sdp, NSError * _Nullable error) &#123;<br>                          if(error)&#123;<br>                              NSLog(@&quot;Failed to create offer SDP, err=%@&quot;, error);<br>                          &#125; else &#123;<br>                              __weak RTCPeerConnection* weakPeerConnction = self-&gt;peerConnection;<br>                              [self setLocalOffer: weakPeerConnction withSdp: sdp];<br>                          &#125;<br>                      &#125;];<br>&#125;<br><br>#pragma mark - RTCEAGLVideoViewDelegate<br>- (void)videoView:(RTCEAGLVideoView*)videoView didChangeVideoSize:(CGSize)size &#123;<br>    if (videoView == self.remoteVideoView) &#123;<br>        remoteVideoSize = size;<br>    &#125;<br>    [self layoutSubviews];<br>&#125;<br><br>@end<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day12-coTurnæœåŠ¡å™¨æ­å»º</title>
    <link href="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/"/>
    <url>/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€é˜¿é‡Œäº‘æœåŠ¡å™¨ç¯å¢ƒæ­å»º"><a href="#ä¸€ã€é˜¿é‡Œäº‘æœåŠ¡å™¨ç¯å¢ƒæ­å»º" class="headerlink" title="ä¸€ã€é˜¿é‡Œäº‘æœåŠ¡å™¨ç¯å¢ƒæ­å»º"></a>ä¸€ã€é˜¿é‡Œäº‘æœåŠ¡å™¨ç¯å¢ƒæ­å»º</h1><p><strong>å‰è¨€ï¼š</strong></p><p><strong>æ¶‰åŠWebRTCå†…å®¹ï¼Œç»•ä¸å¼€æ­å»ºICEæœåŠ¡å™¨ï¼Œç½‘ä¸Šæœç´¢æ•™ç¨‹æ— æ•°ï¼Œæ²¡æœ‰ä¸€ä¸ªèƒ½ä»å¤´åˆ°å°¾é¡ºåˆ©æ­å»ºæˆåŠŸï¼Œç½‘é¡µå¼€äº†æ— æ•°ä¸ªï¼Œè¿›åº¦å´åŸåœ°è¸æ­¥ï¼Œæ¬²å“­æ— æ³ªã€‚è·Ÿç€ç½‘ä¸Šçš„æ•™ç¨‹ï¼Œå¤§å¤šä¼šå¡åœ¨turnserver.confé…ç½®æ–‡ä»¶çš„ç¼–è¾‘ä¸Šï¼Œé”™è¯¯çš„é…ç½®æ–‡ä»¶å¾€å¾€ä¼šå¯¼è‡´æœåŠ¡å™¨å¼€å¯å¤±è´¥ã€‚</strong></p><p><strong>æ€»ç»“ä¸€ä»½æœåŠ¡å™¨å®‰è£…æ­¥éª¤ï¼Œæ•…åœ¨æ­¤ç•™æ¡£ï¼Œä»¥åˆ©åäººï¼</strong></p><p><strong>å¦‚æœä½ å¡åœ¨é…ç½®æ–‡ä»¶è¿™ä¸€å—ï¼Œè¯·ç›´æ¥è·³åˆ°ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå¦‚æœä½ è¿›åº¦é¢‡æµ…ï¼Œç›´æ¥æŒ‰ç…§æˆ‘çš„æ­¥éª¤æ¥ä¸€éå§ï¼Œè®©ä½ æ„Ÿåˆ°æ— æ¯”ä¸æ»‘ã€‚</strong></p><p><strong>å¦å¤–ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æœ¬åœ°çš„è™šæ‹Ÿæœºä¸Šæ­å»ºcoturnæœåŠ¡å™¨æ˜¯è¡Œä¸é€šçš„ï¼Œå¿…é¡»è¦åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šæ­å»ºã€‚</strong></p><h4 id="1ã€å‡†å¤‡æ­¥éª¤"><a href="#1ã€å‡†å¤‡æ­¥éª¤" class="headerlink" title="1ã€å‡†å¤‡æ­¥éª¤"></a>1ã€å‡†å¤‡æ­¥éª¤</h4><p>å‡†å¤‡ä¸€å°é˜¿é‡Œäº‘æœåŠ¡å™¨ ç³»ç»Ÿä¸º linux centos7.4 æ‰“å¼€3478ç«¯å£ï¼Œä»¥åŠä¸€äº›å¿…è¦çš„ç«¯å£</p><p>é˜¿é‡Œäº‘æœåŠ¡å™¨å…¬ç½‘åœ°å€ï¼š<code>120.77.170.59</code>  å†…ç½‘åœ°å€ï¼š<code>172.30.124.174</code></p><p>ä¸»æœºåç§°éšä¾¿å–ï¼Œä¸»æœºæ˜¯å…¬ç½‘ipåœ°å€ï¼Œç«¯å£éšä¾¿é€‰æ‹©ï¼Œä½†è¦åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°å¼€æ”¾è¯¥ç«¯å£ï¼Œå¦‚æœæ²¡æœ‰ç™»é™†ä¸Šï¼Œå°±å»ç½‘é¡µç«¯çš„é˜¿é‡Œäº‘æœåŠ¡å™¨å…ˆç™»å½•ä¸€éã€‚ï¼‰</p><p>é¦–å…ˆå®‰è£…å„ç§ä¾èµ–å’Œè½¯ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><pre><code class="hljs javascript">yum install git<br>yum install gcc<br>yum install gcc-c++<br>yum install openssl<br>yum install openssl-devel<br>yum install libevent-devel<br></code></pre></td></tr></table></figure><p>é‡åˆ°çš„æ‰€æœ‰é€‰é¡¹éƒ½é€‰yï¼Œä¸€è·¯yä¸‹å»ï¼Œ</p><p>å®‰è£…å®Œæ¯•å</p><h3 id="2ã€æ‰‹åŠ¨ä¸‹è½½å¹¶å®‰è£…-libevent2"><a href="#2ã€æ‰‹åŠ¨ä¸‹è½½å¹¶å®‰è£…-libevent2" class="headerlink" title="2ã€æ‰‹åŠ¨ä¸‹è½½å¹¶å®‰è£… libevent2"></a>2ã€æ‰‹åŠ¨ä¸‹è½½å¹¶å®‰è£… <code>libevent2</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://github.com/downloads/libevent/libevent/libevent-2.0.21-stable.tar.gz<br>tar zxvf libevent-2.0.21-stable.tar.gz<br>cd libevent-2.0.21-stable &amp;&amp; ./configure<br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure><h2 id="äºŒã€CoturnæœåŠ¡å™¨æ­å»ºæ­¥éª¤"><a href="#äºŒã€CoturnæœåŠ¡å™¨æ­å»ºæ­¥éª¤" class="headerlink" title="äºŒã€CoturnæœåŠ¡å™¨æ­å»ºæ­¥éª¤"></a>äºŒã€CoturnæœåŠ¡å™¨æ­å»ºæ­¥éª¤</h2><h3 id="1ã€ä¸‹è½½å¹¶å®‰è£…-coturn"><a href="#1ã€ä¸‹è½½å¹¶å®‰è£…-coturn" class="headerlink" title="1ã€ä¸‹è½½å¹¶å®‰è£… coturn"></a>1ã€ä¸‹è½½å¹¶å®‰è£… coturn</h3><p>å‡†å¤‡å®‰è£…coturnåŒ…ã€‚æ³¨æ„ï¼Œä¸è¦ç›´æ¥git clone coturnï¼Œä¼šå‡ºç°ç¼–è¯‘é”™è¯¯</p><p>æ­¤å¤„å®‰è£…ç¨³å®šçš„ç‰ˆæœ¬ï¼Œä¸‹è½½å‹ç¼©åŒ…</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">wget <span class="hljs-attr">https</span>:<span class="hljs-comment">//github.com/coturn/coturn/archive/4.5.1.1.tar.gz</span><br></code></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œè§£å‹ï¼Œç¼–è¯‘ï¼Œä¾æ¬¡æ‰§è¡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">tar -zxvf <span class="hljs-number">4.5</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span>.<span class="hljs-property">tar</span>.<span class="hljs-property">gz</span><br>cd coturn-<span class="hljs-number">4.5</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span><br>./configure<br>make<br>make install<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœcd coturn-4.5.1.1æ‰¾ä¸åˆ°æ–‡ä»¶å¤¹çš„è¯ï¼Œä¸€èˆ¬å®‰è£…åŒ…çš„é»˜è®¤å®‰è£…ä½ç½®åœ¨é˜¿é‡Œäº‘çš„&#x2F;usr&#x2F;localç›®å½•ä¸‹ï¼Œåˆ‡æ¢åˆ°è¯¥ç›®å½•ä¸‹ç»§ç»­æ‰§è¡Œæ“ä½œå³å¯</p><p>å¦‚æœæˆåŠŸäº†ï¼Œå¯ä»¥é€šè¿‡which turnserveréªŒè¯ã€‚å¦‚æœå‡ºç°è·¯å¾„å³ä¸ºæˆåŠŸï¼Œé»˜è®¤è·¯å¾„ä¸º</p><img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/8c0d35cf0a4ae8fe93cddd31d0121f68bf9d1eda.png@876w_99h_progressive.webp" class="" title="img">turnserveræ‰€åœ¨çš„é»˜è®¤è·¯å¾„ï¼Œä¹‹ååˆ°è¯¥è·¯å¾„ä¸‹å¼€å¯æœåŠ¡<h3 id="2ã€é…ç½®æ–‡ä»¶"><a href="#2ã€é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€é…ç½®æ–‡ä»¶"></a>2ã€é…ç½®æ–‡ä»¶</h3><p>ç„¶åè¿›å…¥æ–‡ä»¶å¤¹ï¼š</p><p>cd &#x2F;usr&#x2F;local&#x2F;etc&#x2F;</p><p>è¾“å…¥å‘½ä»¤ll</p><p>ä¼šçœ‹åˆ°ä¸€ä¸ªå«åš turnserver.conf.defaultçš„é…ç½®æ–‡ä»¶ã€‚</p><p>é€šè¿‡å‘½ä»¤å°†å®ƒå¤‡ä»½ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">cp turnserver.<span class="hljs-property">conf</span>.<span class="hljs-property">default</span> turnserver.<span class="hljs-property">conf</span><br></code></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡å‘½ä»¤åœ¨å½“å‰æ–‡ä»¶å¤¹ç”Ÿæˆç­¾åè¯ä¹¦ï¼ˆæ­¤æ­¥ä¼¼ä¹å¯ä»¥ä¸ç”¨ï¼Œå› ä¸ºåœ¨é…ç½®æ–‡ä»¶ä¸­å¹¶æœªç”¨åˆ°ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥åšä¸€ä¸‹ï¼Œä»¥é˜²ä¸‡ä¸€ï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">openssl req -x509 -newkey <span class="hljs-attr">rsa</span>:<span class="hljs-number">2048</span> -keyout /usr/local/etc/turn_server_pkey.<span class="hljs-property">pem</span> -out /usr/local/etc/turn_server_cert.<span class="hljs-property">pem</span> -days <span class="hljs-number">99999</span> -nodes<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆè¯ä¹¦çš„æ—¶å€™ä¼šè®©å¡«å†™å›½å®¶åœ°åŒºç­‰ä¸€äº›ä¿¡æ¯ï¼Œå¯ä»¥éšä¾¿å¡«å†™ï¼Œ</p><p>ç¬¬ä¸€ä¸ªcountry nameå¡«å†™cn</p><p>state or province å¡«å†™sichuang</p><p>Locality nameå¡«å†™chengdu</p><p>å‰©ä¸‹çš„éšä¾¿å¡«ï¼Œå¯ä»¥éƒ½å¡«noï¼Œé‚®ç®±éšä¾¿å¡«ä¸€ä¸ª</p><p>å®Œæˆåï¼Œå¯ä»¥åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°turn_server_cert.pemå’Œturn_server_pkey.pemä¸¤ä¸ªæ–‡ä»¶ã€‚</p><p>ç„¶ååœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé€šè¿‡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶turnuserdb.confç”¨äºå­˜å‚¨ç”¨æˆ·åå’Œä¿¡æ¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">cp turnserver.<span class="hljs-property">conf</span>.<span class="hljs-property">default</span> turnuserdb.<span class="hljs-property">conf</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶æ•´ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶æ„æˆä¸ºä¸‹å›¾æ‰€ç¤º</p><img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/4ae187ebbe5cac79057e791909a7afb8157bac3d.png@857w_273h_progressive.webp" class="" title="img">æ–‡ä»¶å¤¹çš„å†…å®¹æ„æˆ<h3 id="3ã€ç¼–è¾‘æ–‡ä»¶"><a href="#3ã€ç¼–è¾‘æ–‡ä»¶" class="headerlink" title="3ã€ç¼–è¾‘æ–‡ä»¶"></a>3ã€ç¼–è¾‘æ–‡ä»¶</h3><p>é¦–å…ˆï¼Œipconfigçœ‹ä¸€ä¸‹ç½‘å¡ä¿¡æ¯ï¼Œæˆ‘çš„é˜¿é‡Œäº‘ä¸»æœºç½‘å¡æ˜¯eth0ï¼Œè®°ä½ç½‘å¡ç±»å‹ã€‚ï¼ˆéƒ¨åˆ†æ•™ç¨‹çš„é…ç½®æ–‡ä»¶ä¸­è¦å¡«å†™ç½‘å¡ä¿¡æ¯ï¼Œæœ¬æ–‡æ€»ç»“çš„é…ç½®æ–‡ä»¶ä¸­å¹¶ä¸éœ€è¦å¡«å†™ç½‘å¡ä¿¡æ¯ï¼‰</p><p>ç„¶åï¼Œç”¨å‘½ä»¤ç”Ÿæˆè´¦å·å¯†ç çš„md5ç ï¼Œæ ‡çº¢çš„éƒ¨åˆ†åˆ†åˆ«å¯¹åº”ç”¨æˆ·å åœ°åŒº å¯†ç  ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">turnadmin -k -u carrot -p <span class="hljs-number">123456</span> -r carrtRealm<br></code></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡Œåä¼šç”Ÿæˆä¸€æ®µmd5ç ï¼Œè®°å¾—å¤åˆ¶ä¸‹æ¥ï¼</p><p>ç„¶åï¼Œåœ¨finalshellè½¯ä»¶çš„ä¸‹æ–¹ï¼Œä¾æ¬¡é€‰æ‹©è·¯å¾„usr&#x2F;local&#x2F;etcï¼Œå¯ä»¥çœ‹åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸­å·²ç»å­˜åœ¨å¦‚ä¸‹æ–‡ä»¶ã€‚ç›´æ¥åŒå‡»æ–‡ä»¶å°±å¯ä»¥æ‰“å¼€è¿›è¡Œç¼–è¾‘</p><img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/eb74eeb8f59d606cb05e5380a310c6690a5746d1.png@942w_255h_progressive.webp" class="" title="img">finalshellç•Œé¢<p>é¦–å…ˆæˆ‘ä»¬åŒå‡»turnuserdb.confæ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å¡«å…¥ç”¨æˆ·åå’Œåˆšæ‰ç”Ÿæˆçš„md5ç å¹¶ä¿å­˜ã€‚</p><img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/e0dded2a03b462b29236fa89e0511df4382246b2.png@909w_303h_progressive.webp" class="" title="img"><p>ç„¶ååˆ°äº†æœ€é‡è¦çš„ä¸€æ­¥ï¼Œç½‘ä¸ŠæŸ¥æ‰¾çš„å¤§éƒ¨åˆ†æ•™ç¨‹éƒ½æœ‰é”™è¯¯ï¼Œç»è¿‡æ€»ç»“ï¼ŒæŒ‰ç…§å¦‚ä¸‹çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œæ‰èƒ½çœŸæ­£å¼€å¯æœåŠ¡å¹¶ä¸æŠ¥é”™ï¼</p><p>æˆ‘ä»¬å¯¹é…ç½®æ–‡ä»¶turnserver.confè¿›è¡Œç¼–è¾‘ï¼ŒåŒå‡»æ‰“å¼€æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹çš„é…ç½®ä¿¡æ¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript">#ä¸­ç»§æœåŠ¡å™¨ç›‘å¬çš„<span class="hljs-variable constant_">IP</span>åœ°å€ï¼Œ<span class="hljs-variable constant_">NAT</span>ç¯å¢ƒä¸‹ç›´æ¥å†™ç§ç½‘<span class="hljs-variable constant_">IP</span>åœ°å€ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª<span class="hljs-variable constant_">IP</span><br>listening-ip=<span class="hljs-number">172.30</span><span class="hljs-number">.124</span><span class="hljs-number">.174</span><br>#ä¸­ç»§æœåŠ¡å™¨è½¬å‘åœ°å€(æœ¬åœ°<span class="hljs-variable constant_">IP</span>åœ°å€å°†ç”¨äºä¼ é€’æ•°æ®åŒ…çš„ç»™æ¯ä¸ªç«¯)ï¼Œå’Œç›‘å¬åœ°å€ä¸€æ ·<br>#relay-ip=<span class="hljs-number">120.77</span><span class="hljs-number">.170</span><span class="hljs-number">.59</span><br>#å¤–éƒ¨<span class="hljs-variable constant_">IP</span>,<span class="hljs-variable constant_">NAT</span>ç¯å¢ƒä¸‹ç›´æ¥å†™ï¼šå…¬ç½‘<span class="hljs-variable constant_">IP</span>/ç§ç½‘<span class="hljs-variable constant_">IP</span><br>external-ip=<span class="hljs-number">120.77</span><span class="hljs-number">.170</span><span class="hljs-number">.59</span>/<span class="hljs-number">172.30</span><span class="hljs-number">.124</span><span class="hljs-number">.174</span><br>#cli-password=<span class="hljs-number">123456</span><br>#æ‰“å¼€fingerprintçš„æ³¨é‡Šï¼Œä½¿ç”¨é•¿æœŸè¯ä¹¦æœºåˆ¶ã€‚<br>fingerprint<br>#æ‰“å¼€å¯†ç éªŒè¯ï¼Œä½¿ç”¨çŸ­æœŸè¯ä¹¦æœºåˆ¶ã€‚<br>lt-cred-mech<br>#æœåŠ¡å™¨åç§°,ç”¨äº<span class="hljs-title class_">OAuth</span>è®¤è¯,é»˜è®¤å’Œrealmç›¸åŒ,ç›´æ¥å¡«å…¬ç½‘ip.éƒ¨åˆ†æµè§ˆå™¨æœ¬æ®µä¸è®¾å¯èƒ½ä¼šå¼•å‘corsé”™è¯¯ã€‚<br>server-name=<span class="hljs-number">120.77</span><span class="hljs-number">.170</span><span class="hljs-number">.59</span><br># <span class="hljs-variable constant_">TURN</span> <span class="hljs-variable constant_">REST</span> <span class="hljs-variable constant_">API</span>çš„é•¿æœŸå‡­è¯æœºåˆ¶èŒƒå›´ï¼ŒåŒæ ·è®¾ä¸ºip,åŒserver-name.<br>realm=<span class="hljs-number">120.77</span><span class="hljs-number">.170</span><span class="hljs-number">.59</span><br>#ç§»åŠ¨çš„<span class="hljs-title function_">ICE</span>(<span class="hljs-variable constant_">MICE</span>)çš„è§„èŒƒæ”¯æŒã€‚<br>mobility<br>#å¿«æ·çš„æ·»åŠ ç”¨æˆ·æ˜¯ä½¿ç”¨user=<span class="hljs-attr">XXX</span>:<span class="hljs-variable constant_">XXXX</span>çš„æ–¹å¼ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªã€‚/<span class="hljs-keyword">var</span>/db/turndbä¹Ÿå·¥ä½œï¼Œå¯ä»¥ä½¿ç”¨turnadminæ¥ç®¡ç†å…¶ä¸­ç”¨æˆ·ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªã€‚<br>user=<span class="hljs-attr">demo</span>:<span class="hljs-number">123456</span><br>#ä½ è®¾ç½®çš„å¯†ç ï¼ˆé˜²æ­¢æŠ¥é”™è­¦å‘Šï¼‰<br>cli-password=<span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜æ–‡ä»¶åï¼Œæˆ‘ä»¬åˆ°usr&#x2F;local&#x2F;binæ–‡ä»¶å¤¹ä¸‹ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å¼€å¯æœåŠ¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">cd /usr/local/bin<br>turnserver -v -r <span class="hljs-number">120.77</span><span class="hljs-number">.170</span><span class="hljs-number">.59</span>:<span class="hljs-number">3478</span> -a -o<br></code></pre></td></tr></table></figure><p>æˆ–è€…é€šè¿‡è¿™æ¡å‘½ä»¤å¼€å¯æœåŠ¡ï¼ˆä¸‹é¢è¿™æ¡å‘½ä»¤æŒ‡å®šäº†é…ç½®æ–‡ä»¶ï¼Œä¸Šé¢çš„å‘½ä»¤åº”è¯¥æ˜¯é»˜è®¤å®šä½åˆ°äº†æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶å¤„ï¼Œå¦‚æœæœ‰ä¿®æ”¹é…ç½®æ–‡ä»¶ä½ç½®çš„è¯ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œç»æµ‹è¯•ï¼Œè¿™ä¸¤æ¡å‘½ä»¤éƒ½å¯ä»¥æˆåŠŸæ‰“å¼€æœåŠ¡ï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">turnserver -v -r ä½ çš„å…¬ç½‘<span class="hljs-attr">ip</span>:<span class="hljs-number">3478</span> -a -o -c /usr/local/etc/turnserver.<span class="hljs-property">conf</span><br></code></pre></td></tr></table></figure><p>æœåŠ¡å¼€å¯åï¼Œçª—å£ä¸­å¦‚ä¸‹æ˜¾ç¤ºåˆ™ä»£è¡¨æœåŠ¡å¼€å¯æˆåŠŸ</p><img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/2332bef790237e7668d4b4d7d699f3950dd10a2f.png@942w_840h_progressive.webp" class="" title="img">å¦‚å›¾æ‰€ç¤ºè¡¨ç¤ºæœåŠ¡å¼€å¯æˆåŠŸ<p>ä¸Šå›¾ä¸­æœ‰ä¸€å¤„æ˜¾ç¤ºconfig errorçš„åœ°æ–¹ï¼Œä½†ç»è¿‡æµ‹è¯•ï¼Œè¿™ä¸ªerrorå¹¶ä¸å½±å“turnserveræœåŠ¡çš„æ­£ç¡®å¼€å¯ï¼Œå¦‚æœæƒ³è¦æ¶ˆå»è¿™æ¡errorä¿¡æ¯ï¼Œåªéœ€è¦åœ¨ä¸Šæ–‡çš„turnserver.confé…ç½®æ–‡ä»¶ä¸­åŠ ä¸Šå¦‚ä¸‹ä¸€å¥å³å¯å»æ‰erroræŠ¥é”™ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">cli-password=<span class="hljs-number">123456</span>ï¼ˆä½ è®¾ç½®çš„å¯†ç ï¼‰<br></code></pre></td></tr></table></figure><h3 id="4ã€æµ‹è¯•coturnæœåŠ¡"><a href="#4ã€æµ‹è¯•coturnæœåŠ¡" class="headerlink" title="4ã€æµ‹è¯•coturnæœåŠ¡"></a>4ã€æµ‹è¯•coturnæœåŠ¡</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦æµ‹è¯•å¼€å¯çš„turnserveræœåŠ¡å™¨èƒ½å¦èµ·ä½œç”¨ï¼Œæˆ‘ä»¬åˆ°æµ‹è¯•ç½‘å€ï¼š<a href="https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/">https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/</a></p><p>å»è¿›è¡Œæµ‹è¯•ï¼Œè¿™é‡Œå»ºè®®ç”¨ç«ç‹æµè§ˆå™¨è®¿é—®ç½‘å€è¿›è¡Œæµ‹è¯•ï¼Œchromeæµè§ˆå™¨å¯èƒ½ä¼šå‡ºé”™</p><p>æ‰“å¼€ç½‘å€åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¡µé¢ï¼ŒæŒ‰å›¾ä¸­å½¢å¼å¡«å†™ä¿¡æ¯</p><p>ç¬¬ä¸€æ æ˜¯ turn:å…¬ç½‘ip:ç«¯å£å· ï¼ˆç»æµ‹è¯•ï¼Œå¦‚æœä¸å¡«ç«¯å£å·ï¼Œé»˜è®¤æ˜¯3478ç«¯å£ï¼‰</p><p>ç¬¬äºŒæ æ˜¯ ä¹‹å‰è®¾ç½®çš„ç”¨æˆ·å</p><p>ç¬¬ä¸‰æ æ˜¯ ä¹‹å‰è®¾ç½®çš„å¯†ç </p><p>ç„¶åç‚¹å‡»Add Server</p><img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/ff5daf380e600ea6c627178aac259edcae264270.png@942w_674h_progressive.webp" class="" title="img">turnæœåŠ¡å™¨ä¿¡æ¯å¡«å†™<p>ç„¶åæˆ‘ä»¬ç‚¹å‡»é¡µé¢ä¸‹æ–¹çš„gather candidatesæŒ‰é’®</p><img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/96ce92b6a7153ccb8319c5756673a3c6694d9ec6.png@870w_422h_progressive.webp" class="" title="img">ç‚¹è¿™ä¸ªæŒ‰é’®<p>å¦‚æœæœåŠ¡å™¨é…ç½®æ­£ç¡®çš„è¯ï¼Œå¾ˆå¿«å°±å¯ä»¥çœ‹åˆ°è¿”å›çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/36a363f739d62917ad9e412c466a060292617c76.png@942w_255h_progressive.webp" class="" title="img">è¿”å›çš„ç»“æœ<img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/571f6ec806711b171c30dfff448c55d9b4cddc20.png@930w_368h_progressive.webp" class="" title="img"><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å…¬ç½‘ip</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæœ‰æˆ‘ä»¬æœåŠ¡å™¨æ‰€åœ¨çš„å…¬ç½‘åœ°å€120.77.170.59è¿”å›çš„ä¿¡æ¯ï¼Œé‚£å°±è¯´æ˜æˆ‘ä»¬çš„æœåŠ¡å™¨é…ç½®æˆåŠŸäº†ï¼Œè¿›è¡Œä¸¤å°è®¾å¤‡çš„ç›´è¿æ—¶ï¼Œèƒ½å¤Ÿé€šè¿‡turnæœåŠ¡å™¨è¿›è¡Œä¸­è½¬ã€‚å¦‚æœæ²¡æœ‰æˆ‘ä»¬å…¬ç½‘IPåœ°å€ï¼Œåªæ˜¾ç¤ºdoneï¼Œå¹¶ä¸ä»£è¡¨æˆåŠŸã€‚</p><p>å¦‚æœè¦æµ‹è¯•stunæœåŠ¡å™¨ï¼Œåˆ™æŒ‰ä¸‹å›¾è¿›è¡Œé…ç½®</p><img src="/2022/06/26/WebRTC%E5%85%A5%E9%97%A8/day12coTurn%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/6dd5c4f742072628a0bd87ca81c84bf66b0ec821.png@942w_668h_progressive.webp" class="" title="img">stunæœåŠ¡å™¨çš„é…ç½®<p>æœ‰ä¸€ç§è¯´æ³•æ˜¯ç”±äºstunæœåŠ¡å™¨ä¸æ‰¿æ‹…è½¬å‘çš„ä½œç”¨ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯ï¼Œç”±äºæˆ‘çš„å®¿èˆç½‘ç»œç¯å¢ƒæ˜¯å¯¹ç§°æ€§ï¼Œæ— æ³•éªŒè¯stunæœåŠ¡å™¨çš„ä½œç”¨æƒ…å†µï¼Œåœ¨æ­¤ä¸åšç»“æœå±•ç¤ºã€‚ä½†æ˜¯å¯ä»¥æ¨æ–­ï¼ŒturnæœåŠ¡å™¨æˆåŠŸéªŒè¯çš„æƒ…å†µä¸‹ï¼ŒstunæœåŠ¡å™¨åº”è¯¥åŒæ ·èƒ½å¤Ÿç”Ÿæ•ˆã€‚</p><h3 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h3><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å¼€å¯äº†turnserveræœåŠ¡ï¼ŒturnserveræœåŠ¡æ˜¯åœ¨åå°é»˜è®¤å¼€å¯çš„ï¼Œå¦‚æœé‡å¤æ‰§è¡Œå¼€å¯æœåŠ¡çš„å‘½ä»¤ï¼Œä¼šé€ æˆå¤šä¸ªturnserveræœåŠ¡åœ¨åå°ä¸€èµ·æ‰“å¼€ï¼Œç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æœåŠ¡æ˜¯å¦åœ¨åå°è¿è¡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">ps -ef|grep turnserver<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ‰å¤šä¸ªturnserveræœåŠ¡åŒæ—¶åœ¨åå°å¼€å¯ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤æ€æ‰æ‰€æœ‰turnserveræœåŠ¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">killall turnserver<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹turnserveræœåŠ¡ä¸€ç›´ä¼šåœ¨åå°ä¿æŒï¼Œå¦‚æœä¸ç”¨äº†è®°å¾—æ€æ‰æœåŠ¡ã€‚</p><h3 id="6ã€Ubuntu14å®‰è£…coturnå‚è€ƒ"><a href="#6ã€Ubuntu14å®‰è£…coturnå‚è€ƒ" class="headerlink" title="6ã€Ubuntu14å®‰è£…coturnå‚è€ƒ"></a>6ã€Ubuntu14å®‰è£…coturnå‚è€ƒ</h3><p><a href="https://blog.csdn.net/tanyhuan/article/details/77265349">https://blog.csdn.net/tanyhuan/article/details/77265349</a></p><h3 id="7ã€ä¸€äº›æœ‰ç”¨çš„å‚è€ƒæ–‡ç« "><a href="#7ã€ä¸€äº›æœ‰ç”¨çš„å‚è€ƒæ–‡ç« " class="headerlink" title="7ã€ä¸€äº›æœ‰ç”¨çš„å‚è€ƒæ–‡ç« "></a>7ã€ä¸€äº›æœ‰ç”¨çš„å‚è€ƒæ–‡ç« </h3><p><a href="https://www.jianshu.com/p/915eab39476d">https://www.jianshu.com/p/915eab39476d</a></p><p><a href="https://www.jianshu.com/p/5543dd3e002b">https://www.jianshu.com/p/5543dd3e002b</a></p><p><a href="https://www.jianshu.com/p/d65e369f44fb">https://www.jianshu.com/p/d65e369f44fb</a></p><p><a href="https://blog.csdn.net/ZSH1205209422/article/details/106637977">https://blog.csdn.net/ZSH1205209422/article/details/106637977</a></p><p><a href="https://blog.csdn.net/qq_16042523/article/details/52994785">https://blog.csdn.net/qq_16042523/article/details/52994785</a></p>]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day12-å®ç°1v1éŸ³è§†é¢‘äº’åŠ¨ç›´æ’­ç³»ç»Ÿ</title>
    <link href="/2022/06/25/WebRTC%E5%85%A5%E9%97%A8/day12%E5%AE%9E%E7%8E%B01v1%E9%9F%B3%E8%A7%86%E9%A2%91%E4%BA%92%E5%8A%A8%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/"/>
    <url>/2022/06/25/WebRTC%E5%85%A5%E9%97%A8/day12%E5%AE%9E%E7%8E%B01v1%E9%9F%B3%E8%A7%86%E9%A2%91%E4%BA%92%E5%8A%A8%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€æ ¸å¿ƒæ€æƒ³"><a href="#ä¸€ã€æ ¸å¿ƒæ€æƒ³" class="headerlink" title="ä¸€ã€æ ¸å¿ƒæ€æƒ³"></a>ä¸€ã€æ ¸å¿ƒæ€æƒ³</h2><h3 id="1ã€ä¸»è¦æµç¨‹å›¾ï¼ˆè‡ªå·±æœ‰ç©ºå¤šç»˜åˆ¶å‡ éï¼‰"><a href="#1ã€ä¸»è¦æµç¨‹å›¾ï¼ˆè‡ªå·±æœ‰ç©ºå¤šç»˜åˆ¶å‡ éï¼‰" class="headerlink" title="1ã€ä¸»è¦æµç¨‹å›¾ï¼ˆè‡ªå·±æœ‰ç©ºå¤šç»˜åˆ¶å‡ éï¼‰"></a>1ã€ä¸»è¦æµç¨‹å›¾ï¼ˆè‡ªå·±æœ‰ç©ºå¤šç»˜åˆ¶å‡ éï¼‰</h3><img src="/2022/06/25/WebRTC%E5%85%A5%E9%97%A8/day12%E5%AE%9E%E7%8E%B01v1%E9%9F%B3%E8%A7%86%E9%A2%91%E4%BA%92%E5%8A%A8%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/Image_20220701135914.png" class="" title="Image_20220701135914"><h2 id="äºŒã€æ ¸å¿ƒä»£ç "><a href="#äºŒã€æ ¸å¿ƒä»£ç " class="headerlink" title="äºŒã€æ ¸å¿ƒä»£ç "></a>äºŒã€æ ¸å¿ƒä»£ç </h2><h4 id="1ã€æœåŠ¡ç«¯ä¿¡ä»¤æœåŠ¡å™¨ä»£ç "><a href="#1ã€æœåŠ¡ç«¯ä¿¡ä»¤æœåŠ¡å™¨ä»£ç " class="headerlink" title="1ã€æœåŠ¡ç«¯ä¿¡ä»¤æœåŠ¡å™¨ä»£ç "></a>1ã€æœåŠ¡ç«¯ä¿¡ä»¤æœåŠ¡å™¨ä»£ç </h4><figure class="highlight javascript"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span><br><br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> serveIndex = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;serve-index&#x27;</span>);<br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> socketIo = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;socket.io&#x27;</span>);<br><br><span class="hljs-keyword">var</span> <span class="hljs-variable constant_">USERSCOUNT</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">//æˆ¿é—´äººæ•°ä¸Šé™</span><br><br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-comment">//é¡ºåºä¸èƒ½æ¢</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">serveIndex</span>(<span class="hljs-string">&#x27;./public&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">&#x27;./public&#x27;</span>));<br><br><span class="hljs-keyword">var</span> http_server = http.<span class="hljs-title function_">createServer</span>(app);<br>http_server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">9980</span>, <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>);<br><br><span class="hljs-comment">//ç»‘å®šsocket.ioåˆ°httpæœåŠ¡</span><br><span class="hljs-keyword">var</span> io = socketIo.<span class="hljs-title function_">listen</span>(http_server)<br><br>io.<span class="hljs-property">sockets</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">socket</span>)=&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;æœ‰äººå‘èµ·äº†é“¾æ¥è¯·æ±‚111&quot;</span>);<br>  <br>  socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room, data</span>)=&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;message&quot;</span> + room + data);<br>socket.<span class="hljs-title function_">to</span>(room).<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;message&#x27;</span>,room, data);<br>  &#125;);<br><br>  socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;join&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room</span>)=&gt;</span> &#123;<br>socket.<span class="hljs-title function_">join</span>(room);<br><span class="hljs-keyword">var</span> myRoom = io.<span class="hljs-property">sockets</span>.<span class="hljs-property">adapter</span>.<span class="hljs-property">rooms</span>[room];<br><span class="hljs-keyword">var</span> users = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(myRoom.<span class="hljs-property">sockets</span>).<span class="hljs-property">length</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;join&quot;</span> + room);<br><br>    <span class="hljs-keyword">if</span> (users &lt;= <span class="hljs-variable constant_">USERSCOUNT</span>) &#123; <span class="hljs-comment">//æˆ¿é—´äººæ•°æœªè¶…è¿‡</span><br>      socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;joined&#x27;</span>, room, socket.<span class="hljs-property">id</span>); <span class="hljs-comment">//ç»™è‡ªå·±å‘</span><br>      <span class="hljs-keyword">if</span> (users &gt; <span class="hljs-number">1</span>) &#123; <span class="hljs-comment">//æˆ¿é—´é‡Œé¢å·²ç»æœ‰å…¶ä»–äººäº†</span><br>        socket.<span class="hljs-title function_">to</span>(room).<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;otherjoin&#x27;</span>, room); <span class="hljs-comment">//å‘ç»™é™¤è‡ªå·±ä¹‹å¤–ï¼Œæˆ¿é—´å†…çš„æ‰€æœ‰äºº</span><br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">//è¶…è¿‡2ä¸ªäººäº†</span><br>      socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;full&#x27;</span>, room, socket.<span class="hljs-property">id</span>); <span class="hljs-comment">//ç»™è‡ªå·±å‘</span><br>      socket.<span class="hljs-title function_">leave</span>(room);<br>    &#125;<br>  &#125;);<br><br>  socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;leave&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room</span>)=&gt;</span> &#123;<br><span class="hljs-keyword">var</span> myRoom = io.<span class="hljs-property">sockets</span>.<span class="hljs-property">adapter</span>.<span class="hljs-property">rooms</span>[room];<br><span class="hljs-keyword">var</span> users = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(myRoom.<span class="hljs-property">sockets</span>).<span class="hljs-property">length</span>;<br>socket.<span class="hljs-title function_">to</span>(room).<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;bye&#x27;</span>, room, socket.<span class="hljs-property">id</span>)<span class="hljs-comment">//æˆ¿é—´å†…æ‰€æœ‰äºº,é™¤è‡ªå·±å¤–</span><br> socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;leaved&#x27;</span>, room, socket.<span class="hljs-property">id</span>);<span class="hljs-comment">// ç»™è‡ªå·±å‘</span><br>    socket.<span class="hljs-title function_">leave</span>(room);<br>&#125;);<br>&#125;);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;webrtcæœåŠ¡å¯åŠ¨æˆåŠŸ&quot;</span>);<br><br><br></code></pre></td></tr></table></figure><h3 id="2ã€è¾“å…¥æˆ¿é—´å·ä»£ç "><a href="#2ã€è¾“å…¥æˆ¿é—´å·ä»£ç " class="headerlink" title="2ã€è¾“å…¥æˆ¿é—´å·ä»£ç "></a>2ã€è¾“å…¥æˆ¿é—´å·ä»£ç </h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>really peer connection<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./css/main.css&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;javascript&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">gotoNextPage</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-keyword">var</span> roomid = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;input#room&#x27;</span>);</span><br><span class="language-javascript"><span class="hljs-keyword">if</span>(roomid.<span class="hljs-property">value</span> === <span class="hljs-literal">null</span> || roomid.<span class="hljs-property">value</span> === <span class="hljs-string">&#x27;&#x27;</span>)&#123;</span><br><span class="language-javascript"><span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;roomid is null&#x27;</span>);</span><br><span class="language-javascript">&#125;<span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;room.html?room=&quot;</span>+ roomid.<span class="hljs-property">value</span>;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>roomid:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;input&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;room&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;join&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;gotoNextPage()&quot;</span>&gt;</span>Join<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="3ã€ç»˜åˆ¶ç«¯å¯¹ç«¯èŠå¤©çš„htmlä»£ç "><a href="#3ã€ç»˜åˆ¶ç«¯å¯¹ç«¯èŠå¤©çš„htmlä»£ç " class="headerlink" title="3ã€ç»˜åˆ¶ç«¯å¯¹ç«¯èŠå¤©çš„htmlä»£ç "></a>3ã€ç»˜åˆ¶ç«¯å¯¹ç«¯èŠå¤©çš„htmlä»£ç </h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>WebRTC PeerConnection<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./css/main.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;connserver&quot;</span>&gt;</span>Connect Sig Server<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;leave&quot;</span> <span class="hljs-attr">disabled</span>&gt;</span>Leave<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;shareDesk&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;shareDesk&quot;</span>&gt;</span>Share Desktop<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;preview&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Local:<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;localvideo&quot;</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">playsinline</span> <span class="hljs-attr">muted</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Offer SDP:<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;offer&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Remote:<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;remotevideo&quot;</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">playsinline</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Answer SDP:<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;answer&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://webrtc.github.io/adapter/adapter-latest.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/main.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="4ã€æ ¸å¿ƒå®¢æˆ·ç«¯jsä»£ç "><a href="#4ã€æ ¸å¿ƒå®¢æˆ·ç«¯jsä»£ç " class="headerlink" title="4ã€æ ¸å¿ƒå®¢æˆ·ç«¯jsä»£ç "></a>4ã€æ ¸å¿ƒå®¢æˆ·ç«¯jsä»£ç </h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span><br><br><span class="hljs-keyword">var</span> localVideo = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;video#localvideo&#x27;</span>);<br><span class="hljs-keyword">var</span> remoteVideo = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;video#remotevideo&#x27;</span>);<br><br><span class="hljs-keyword">var</span> btnConn =  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;button#connserver&#x27;</span>);<br><span class="hljs-keyword">var</span> btnLeave = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;button#leave&#x27;</span>);<br><br><span class="hljs-keyword">var</span> offer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;textarea#offer&#x27;</span>);<br><span class="hljs-keyword">var</span> answer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;textarea#answer&#x27;</span>);<br><br><span class="hljs-keyword">var</span> shareDeskBox  = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;input#shareDesk&#x27;</span>);<br><br><span class="hljs-keyword">var</span> pcConfig = &#123;<br>  <span class="hljs-string">&#x27;iceServers&#x27;</span>: [&#123;<br>    <span class="hljs-string">&#x27;urls&#x27;</span>: <span class="hljs-string">&#x27;stun:47.95.15.179:3478&#x27;</span>,<br>    <span class="hljs-string">&#x27;credential&#x27;</span>: <span class="hljs-string">&quot;123456&quot;</span>,<br>    <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&quot;carrot&quot;</span><br>  &#125;]<br>&#125;;<br><br><span class="hljs-keyword">var</span> localStream = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">var</span> remoteStream = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">var</span> pc = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">var</span> roomid;<br><span class="hljs-keyword">var</span> socket = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">var</span> offerdesc = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">var</span> state = <span class="hljs-string">&#x27;init&#x27;</span>;<br><br><span class="hljs-comment">// ä»¥ä¸‹ä»£ç æ˜¯ä»ç½‘ä¸Šæ‰¾çš„</span><br><span class="hljs-comment">//=========================================================================================</span><br><br><span class="hljs-comment">//å¦‚æœè¿”å›çš„æ˜¯falseè¯´æ˜å½“å‰æ“ä½œç³»ç»Ÿæ˜¯æ‰‹æœºç«¯ï¼Œå¦‚æœè¿”å›çš„æ˜¯trueåˆ™è¯´æ˜å½“å‰çš„æ“ä½œç³»ç»Ÿæ˜¯ç”µè„‘ç«¯</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">IsPC</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">var</span> userAgentInfo = navigator.<span class="hljs-property">userAgent</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-title class_">Agents</span> = [<span class="hljs-string">&quot;Android&quot;</span>, <span class="hljs-string">&quot;iPhone&quot;</span>,<span class="hljs-string">&quot;SymbianOS&quot;</span>, <span class="hljs-string">&quot;Windows Phone&quot;</span>,<span class="hljs-string">&quot;iPad&quot;</span>, <span class="hljs-string">&quot;iPod&quot;</span>];<br><span class="hljs-keyword">var</span> flag = <span class="hljs-literal">true</span>;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> v = <span class="hljs-number">0</span>; v &lt; <span class="hljs-title class_">Agents</span>.<span class="hljs-property">length</span>; v++) &#123;<br><span class="hljs-keyword">if</span> (userAgentInfo.<span class="hljs-title function_">indexOf</span>(<span class="hljs-title class_">Agents</span>[v]) &gt; <span class="hljs-number">0</span>) &#123;<br>flag = <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">return</span> flag;<br>&#125;<br><br><span class="hljs-comment">//å¦‚æœè¿”å›true åˆ™è¯´æ˜æ˜¯Android  falseæ˜¯ios</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">is_android</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">var</span> u = navigator.<span class="hljs-property">userAgent</span>, app = navigator.<span class="hljs-property">appVersion</span>;<br><span class="hljs-keyword">var</span> isAndroid = u.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;Android&#x27;</span>) &gt; -<span class="hljs-number">1</span> || u.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;Linux&#x27;</span>) &gt; -<span class="hljs-number">1</span>; <span class="hljs-comment">//g</span><br><span class="hljs-keyword">var</span> isIOS = !!u.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span>); <span class="hljs-comment">//iosç»ˆç«¯</span><br><span class="hljs-keyword">if</span> (isAndroid) &#123;<br><span class="hljs-comment">//è¿™ä¸ªæ˜¯å®‰å“æ“ä½œç³»ç»Ÿ</span><br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (isIOS) &#123;<br><span class="hljs-comment">//è¿™ä¸ªæ˜¯iosæ“ä½œç³»ç»Ÿ</span><br> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//è·å–urlå‚æ•°</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getQueryVariable</span>(<span class="hljs-params">variable</span>)<br>&#123;<br>       <span class="hljs-keyword">var</span> query = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>);<br>       <span class="hljs-keyword">var</span> vars = query.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&amp;&quot;</span>);<br>       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;vars.<span class="hljs-property">length</span>;i++) &#123;<br>               <span class="hljs-keyword">var</span> pair = vars[i].<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;=&quot;</span>);<br>               <span class="hljs-keyword">if</span>(pair[<span class="hljs-number">0</span>] == variable)&#123;<span class="hljs-keyword">return</span> pair[<span class="hljs-number">1</span>];&#125;<br>       &#125;<br>       <span class="hljs-keyword">return</span>(<span class="hljs-literal">false</span>);<br>&#125;<br><br><span class="hljs-comment">//=======================================================================</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params">roomid, data</span>)&#123;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;send message to other end&#x27;</span>, roomid, data);<br><span class="hljs-keyword">if</span>(!socket)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;socket is null&#x27;</span>);<br>&#125;<br>socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;message&#x27;</span>, roomid, data);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">conn</span>(<span class="hljs-params"></span>)&#123; <br><br>socket = io.<span class="hljs-title function_">connect</span>();<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;joined&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">roomid, id</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive joined message!&#x27;</span>, roomid, id);<br>state = <span class="hljs-string">&#x27;joined&#x27;</span><br><br><span class="hljs-comment">//å¦‚æœæ˜¯å¤šäººçš„è¯ï¼Œç¬¬ä¸€ä¸ªäººä¸è¯¥åœ¨è¿™é‡Œåˆ›å»ºpeerConnection</span><br><span class="hljs-comment">//éƒ½ç­‰åˆ°æ”¶åˆ°ä¸€ä¸ªotherjoinæ—¶å†åˆ›å»º</span><br><span class="hljs-comment">//æ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªæ¶ˆæ¯é‡Œåº”è¯¥å¸¦å½“å‰æˆ¿é—´çš„ç”¨æˆ·æ•°</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//create conn and bind media track</span><br><span class="hljs-title function_">createPeerConnection</span>();<br><br>btnConn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br>btnLeave.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive joined message, state=&#x27;</span>, state);<br>&#125;);<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;otherjoin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">roomid</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive otherjoin message:&#x27;</span>, roomid, state);<br><br><span class="hljs-comment">//å¦‚æœæ˜¯å¤šäººçš„è¯ï¼Œæ¯ä¸Šæ¥ä¸€ä¸ªäººéƒ½è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ peerConnection</span><br><span class="hljs-comment">//</span><br><span class="hljs-keyword">if</span>(state === <span class="hljs-string">&#x27;joined_unbind&#x27;</span>)&#123;<br><span class="hljs-title function_">createPeerConnection</span>();<br>&#125;<br><br>state = <span class="hljs-string">&#x27;joined_conn&#x27;</span>;<br><span class="hljs-title function_">call</span>();<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive other_join message, state=&#x27;</span>, state);<br>&#125;);<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;full&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">roomid, id</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive full message&#x27;</span>, roomid, id);<br><span class="hljs-title function_">hangup</span>();<br><span class="hljs-title function_">closeLocalMedia</span>();<br>state = <span class="hljs-string">&#x27;leaved&#x27;</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive full message, state=&#x27;</span>, state);<br><span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;the room is full!&#x27;</span>);<br>&#125;);<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;leaved&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">roomid, id</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive leaved message&#x27;</span>, roomid, id);<br>state=<span class="hljs-string">&#x27;leaved&#x27;</span><br>socket.<span class="hljs-title function_">disconnect</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive leaved message, state=&#x27;</span>, state);<br><br>btnConn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;<br>btnLeave.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br>&#125;);<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;bye&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room, id</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive bye message&#x27;</span>, roomid, id);<br><span class="hljs-comment">//state = &#x27;created&#x27;;</span><br><span class="hljs-comment">//å½“æ˜¯å¤šäººé€šè¯æ—¶ï¼Œåº”è¯¥å¸¦ä¸Šå½“å‰æˆ¿é—´çš„ç”¨æˆ·æ•°</span><br><span class="hljs-comment">//å¦‚æœå½“å‰æˆ¿é—´ç”¨æˆ·ä¸å°äº 2, åˆ™ä¸ç”¨ä¿®æ”¹çŠ¶æ€</span><br><span class="hljs-comment">//å¹¶ä¸”ï¼Œå…³é—­çš„åº”è¯¥æ˜¯å¯¹åº”ç”¨æˆ·çš„peerconnection</span><br><span class="hljs-comment">//åœ¨å®¢æˆ·ç«¯åº”è¯¥ç»´æŠ¤ä¸€å¼ peerconnectionè¡¨ï¼Œå®ƒæ˜¯</span><br><span class="hljs-comment">//ä¸€ä¸ªkey:valueçš„æ ¼å¼ï¼Œkey=userid, value=peerconnection</span><br>state = <span class="hljs-string">&#x27;joined_unbind&#x27;</span>;<br><span class="hljs-title function_">hangup</span>();<br>offer.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>answer.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive bye message, state=&#x27;</span>, state);<br>&#125;);<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;disconnect&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">socket</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive disconnect message!&#x27;</span>, roomid);<br><span class="hljs-keyword">if</span>(!(state === <span class="hljs-string">&#x27;leaved&#x27;</span>))&#123;<br><span class="hljs-title function_">hangup</span>();<br><span class="hljs-title function_">closeLocalMedia</span>();<br><br>&#125;<br>state = <span class="hljs-string">&#x27;leaved&#x27;</span>;<br><br>&#125;);<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">roomid, data</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;receive message!&#x27;</span>, roomid, data);<br><br><span class="hljs-keyword">if</span>(data === <span class="hljs-literal">null</span> || data === <span class="hljs-literal">undefined</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;the message is invalid!&#x27;</span>);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(data.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">&#x27;type&#x27;</span>) &amp;&amp; data.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;offer&#x27;</span>) &#123;<br><br>offer.<span class="hljs-property">value</span> = data.<span class="hljs-property">sdp</span>;<br><br>pc.<span class="hljs-title function_">setRemoteDescription</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCSessionDescription</span>(data));<br><br><span class="hljs-comment">//create answer</span><br>pc.<span class="hljs-title function_">createAnswer</span>()<br>.<span class="hljs-title function_">then</span>(getAnswer)<br>.<span class="hljs-title function_">catch</span>(handleAnswerError);<br><br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(data.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">&#x27;type&#x27;</span>) &amp;&amp; data.<span class="hljs-property">type</span> == <span class="hljs-string">&#x27;answer&#x27;</span>)&#123;<br>answer.<span class="hljs-property">value</span> = data.<span class="hljs-property">sdp</span>;<br>pc.<span class="hljs-title function_">setRemoteDescription</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCSessionDescription</span>(data));<br><br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">&#x27;type&#x27;</span>) &amp;&amp; data.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;candidate&#x27;</span>)&#123;<br><span class="hljs-keyword">var</span> candidate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCIceCandidate</span>(&#123;<br><span class="hljs-attr">sdpMLineIndex</span>: data.<span class="hljs-property">label</span>,<br><span class="hljs-attr">candidate</span>: data.<span class="hljs-property">candidate</span><br>&#125;);<br>pc.<span class="hljs-title function_">addIceCandidate</span>(candidate);<br><br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;the message is invalid!&#x27;</span>, data);<br><br>&#125;<br><br>&#125;);<br><br><br>roomid = <span class="hljs-title function_">getQueryVariable</span>(<span class="hljs-string">&#x27;room&#x27;</span>);<br>socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;join&#x27;</span>, roomid);<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">connSignalServer</span>(<span class="hljs-params"></span>)&#123;<br><br><span class="hljs-comment">//å¼€å¯æœ¬åœ°è§†é¢‘</span><br><span class="hljs-title function_">start</span>();<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getMediaStream</span>(<span class="hljs-params">stream</span>)&#123;<br><br><span class="hljs-keyword">if</span>(localStream)&#123;<br>stream.<span class="hljs-title function_">getAudioTracks</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">track</span>)=&gt;</span>&#123;<br>localStream.<span class="hljs-title function_">addTrack</span>(track);<br>stream.<span class="hljs-title function_">removeTrack</span>(track);<br>&#125;);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>localStream = stream;<br>&#125;<br><br>localVideo.<span class="hljs-property">srcObject</span> = localStream;<br><br><span class="hljs-comment">//è¿™ä¸ªå‡½æ•°çš„ä½ç½®ç‰¹åˆ«é‡è¦ï¼Œ</span><br><span class="hljs-comment">//ä¸€å®šè¦æ”¾åˆ°getMediaStreamä¹‹åå†è°ƒç”¨</span><br><span class="hljs-comment">//å¦åˆ™å°±ä¼šå‡ºç°ç»‘å®šå¤±è´¥çš„æƒ…å†µ</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//setup connection</span><br><span class="hljs-title function_">conn</span>();<br><br><span class="hljs-comment">//btnStart.disabled = true;</span><br><span class="hljs-comment">//btnCall.disabled = true;</span><br><span class="hljs-comment">//btnHangup.disabled = true;</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getDeskStream</span>(<span class="hljs-params">stream</span>)&#123;<br>localStream = stream;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleError</span>(<span class="hljs-params">err</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Failed to get Media Stream!&#x27;</span>, err);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">shareDesk</span>(<span class="hljs-params"></span>)&#123;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title class_">IsPC</span>())&#123;<br>navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getDisplayMedia</span>(&#123;<span class="hljs-attr">video</span>: <span class="hljs-literal">true</span>&#125;)<br>.<span class="hljs-title function_">then</span>(getDeskStream)<br>.<span class="hljs-title function_">catch</span>(handleError);<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>)&#123;<br><br><span class="hljs-keyword">if</span>(!navigator.<span class="hljs-property">mediaDevices</span> ||<br>!navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-property">getUserMedia</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;the getUserMedia is not supported!&#x27;</span>);<br><span class="hljs-keyword">return</span>;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><br><span class="hljs-keyword">var</span> constraints;<br><br><span class="hljs-keyword">if</span>( shareDeskBox.<span class="hljs-property">checked</span> &amp;&amp; <span class="hljs-title function_">shareDesk</span>())&#123;<br><br>constraints = &#123;<br><span class="hljs-attr">video</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-attr">audio</span>:  &#123;<br><span class="hljs-attr">echoCancellation</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-attr">noiseSuppression</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-attr">autoGainControl</span>: <span class="hljs-literal">true</span><br>&#125;<br>&#125;<br><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>constraints = &#123;<br><span class="hljs-attr">video</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-attr">audio</span>:  &#123;<br><span class="hljs-attr">echoCancellation</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-attr">noiseSuppression</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-attr">autoGainControl</span>: <span class="hljs-literal">true</span><br>&#125;<br>&#125;<br>&#125;<br><br>navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getUserMedia</span>(constraints)<br>.<span class="hljs-title function_">then</span>(getMediaStream)<br>.<span class="hljs-title function_">catch</span>(handleError);<br>&#125;<br><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getRemoteStream</span>(<span class="hljs-params">e</span>)&#123;<br>remoteStream = e.<span class="hljs-property">streams</span>[<span class="hljs-number">0</span>];<br>remoteVideo.<span class="hljs-property">srcObject</span> = e.<span class="hljs-property">streams</span>[<span class="hljs-number">0</span>];<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleOfferError</span>(<span class="hljs-params">err</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Failed to create offer:&#x27;</span>, err);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAnswerError</span>(<span class="hljs-params">err</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Failed to create answer:&#x27;</span>, err);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getAnswer</span>(<span class="hljs-params">desc</span>)&#123;<br>pc.<span class="hljs-title function_">setLocalDescription</span>(desc);<br>answer.<span class="hljs-property">value</span> = desc.<span class="hljs-property">sdp</span>;<br><br><span class="hljs-comment">//send answer sdp</span><br><span class="hljs-title function_">sendMessage</span>(roomid, desc);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getOffer</span>(<span class="hljs-params">desc</span>)&#123;<br>pc.<span class="hljs-title function_">setLocalDescription</span>(desc);<br>offer.<span class="hljs-property">value</span> = desc.<span class="hljs-property">sdp</span>;<br>offerdesc = desc;<br><br><span class="hljs-comment">//send offer sdp</span><br><span class="hljs-title function_">sendMessage</span>(roomid, offerdesc);<br><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createPeerConnection</span>(<span class="hljs-params"></span>)&#123;<br><br><span class="hljs-comment">//å¦‚æœæ˜¯å¤šäººçš„è¯ï¼Œåœ¨è¿™é‡Œè¦åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥.</span><br><span class="hljs-comment">//æ–°åˆ›å»ºå¥½çš„è¦æ”¾åˆ°ä¸€ä¸ªmapè¡¨ä¸­ã€‚</span><br><span class="hljs-comment">//key=userid, value=peerconnection</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;create RTCPeerConnection!&#x27;</span>);<br><span class="hljs-keyword">if</span>(!pc)&#123;<br>pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCPeerConnection</span>(pcConfig);<br><br>pc.<span class="hljs-property">onicecandidate</span> = <span class="hljs-function">(<span class="hljs-params">e</span>)=&gt;</span>&#123;<br><br><span class="hljs-keyword">if</span>(e.<span class="hljs-property">candidate</span>) &#123;<br><span class="hljs-title function_">sendMessage</span>(roomid, &#123;<br><span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;candidate&#x27;</span>,<br><span class="hljs-attr">label</span>:e.<span class="hljs-property">candidate</span>.<span class="hljs-property">sdpMLineIndex</span>, <br><span class="hljs-attr">id</span>:e.<span class="hljs-property">candidate</span>.<span class="hljs-property">sdpMid</span>, <br><span class="hljs-attr">candidate</span>: e.<span class="hljs-property">candidate</span>.<span class="hljs-property">candidate</span><br>&#125;);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;this is the end candidate&#x27;</span>);<br>&#125;<br>&#125;<br>pc.<span class="hljs-property">ontrack</span> = getRemoteStream;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warning</span>(<span class="hljs-string">&#x27;the pc have be created!&#x27;</span>);<br>&#125;<br><br><span class="hljs-title function_">bindTracks</span>();<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">//ç»‘å®šæ°¸è¿œä¸ peerconnectionåœ¨ä¸€èµ·ï¼Œ</span><br><span class="hljs-comment">//æ‰€ä»¥æ²¡å¿…è¦å†å•ç‹¬åšæˆä¸€ä¸ªå‡½æ•°</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">bindTracks</span>(<span class="hljs-params"></span>)&#123;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;bind tracks into RTCPeerConnection!&#x27;</span>);<br><br><span class="hljs-keyword">if</span>( pc === <span class="hljs-literal">null</span> || pc === <span class="hljs-literal">undefined</span>) &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;pc is null or undefined!&#x27;</span>);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(localStream === <span class="hljs-literal">null</span> || localStream === <span class="hljs-literal">undefined</span>) &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;localstream is null or undefined!&#x27;</span>);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">//add all track into peer connection</span><br>localStream.<span class="hljs-title function_">getTracks</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">track</span>)=&gt;</span>&#123;<br>pc.<span class="hljs-title function_">addTrack</span>(track, localStream);<br>&#125;);<br><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">call</span>(<span class="hljs-params"></span>)&#123;<br><br><span class="hljs-keyword">if</span>(state === <span class="hljs-string">&#x27;joined_conn&#x27;</span>)&#123;<br><br><span class="hljs-keyword">var</span> offerOptions = &#123;<br><span class="hljs-attr">offerToRecieveAudio</span>: <span class="hljs-number">1</span>,<br><span class="hljs-attr">offerToRecieveVideo</span>: <span class="hljs-number">1</span><br>&#125;<br><br>pc.<span class="hljs-title function_">createOffer</span>(offerOptions)<br>.<span class="hljs-title function_">then</span>(getOffer)<br>.<span class="hljs-title function_">catch</span>(handleOfferError);<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">hangup</span>(<span class="hljs-params"></span>)&#123;<br><br><span class="hljs-keyword">if</span>(pc) &#123;<br><br>offerdesc = <span class="hljs-literal">null</span>;<br><br>pc.<span class="hljs-title function_">close</span>();<br>pc = <span class="hljs-literal">null</span>;<br>&#125;<br><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">closeLocalMedia</span>(<span class="hljs-params"></span>)&#123;<br><br><span class="hljs-keyword">if</span>(localStream &amp;&amp; localStream.<span class="hljs-title function_">getTracks</span>())&#123;<br>localStream.<span class="hljs-title function_">getTracks</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">track</span>)=&gt;</span>&#123;<br>track.<span class="hljs-title function_">stop</span>();<br>&#125;);<br>&#125;<br>localStream = <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">leave</span>(<span class="hljs-params"></span>) &#123;<br><br><span class="hljs-keyword">if</span>(socket)&#123;<br>socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;leave&#x27;</span>, roomid); <span class="hljs-comment">//notify server</span><br>&#125;<br><br><span class="hljs-title function_">hangup</span>();<br><span class="hljs-title function_">closeLocalMedia</span>();<br><br>offer.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>answer.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>btnConn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;<br>btnLeave.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br>&#125;<br><br>btnConn.<span class="hljs-property">onclick</span> = connSignalServer<br>btnLeave.<span class="hljs-property">onclick</span> = leave;<br><br></code></pre></td></tr></table></figure><h3 id="5ã€å®¢æˆ·ç«¯ä¸€äº›è¾…åŠ©cssä»£ç "><a href="#5ã€å®¢æˆ·ç«¯ä¸€äº›è¾…åŠ©cssä»£ç " class="headerlink" title="5ã€å®¢æˆ·ç«¯ä¸€äº›è¾…åŠ©cssä»£ç "></a>5ã€å®¢æˆ·ç«¯ä¸€äº›è¾…åŠ©cssä»£ç </h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> *  Copyright (c) 2015 The WebRTC project authors. All Rights Reserved.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *  Use of this source code is governed by a BSD-style license</span><br><span class="hljs-comment"> *  that can be found in the LICENSE file in the root of the source</span><br><span class="hljs-comment"> *  tree.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-selector-tag">button</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span> <span class="hljs-number">25px</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">vertical-align</span>: top;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">134px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">table</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">200px</span> (<span class="hljs-number">50%</span> - <span class="hljs-number">100</span>) <span class="hljs-number">0</span> <span class="hljs-number">0</span>; <br>&#125;<br><br><span class="hljs-selector-tag">textarea</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#444</span>;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9em</span>;<br>  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">300</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">20.0em</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">10px</span>);<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-id">#getUserMedia</span> &#123;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.input</span> &#123;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">vertical-align</span>: top;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">310px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.input</span> &gt; <span class="hljs-selector-tag">div</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">vertical-align</span>: top;<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.output</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eee</span>;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;Inconsolata&#x27;</span>, <span class="hljs-string">&#x27;Courier New&#x27;</span>, monospace;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9em</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">10px</span> <span class="hljs-number">10px</span> <span class="hljs-number">25px</span>;<br>  <span class="hljs-attribute">position</span>: relative;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">white-space</span>: pre;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">270px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-id">#preview</span> &#123;<br>  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1em</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0.5em</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-id">#preview</span> &gt; <span class="hljs-selector-tag">div</span> &#123;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>  <span class="hljs-attribute">vertical-align</span>: top;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">50%</span> - <span class="hljs-number">12px</span>);<br>&#125;<br><br><span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#statistics</span> <span class="hljs-selector-tag">div</span> &#123;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;Inconsolata&#x27;</span>, <span class="hljs-string">&#x27;Courier New&#x27;</span>, monospace;<br>  <span class="hljs-attribute">vertical-align</span>: top;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">308px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#statistics</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-id">#senderStats</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#constraints</span> &gt; <span class="hljs-selector-tag">div</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">h2</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1em</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br><span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#constraints</span> <span class="hljs-selector-tag">label</span> &#123;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">156px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">section</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">15px</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">video</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#222</span>;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attr">--width</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--width);<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">225px</span>;<br>&#125;<br><br><span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">720px</span>) &#123;<br>  <span class="hljs-selector-tag">button</span> &#123;<br>    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">56px</span>;<br>    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.3em</span>;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">90px</span>;<br>  &#125;<br><br>  <span class="hljs-selector-tag">div</span><span class="hljs-selector-id">#getUserMedia</span> &#123;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">40px</span> <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#statistics</span> <span class="hljs-selector-tag">div</span> &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">50%</span> - <span class="hljs-number">14px</span>);<br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day11-WebRTCæ ¸å¿ƒä¹‹SDPè¯¦è§£</title>
    <link href="/2022/06/20/WebRTC%E5%85%A5%E9%97%A8/day11WebRTC%E6%A0%B8%E5%BF%83SDP/"/>
    <url>/2022/06/20/WebRTC%E5%85%A5%E9%97%A8/day11WebRTC%E6%A0%B8%E5%BF%83SDP/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€ç½‘ç»œæŠ“åŒ…"><a href="#ä¸€ã€ç½‘ç»œæŠ“åŒ…" class="headerlink" title="ä¸€ã€ç½‘ç»œæŠ“åŒ…"></a>ä¸€ã€ç½‘ç»œæŠ“åŒ…</h1><h3 id="1ã€SDPåœ¨WebRTCä¸­çš„åœ°ä½ï¼Ÿ"><a href="#1ã€SDPåœ¨WebRTCä¸­çš„åœ°ä½ï¼Ÿ" class="headerlink" title="1ã€SDPåœ¨WebRTCä¸­çš„åœ°ä½ï¼Ÿ"></a>1ã€SDPåœ¨WebRTCä¸­çš„åœ°ä½ï¼Ÿ</h3><ul><li>SDPå¯ä»¥è¯´æ˜¯WebRTCçš„æ ¸å¿ƒï¼Œå› ä¸ºåŒæ–¹è¿›è¡Œé€šä¿¡çš„å‚æ•°éƒ½åœ¨å…¶ä¸­</li><li>å¦‚ä½¿ç”¨çš„ç¼–ç å™¨æ˜¯ä»€ä¹ˆï¼Œç æµæ˜¯å¤šå¤§ï¼Œæœ‰å¤šå°‘ä¸ªåª’ä½“æµç­‰ç­‰éƒ½åœ¨SDPä¸­æè¿°ç€</li></ul><h3 id="2ã€ä»€ä¹ˆæ˜¯SDPï¼Ÿ"><a href="#2ã€ä»€ä¹ˆæ˜¯SDPï¼Ÿ" class="headerlink" title="2ã€ä»€ä¹ˆæ˜¯SDPï¼Ÿ"></a>2ã€ä»€ä¹ˆæ˜¯SDPï¼Ÿ</h3><ul><li>SDPï¼ˆSession Description Protocolï¼‰å®ƒåªæ˜¯ä¸€ç§ä¿¡æ¯æ ¼å¼çš„æè¿°æ ‡å‡†</li><li>æœ¬èº«ä¸å±äºä¼ è¾“åè®®ï¼Œä½†æ˜¯å¯ä»¥è¢«å…¶ä»–ä¼ è¾“åè®®ç”¨æ¥äº¤æ¢å¿…è¦çš„ä¿¡æ¯ã€‚</li></ul><h3 id="3ã€è®¤è¯†WebRTCä¸­çš„SDPï¼Œæœ‰ä¸ªå°è±¡å°±è¡Œï¼Œåç»­å†å€’å›æ¥ç ”ç©¶ã€‚"><a href="#3ã€è®¤è¯†WebRTCä¸­çš„SDPï¼Œæœ‰ä¸ªå°è±¡å°±è¡Œï¼Œåç»­å†å€’å›æ¥ç ”ç©¶ã€‚" class="headerlink" title="3ã€è®¤è¯†WebRTCä¸­çš„SDPï¼Œæœ‰ä¸ªå°è±¡å°±è¡Œï¼Œåç»­å†å€’å›æ¥ç ”ç©¶ã€‚"></a>3ã€è®¤è¯†WebRTCä¸­çš„SDPï¼Œæœ‰ä¸ªå°è±¡å°±è¡Œï¼Œåç»­å†å€’å›æ¥ç ”ç©¶ã€‚</h3><ul><li>ä¼šè¯å±‚ï¼šç±»ä¼¼å…¨å±€å˜é‡ï¼Œæ˜¯å¯¹SDPå¤§è€Œå…¨çš„ä¿¡æ¯ç»Ÿè®¡</li><li>åª’ä½“å±‚ï¼šç±»ä¼¼äºå±€éƒ¨å˜é‡ï¼Œåª’ä½“å±‚çš„æ•°æ®ä¼šè¦†ç›–ä¼šè¯å±‚</li></ul><img src="/2022/06/20/WebRTC%E5%85%A5%E9%97%A8/day11WebRTC%E6%A0%B8%E5%BF%83SDP/image-20220625173942004.png" class=""><h3 id="4ã€å¦‚ä½•è·å–SDPï¼Ÿ"><a href="#4ã€å¦‚ä½•è·å–SDPï¼Ÿ" class="headerlink" title="4ã€å¦‚ä½•è·å–SDPï¼Ÿ"></a>4ã€å¦‚ä½•è·å–SDPï¼Ÿ</h3><figure class="highlight js"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getAnswer</span>(<span class="hljs-params">desc</span>)&#123;<br>pc2.<span class="hljs-title function_">setLocalDescription</span>(desc);<br>answerSdpTextarea.<span class="hljs-property">value</span> = desc.<span class="hljs-property">sdp</span><br><br><span class="hljs-comment">//send desc to signal</span><br><span class="hljs-comment">//receive desc from signal</span><br><br>pc1.<span class="hljs-title function_">setRemoteDescription</span>(desc);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getOffer</span>(<span class="hljs-params">desc</span>)&#123;<br>pc1.<span class="hljs-title function_">setLocalDescription</span>(desc);<br>offerSdpTextarea.<span class="hljs-property">value</span> = desc.<span class="hljs-property">sdp</span><br><br><span class="hljs-comment">//send desc to signal</span><br><span class="hljs-comment">//receive desc from signal</span><br><br>pc2.<span class="hljs-title function_">setRemoteDescription</span>(desc);<br><br>pc2.<span class="hljs-title function_">createAnswer</span>()<br>.<span class="hljs-title function_">then</span>(getAnswer)<br>.<span class="hljs-title function_">catch</span>(handleAnswerError);<br><br>&#125;<br></code></pre></td></tr></table></figure><img src="/2022/06/20/WebRTC%E5%85%A5%E9%97%A8/day11WebRTC%E6%A0%B8%E5%BF%83SDP/image-20220625173459114.png" class=""><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs xml">v=0<br>o=- 6529374866365022581 2 IN IP4 127.0.0.1<br>s=-<br>t=0 0<br>a=group:BUNDLE 0<br>a=extmap-allow-mixed<br>a=msid-semantic: WMS 8WZ552nThLWpJd1OTFAcTJTEIb6s4aHH1vlF<br>m=video 9 UDP/TLS/RTP/SAVPF 96 97 98 99 100 101 127 121 125 107 108 109 124 120 123 119 35 36 41 42 114 115 116 117 118<br>c=IN IP4 0.0.0.0<br>a=rtcp:9 IN IP4 0.0.0.0<br>a=ice-ufrag:j9z9<br>a=ice-pwd:JcYFBZ/8ONKMNks8lG37N83y<br>a=ice-options:trickle<br>a=fingerprint:sha-256 A4:52:8C:A8:2B:22:8C:66:C1:03:D3:65:EC:EE:36:E4:0E:28:CB:02:FB:90:DE:EA:E6:C2:C8:B2:DE:6A:05:30<br>a=setup:actpass<br>a=mid:0<br>a=extmap:1 urn:ietf:params:rtp-hdrext:toffset<br>a=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time<br>a=extmap:3 urn:3gpp:video-orientation<br>a=extmap:4 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01<br>a=extmap:5 http://www.webrtc.org/experiments/rtp-hdrext/playout-delay<br>a=extmap:6 http://www.webrtc.org/experiments/rtp-hdrext/video-content-type<br>a=extmap:7 http://www.webrtc.org/experiments/rtp-hdrext/video-timing<br>a=extmap:8 http://www.webrtc.org/experiments/rtp-hdrext/color-space<br>a=extmap:9 urn:ietf:params:rtp-hdrext:sdes:mid<br>a=extmap:10 urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id<br>a=extmap:11 urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id<br>a=sendrecv<br>a=msid:8WZ552nThLWpJd1OTFAcTJTEIb6s4aHH1vlF 31751cde-a529-4f04-bd71-ad11336ad20b<br>a=rtcp-mux<br>a=rtcp-rsize<br>a=rtpmap:96 VP8/90000<br>a=rtcp-fb:96 goog-remb<br>a=rtcp-fb:96 transport-cc<br>a=rtcp-fb:96 ccm fir<br>a=rtcp-fb:96 nack<br>a=rtcp-fb:96 nack pli<br>a=rtpmap:97 rtx/90000<br>a=fmtp:97 apt=96<br>a=rtpmap:98 VP9/90000<br>a=rtcp-fb:98 goog-remb<br>a=rtcp-fb:98 transport-cc<br>a=rtcp-fb:98 ccm fir<br>a=rtcp-fb:98 nack<br>a=rtcp-fb:98 nack pli<br>a=fmtp:98 profile-id=0<br>a=rtpmap:99 rtx/90000<br>a=fmtp:99 apt=98<br>a=rtpmap:100 VP9/90000<br>a=rtcp-fb:100 goog-remb<br>a=rtcp-fb:100 transport-cc<br>a=rtcp-fb:100 ccm fir<br>a=rtcp-fb:100 nack<br>a=rtcp-fb:100 nack pli<br>a=fmtp:100 profile-id=2<br>a=rtpmap:101 rtx/90000<br>a=fmtp:101 apt=100<br>a=rtpmap:127 H264/90000<br>a=rtcp-fb:127 goog-remb<br>a=rtcp-fb:127 transport-cc<br>a=rtcp-fb:127 ccm fir<br>a=rtcp-fb:127 nack<br>a=rtcp-fb:127 nack pli<br>a=fmtp:127 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f<br>a=rtpmap:121 rtx/90000<br>a=fmtp:121 apt=127<br>a=rtpmap:125 H264/90000<br>a=rtcp-fb:125 goog-remb<br>a=rtcp-fb:125 transport-cc<br>a=rtcp-fb:125 ccm fir<br>a=rtcp-fb:125 nack<br>a=rtcp-fb:125 nack pli<br>a=fmtp:125 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42001f<br>a=rtpmap:107 rtx/90000<br>a=fmtp:107 apt=125<br>a=rtpmap:108 H264/90000<br>a=rtcp-fb:108 goog-remb<br>a=rtcp-fb:108 transport-cc<br>a=rtcp-fb:108 ccm fir<br>a=rtcp-fb:108 nack<br>a=rtcp-fb:108 nack pli<br>a=fmtp:108 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f<br>a=rtpmap:109 rtx/90000<br>a=fmtp:109 apt=108<br>a=rtpmap:124 H264/90000<br>a=rtcp-fb:124 goog-remb<br>a=rtcp-fb:124 transport-cc<br>a=rtcp-fb:124 ccm fir<br>a=rtcp-fb:124 nack<br>a=rtcp-fb:124 nack pli<br>a=fmtp:124 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42e01f<br>a=rtpmap:120 rtx/90000<br>a=fmtp:120 apt=124<br>a=rtpmap:123 H264/90000<br>a=rtcp-fb:123 goog-remb<br>a=rtcp-fb:123 transport-cc<br>a=rtcp-fb:123 ccm fir<br>a=rtcp-fb:123 nack<br>a=rtcp-fb:123 nack pli<br>a=fmtp:123 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f<br>a=rtpmap:119 rtx/90000<br>a=fmtp:119 apt=123<br>a=rtpmap:35 H264/90000<br>a=rtcp-fb:35 goog-remb<br>a=rtcp-fb:35 transport-cc<br>a=rtcp-fb:35 ccm fir<br>a=rtcp-fb:35 nack<br>a=rtcp-fb:35 nack pli<br>a=fmtp:35 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=4d001f<br>a=rtpmap:36 rtx/90000<br>a=fmtp:36 apt=35<br>a=rtpmap:41 AV1/90000<br>a=rtcp-fb:41 goog-remb<br>a=rtcp-fb:41 transport-cc<br>a=rtcp-fb:41 ccm fir<br>a=rtcp-fb:41 nack<br>a=rtcp-fb:41 nack pli<br>a=rtpmap:42 rtx/90000<br>a=fmtp:42 apt=41<br>a=rtpmap:114 H264/90000<br>a=rtcp-fb:114 goog-remb<br>a=rtcp-fb:114 transport-cc<br>a=rtcp-fb:114 ccm fir<br>a=rtcp-fb:114 nack<br>a=rtcp-fb:114 nack pli<br>a=fmtp:114 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f<br>a=rtpmap:115 rtx/90000<br>a=fmtp:115 apt=114<br>a=rtpmap:116 red/90000<br>a=rtpmap:117 rtx/90000<br>a=fmtp:117 apt=116<br>a=rtpmap:118 ulpfec/90000<br>a=ssrc-group:FID 436826565 1885894064<br>a=ssrc:436826565 cname:t+9nyTqxmjVC0Wq9<br>a=ssrc:436826565 msid:8WZ552nThLWpJd1OTFAcTJTEIb6s4aHH1vlF 31751cde-a529-4f04-bd71-ad11336ad20b<br>a=ssrc:436826565 mslabel:8WZ552nThLWpJd1OTFAcTJTEIb6s4aHH1vlF<br>a=ssrc:436826565 label:31751cde-a529-4f04-bd71-ad11336ad20b<br>a=ssrc:1885894064 cname:t+9nyTqxmjVC0Wq9<br>a=ssrc:1885894064 msid:8WZ552nThLWpJd1OTFAcTJTEIb6s4aHH1vlF 31751cde-a529-4f04-bd71-ad11336ad20b<br>a=ssrc:1885894064 mslabel:8WZ552nThLWpJd1OTFAcTJTEIb6s4aHH1vlF<br>a=ssrc:1885894064 label:31751cde-a529-4f04-bd71-ad11336ad20b<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day10-WebRTCç«¯å¯¹ç«¯1v1ä¼ è¾“åŸºæœ¬æµç¨‹</title>
    <link href="/2022/06/19/WebRTC%E5%85%A5%E9%97%A8/day10%E7%AB%AF%E5%AF%B9%E7%AB%AF%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/"/>
    <url>/2022/06/19/WebRTC%E5%85%A5%E9%97%A8/day10%E7%AB%AF%E5%AF%B9%E7%AB%AF%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€ç½‘ç»œæŠ“åŒ…"><a href="#ä¸€ã€ç½‘ç»œæŠ“åŒ…" class="headerlink" title="ä¸€ã€ç½‘ç»œæŠ“åŒ…"></a>ä¸€ã€ç½‘ç»œæŠ“åŒ…</h1><h3 id="1ã€ç½‘ç»œæŠ“åŒ…å·¥å…·å¸¸ç”¨çš„ä¸¤ä¸ªå·¥å…·æ˜¯å“ªä¸¤ä¸ªï¼Ÿ"><a href="#1ã€ç½‘ç»œæŠ“åŒ…å·¥å…·å¸¸ç”¨çš„ä¸¤ä¸ªå·¥å…·æ˜¯å“ªä¸¤ä¸ªï¼Ÿ" class="headerlink" title="1ã€ç½‘ç»œæŠ“åŒ…å·¥å…·å¸¸ç”¨çš„ä¸¤ä¸ªå·¥å…·æ˜¯å“ªä¸¤ä¸ªï¼Ÿ"></a>1ã€ç½‘ç»œæŠ“åŒ…å·¥å…·å¸¸ç”¨çš„ä¸¤ä¸ªå·¥å…·æ˜¯å“ªä¸¤ä¸ªï¼Ÿ</h3><ul><li>tcpdump</li><li>WireShark</li></ul><h3 id="2ã€tcpdump-å’Œ-WireShark-ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#2ã€tcpdump-å’Œ-WireShark-ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="2ã€tcpdump å’Œ WireShark ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>2ã€<code>tcpdump</code> å’Œ <code>WireShark</code> ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ul><li><font color="red">tcpdump</font>ï¼štcpdumpåœ¨LinuxæœåŠ¡ç«¯ä½¿ç”¨ï¼Œå¯¹ä½¿ç”¨è€…çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œéœ€è¦å¯¹ç½‘ç»œå¾ˆç†Ÿæ‚‰ã€‚ï¼ˆçœŸæ­£çš„é«˜æ‰‹ä¸“ç”¨ï¼‰</li><li><font color="red">WireShark</font>ï¼šæ‹¥æœ‰å„ä¸ªå¹³å°çš„å¯è§†åŒ–ç•Œé¢ï¼Œæ‰€ä»¥å¯¹ä½¿ç”¨è€…è¦æ±‚æ¯”è¾ƒä½ã€‚ï¼ˆåˆ†æè¾…åŠ©æç¤ºåŠŸèƒ½åšå¾—å¾ˆæ£’ï¼‰</li></ul><h3 id="3ã€tcpdumpæœ€å¸¸è§çš„ç”¨æ³•ï¼Ÿï¼ˆå…ˆè®°å½•ä¸€ä¸‹ï¼Œåç»­å†çœ‹å§ï¼‰"><a href="#3ã€tcpdumpæœ€å¸¸è§çš„ç”¨æ³•ï¼Ÿï¼ˆå…ˆè®°å½•ä¸€ä¸‹ï¼Œåç»­å†çœ‹å§ï¼‰" class="headerlink" title="3ã€tcpdumpæœ€å¸¸è§çš„ç”¨æ³•ï¼Ÿï¼ˆå…ˆè®°å½•ä¸€ä¸‹ï¼Œåç»­å†çœ‹å§ï¼‰"></a>3ã€tcpdumpæœ€å¸¸è§çš„ç”¨æ³•ï¼Ÿï¼ˆå…ˆè®°å½•ä¸€ä¸‹ï¼Œåç»­å†çœ‹å§ï¼‰</h3><img src="/2022/06/19/WebRTC%E5%85%A5%E9%97%A8/day10%E7%AB%AF%E5%AF%B9%E7%AB%AF%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/image-20220619081627151.png" class="" title="image-20220619081627151"><h3 id="4ã€Macä¸‹å¦‚ä½•çŸ¥é“è‡ªå·±æœ‰å“ªäº›ç½‘å¡ï¼Ÿ"><a href="#4ã€Macä¸‹å¦‚ä½•çŸ¥é“è‡ªå·±æœ‰å“ªäº›ç½‘å¡ï¼Ÿ" class="headerlink" title="4ã€Macä¸‹å¦‚ä½•çŸ¥é“è‡ªå·±æœ‰å“ªäº›ç½‘å¡ï¼Ÿ"></a>4ã€Macä¸‹å¦‚ä½•çŸ¥é“è‡ªå·±æœ‰å“ªäº›ç½‘å¡ï¼Ÿ</h3><ul><li>åœ¨ç»ˆç«¯ä½¿ç”¨ <code>ifconfig</code> å‘½ä»¤å³å¯æŸ¥çœ‹</li></ul><h3 id="5ã€ã€æŒæ¡ã€‘WireSharkçš„é€»è¾‘è¿ç®—æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#5ã€ã€æŒæ¡ã€‘WireSharkçš„é€»è¾‘è¿ç®—æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="5ã€ã€æŒæ¡ã€‘WireSharkçš„é€»è¾‘è¿ç®—æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>5ã€ã€æŒæ¡ã€‘WireSharkçš„é€»è¾‘è¿ç®—æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h3><ul><li>ä¸ï¼š <code>and</code> æˆ– <code>&amp;&amp;</code></li><li>æˆ–ï¼š<code>or</code> æˆ– <code>||</code></li><li>éï¼š<code>not</code> æˆ– <code>ï¼</code></li></ul><h3 id="6ã€ã€æŒæ¡ã€‘WireSharkçš„åˆ¤æ–­è¯­å¥æœ‰å“ªäº›ï¼Ÿ"><a href="#6ã€ã€æŒæ¡ã€‘WireSharkçš„åˆ¤æ–­è¯­å¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="6ã€ã€æŒæ¡ã€‘WireSharkçš„åˆ¤æ–­è¯­å¥æœ‰å“ªäº›ï¼Ÿ"></a>6ã€ã€æŒæ¡ã€‘WireSharkçš„åˆ¤æ–­è¯­å¥æœ‰å“ªäº›ï¼Ÿ</h3><ul><li>ç­‰äºï¼š<code>eq</code> æˆ– <code>==</code></li><li>å°äºï¼š<code>lt</code> æˆ– <code>&lt;</code></li><li>å¤§äºï¼š<code>gt</code> æˆ– <code>&gt;</code></li><li>å°äºç­‰äºï¼š<code>le</code> æˆ– <code>&lt;=</code></li><li>å¤§äºç­‰äºï¼š<code>ge</code> æˆ– <code>&gt;=</code></li><li>ä¸ç­‰äºï¼š<code>ne</code> æˆ– <code>!=</code></li></ul><h3 id="7ã€ã€æŒæ¡ã€‘WireSharkå¦‚ä½•æŒ‰ç…§åè®®è¿›è¡Œè¿‡æ»¤ï¼Ÿ"><a href="#7ã€ã€æŒæ¡ã€‘WireSharkå¦‚ä½•æŒ‰ç…§åè®®è¿›è¡Œè¿‡æ»¤ï¼Ÿ" class="headerlink" title="7ã€ã€æŒæ¡ã€‘WireSharkå¦‚ä½•æŒ‰ç…§åè®®è¿›è¡Œè¿‡æ»¤ï¼Ÿ"></a>7ã€ã€æŒæ¡ã€‘WireSharkå¦‚ä½•æŒ‰ç…§åè®®è¿›è¡Œè¿‡æ»¤ï¼Ÿ</h3><ul><li>stun</li><li>tcp</li><li>udp</li><li>æ³¨æ„éƒ½ç”¨å°å†™</li></ul><h3 id="8ã€ã€æŒæ¡ã€‘WireShark-å¦‚ä½•æŒ‰ç…§ipåœ°å€æˆ–ç«¯å£å·è¿‡æ»¤ï¼Ÿ"><a href="#8ã€ã€æŒæ¡ã€‘WireShark-å¦‚ä½•æŒ‰ç…§ipåœ°å€æˆ–ç«¯å£å·è¿‡æ»¤ï¼Ÿ" class="headerlink" title="8ã€ã€æŒæ¡ã€‘WireShark å¦‚ä½•æŒ‰ç…§ipåœ°å€æˆ–ç«¯å£å·è¿‡æ»¤ï¼Ÿ"></a>8ã€ã€æŒæ¡ã€‘WireShark å¦‚ä½•æŒ‰ç…§<code>ipåœ°å€</code>æˆ–<code>ç«¯å£å·</code>è¿‡æ»¤ï¼Ÿ</h3><ul><li><font color="red">æŒ‰ipåœ°å€è¿‡æ»¤</font>ï¼š<ul><li>ip.dst &#x3D;&#x3D; 172.172.172.172ï¼ˆæŒ‰ç›®çš„åœ°å€è¿‡æ»¤ï¼‰</li><li>ip.src &#x3D; 192.168.0.1 ï¼ˆæŒ‰æºåœ°å€è¿‡æ»¤ï¼‰</li><li>ip.addr &#x3D; 192.168.0.1ï¼ˆæºæˆ–ç›®çš„åœ°å€ä¸­åŒ…å«æ­¤ipå³å¯ï¼‰</li></ul></li><li><font color="red">æŒ‰ç«¯å£å·è¿‡æ»¤</font>ï¼š<ul><li>tcp.port &#x3D;&#x3D; 8080</li><li>udp.port &#x3D;&#x3D; 8080</li><li>udp.dstport &#x3D;&#x3D; 3478</li><li>udp.srcport &#x3D;&#x3D; 3478</li></ul></li></ul><h2 id="äºŒã€ç«¯å¯¹ç«¯1V1ä¼ è¾“åŸºæœ¬æµç¨‹"><a href="#äºŒã€ç«¯å¯¹ç«¯1V1ä¼ è¾“åŸºæœ¬æµç¨‹" class="headerlink" title="äºŒã€ç«¯å¯¹ç«¯1V1ä¼ è¾“åŸºæœ¬æµç¨‹"></a>äºŒã€ç«¯å¯¹ç«¯1V1ä¼ è¾“åŸºæœ¬æµç¨‹</h2><h3 id="1ã€ç®€è¿°WebRTCåª’ä½“åå•†çš„æ ¸å¿ƒè¿‡ç¨‹ï¼Ÿï¼ˆ4ä¸ªï¼‰"><a href="#1ã€ç®€è¿°WebRTCåª’ä½“åå•†çš„æ ¸å¿ƒè¿‡ç¨‹ï¼Ÿï¼ˆ4ä¸ªï¼‰" class="headerlink" title="1ã€ç®€è¿°WebRTCåª’ä½“åå•†çš„æ ¸å¿ƒè¿‡ç¨‹ï¼Ÿï¼ˆ4ä¸ªï¼‰"></a>1ã€ç®€è¿°WebRTC<code>åª’ä½“åå•†</code>çš„æ ¸å¿ƒè¿‡ç¨‹ï¼Ÿï¼ˆ4ä¸ªï¼‰</h3><ul><li>Amyï¼šåˆ›å»ºOfferï¼Œè®¾ç½®setLocalDescription</li><li>Bobï¼šæ”¶åˆ°Offerï¼Œè®¾ç½®setRemoteDescription</li><li>Bobï¼šåˆ›å»ºAnswerï¼Œè®¾ç½®setLocalDescription</li><li>Amyï¼šæ”¶åˆ°answerï¼Œè®¾ç½®setRemoteDescription</li></ul><img src="/2022/06/19/WebRTC%E5%85%A5%E9%97%A8/day10%E7%AB%AF%E5%AF%B9%E7%AB%AF%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/image-20220619083122853.png" class="" title="image-20220619083122853"><h3 id="2ã€ç«¯å¯¹ç«¯é“¾æ¥å®Œæ•´æµç¨‹ï¼Ÿï¼ˆç”»å¾—å¤ªå¥½äº†ï¼Œæœ‰ç©ºè‡ªå·±ç”»ä¸€ç”»ï¼Œä¸€å®šè¦ï¼‰"><a href="#2ã€ç«¯å¯¹ç«¯é“¾æ¥å®Œæ•´æµç¨‹ï¼Ÿï¼ˆç”»å¾—å¤ªå¥½äº†ï¼Œæœ‰ç©ºè‡ªå·±ç”»ä¸€ç”»ï¼Œä¸€å®šè¦ï¼‰" class="headerlink" title="2ã€ç«¯å¯¹ç«¯é“¾æ¥å®Œæ•´æµç¨‹ï¼Ÿï¼ˆç”»å¾—å¤ªå¥½äº†ï¼Œæœ‰ç©ºè‡ªå·±ç”»ä¸€ç”»ï¼Œä¸€å®šè¦ï¼‰"></a>2ã€ç«¯å¯¹ç«¯é“¾æ¥å®Œæ•´æµç¨‹ï¼Ÿï¼ˆç”»å¾—å¤ªå¥½äº†ï¼Œæœ‰ç©ºè‡ªå·±ç”»ä¸€ç”»ï¼Œä¸€å®šè¦ï¼‰</h3><ul><li>â‘ åª’ä½“åå•†</li><li>â‘¡å…¶æ¬¡æ˜¯äº¤æ¢Candidateï¼Œè¿›è¡ŒICEè¿‡ç¨‹</li><li>â‘¢æµåª’ä½“ä¼ è¾“</li></ul><img src="/2022/06/19/WebRTC%E5%85%A5%E9%97%A8/day10%E7%AB%AF%E5%AF%B9%E7%AB%AF%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/image-20220619083342751.png" class="" title="image-20220619083342751"><h2 id="ä¸‰ã€ç«¯å¯¹ç«¯1V1ä¼ è¾“åŸºæœ¬æµç¨‹-ä»£ç å®ç°"><a href="#ä¸‰ã€ç«¯å¯¹ç«¯1V1ä¼ è¾“åŸºæœ¬æµç¨‹-ä»£ç å®ç°" class="headerlink" title="ä¸‰ã€ç«¯å¯¹ç«¯1V1ä¼ è¾“åŸºæœ¬æµç¨‹ - ä»£ç å®ç°"></a>ä¸‰ã€ç«¯å¯¹ç«¯1V1ä¼ è¾“åŸºæœ¬æµç¨‹ - ä»£ç å®ç°</h2><ul><li>htmlä»£ç å®ç°</li></ul><figure class="highlight html"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>RTCPeerConnection<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/main.css&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;localVideo&quot;</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">playsinline</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;remoteVideo&quot;</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">playsinline</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;start&quot;</span>&gt;</span>start<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;call&quot;</span>&gt;</span>call<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hangup&quot;</span>&gt;</span>hang up<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://webrtc.github.io/adapter/adapter-latest.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./js/main.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><ul><li>cssä»£ç å®ç°</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> *  Copyright (c) 2015 The WebRTC project authors. All Rights Reserved.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *  Use of this source code is governed by a BSD-style license</span><br><span class="hljs-comment"> *  that can be found in the LICENSE file in the root of the source</span><br><span class="hljs-comment"> *  tree.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-selector-tag">button</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">25px</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">vertical-align</span>: top;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">134px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-id">#getUserMedia</span> &#123;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.input</span> &#123;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">vertical-align</span>: top;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">310px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.input</span> &gt; <span class="hljs-selector-tag">div</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">vertical-align</span>: top;<br>&#125;<br><br><span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.output</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eee</span>;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;Inconsolata&#x27;</span>, <span class="hljs-string">&#x27;Courier New&#x27;</span>, monospace;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9em</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">10px</span> <span class="hljs-number">10px</span> <span class="hljs-number">25px</span>;<br>  <span class="hljs-attribute">position</span>: relative;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">white-space</span>: pre;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">270px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#statistics</span> <span class="hljs-selector-tag">div</span> &#123;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;Inconsolata&#x27;</span>, <span class="hljs-string">&#x27;Courier New&#x27;</span>, monospace;<br>  <span class="hljs-attribute">vertical-align</span>: top;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">308px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#statistics</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-id">#senderStats</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#constraints</span> &gt; <span class="hljs-selector-tag">div</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">h2</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1em</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#constraints</span> <span class="hljs-selector-tag">label</span> &#123;<br>  <span class="hljs-attribute">display</span>: inline-block;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">156px</span>;<br>&#125;<br><br><span class="hljs-selector-tag">section</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">15px</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">video</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#222</span>;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attr">--width</span>: <span class="hljs-number">45%</span>;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--width);<br>  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">var</span>(--width);<br>&#125;<br><br><span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">720px</span>) &#123;<br>  <span class="hljs-selector-tag">button</span> &#123;<br>    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">56px</span>;<br>    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.3em</span>;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">90px</span>;<br>  &#125;<br><br>  <span class="hljs-selector-tag">div</span><span class="hljs-selector-id">#getUserMedia</span> &#123;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">40px</span> <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-selector-tag">section</span><span class="hljs-selector-id">#statistics</span> <span class="hljs-selector-tag">div</span> &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">50%</span> - <span class="hljs-number">14px</span>);<br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>æ ¸å¿ƒjsä»£ç å®ç°ï¼ˆå…¶å®å°±æ˜¯ä¸Šé¢æ—¶åºå›¾çš„å®ç°æµç¨‹ï¼Œæ‰€ä»¥è¯´æŒæ¡æ—¶åºå›¾å¾ˆé‡è¦ï¼‰</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-keyword">var</span> localVideo = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;video#localVideo&#x27;</span>);<br><span class="hljs-keyword">var</span> remoteVideo = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;video#remoteVideo&#x27;</span>);<br><span class="hljs-keyword">var</span> btnStart = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;button#start&#x27;</span>);<br><span class="hljs-keyword">var</span> btnCall = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;button#call&#x27;</span>);<br><span class="hljs-keyword">var</span> btnHangUp= <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;button#hangup&#x27;</span>);<br><br><br><span class="hljs-keyword">var</span> localStream;<br><span class="hljs-keyword">var</span> pc1; <br><span class="hljs-keyword">var</span> pc2;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">gotMediaStream</span>(<span class="hljs-params">stream</span>) &#123;<br>  localVideo.<span class="hljs-property">srcObject</span> = stream;<br>  localStream = stream;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleError</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Failed to call getUserMedia&quot;</span>, err);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> constraints = &#123;<br>    <span class="hljs-attr">video</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">audio</span>:<span class="hljs-literal">false</span><br>  &#125;<br>  <span class="hljs-keyword">if</span>(!navigator.<span class="hljs-property">mediaDevices</span> || !navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-property">getUserMedia</span>) &#123;<br>    <span class="hljs-keyword">return</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getUserMedia</span>(constraints)<br>    .<span class="hljs-title function_">then</span>(gotMediaStream)<br>    .<span class="hljs-title function_">catch</span>(handleError);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">gotAnswerDescription</span>(<span class="hljs-params">desc</span>) &#123;<br>  pc2.<span class="hljs-title function_">setLocalDescription</span>(desc);<br><br>  <span class="hljs-comment">//send sdp to caller</span><br>  <span class="hljs-comment">//recieve sdp from callee</span><br>  pc1.<span class="hljs-title function_">setRemoteDescription</span>(desc);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">gotLocalDescription</span>(<span class="hljs-params">desc</span>) &#123;<br>  pc1.<span class="hljs-title function_">setLocalDescription</span>(desc);<br><br>  <span class="hljs-comment">//send sdp to callee</span><br>  <span class="hljs-comment">//receive sdp from caller</span><br>  pc2.<span class="hljs-title function_">setRemoteDescription</span>(desc);<br>  pc2.<span class="hljs-title function_">createAnswer</span>().<span class="hljs-title function_">then</span>(gotAnswerDescription)<br>  .<span class="hljs-title function_">catch</span>(handleError);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">gotRemoteStream</span>(<span class="hljs-params">e</span>) &#123;<br>  <span class="hljs-keyword">if</span>(remoteVideo.<span class="hljs-property">srcObject</span> !== e.<span class="hljs-property">streams</span>[<span class="hljs-number">0</span>]) &#123;<br>    remoteVideo.<span class="hljs-property">srcObject</span> = e.<span class="hljs-property">streams</span>[<span class="hljs-number">0</span>];<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">call</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> offerOptions = &#123;<br><span class="hljs-attr">offerToReceiveAudio</span>: <span class="hljs-number">0</span>,<br><span class="hljs-attr">offerToReceiveVideo</span>: <span class="hljs-number">1</span> <br>  &#125;<br>  pc1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCPeerConnection</span>();<br>  pc1.<span class="hljs-property">onicecandidate</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">//send candidate to peer</span><br>    <span class="hljs-comment">//receive candidate from peer</span><br>    pc2.<span class="hljs-title function_">addIceCandidate</span>(e.<span class="hljs-property">candidate</span>).<span class="hljs-title function_">catch</span>(handleError);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;pc1 ICE candidate&#x27;</span>, e.<span class="hljs-property">candidate</span>);<br>  &#125;<br><br>pc1.<span class="hljs-property">iceconnectionstatechange</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`pc1 ICE state: <span class="hljs-subst">$&#123;pc.iceConnectionState&#125;</span>`</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ICE state change event: &#x27;</span>, e);<br>&#125;<br><br>  pc2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCPeerConnection</span>();<br>  pc2.<span class="hljs-property">onicecandidate</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">//send candidate to peer</span><br>    <span class="hljs-comment">//receive candidate from peer</span><br>    pc1.<span class="hljs-title function_">addIceCandidate</span>(e.<span class="hljs-property">candidate</span>).<span class="hljs-title function_">catch</span>(handleError);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;pc2 ICE candidate&#x27;</span>, e.<span class="hljs-property">candidate</span>);<br>  &#125;<br><br>pc2.<span class="hljs-property">iceconnectionstatechange</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`pc2 ICE state: <span class="hljs-subst">$&#123;pc.iceConnectionState&#125;</span>`</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ICE state change event: &#x27;</span>, e);<br>&#125;<br><br>  pc2.<span class="hljs-property">ontrack</span> = gotRemoteStream;<br><br>  <span class="hljs-comment">//add Stream to caller</span><br>  localStream.<span class="hljs-title function_">getTracks</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">track</span>)=&gt;</span>&#123;<br>    pc1.<span class="hljs-title function_">addTrack</span>(track, localStream);<br>  &#125;);<br><br>  pc1.<span class="hljs-title function_">createOffer</span>(offerOptions)<br>  .<span class="hljs-title function_">then</span>(gotLocalDescription)<br>  .<span class="hljs-title function_">catch</span>(handleError);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">hangup</span>(<span class="hljs-params"></span>) &#123;<br>  pc1.<span class="hljs-title function_">close</span>();<br>  pc2.<span class="hljs-title function_">close</span>();<br>  pc1 = <span class="hljs-literal">null</span>;<br>  pc2 = <span class="hljs-literal">null</span>;<br>&#125;<br><br>btnStart.<span class="hljs-property">onclick</span> = start;<br>btnCall.<span class="hljs-property">onclick</span> = call;<br>btnHangUp.<span class="hljs-property">onclick</span> = hangup;<br></code></pre></td></tr></table></figure><ul><li>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š</li></ul><img src="/2022/06/19/WebRTC%E5%85%A5%E9%97%A8/day10%E7%AB%AF%E5%AF%B9%E7%AB%AF%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/image-20220619094922812.png" class="">]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
      <tag>WireShark</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day09-WebRTCç½‘ç»œåŸºç¡€è¡¥å……ï¼šP2P/STUN/TURN/ICEçŸ¥è¯†</title>
    <link href="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/"/>
    <url>/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€åŸºæœ¬æ¦‚å¿µå…ˆè®¤è¯†"><a href="#ä¸€ã€åŸºæœ¬æ¦‚å¿µå…ˆè®¤è¯†" class="headerlink" title="ä¸€ã€åŸºæœ¬æ¦‚å¿µå…ˆè®¤è¯†"></a>ä¸€ã€åŸºæœ¬æ¦‚å¿µå…ˆè®¤è¯†</h2><h3 id="1ã€NATçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸNATæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"><a href="#1ã€NATçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸNATæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ" class="headerlink" title="1ã€NATçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸNATæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"></a>1ã€NATçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸNATæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</h3><ul><li><font color="red">NAT</font>ï¼šNetwork Address Translationï¼Œå³ç½‘ç»œåœ°å€æ˜ å°„</li><li><font color="red">ä½œç”¨</font>ï¼šâ‘ è§£å†³IPV4åœ°å€ä¸è¶³çš„é—®é¢˜ â‘¡ä¿æŠ¤NATå†…éƒ¨è®¡ç®—æœºçš„å®‰å…¨</li></ul><h3 id="2ã€STUNçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸSTUNæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"><a href="#2ã€STUNçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸSTUNæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ" class="headerlink" title="2ã€STUNçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸSTUNæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"></a>2ã€STUNçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸSTUNæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</h3><ul><li><p><font color="red">STUN</font>ï¼šSimple Traversal of UDP Through NATï¼Œå³UDPå¯¹NATçš„ç®€å•ç©¿è¶Šæ–¹å¼ï¼ˆæ˜¯ä¸€ç§åè®®ï¼‰</p></li><li><p><font color="red">åŠŸèƒ½</font>ï¼šé€šè¿‡NATç©¿è¶Šï¼Œå†…ç½‘çš„è®¡ç®—æœºä¸å¤–ç½‘èƒ½å¤Ÿè¿›è¡ŒP2Pè¿æ¥é€šä¿¡ï¼ˆæœ‰ç‚¹ä¸­ä»‹ä¿¡æ¯æœåŠ¡åº¦çš„æ„Ÿè§‰ï¼‰</p></li><li><p><font color="red">ç¼ºé™·</font>ï¼šâ‘ STUNä¸é€‚åˆæ”¯æŒTCPè¿æ¥çš„ç©¿è¶Š â‘¡STUNæ–¹å¼ä¸æ”¯æŒå¯¹ç§°NATç©¿è¶Š</p></li><li><p>STUNçš„å­˜åœ¨ç›®çš„å°±æ˜¯è¿›è¡ŒNATç©¿è¶Š</p></li><li><p>STUNæ˜¯å…¸å‹çš„å®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯æ¨¡å¼ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿›è¡Œå“åº”ã€‚</p></li><li><p>æœ¬ç« å¯¹STUNåè®®ã€åè®®å¤´ã€åè®®ä½“éƒ½æœ‰è¯¦ç»†æè¿°ï¼Œæ—¥åéœ€è¦å†å›æ¥çœ‹ã€‚</p></li></ul><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618215247077.png" class=""><h3 id="3ã€TURNçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸTURNæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"><a href="#3ã€TURNçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸTURNæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ" class="headerlink" title="3ã€TURNçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸTURNæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"></a>3ã€TURNçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸTURNæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</h3><ul><li><font color="red">TURN</font>ï¼šTranversal Using ReplayNATï¼Œå³é€šè¿‡Relayæ–¹å¼ç©¿è¶ŠNAT</li><li><font color="red">åŠŸèƒ½</font>ï¼šå³ç§ç½‘ç”¨æˆ·å‘å‡ºçš„æŠ¥æ–‡éƒ½è¦ç»è¿‡ TURNServer è¿›è¡Œ Relay è½¬å‘</li><li><font color="red">ä¼˜ç‚¹</font>ï¼šè§£å†³äº†STUNçš„æ— æ³•ç©¿è¶Šçš„é—®é¢˜</li><li>TURNç®€å†åœ¨STUNä¹‹ä¸Šï¼Œæ¶ˆæ¯æ ¼å¼ä½¿ç”¨STUNæ ¼å¼æ¶ˆæ¯</li><li>TURN Client è¦æ±‚æœåŠ¡ç«¯åˆ†é…ä¸€ä¸ªå…¬ç½‘IPå’ŒPortç”¨æˆ·æ¥æ”¶æˆ–å‘é€æ•°æ®ã€‚</li></ul><h3 id="4ã€ICEçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸICEæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"><a href="#4ã€ICEçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸICEæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ" class="headerlink" title="4ã€ICEçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸICEæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"></a><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618215509316.png" class="">4ã€ICEçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼ŸICEæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</h3><ul><li><font color="red">ICE</font>ï¼šInteractive Connectivity EStablishment</li><li><font color="red">åŠŸèƒ½</font>ï¼šICEä¸æ˜¯ä¸€ç§åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªframeworkï¼Œå®ƒæ•´åˆäº†STUNå’ŒTURN</li><li><font color="red">ä¸¾ä¾‹</font>ï¼š<code>ä»â‘ å±€åŸŸç½‘å°è¯•ã€â‘¡NATç©¿è¶Šå°è¯•ã€â‘¢TRUNæœåŠ¡ç«¯ä¸­è½¬ </code>è¿™ä¸‰ç§æ¨¡å¼ä¸­ï¼Œé€‰ä¸€ä¸ªæœ€ä½³é€šä¿¡æ¨¡å¼</li></ul><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618215628498.png" class="" title="image-20220618215628498"><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220619081142118.png" class="" title="image-20220619081142118"><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220619081149307.png" class="" title="image-20220619081149307"><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220619081157868.png" class="" title="image-20220619081157868"><h2 id="äºŒã€æ›´æ·±å…¥è®¤è¯†NAT"><a href="#äºŒã€æ›´æ·±å…¥è®¤è¯†NAT" class="headerlink" title="äºŒã€æ›´æ·±å…¥è®¤è¯†NAT"></a>äºŒã€æ›´æ·±å…¥è®¤è¯†NAT</h2><h3 id="1ã€å†æ¬¡è®¤è¯†NAT"><a href="#1ã€å†æ¬¡è®¤è¯†NAT" class="headerlink" title="1ã€å†æ¬¡è®¤è¯†NAT"></a>1ã€å†æ¬¡è®¤è¯†NAT</h3><ul><li>NATå°±æ˜¯å†…ç½‘åœ°å€è½¬æ¢åˆ°å…¬ç½‘åœ°å€</li><li>ç®€å•æ¥è¯´å°±æ˜¯ä¸€å¼ åœ°å€<code>æ˜ å°„è¡¨</code></li></ul><h3 id="2ã€NATæœ‰å“ªå››ä¸ªç§ç±»ï¼Ÿ"><a href="#2ã€NATæœ‰å“ªå››ä¸ªç§ç±»ï¼Ÿ" class="headerlink" title="2ã€NATæœ‰å“ªå››ä¸ªç§ç±»ï¼Ÿ"></a>2ã€NATæœ‰å“ªå››ä¸ªç§ç±»ï¼Ÿ</h3><ul><li>å®Œå…¨é”¥å‹NAT</li><li>åœ°å€é™åˆ¶é”¥å‹NAT</li><li>ç«¯å£é™åˆ¶é”¥å‹NAT</li><li>å¯¹ç§°å‹NAT</li></ul><h3 id="3ã€ä»€ä¹ˆæ˜¯å®Œå…¨é”¥å‹NATï¼Ÿ"><a href="#3ã€ä»€ä¹ˆæ˜¯å®Œå…¨é”¥å‹NATï¼Ÿ" class="headerlink" title="3ã€ä»€ä¹ˆæ˜¯å®Œå…¨é”¥å‹NATï¼Ÿ"></a>3ã€ä»€ä¹ˆæ˜¯å®Œå…¨é”¥å‹NATï¼Ÿ</h3><ul><li><p>Full cone NAT</p></li><li><p>å†…éƒ¨æœºå™¨Aè®¿é—®å¤–ç½‘æœºå™¨Cï¼ŒNATæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œåé¢<strong>å¤–ç½‘çš„ä»»æ„ipå’Œä»»æ„port</strong>éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªç«¯å£ï¼Œä¹Ÿå°±æ˜¯<strong>ä»»æ„ip+ä»»æ„port</strong>å¯ä»¥è®¿é—®æœºå™¨A</p></li></ul><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618214518833.png" class="" title="image-20220618214518833"><h3 id="4ã€ä»€ä¹ˆæ˜¯åœ°å€é™åˆ¶é”¥å‹NATï¼Ÿ"><a href="#4ã€ä»€ä¹ˆæ˜¯åœ°å€é™åˆ¶é”¥å‹NATï¼Ÿ" class="headerlink" title="4ã€ä»€ä¹ˆæ˜¯åœ°å€é™åˆ¶é”¥å‹NATï¼Ÿ"></a>4ã€ä»€ä¹ˆæ˜¯åœ°å€é™åˆ¶é”¥å‹NATï¼Ÿ</h3><ul><li>Address Restricted Cone</li><li>å†…éƒ¨æœºå™¨Aè®¿é—®å¤–ç½‘æœºå™¨Cï¼ŒNATæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œåé¢<strong>æœºå™¨Cçš„ä»»æ„port</strong>å¯ä»¥è®¿é—®è¿™ä¸ªç«¯å£ï¼Œå°±æ˜¯åªèƒ½<strong>å›ºå®šip+ä»»æ„port</strong>è®¿é—®A</li></ul><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618214528801.png" class="" title="image-20220618214528801"><h3 id="5ã€ä»€ä¹ˆæ˜¯ç«¯å£é™åˆ¶é”¥å‹NATï¼Ÿ"><a href="#5ã€ä»€ä¹ˆæ˜¯ç«¯å£é™åˆ¶é”¥å‹NATï¼Ÿ" class="headerlink" title="5ã€ä»€ä¹ˆæ˜¯ç«¯å£é™åˆ¶é”¥å‹NATï¼Ÿ"></a>5ã€ä»€ä¹ˆæ˜¯ç«¯å£é™åˆ¶é”¥å‹NATï¼Ÿ</h3><ul><li>Port Restricted Cone</li><li>å†…éƒ¨æœºå™¨Aè®¿é—®å¤–ç½‘æœºå™¨Cï¼ŒNATæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œåé¢<strong>æœºå™¨Cçš„å›ºå®šport</strong>å¯ä»¥è®¿é—®è¿™ä¸ªç«¯å£ï¼Œå°±æ˜¯åªèƒ½<strong>å›ºå®šip+å›ºå®šport</strong>è®¿é—®A</li></ul><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618214540839.png" class="" title="image-20220618214540839"><h3 id="6ã€ä»€ä¹ˆæ˜¯å¯¹ç§°å‹NATï¼Ÿ"><a href="#6ã€ä»€ä¹ˆæ˜¯å¯¹ç§°å‹NATï¼Ÿ" class="headerlink" title="6ã€ä»€ä¹ˆæ˜¯å¯¹ç§°å‹NATï¼Ÿ"></a>6ã€ä»€ä¹ˆæ˜¯å¯¹ç§°å‹NATï¼Ÿ</h3><ul><li>Symmetric</li><li>è¿æ¥ä¸åŒçš„å¤–éƒ¨Serverï¼ŒNATæ‰“å¼€çš„ç«¯å£ä¼šå˜åŒ–ã€‚ä¹Ÿå°±æ˜¯å†…éƒ¨æœºå™¨Aè¿æ¥å¤–ç½‘æœºå™¨Bæ—¶ï¼ŒNATä¼šæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œè¿æ¥å¤–ç½‘æœºå™¨Cæ—¶åˆä¼šæ‰“å¼€å¦å¤–ä¸€ä¸ªç«¯å£ã€‚</li></ul><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618214550416.png" class="" title="image-20220618214550416"><h2 id="ä¸‰ã€è®¤è¯†NATç©¿è¶Šè¿‡ç¨‹"><a href="#ä¸‰ã€è®¤è¯†NATç©¿è¶Šè¿‡ç¨‹" class="headerlink" title="ä¸‰ã€è®¤è¯†NATç©¿è¶Šè¿‡ç¨‹"></a>ä¸‰ã€è®¤è¯†NATç©¿è¶Šè¿‡ç¨‹</h2><h3 id="1ã€NATç©¿è¶ŠåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€NATç©¿è¶ŠåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€NATç©¿è¶ŠåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€NATç©¿è¶ŠåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>åŸºäºå„ç§NATç‰¹æ€§ï¼Œè®©ä¸¤å°ç§ç½‘æœºå™¨èƒ½å¤Ÿp2pé€šä¿¡</li></ul><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618214733843.png" class=""><h3 id="2ã€NATèƒ½ç©¿è¶ŠæˆåŠŸçš„ç»„åˆï¼Ÿï¼ˆè®°ä½å“ªä¸¤ç§ä¸å¯èƒ½æ‰“é€šå³å¯ï¼‰"><a href="#2ã€NATèƒ½ç©¿è¶ŠæˆåŠŸçš„ç»„åˆï¼Ÿï¼ˆè®°ä½å“ªä¸¤ç§ä¸å¯èƒ½æ‰“é€šå³å¯ï¼‰" class="headerlink" title="2ã€NATèƒ½ç©¿è¶ŠæˆåŠŸçš„ç»„åˆï¼Ÿï¼ˆè®°ä½å“ªä¸¤ç§ä¸å¯èƒ½æ‰“é€šå³å¯ï¼‰"></a>2ã€NATèƒ½ç©¿è¶ŠæˆåŠŸçš„ç»„åˆï¼Ÿï¼ˆè®°ä½å“ªä¸¤ç§ä¸å¯èƒ½æ‰“é€šå³å¯ï¼‰</h3><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618214814385.png" class=""><h3 id="3ã€NATç±»å‹åˆ¤æ–­è¿‡ç¨‹ï¼Ÿï¼ˆè¿™å›¾å¾ˆç»å…¸ï¼Œåé¢ä¸æ‡‚å†å›æ¥çœ‹ï¼‰"><a href="#3ã€NATç±»å‹åˆ¤æ–­è¿‡ç¨‹ï¼Ÿï¼ˆè¿™å›¾å¾ˆç»å…¸ï¼Œåé¢ä¸æ‡‚å†å›æ¥çœ‹ï¼‰" class="headerlink" title="3ã€NATç±»å‹åˆ¤æ–­è¿‡ç¨‹ï¼Ÿï¼ˆè¿™å›¾å¾ˆç»å…¸ï¼Œåé¢ä¸æ‡‚å†å›æ¥çœ‹ï¼‰"></a>3ã€NATç±»å‹åˆ¤æ–­è¿‡ç¨‹ï¼Ÿï¼ˆè¿™å›¾å¾ˆç»å…¸ï¼Œåé¢ä¸æ‡‚å†å›æ¥çœ‹ï¼‰</h3><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day09%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/image-20220618214917186.png" class="" title="image-20220618214917186">]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day08-WebRTCä¿¡ä»¤æœåŠ¡å™¨å®ç°</title>
    <link href="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day08%E4%BF%A1%E4%BB%A4%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E7%8E%B0/"/>
    <url>/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day08%E4%BF%A1%E4%BB%A4%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€è®¤è¯†-socket-io"><a href="#ä¸€ã€è®¤è¯†-socket-io" class="headerlink" title="ä¸€ã€è®¤è¯† socket.io"></a>ä¸€ã€è®¤è¯† socket.io</h2><h3 id="1ã€å€ŸåŠ©-socket-io-å‘é€ç»™æŸäº›å¯¹è±¡çš„ç›¸å…³APIï¼Ÿ"><a href="#1ã€å€ŸåŠ©-socket-io-å‘é€ç»™æŸäº›å¯¹è±¡çš„ç›¸å…³APIï¼Ÿ" class="headerlink" title="1ã€å€ŸåŠ© socket.io å‘é€ç»™æŸäº›å¯¹è±¡çš„ç›¸å…³APIï¼Ÿ"></a>1ã€å€ŸåŠ© socket.io å‘é€ç»™æŸäº›å¯¹è±¡çš„ç›¸å…³APIï¼Ÿ</h3><figure class="highlight js"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//ç»™æœ¬æ¬¡è¿æ¥å‘æ¶ˆæ¯</span><br>socket.<span class="hljs-title function_">emit</span>()<br><br><span class="hljs-comment">//ç»™æŸä¸ªæˆ¿é—´å†…æ‰€æœ‰äººå‘æ¶ˆæ¯</span><br>io.<span class="hljs-title function_">in</span>(room).<span class="hljs-title function_">emit</span>()<br><br><span class="hljs-comment">//é™¤æœ¬è¿æ¥å¤–ï¼Œç»™æŸä¸ªæˆ¿é—´å†…æ‰€æœ‰äººå‘æ¶ˆæ¯</span><br>socket.<span class="hljs-title function_">to</span>(room).<span class="hljs-title function_">emit</span>()<br><br><span class="hljs-comment">//é™¤æœ¬è¿æ¥å¤–ï¼Œç»™æ‰€æœ‰äººå‘æ¶ˆæ¯</span><br>socket.<span class="hljs-property">brocast</span>.<span class="hljs-title function_">emit</span>()<br></code></pre></td></tr></table></figure><h3 id="2ã€socket-io-ç›‘å¬å’Œå‘é€å…·ä½“æ¶ˆæ¯çš„æ ¼å¼ï¼Ÿ"><a href="#2ã€socket-io-ç›‘å¬å’Œå‘é€å…·ä½“æ¶ˆæ¯çš„æ ¼å¼ï¼Ÿ" class="headerlink" title="2ã€socket.io ç›‘å¬å’Œå‘é€å…·ä½“æ¶ˆæ¯çš„æ ¼å¼ï¼Ÿ"></a>2ã€socket.io ç›‘å¬å’Œå‘é€å…·ä½“æ¶ˆæ¯çš„æ ¼å¼ï¼Ÿ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//å‘é€actionå‘½ä»¤</span><br><span class="hljs-attr">S</span>:socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;action&#x27;</span>);<br><span class="hljs-attr">C</span>:socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;action&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;...&#125;);<br><br><span class="hljs-comment">//å‘é€actionå‘½ä»¤ï¼Œè¿˜æœ‰dataæ•°æ®</span><br><span class="hljs-attr">S</span>:socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;action&#x27;</span>, data);<br><span class="hljs-attr">C</span>:socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;action&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)&#123;...&#125;);<br><br><span class="hljs-comment">//å‘é€actionå‘½ä»¤ï¼Œè¿˜æœ‰ä¸¤ä¸ªæ•°æ®</span><br><span class="hljs-attr">S</span>:socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;action&#x27;</span>, arg1, arg2);<br><span class="hljs-attr">C</span>:socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;action&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">arg1, arg2</span>)&#123;...&#125;);<br>                                             <br><span class="hljs-comment">//å‘é€actionå‘½ä»¤ï¼Œè¿˜æœ‰å›è°ƒå‡½æ•°</span><br><span class="hljs-attr">S</span>:socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;action&#x27;</span>, data, <span class="hljs-keyword">function</span>(<span class="hljs-params">arg1, arg2</span>)&#123;...&#125;);<br><span class="hljs-attr">C</span>:socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;action&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">data, fn</span>)&#123;...&#125;);<br></code></pre></td></tr></table></figure><h3 id="3ã€åœ¨WebRTCä¸­ä¿¡ä»¤æœåŠ¡å™¨æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#3ã€åœ¨WebRTCä¸­ä¿¡ä»¤æœåŠ¡å™¨æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="3ã€åœ¨WebRTCä¸­ä¿¡ä»¤æœåŠ¡å™¨æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>3ã€åœ¨WebRTCä¸­ä¿¡ä»¤æœåŠ¡å™¨æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h3><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day08%E4%BF%A1%E4%BB%A4%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E7%8E%B0/image-20220618190417842.png" class="" title="image-20220618190417842"><ul><li>â‘ ç»ˆç«¯ä¹‹é—´äº¤æ¢<font color="red">åª’ä½“ç›¸å…³ä¿¡æ¯</font>ï¼ˆæ¯”å¦‚ç¼–ç æ ¼å¼ã€æ˜¯å¦æ”¯æŒéŸ³é¢‘ã€æ˜¯å¦æ”¯æŒè§†é¢‘ç­‰ï¼‰</li><li>â‘¡ç»ˆç«¯ä¹‹é—´äº¤æ¢<font color="red">ç½‘ç»œç›¸å…³ä¿¡æ¯</font>ï¼ˆæ¯”å¦‚ipåœ°å€ã€localåœ°å€ã€å…¬ç½‘åœ°å€ç­‰ï¼‰</li><li>â‘¢ç»ˆç«¯ä¹‹é—´è¿›è¡Œ<font color="red">ä¸€äº›ä¸šåŠ¡æ“ä½œ</font> ï¼ˆæ¯”å¦‚åŠ å…¥æˆ¿é—´ã€é€€å‡ºæˆ¿é—´ç­‰ï¼‰</li></ul><h3 id="4ã€socket-ioæ˜¯åŸºäºTCPè¿˜æ˜¯UDPå‘¢ï¼Ÿ"><a href="#4ã€socket-ioæ˜¯åŸºäºTCPè¿˜æ˜¯UDPå‘¢ï¼Ÿ" class="headerlink" title="4ã€socket.ioæ˜¯åŸºäºTCPè¿˜æ˜¯UDPå‘¢ï¼Ÿ"></a>4ã€socket.ioæ˜¯åŸºäºTCPè¿˜æ˜¯UDPå‘¢ï¼Ÿ</h3><ul><li>å¯¹äºéŸ³è§†é¢‘æ¥è®²å¯ä»¥ä½¿ç”¨UDPï¼Œä¸¢äº†ä¸€ä¸¤å¸§æ•°æ®å…³ç³»ä¸å¤§ã€‚</li><li>ä½†æ˜¯å¯¹äºä¿¡ä»¤æˆ–ä¸šåŠ¡è¯·æ±‚æ¥è®²ï¼Œä¸€å®šè¦èƒ½æ‹¿åˆ°å¯é ç»“æœï¼Œé‚£å°±éœ€è¦TCPæ¥ä¿è¯ä¼ è¾“çš„å¯é æ€§ã€‚</li><li>socket.io æ˜¯åŸºäºTCPçš„</li></ul><h2 id="äºŒã€ä»£ç å€ŸåŠ©-socket-io-å®ç°ç®€æ˜“ç‰ˆèŠå¤©å®¤"><a href="#äºŒã€ä»£ç å€ŸåŠ©-socket-io-å®ç°ç®€æ˜“ç‰ˆèŠå¤©å®¤" class="headerlink" title="äºŒã€ä»£ç å€ŸåŠ© socket.io å®ç°ç®€æ˜“ç‰ˆèŠå¤©å®¤"></a>äºŒã€ä»£ç å€ŸåŠ© socket.io å®ç°ç®€æ˜“ç‰ˆèŠå¤©å®¤</h2><h3 id="1ã€å®‰è£…ä¾èµ–åº“"><a href="#1ã€å®‰è£…ä¾èµ–åº“" class="headerlink" title="1ã€å®‰è£…ä¾èµ–åº“"></a>1ã€å®‰è£…ä¾èµ–åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿™é‡Œè¿›è¡ŒæŒ‡å®šç‰ˆæœ¬ï¼Œé˜²æ­¢ä¸€äº›æ–¹æ³•å·²ç»å‘é€å˜åŒ–</span><br>npm install log4js@5.2.0<br>npm install socket.io@2.0.4  <br></code></pre></td></tr></table></figure><h3 id="2ã€ä»£ç å®ç°èŠå¤©å®¤-æœåŠ¡ç«¯éƒ¨åˆ†"><a href="#2ã€ä»£ç å®ç°èŠå¤©å®¤-æœåŠ¡ç«¯éƒ¨åˆ†" class="headerlink" title="2ã€ä»£ç å®ç°èŠå¤©å®¤(æœåŠ¡ç«¯éƒ¨åˆ†)"></a>2ã€ä»£ç å®ç°èŠå¤©å®¤(æœåŠ¡ç«¯éƒ¨åˆ†)</h3><ul><li>æœåŠ¡ç«¯ä»£ç </li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//æœåŠ¡ç«¯ä»£ç </span><br><span class="hljs-meta">&#x27;use strict&#x27;</span><br><br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> serveIndex = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;serve-index&#x27;</span>);<br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> socketIo = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;socket.io&#x27;</span>);<br><span class="hljs-keyword">var</span> log4js = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;log4js&#x27;</span>);<br><br><span class="hljs-comment">//log4jsçš„åŸºæœ¬é…ç½®ï¼ˆæ— é¡»å¤šåšäº†è§£ï¼‰</span><br>log4js.<span class="hljs-title function_">configure</span>(&#123;<br>  <span class="hljs-attr">appenders</span>: &#123;<br>      <span class="hljs-attr">file</span>: &#123;<br>          <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;file&#x27;</span>,<br>          <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;app.log&#x27;</span>,<br>          <span class="hljs-attr">layout</span>: &#123;<br>              <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;pattern&#x27;</span>,<br>              <span class="hljs-attr">pattern</span>: <span class="hljs-string">&#x27;%r %p - %m&#x27;</span>,<br>          &#125;<br>      &#125;<br>  &#125;,<br>  <span class="hljs-attr">categories</span>: &#123;<br>     <span class="hljs-attr">default</span>: &#123;<br>        <span class="hljs-attr">appenders</span>: [<span class="hljs-string">&#x27;file&#x27;</span>],<br>        <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;debug&#x27;</span><br>     &#125;<br>  &#125;<br>&#125;);<br><br><span class="hljs-keyword">var</span> logger = log4js.<span class="hljs-title function_">getLogger</span>();<br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">//é¡ºåºä¸èƒ½æ¢</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">serveIndex</span>(<span class="hljs-string">&#x27;./public&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">&#x27;./public&#x27;</span>));<br><br><span class="hljs-keyword">var</span> http_server = http.<span class="hljs-title function_">createServer</span>(app);<br>http_server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">9980</span>, <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>);<br><br><span class="hljs-comment">//ç»‘å®šsocket.ioåˆ°httpæœåŠ¡</span><br><span class="hljs-keyword">var</span> io = socketIo.<span class="hljs-title function_">listen</span>(http_server)<br><br>io.<span class="hljs-property">sockets</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">socket</span>)=&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;æœ‰äººå‘èµ·äº†é“¾æ¥è¯·æ±‚111&quot;</span>);<br>  <br>  socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room, data</span>)=&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;message&quot;</span> + room + data);<br>    io.<span class="hljs-title function_">in</span>(room).<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;message&#x27;</span>, room, socket.<span class="hljs-property">id</span>, data); <span class="hljs-comment">//æˆ¿é—´å†…æ‰€æœ‰äººï¼Œé™¤äº†è‡ªå·±</span><br>  &#125;);<br><br>  socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;join&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room</span>)=&gt;</span> &#123;<br>socket.<span class="hljs-title function_">join</span>(room);<br><span class="hljs-keyword">var</span> myRoom = io.<span class="hljs-property">sockets</span>.<span class="hljs-property">adapter</span>.<span class="hljs-property">rooms</span>[room];<br><span class="hljs-keyword">var</span> users = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(myRoom.<span class="hljs-property">sockets</span>).<span class="hljs-property">length</span>;<br>logger.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;the number of user in room is: &#x27;</span> + users);<br> socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;joined&#x27;</span>, room, socket.<span class="hljs-property">id</span>);<br>  &#125;);<br><br>  socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;leave&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room</span>)=&gt;</span> &#123;<br><span class="hljs-keyword">var</span> myRoom = io.<span class="hljs-property">sockets</span>.<span class="hljs-property">adapter</span>.<span class="hljs-property">rooms</span>[room];<br><span class="hljs-keyword">var</span> users = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(myRoom.<span class="hljs-property">sockets</span>).<span class="hljs-property">length</span>;<br>logger.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;the number of user in room is: &#x27;</span> + (users-<span class="hljs-number">1</span>));<br><br>socket.<span class="hljs-title function_">leave</span>(room);<br>socket.<span class="hljs-title function_">to</span>(room).<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;bye&#x27;</span>, room, socket.<span class="hljs-property">id</span>)<span class="hljs-comment">//æˆ¿é—´å†…æ‰€æœ‰äºº,é™¤è‡ªå·±å¤–</span><br> socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;leaved&#x27;</span>, room, socket.<span class="hljs-property">id</span>);<br>&#125;);<br>&#125;);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;webrtcæœåŠ¡å¯åŠ¨æˆåŠŸ&quot;</span>);<br><br><br><br></code></pre></td></tr></table></figure><h3 id="3ã€ä»£ç å®ç°å®¢æˆ·ç«¯éƒ¨åˆ†"><a href="#3ã€ä»£ç å®ç°å®¢æˆ·ç«¯éƒ¨åˆ†" class="headerlink" title="3ã€ä»£ç å®ç°å®¢æˆ·ç«¯éƒ¨åˆ†"></a>3ã€ä»£ç å®ç°å®¢æˆ·ç«¯éƒ¨åˆ†</h3><ul><li>index.html ä»£ç éƒ¨åˆ†</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- index.html ä»£ç éƒ¨åˆ† --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Chat Room<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./css/main.css&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">link</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>UserName: <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Chrome&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">text</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>room: <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;112222&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">text</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;room&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;connect&quot;</span>&gt;</span>Conect<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;leave&quot;</span> <span class="hljs-attr">disabled</span>&gt;</span>Leave<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Content: <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">disabled</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;line-height: 1.5;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;output&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;10&quot;</span> <span class="hljs-attr">cols</span>=<span class="hljs-string">&quot;100&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Input: <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">disabled</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;input&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">cols</span>=<span class="hljs-string">&quot;100&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;send&quot;</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./js/client.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><ul><li>.&#x2F;js&#x2F;client.js ä»£ç å®ç°</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ./js/client.js ä»£ç å®ç°</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">&#x27;use strict&#x27;</span><br><span class="hljs-keyword">var</span> userName = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;input#username&#x27;</span>);<br><span class="hljs-keyword">var</span> inputRoom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;input#room&#x27;</span>);<br><span class="hljs-keyword">var</span> btnConnect = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;button#connect&#x27;</span>);<br><span class="hljs-keyword">var</span> btnLeave = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;button#leave&#x27;</span>);<br><span class="hljs-keyword">var</span> outputArea = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;textarea#output&#x27;</span>);<br><span class="hljs-keyword">var</span> inputArea = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;textarea#input&#x27;</span>);<br><span class="hljs-keyword">var</span> btnSend = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;button#send&#x27;</span>);<br><br><span class="hljs-keyword">var</span> socket;<br><span class="hljs-keyword">var</span> room;<br><br>btnConnect.<span class="hljs-property">onclick</span> = <span class="hljs-function">()=&gt;</span> &#123;<br><span class="hljs-comment">//connect</span><br>socket = io.<span class="hljs-title function_">connect</span>();<br><br><span class="hljs-comment">//recieve message</span><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;joined&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room, id</span>) =&gt;</span> &#123;<br>btnConnect.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br>btnLeave.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;<br>inputArea.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;<br>btnSend.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;<br>&#125;);<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;leaved&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room, id</span>) =&gt;</span> &#123;<br>btnConnect.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;<br>btnLeave.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br>inputArea.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br>btnSend.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br><br>socket.<span class="hljs-title function_">disconnect</span>();<br>&#125;);<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">room, id, data</span>) =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;message:&#x27;</span> + room + id + data);<br>outputArea.<span class="hljs-property">scrollTop</span> = outputArea.<span class="hljs-property">scrollHeight</span>; <span class="hljs-comment">//çª—å£æ€»æ˜¯æ˜¾ç¤ºæœ€åçš„å†…å®¹</span><br>outputArea.<span class="hljs-property">value</span> = outputArea.<span class="hljs-property">value</span> + data + <span class="hljs-string">&quot;\n\r&quot;</span>;<br>&#125;)<br><br>socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;disconnect&quot;</span>, <span class="hljs-function">(<span class="hljs-params">socket</span>) =&gt;</span> &#123;<br>    btnConnect.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;<br>    btnLeave.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br>    inputArea.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br>    btnSend.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;<br>  &#125;);<br><br><span class="hljs-comment">//send message</span><br>room = inputRoom.<span class="hljs-property">value</span>;<br>socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;join&#x27;</span>, room);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userName.<span class="hljs-property">value</span> + <span class="hljs-string">&quot;å‘é€joinä¿¡æ¯&quot;</span>);<br>&#125;<br><br>btnSend.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> &#123;<br><span class="hljs-keyword">var</span> data = inputArea.<span class="hljs-property">value</span>;<br>data = userName.<span class="hljs-property">value</span> + <span class="hljs-string">&quot;:&quot;</span> + data;<br>socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;message&#x27;</span>, room, data);<br>inputArea.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>&#125;<br><br>btnLeave.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>room = inputRoom.<span class="hljs-property">value</span>;<br>socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;leave&#x27;</span>, room);<br>&#125;<br><br>inputArea.<span class="hljs-property">onkeypress</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">//event = event || window.event;</span><br>  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">keyCode</span> == <span class="hljs-number">13</span>) &#123;<br>    <span class="hljs-comment">//å›è½¦å‘é€æ¶ˆæ¯</span><br>    <span class="hljs-keyword">var</span> data = inputArea.<span class="hljs-property">value</span>;<br>    data = userName.<span class="hljs-property">value</span> + <span class="hljs-string">&quot;:&quot;</span> + data;<br>    socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;message&quot;</span>, room, data);<br>    inputArea.<span class="hljs-property">value</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    event.<span class="hljs-title function_">preventDefault</span>(); <span class="hljs-comment">//é˜»æ­¢é»˜è®¤è¡Œä¸º</span><br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="4ã€ç®€æ˜“èŠå¤©å®¤æœ€ç»ˆæ•ˆæœå›¾å¦‚ä¸‹"><a href="#4ã€ç®€æ˜“èŠå¤©å®¤æœ€ç»ˆæ•ˆæœå›¾å¦‚ä¸‹" class="headerlink" title="4ã€ç®€æ˜“èŠå¤©å®¤æœ€ç»ˆæ•ˆæœå›¾å¦‚ä¸‹"></a>4ã€ç®€æ˜“èŠå¤©å®¤æœ€ç»ˆæ•ˆæœå›¾å¦‚ä¸‹</h3><img src="/2022/06/18/WebRTC%E5%85%A5%E9%97%A8/day08%E4%BF%A1%E4%BB%A4%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E7%8E%B0/image-20220618205623601.png" class="" title="æœ€ç»ˆå®ç°safariå’ŒchromeèŠå¤©"><h3 id="5ã€é™„ä¸Špacket-jsonæ–‡ä»¶å†…å®¹"><a href="#5ã€é™„ä¸Špacket-jsonæ–‡ä»¶å†…å®¹" class="headerlink" title="5ã€é™„ä¸Špacket.jsonæ–‡ä»¶å†…å®¹"></a>5ã€é™„ä¸Špacket.jsonæ–‡ä»¶å†…å®¹</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;webserver&quot;</span>,<br>  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;server.js&quot;</span>,<br>  <span class="hljs-string">&quot;dependencies&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;express&quot;</span>: <span class="hljs-string">&quot;^4.18.1&quot;</span>,<br>    <span class="hljs-string">&quot;log4js&quot;</span>: <span class="hljs-string">&quot;^5.2.0&quot;</span>,<br>    <span class="hljs-string">&quot;serve-index&quot;</span>: <span class="hljs-string">&quot;^1.9.1&quot;</span>,<br>    <span class="hljs-string">&quot;socket.io&quot;</span>: <span class="hljs-string">&quot;^2.0.4&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;devDependencies&quot;</span>: &#123;&#125;,<br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,<br>    <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-string">&quot;node server.js&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;license&quot;</span>: <span class="hljs-string">&quot;ISC&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day06-è·å–éŸ³é¢‘è§†é¢‘</title>
    <link href="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day03%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E9%9F%B3%E9%A2%91/"/>
    <url>/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day03%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E9%9F%B3%E9%A2%91/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€éŸ³è§†é¢‘æ•°æ®é‡‡é›†"><a href="#ä¸€ã€éŸ³è§†é¢‘æ•°æ®é‡‡é›†" class="headerlink" title="ä¸€ã€éŸ³è§†é¢‘æ•°æ®é‡‡é›†"></a>ä¸€ã€éŸ³è§†é¢‘æ•°æ®é‡‡é›†</h2><h3 id="1ã€è®¤è¯†-MediaDevices-getUserMedia-æ˜¯ä»€ä¹ˆçš„ï¼Ÿ"><a href="#1ã€è®¤è¯†-MediaDevices-getUserMedia-æ˜¯ä»€ä¹ˆçš„ï¼Ÿ" class="headerlink" title="1ã€è®¤è¯† MediaDevices.getUserMedia() æ˜¯ä»€ä¹ˆçš„ï¼Ÿ"></a>1ã€è®¤è¯† <code>MediaDevices.getUserMedia()</code> æ˜¯ä»€ä¹ˆçš„ï¼Ÿ</h3><ul><li><p>ä¼šæç¤ºç”¨æˆ·ç»™ä¸ä½¿ç”¨åª’ä½“è¾“å…¥çš„è®¸å¯ï¼Œåª’ä½“è¾“å…¥ä¼šäº§ç”Ÿä¸€ä¸ª <code>MediaStream</code>ï¼Œé‡Œé¢åŒ…å«äº†è¯·æ±‚åª’ä½“ç±»å‹çš„è½¨é“</p></li><li><p>æ¯”å¦‚ï¼šè§†é¢‘è½¨é“ã€éŸ³é¢‘è½¨é“</p></li><li><p>å®ƒè¿”å›ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ï¼Œç”¨æˆ·æˆæƒåŒæ„åï¼Œresolveå›è°ƒä¸€ä¸ª MediaStreamå¯¹è±¡ã€‚</p></li><li><p>è¯¦ç»†ç”¨æ³•ï¼š <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/getUserMedia">https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/getUserMedia</a></p></li></ul><h3 id="2ã€ç”±äºå„ä¸ªæµè§ˆå™¨å‚å•†å¯¹åª’ä½“è®¾å¤‡çš„è·å–ï¼Œä»¥åŠéŸ³è§†é¢‘æµçš„è·å–æ–¹æ³•åç§°ä¸åŒï¼Œå¦‚æœé€‚é…å‘¢ï¼Ÿ"><a href="#2ã€ç”±äºå„ä¸ªæµè§ˆå™¨å‚å•†å¯¹åª’ä½“è®¾å¤‡çš„è·å–ï¼Œä»¥åŠéŸ³è§†é¢‘æµçš„è·å–æ–¹æ³•åç§°ä¸åŒï¼Œå¦‚æœé€‚é…å‘¢ï¼Ÿ" class="headerlink" title="2ã€ç”±äºå„ä¸ªæµè§ˆå™¨å‚å•†å¯¹åª’ä½“è®¾å¤‡çš„è·å–ï¼Œä»¥åŠéŸ³è§†é¢‘æµçš„è·å–æ–¹æ³•åç§°ä¸åŒï¼Œå¦‚æœé€‚é…å‘¢ï¼Ÿ"></a>2ã€ç”±äºå„ä¸ªæµè§ˆå™¨å‚å•†å¯¹åª’ä½“è®¾å¤‡çš„è·å–ï¼Œä»¥åŠéŸ³è§†é¢‘æµçš„è·å–æ–¹æ³•åç§°ä¸åŒï¼Œå¦‚æœé€‚é…å‘¢ï¼Ÿ</h3><ul><li>é€šå¸¸å€ŸåŠ©ä¸€ä¸ª <code>adapter.js</code> æ¥åšé€‚é…</li><li><a href="https://webrtc.github.io/adapter/adapter-latest.js">https://webrtc.github.io/adapter/adapter-latest.js</a></li></ul><h3 id="3ã€è·å–è§†é¢‘éŸ³é¢‘ï¼Œä»¥åŠå±•ç¤ºçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š"><a href="#3ã€è·å–è§†é¢‘éŸ³é¢‘ï¼Œä»¥åŠå±•ç¤ºçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š" class="headerlink" title="3ã€è·å–è§†é¢‘éŸ³é¢‘ï¼Œä»¥åŠå±•ç¤ºçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š"></a>3ã€è·å–è§†é¢‘éŸ³é¢‘ï¼Œä»¥åŠå±•ç¤ºçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</h3><ul><li>htmlä»£ç </li></ul><figure class="highlight html"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;video&quot;</span> <span class="hljs-attr">playsinline</span> <span class="hljs-attr">autoplay</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>jsä»£ç </li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> videoElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;video&#x27;</span>);<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">const</span> constraints = &#123; <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">video</span>: <span class="hljs-literal">true</span> &#125;;<br>navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getUserMedia</span>(constraints)<br>.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">stream</span>)=&gt;</span> &#123;<br>videoElement.<span class="hljs-property">srcObject</span> = stream;<br><span class="hljs-title function_">getDevicesInfo</span>();<br>&#125;)<br>.<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>)=&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;getUserMedia&quot;</span> + err);<br>&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å…¶ä¸­constraint å¯ä»¥å¯¹éŸ³é¢‘å’Œè§†é¢‘çš„å‚æ•°è¿›è¡Œé€‚é…</li><li>è§†é¢‘ï¼šå®½é«˜æ¯”ä¾‹ã€å¸§ç‡ã€å‰åæ‘„åƒå¤´â€¦</li><li>éŸ³é¢‘ï¼šé‡‡æ ·ç‡ã€é‡‡æ ·å¤§å°ã€éŸ³é‡ã€å›éŸ³æ¶ˆé™¤ã€è‡ªåŠ¨å¢ç›Šã€é™å™ªâ€¦</li></ul><h3 id="4ã€å¦‚ä½•è·å–è§†é¢‘æµä¸­çš„æŸä¸€å¸§æ•°æ®å‘¢ï¼Ÿ"><a href="#4ã€å¦‚ä½•è·å–è§†é¢‘æµä¸­çš„æŸä¸€å¸§æ•°æ®å‘¢ï¼Ÿ" class="headerlink" title="4ã€å¦‚ä½•è·å–è§†é¢‘æµä¸­çš„æŸä¸€å¸§æ•°æ®å‘¢ï¼Ÿ"></a>4ã€å¦‚ä½•è·å–è§†é¢‘æµä¸­çš„æŸä¸€å¸§æ•°æ®å‘¢ï¼Ÿ</h3><ul><li>htmlä»£ç </li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;video&quot;</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">playsinline</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;snapshot&quot;</span>&gt;</span>æˆªå±<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: 200px; height: 150px;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;picture&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>jsä»£ç </li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">snapshotElement.<span class="hljs-property">onclick</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>pictureElement.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&quot;2d&quot;</span>).<span class="hljs-title function_">drawImage</span>(videoElement,<br><span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<br>pictureElement.<span class="hljs-property">width</span>, pictureElement.<span class="hljs-property">height</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ€è·¯ï¼šå€ŸåŠ© <code>canvas</code> æ ‡ç­¾ï¼ŒæŠŠ <code>video</code> ä¸­æ•°æ®ç»˜åˆ¶å‡ºæ¥</li></ul><h3 id="5ã€å¦‚ä½•ä»…ä»…é‡‡é›†å’Œæ’­æ”¾éŸ³é¢‘å‘¢ï¼Ÿ"><a href="#5ã€å¦‚ä½•ä»…ä»…é‡‡é›†å’Œæ’­æ”¾éŸ³é¢‘å‘¢ï¼Ÿ" class="headerlink" title="5ã€å¦‚ä½•ä»…ä»…é‡‡é›†å’Œæ’­æ”¾éŸ³é¢‘å‘¢ï¼Ÿ"></a>5ã€å¦‚ä½•ä»…ä»…é‡‡é›†å’Œæ’­æ”¾éŸ³é¢‘å‘¢ï¼Ÿ</h3><ul><li>htmlä»£ç </li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">audio</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;audio&quot;</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">controls</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">audio</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>jsä»£ç </li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> audioElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;audio&quot;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">const</span> constraints = &#123; <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">video</span>: <span class="hljs-literal">false</span> &#125;;<br>navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getUserMedia</span>(constraints)<br>.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">stream</span>)=&gt;</span> &#123;<br>audioElement.<span class="hljs-property">srcObject</span> = stream;<br><span class="hljs-title function_">getDevicesInfo</span>();<br>&#125;)<br>.<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>)=&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;getUserMedia&quot;</span> + err);<br>&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day03%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E9%9F%B3%E9%A2%91/image-20220612195354615.png" class="" title="æœ€ç»ˆæ•ˆæœå›¾"><h3 id="6ã€ä¸€äº›MediaStreamçš„å¸¸ç”¨APIï¼ˆç”¨åˆ°å†è¯´å§ï¼‰"><a href="#6ã€ä¸€äº›MediaStreamçš„å¸¸ç”¨APIï¼ˆç”¨åˆ°å†è¯´å§ï¼‰" class="headerlink" title="6ã€ä¸€äº›MediaStreamçš„å¸¸ç”¨APIï¼ˆç”¨åˆ°å†è¯´å§ï¼‰"></a>6ã€ä¸€äº›MediaStreamçš„å¸¸ç”¨APIï¼ˆç”¨åˆ°å†è¯´å§ï¼‰</h3><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day03%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E9%9F%B3%E9%A2%91/image-20220612195626060.png" class="" title="image-20220612195626060"><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day03%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E9%9F%B3%E9%A2%91/image-20220612195636710.png" class="" title="image-20220612195636710"><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day03%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E9%9F%B3%E9%A2%91/image-20220612195650400.png" class="" title="image-20220612195650400">]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day02-å€ŸåŠ©nodejsæ­å»ºHTTPSæœåŠ¡å™¨</title>
    <link href="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day02%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <url>/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day02%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€NodejsæœåŠ¡å™¨æ­å»º"><a href="#ä¸€ã€NodejsæœåŠ¡å™¨æ­å»º" class="headerlink" title="ä¸€ã€NodejsæœåŠ¡å™¨æ­å»º"></a>ä¸€ã€NodejsæœåŠ¡å™¨æ­å»º</h2><h3 id="1ã€ä¸ºä»€ä¹ˆè¦æ­å»ºHTTPSæœåŠ¡å™¨ï¼Ÿ"><a href="#1ã€ä¸ºä»€ä¹ˆè¦æ­å»ºHTTPSæœåŠ¡å™¨ï¼Ÿ" class="headerlink" title="1ã€ä¸ºä»€ä¹ˆè¦æ­å»ºHTTPSæœåŠ¡å™¨ï¼Ÿ"></a>1ã€ä¸ºä»€ä¹ˆè¦æ­å»ºHTTPSæœåŠ¡å™¨ï¼Ÿ</h3><ul><li><font color="red">æ­å»ºæœåŠ¡å™¨çš„åŸå› </font>ï¼šwebä»£ç éœ€è¦ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ‰èƒ½æ–¹ä¾¿çš„è¢«æµè§ˆå™¨è§£æå±•ç¤º</li><li><font color="red">æ­å»ºHTTPSçš„åŸå› </font>ï¼šè®¿é—®ç”¨æˆ·çš„(éšç§)éŸ³è§†é¢‘è®¾å¤‡ï¼Œéœ€è¦é€šè¿‡HTTPSæ‰èƒ½å®Œå…¨è®¿é—®ã€‚</li></ul><h3 id="2ã€å¦‚ä½•è·å–HTTPSè¯ä¹¦ï¼Ÿ"><a href="#2ã€å¦‚ä½•è·å–HTTPSè¯ä¹¦ï¼Ÿ" class="headerlink" title="2ã€å¦‚ä½•è·å–HTTPSè¯ä¹¦ï¼Ÿ"></a>2ã€å¦‚ä½•è·å–HTTPSè¯ä¹¦ï¼Ÿ</h3><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day02%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/image-20220612174651525.png" class=""><ul><li>ç„¶ååœ¨<font color="red">éƒ¨ç½²</font>ä¸­æœ‰å„ä¸ªå¹³å°çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œè¿˜æ˜¯éå¸¸è¯¦ç»†çš„ã€‚</li></ul><h3 id="3ã€éƒ¨ç½²ä¸€ä¸ªæœ€ç®€å•çš„httpæœåŠ¡å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š"><a href="#3ã€éƒ¨ç½²ä¸€ä¸ªæœ€ç®€å•çš„httpæœåŠ¡å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š" class="headerlink" title="3ã€éƒ¨ç½²ä¸€ä¸ªæœ€ç®€å•çš„httpæœåŠ¡å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š"></a>3ã€éƒ¨ç½²ä¸€ä¸ªæœ€ç®€å•çš„httpæœåŠ¡å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</h3><figure class="highlight js"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">&#x27;use strict&#x27;</span><br><br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><br><span class="hljs-keyword">var</span> serveIndex = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;serve-index&#x27;</span>);<br><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">//é¡ºåºä¸èƒ½æ¢</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">serveIndex</span>(<span class="hljs-string">&#x27;./public&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">&#x27;./public&#x27;</span>));<br><br><span class="hljs-keyword">var</span> http_server = http.<span class="hljs-title function_">createServer</span>(app);<br>http_server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">9980</span>, <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;webrtcæœåŠ¡å¯åŠ¨æˆåŠŸ&quot;</span>);<br></code></pre></td></tr></table></figure><ul><li><code>express</code>ï¼šæ˜¯nodejsçš„æœåŠ¡å™¨æ¡†æ¶</li><li><code>serve-index</code>ï¼šæ˜¯è®©æœåŠ¡å™¨çš„èµ„æºå¯ä»¥é€šè¿‡webå±•ç¤ºå‡ºæ¥</li></ul><h3 id="4ã€å°†è¯¥æœåŠ¡ç«¯æŒ‚è½½åœ¨HTTPSä¸‹ï¼Œä¹Ÿå°±æ˜¯nginxçš„httpsä»£ç†"><a href="#4ã€å°†è¯¥æœåŠ¡ç«¯æŒ‚è½½åœ¨HTTPSä¸‹ï¼Œä¹Ÿå°±æ˜¯nginxçš„httpsä»£ç†" class="headerlink" title="4ã€å°†è¯¥æœåŠ¡ç«¯æŒ‚è½½åœ¨HTTPSä¸‹ï¼Œä¹Ÿå°±æ˜¯nginxçš„httpsä»£ç†"></a>4ã€å°†è¯¥æœåŠ¡ç«¯æŒ‚è½½åœ¨HTTPSä¸‹ï¼Œä¹Ÿå°±æ˜¯nginxçš„httpsä»£ç†</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">server &#123;<br>listen 443 ssl;   #SSLåè®®è®¿é—®ç«¯å£å·ä¸º443ã€‚æ­¤å¤„å¦‚æœªæ·»åŠ sslï¼Œå¯èƒ½ä¼šé€ æˆNginxæ— æ³•å¯åŠ¨ã€‚<br>server_name webrtc.runduck.cn;  #å°†localhostä¿®æ”¹ä¸ºæ‚¨è¯ä¹¦ç»‘å®šçš„åŸŸåï¼Œä¾‹å¦‚ï¼šwww.example.comã€‚<br>root html;<br>index index.html index.htm;<br>ssl_certificate webrtc_cert/7929948_webrtc.runduck.cn.pem;   #å°†domain name.pemæ›¿æ¢æˆæ‚¨è¯ä¹¦çš„æ–‡ä»¶åã€‚<br>ssl_certificate_key webrtc_cert/7929948_webrtc.runduck.cn.key;   #å°†domain name.keyæ›¿æ¢æˆæ‚¨è¯ä¹¦çš„å¯†é’¥æ–‡ä»¶åã€‚<br>ssl_session_timeout 5m;<br>ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;  #ä½¿ç”¨æ­¤åŠ å¯†å¥—ä»¶ã€‚<br>ssl_protocols TLSv1 TLSv1.1 TLSv1.2;   #ä½¿ç”¨è¯¥åè®®è¿›è¡Œé…ç½®ã€‚<br>ssl_prefer_server_ciphers on;   <br>location / &#123;<br>  proxy_pass http://127.0.0.1:9980;<br>&#125;<br>&#125;   <br><br>server &#123;<br>    listen       80;<br>    server_name webrtc.runduck.cn;<br>    rewrite ^(.*)$ https://$&#123;server_name&#125;$1 permanent; <br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>è¿™æ ·é€šè¿‡ <code>https://webrtc.runduck.cn/</code> å°±å¯ä»¥è®¿é—®æˆ‘ä»¬éƒ¨ç½²å¥½çš„æœåŠ¡å™¨äº†ã€‚</li></ul><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day02%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/image-20220612175149553.png" class=""><h3 id="äºŒã€è·å–ç”¨æˆ·çš„è¾“å…¥è¾“å‡ºè®¾å¤‡"><a href="#äºŒã€è·å–ç”¨æˆ·çš„è¾“å…¥è¾“å‡ºè®¾å¤‡" class="headerlink" title="äºŒã€è·å–ç”¨æˆ·çš„è¾“å…¥è¾“å‡ºè®¾å¤‡"></a>äºŒã€è·å–ç”¨æˆ·çš„è¾“å…¥è¾“å‡ºè®¾å¤‡</h3><h3 id="1ã€è®¤è¯†-MediaDevices-çš„ä½œç”¨ï¼Ÿ"><a href="#1ã€è®¤è¯†-MediaDevices-çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="1ã€è®¤è¯† MediaDevices  çš„ä½œç”¨ï¼Ÿ"></a>1ã€è®¤è¯† <code>MediaDevices</code>  çš„ä½œç”¨ï¼Ÿ</h3><ul><li><code>navigator.mediaDevices</code> æ¥å£æä¾›è®¿é—®è¿æ¥åª’ä½“è¾“å…¥çš„è®¾å¤‡</li><li>æ¯”å¦‚ï¼šç…§ç›¸æœºã€éº¦å…‹é£ã€å±å¹•å…±äº«ç­‰</li><li>å®ƒå¯ä»¥ä½¿ä½ å–å¾—ä»»ä½•ç¡¬ä»¶èµ„æºçš„åª’ä½“æ•°æ®</li></ul><h3 id="2ã€è®¤è¯†-MediaDevices-enumerateDevices-çš„ä½œç”¨ï¼Ÿ"><a href="#2ã€è®¤è¯†-MediaDevices-enumerateDevices-çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="2ã€è®¤è¯† MediaDevices.enumerateDevices() çš„ä½œç”¨ï¼Ÿ"></a>2ã€è®¤è¯† <code>MediaDevices.enumerateDevices()</code> çš„ä½œç”¨ï¼Ÿ</h3><ul><li><p>è·å–æœ‰å…³ç³»ç»Ÿä¸­å¯ç”¨çš„<font color="red">åª’ä½“è¾“å…¥å’Œè¾“å‡ºè®¾å¤‡</font>çš„ä¸€ç³»åˆ—ä¿¡æ¯</p></li><li><p>å®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ª <code>promise</code></p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">&#x27;use strict&#x27;</span><br><span class="hljs-keyword">var</span> audioSource  = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;select#audioSource&quot;</span>);<br><span class="hljs-keyword">var</span> audioOutput  = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;select#audioOutput&quot;</span>);<br><span class="hljs-keyword">var</span> videoSource  = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;select#videoSource&quot;</span>);<br><br><span class="hljs-keyword">if</span>(!navigator.<span class="hljs-property">mediaDevices</span> ||<br>!navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-property">enumerateDevices</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;enumerateDevices is not supported!&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">enumerateDevices</span>()<br>.<span class="hljs-title function_">then</span>(gotDevices)<br>.<span class="hljs-title function_">catch</span>(handleError);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">gotDevices</span>(<span class="hljs-params">deviceInfos</span>)&#123;<br>deviceInfos.<span class="hljs-title function_">forEach</span>( <span class="hljs-keyword">function</span>(<span class="hljs-params">deviceInfo</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(deviceInfo.<span class="hljs-property">kind</span> + <span class="hljs-string">&quot;: label = &quot;</span> <br>+ deviceInfo.<span class="hljs-property">label</span> + <span class="hljs-string">&quot;: id = &quot;</span><br>+ deviceInfo.<span class="hljs-property">deviceId</span> + <span class="hljs-string">&quot;: groupId = &quot;</span><br>+ deviceInfo.<span class="hljs-property">groupId</span>);<br><span class="hljs-keyword">var</span> option = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;option&#x27;</span>);<br>option.<span class="hljs-property">text</span> = deviceInfo.<span class="hljs-property">label</span>;<br>option.<span class="hljs-property">value</span> = deviceInfo.<span class="hljs-property">deviceId</span>;<br><span class="hljs-keyword">if</span>(deviceInfo.<span class="hljs-property">kind</span> === <span class="hljs-string">&#x27;audioinput&#x27;</span>)&#123;<br>audioSource.<span class="hljs-title function_">appendChild</span>(option);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(deviceInfo.<span class="hljs-property">kind</span> === <span class="hljs-string">&#x27;audiooutput&#x27;</span>)&#123;<br>audioOutput.<span class="hljs-title function_">appendChild</span>(option);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(deviceInfo.<span class="hljs-property">kind</span> === <span class="hljs-string">&#x27;videoinput&#x27;</span>)&#123;<br>videoSource.<span class="hljs-title function_">appendChild</span>(option);<br>&#125;<br>&#125;);<br><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleError</span>(<span class="hljs-params">err</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; : &quot;</span> + err.<span class="hljs-property">message</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>ä»£ç è¿è¡ŒæˆåŠŸå¦‚ä¸‹ï¼š</li></ul><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day02%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/image-20220612181336272.png" class=""><h3 id="3ã€ä½†æ˜¯ä¸Šè¿°ä»£ç ï¼Œåœ¨Safariä¸­è¿è¡Œï¼Œå´ä¸èƒ½æ‹¿åˆ°è®¾å¤‡ä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#3ã€ä½†æ˜¯ä¸Šè¿°ä»£ç ï¼Œåœ¨Safariä¸­è¿è¡Œï¼Œå´ä¸èƒ½æ‹¿åˆ°è®¾å¤‡ä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="3ã€ä½†æ˜¯ä¸Šè¿°ä»£ç ï¼Œåœ¨Safariä¸­è¿è¡Œï¼Œå´ä¸èƒ½æ‹¿åˆ°è®¾å¤‡ä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ"></a>3ã€ä½†æ˜¯ä¸Šè¿°ä»£ç ï¼Œåœ¨Safariä¸­è¿è¡Œï¼Œå´ä¸èƒ½æ‹¿åˆ°è®¾å¤‡ä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</h3><ul><li>å› ä¸ºSafariæœ‰æ›´åŠ ä¸¥æ ¼çš„ç”¨æˆ·éšç§æƒé™ä¿æŠ¤åè®®</li><li>å½“è°ƒç”¨ <code>navigator.mediaDevices.getUserMedia(constraints)</code> æ—¶ï¼Œå¯ä»¥è·å–ç”¨æˆ·æƒé™å¼¹çª—ï¼Œç”¨æˆ·åŒæ„å³å¯è·å–è®¾å¤‡ä¿¡æ¯äº†ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day01-åˆå§‹WebRTC</title>
    <link href="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    <url>/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€WebRTCåŸºç¡€æ¦‚å¿µ"><a href="#ä¸€ã€WebRTCåŸºç¡€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€WebRTCåŸºç¡€æ¦‚å¿µ"></a>ä¸€ã€WebRTCåŸºç¡€æ¦‚å¿µ</h2><h3 id="1ã€ä¸€å¥è¯ä»‹ç»ä¸‹WebRTCæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€ä¸€å¥è¯ä»‹ç»ä¸‹WebRTCæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€ä¸€å¥è¯ä»‹ç»ä¸‹WebRTCæ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€ä¸€å¥è¯ä»‹ç»ä¸‹WebRTCæ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>éŸ³è§†é¢‘å¤„ç† + å³ä½¿é€šè®¯çš„å¼€æºåº“</li></ul><h3 id="2ã€WebRTCä¸»è¦ç”¨äºwebå—ï¼Ÿé‚£ä¸»è¦åº”ç”¨äºå“ªäº›é¢†åŸŸå‘¢ï¼Ÿ"><a href="#2ã€WebRTCä¸»è¦ç”¨äºwebå—ï¼Ÿé‚£ä¸»è¦åº”ç”¨äºå“ªäº›é¢†åŸŸå‘¢ï¼Ÿ" class="headerlink" title="2ã€WebRTCä¸»è¦ç”¨äºwebå—ï¼Ÿé‚£ä¸»è¦åº”ç”¨äºå“ªäº›é¢†åŸŸå‘¢ï¼Ÿ"></a>2ã€WebRTCä¸»è¦ç”¨äºwebå—ï¼Ÿé‚£ä¸»è¦åº”ç”¨äºå“ªäº›é¢†åŸŸå‘¢ï¼Ÿ</h3><ul><li>ä¸€å¼€å§‹æ˜¯ä¸ºäº†webè®¾è®¡çš„</li><li>ç°åœ¨ä¸ä»…ä»…é€‚ç”¨äºwebï¼Œå·²ç»å…¨å¹³å°é€šç”¨ï¼ˆåŒ…æ‹¬iOSã€å®‰å“ï¼‰</li></ul><h3 id="3ã€é‚£ä¹ˆFFMpegå’ŒWebRTCä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ"><a href="#3ã€é‚£ä¹ˆFFMpegå’ŒWebRTCä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ" class="headerlink" title="3ã€é‚£ä¹ˆFFMpegå’ŒWebRTCä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ"></a>3ã€é‚£ä¹ˆFFMpegå’ŒWebRTCä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</h3><ul><li><p>ä¸¤ä¸ªæ¡†æ¶éƒ½æ˜¯éŸ³è§†é¢‘é¢†åŸŸçš„éœ¸ä¸»ã€‚FFmpegæ˜¯åŸºç¡€ï¼ŒWebRTCä¹Ÿä½¿ç”¨å®ƒ</p></li><li><p><font color="red">FFMpeg</font>ï¼šæ›´å¤šçš„ç”¨äºéŸ³è§†é¢‘ç¼–è¾‘ä¸æ’­æ”¾å™¨</p></li><li><p><font color="red">WebRTC</font>ï¼šæ›´å¤šçš„ç”¨äºéŸ³è§†é¢‘å®æ—¶é€šä¿¡ï¼Œæ¯”å¦‚ç½‘ç»œæŠ–åŠ¨ã€ç½‘ç»œä¸¢åŒ…ã€ç½‘ç»œè¯„ä¼°ã€å›éŸ³æ¶ˆé™¤ã€é™å™ªã€è‡ªåŠ¨å¢ç›Šç­‰ã€‚</p></li></ul><h2 id="äºŒã€WebRTCåŸç†ä¸æ¶æ„"><a href="#äºŒã€WebRTCåŸç†ä¸æ¶æ„" class="headerlink" title="äºŒã€WebRTCåŸç†ä¸æ¶æ„"></a>äºŒã€WebRTCåŸç†ä¸æ¶æ„</h2><h3 id="1ã€WebRTCçš„æ•´ä½“æ¶æ„å›¾ï¼Ÿ"><a href="#1ã€WebRTCçš„æ•´ä½“æ¶æ„å›¾ï¼Ÿ" class="headerlink" title="1ã€WebRTCçš„æ•´ä½“æ¶æ„å›¾ï¼Ÿ"></a>1ã€WebRTCçš„æ•´ä½“æ¶æ„å›¾ï¼Ÿ</h3><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/format,png.png" class=""><ul><li><font color="red">ç´«è‰²éƒ¨åˆ†</font>æ˜¯Webå¼€å‘è€…APIå±‚</li><li><font color="red">è“è‰²å®çº¿éƒ¨åˆ†</font>æ˜¯é¢å‘æµè§ˆå™¨å‚å•†çš„APIå±‚</li><li><font color="red">è“è‰²è™šçº¿éƒ¨åˆ†</font>æµè§ˆå™¨å‚å•†å¯ä»¥è‡ªå®šä¹‰å®ç°</li></ul><h3 id="2ã€WebRTCçš„ç›®å½•ç»“æ„-åé¢å†å›æ¥çœ‹"><a href="#2ã€WebRTCçš„ç›®å½•ç»“æ„-åé¢å†å›æ¥çœ‹" class="headerlink" title="2ã€WebRTCçš„ç›®å½•ç»“æ„(åé¢å†å›æ¥çœ‹)"></a>2ã€WebRTCçš„ç›®å½•ç»“æ„(åé¢å†å›æ¥çœ‹)</h3><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220612171615403.png" class="" title="image-20220612171615403"><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220612171621596.png" class="" title="image-20220612171621596"><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220612171629116.png" class="" title="image-20220612171629116"><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220612171634006.png" class="" title="image-20220612171634006"><h3 id="3ã€WebRTCé‡è¦çš„ä¸‰ä¸ªç±»ç†è§£ï¼Ÿ"><a href="#3ã€WebRTCé‡è¦çš„ä¸‰ä¸ªç±»ç†è§£ï¼Ÿ" class="headerlink" title="3ã€WebRTCé‡è¦çš„ä¸‰ä¸ªç±»ç†è§£ï¼Ÿ"></a>3ã€WebRTCé‡è¦çš„ä¸‰ä¸ªç±»ç†è§£ï¼Ÿ</h3><ul><li><font color="red">MediaStream</font>ï¼šé‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªè½¨é“ï¼Œç”¨äºéŸ³è§†é¢‘ä¼ è¾“</li><li><font color="red">RTCDataChannel</font>ï¼šé‡Œé¢å¯ä»¥ä¼ è¾“æ–‡æœ¬ã€äºŒè¿›åˆ¶æ•°æ®(ééŸ³è§†é¢‘æ•°æ®)</li><li><font color="red">RTCPeerConnection</font>ï¼šæ˜¯ä¸€ä¸ªå¤§è€Œå…¨ã€æœ€é‡è¦çš„ç±»</li></ul><h3 id="4ã€RTCPeerConnectionè°ƒç”¨è¿‡ç¨‹ï¼ˆåç»­ï¼Œä¸€å®šè¦èƒ½è‡ªå·±ç»˜åˆ¶ï¼Œç„¶åæ¢æˆé«˜æ¸…å›¾ï¼‰"><a href="#4ã€RTCPeerConnectionè°ƒç”¨è¿‡ç¨‹ï¼ˆåç»­ï¼Œä¸€å®šè¦èƒ½è‡ªå·±ç»˜åˆ¶ï¼Œç„¶åæ¢æˆé«˜æ¸…å›¾ï¼‰" class="headerlink" title="4ã€RTCPeerConnectionè°ƒç”¨è¿‡ç¨‹ï¼ˆåç»­ï¼Œä¸€å®šè¦èƒ½è‡ªå·±ç»˜åˆ¶ï¼Œç„¶åæ¢æˆé«˜æ¸…å›¾ï¼‰"></a>4ã€<font color="red">RTCPeerConnection</font>è°ƒç”¨è¿‡ç¨‹ï¼ˆåç»­ï¼Œä¸€å®šè¦èƒ½è‡ªå·±ç»˜åˆ¶ï¼Œç„¶åæ¢æˆé«˜æ¸…å›¾ï¼‰</h3><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220612172723861.png" class="" title="image-20220612172723861"><img src="/2022/06/12/WebRTC%E5%85%A5%E9%97%A8/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220612172737582.png" class="" title="image-20220612172737582">]]></content>
    
    
    <categories>
      
      <category>WebRTCå…¥é—¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day11-ã€å®æˆ˜ã€‘è§†é¢‘ç¼–ç /è§£ç </title>
    <link href="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/"/>
    <url>/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€è®¤è¯†SPSä¸PPS"><a href="#ä¸€ã€è®¤è¯†SPSä¸PPS" class="headerlink" title="ä¸€ã€è®¤è¯†SPSä¸PPS"></a>ä¸€ã€è®¤è¯†SPSä¸PPS</h2><h3 id="1ã€è®¤è¯†SPSï¼Ÿä¸»è¦åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ"><a href="#1ã€è®¤è¯†SPSï¼Ÿä¸»è¦åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ" class="headerlink" title="1ã€è®¤è¯†SPSï¼Ÿä¸»è¦åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ"></a>1ã€è®¤è¯†SPSï¼Ÿä¸»è¦åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ</h3><ul><li>SPS(Sequence Parameter Set)ï¼Œåºåˆ—å‚æ•°é›†ï¼Œä½œç”¨äºä¸€ä¸²è¿ç»­çš„è§†é¢‘å›¾åƒã€‚</li><li>æ¯”å¦‚ï¼šå¸§æ•°ã€è§£ç å›¾åƒå°ºå¯¸ã€å‚è€ƒå¸§æ•°ç›®</li></ul><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220604191831321.png" class=""><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220604191854932.png" class=""><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220604195729151.png" class=""><h3 id="2ã€è®¤è¯†PPSï¼Ÿä¸»è¦åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ"><a href="#2ã€è®¤è¯†PPSï¼Ÿä¸»è¦åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ" class="headerlink" title="2ã€è®¤è¯†PPSï¼Ÿä¸»è¦åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ"></a>2ã€è®¤è¯†PPSï¼Ÿä¸»è¦åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ</h3><ul><li>PPS(Picture Parameter Set)ï¼Œå›¾åƒå‚æ•°é›†ï¼Œä½œç”¨äºè§†é¢‘åºåˆ—ä¸­çš„å›¾åƒ</li><li>æ¯”å¦‚ï¼šç†µç¼–ç é€‰æ‹©æ ‡è¯†ã€ç‰‡ç»„æ•°ç›®</li></ul><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220604191808115.png" class=""><h3 id="3ã€æŒæ¡Profile"><a href="#3ã€æŒæ¡Profile" class="headerlink" title="3ã€æŒæ¡Profile"></a>3ã€æŒæ¡Profile</h3><ul><li>H264 Profileï¼šå¯¹è§†é¢‘å‹ç¼©ç‰¹æ€§çš„æè¿°ï¼ŒProfileè¶Šé«˜ï¼Œè¯´æ˜é‡‡ç”¨äº†è¶Šé«˜çº§çš„å‹ç¼©ç‰¹æ€§</li></ul><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220604195557564.png" class="" title="image-20220604195557564"><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220604195603752.png" class="" title="image-20220604195603752"><h3 id="4ã€æŒæ¡H264-Level"><a href="#4ã€æŒæ¡H264-Level" class="headerlink" title="4ã€æŒæ¡H264 Level"></a>4ã€æŒæ¡H264 Level</h3><ul><li>H264 Levelï¼šæ˜¯å¯¹è§†é¢‘çš„æè¿°ï¼ŒLevelè¶Šé«˜ï¼Œè§†é¢‘çš„ç ç‡ï¼Œåˆ†è¾¨ç‡è¶Šé«˜</li></ul><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220604195655374.png" class="" title="image-20220604195655374"><h3 id="5ã€è§†é¢‘åˆ†æå·¥å…·ä¸»æµæœ‰å“ªäº›ï¼ˆè¯´ä¸¤ä¸ªï¼‰ï¼Ÿ"><a href="#5ã€è§†é¢‘åˆ†æå·¥å…·ä¸»æµæœ‰å“ªäº›ï¼ˆè¯´ä¸¤ä¸ªï¼‰ï¼Ÿ" class="headerlink" title="5ã€è§†é¢‘åˆ†æå·¥å…·ä¸»æµæœ‰å“ªäº›ï¼ˆè¯´ä¸¤ä¸ªï¼‰ï¼Ÿ"></a>5ã€è§†é¢‘åˆ†æå·¥å…·ä¸»æµæœ‰å“ªäº›ï¼ˆè¯´ä¸¤ä¸ªï¼‰ï¼Ÿ</h3><ul><li>Evecard Stream Eye</li><li>é›·ç¥å¼€å‘çš„å·¥å…·</li></ul><h3 id="äºŒã€H264ç¼–ç å®æˆ˜"><a href="#äºŒã€H264ç¼–ç å®æˆ˜" class="headerlink" title="äºŒã€H264ç¼–ç å®æˆ˜"></a>äºŒã€H264ç¼–ç å®æˆ˜</h3><h3 id="1ã€åŸºæœ¬æ­¥éª¤ï¼Œä¸»è¦å››æ­¥"><a href="#1ã€åŸºæœ¬æ­¥éª¤ï¼Œä¸»è¦å››æ­¥" class="headerlink" title="1ã€åŸºæœ¬æ­¥éª¤ï¼Œä¸»è¦å››æ­¥"></a>1ã€åŸºæœ¬æ­¥éª¤ï¼Œä¸»è¦å››æ­¥</h3><ul><li>æ‰“å¼€ç¼–ç å™¨</li><li>è½¬æ¢NV12åˆ°YUV420P</li><li>å‡†å¤‡ç¼–ç æ•°æ® AVFrame</li><li>H264ç¼–ç </li></ul><h3 id="2ã€å£è¿°ä¸‹NV12è½¬YUV420pçš„æ€è·¯ï¼Ÿ"><a href="#2ã€å£è¿°ä¸‹NV12è½¬YUV420pçš„æ€è·¯ï¼Ÿ" class="headerlink" title="2ã€å£è¿°ä¸‹NV12è½¬YUV420pçš„æ€è·¯ï¼Ÿ"></a>2ã€å£è¿°ä¸‹NV12è½¬YUV420pçš„æ€è·¯ï¼Ÿ</h3><ul><li>NV12æ•°æ®å­˜æ”¾ç»“æ„ï¼šYYYYYYYYYYUVUVUV</li><li>YUV420pæ•°æ®å­˜æ”¾ç»“æ„ï¼šYYYYYYYYYYUUUVVV</li><li><font color="red">ä»NV12ä¸­åˆ†åˆ«æå–å‡ºYã€Uã€Væ•°æ®ï¼Œç„¶åè¿›è¡Œé‡æ–°ç»„åˆå­˜æ”¾ï¼Œå³å¯ã€‚</font></li></ul><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605192735416.png" class=""><h3 id="3ã€åœ¨è¿›è¡ŒNV12è½¬YUV420pæ—¶ï¼Œç”±äºæ‰‹è¯¯å‘æ–‡ä»¶ä¸­å†™å…¥äº†ä¸¤æ¬¡æ•°æ®ï¼Œæ’­æ”¾æ–‡ä»¶ï¼Œä¼šå‡ºç°ä»€ä¹ˆç°è±¡ï¼Ÿ"><a href="#3ã€åœ¨è¿›è¡ŒNV12è½¬YUV420pæ—¶ï¼Œç”±äºæ‰‹è¯¯å‘æ–‡ä»¶ä¸­å†™å…¥äº†ä¸¤æ¬¡æ•°æ®ï¼Œæ’­æ”¾æ–‡ä»¶ï¼Œä¼šå‡ºç°ä»€ä¹ˆç°è±¡ï¼Ÿ" class="headerlink" title="3ã€åœ¨è¿›è¡ŒNV12è½¬YUV420pæ—¶ï¼Œç”±äºæ‰‹è¯¯å‘æ–‡ä»¶ä¸­å†™å…¥äº†ä¸¤æ¬¡æ•°æ®ï¼Œæ’­æ”¾æ–‡ä»¶ï¼Œä¼šå‡ºç°ä»€ä¹ˆç°è±¡ï¼Ÿ"></a>3ã€åœ¨è¿›è¡ŒNV12è½¬YUV420pæ—¶ï¼Œç”±äºæ‰‹è¯¯å‘æ–‡ä»¶ä¸­å†™å…¥äº†ä¸¤æ¬¡æ•°æ®ï¼Œæ’­æ”¾æ–‡ä»¶ï¼Œä¼šå‡ºç°ä»€ä¹ˆç°è±¡ï¼Ÿ</h3><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605182230483.png" class=""><h3 id=""><a href="#" class="headerlink" title=""></a></h3><ul><li>ç¬¬ä¸€æ¬¡å†™å…¥NV12æ•°æ®</li><li>ç¬¬äºŒæ¬¡å†™å…¥YUV420pæ•°æ®</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs sh">ffplay -video_size 640x480 -pixel_format yuv420p -framerate 25 420p.yuv<br></code></pre></td></tr></table></figure><ul><li>ä»¥ä¸ŠæŒ‡ä»¤æ’­æ”¾æ—¶ï¼Œä¼šå‡ºç°<font color="red">å½•å±åŠ¨ä½œè¢«æ”¾ç¼“äº†ä¸¤å€ï¼Œå¹¶ä¸”è§†é¢‘é¢œè‰²é—ªçƒ</font></li><li>åŸå› ï¼šYåˆ†é‡æ²¡é—®é¢˜ï¼ŒUVåˆ†é‡éƒ¨åˆ†é”™ä½äº†ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤è¿›è¡Œè°ƒè¯•æµ‹è¯•ã€‚</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffplay -video_size 640x480 -pixel_format yuv420p -framerate 25 -vf extractplanes=<span class="hljs-string">&#x27;y&#x27;</span> 420p.yuv<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffplay -video_size 640x480 -pixel_format yuv420p -framerate 25 -vf extractplanes=<span class="hljs-string">&#x27;u&#x27;</span> 420p.yuv<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ffplay</span> -video_size <span class="hljs-number">640</span>x480 -pixel_format yuv420p -framerate <span class="hljs-number">25</span> -vf extractplanes=&#x27;v&#x27; <span class="hljs-number">420</span>p.yuv<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡ä¸Šé¢æŒ‡ä»¤ï¼Œå°±å¯ä»¥æ˜æ˜¾çœ‹åˆ°uã€våˆ†é‡çš„é—ªçƒæ•ˆæœã€‚è€Œ yåˆ†é‡çš„ç¼ºåªæ˜¯æ’­æ”¾é€Ÿåº¦å‡æ…¢äº†ã€‚</li></ul><h3 id="4ã€åœ¨ç¼–ç H264çš„æ—¶å€™ï¼Œå¦‚æœå°‘äº†ä¸‹é¢å›¾ä¸­ä¸¤ä¸ªæ­¥éª¤ï¼Œä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼Ÿ"><a href="#4ã€åœ¨ç¼–ç H264çš„æ—¶å€™ï¼Œå¦‚æœå°‘äº†ä¸‹é¢å›¾ä¸­ä¸¤ä¸ªæ­¥éª¤ï¼Œä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼Ÿ" class="headerlink" title="4ã€åœ¨ç¼–ç H264çš„æ—¶å€™ï¼Œå¦‚æœå°‘äº†ä¸‹é¢å›¾ä¸­ä¸¤ä¸ªæ­¥éª¤ï¼Œä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼Ÿ"></a>4ã€åœ¨ç¼–ç H264çš„æ—¶å€™ï¼Œå¦‚æœå°‘äº†ä¸‹é¢å›¾ä¸­ä¸¤ä¸ªæ­¥éª¤ï¼Œä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼Ÿ</h3><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605192501173.png" class=""><ul><li>æ³¨é‡Šä¸€ï¼šä¼šå¯¼è‡´ptsæ··ä¹±ï¼Œæœ€ç»ˆæ’­æ”¾çš„h264æ–‡ä»¶ï¼Œä¼šæœ‰é©¬èµ›å…‹ã€‚</li><li>æ³¨é‡ŠäºŒï¼šä¼šå¯¼è‡´æœ€ç»ˆh264æ–‡ä»¶å°‘æ‰å‡ å¸§æ•°æ®ï¼Œä¸å®Œæ•´ï¼Œå› ä¸ºå‹ç¼©ç¼“å†²åŒºçš„æ•°æ®æ²¡è¢«åˆ·å‡ºæ¥ã€‚</li></ul><h3 id="5ã€H264ç¼–ç å®Œæ•´ä»£ç å¦‚ä¸‹"><a href="#5ã€H264ç¼–ç å®Œæ•´ä»£ç å¦‚ä¸‹" class="headerlink" title="5ã€H264ç¼–ç å®Œæ•´ä»£ç å¦‚ä¸‹"></a>5ã€H264ç¼–ç å®Œæ•´ä»£ç å¦‚ä¸‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;test.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavutil/avutil.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavdevice/avdevice.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavcodec/avcodec.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libswresample/swresample.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> V_WIDTH 640</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> V_HEIGHT 480</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> rec_status = <span class="hljs-number">1</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">set_status</span><span class="hljs-params">(<span class="hljs-type">int</span> status)</span>&#123;<br>    rec_status = status;<br>&#125;<br><br><span class="hljs-comment">///æ‰“å¼€ç¼–ç å™¨</span><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">open_encoder</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height, AVCodecContext **enc_ctx)</span> &#123;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">const</span> AVCodec *codec = <span class="hljs-literal">NULL</span>;<br>    codec = avcodec_find_encoder_by_name(<span class="hljs-string">&quot;libx264&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!codec) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error avcodec_find_encoder_by_name error \n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    *enc_ctx = avcodec_alloc_context3(codec);<br>    <span class="hljs-keyword">if</span> (!enc_ctx) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error avcodec_alloc_context3 error \n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">//SPSã€PPS</span><br>    (*enc_ctx)-&gt;profile = FF_PROFILE_H264_HIGH_444;<br>    (*enc_ctx)-&gt;level = <span class="hljs-number">50</span>; <span class="hljs-comment">//è¡¨ç¤ºLevelæ˜¯5.0</span><br>    <br>    <span class="hljs-comment">//è®¾ç½®åˆ†è¾¨ç‡</span><br>    (*enc_ctx)-&gt;width = width;<br>    (*enc_ctx)-&gt;height = height;<br>    <br>    <span class="hljs-comment">//GOP</span><br>    (*enc_ctx)-&gt;gop_size = <span class="hljs-number">250</span>;<br>    (*enc_ctx)-&gt;keyint_min = <span class="hljs-number">25</span>; <span class="hljs-comment">//optional</span><br>    <br>    <span class="hljs-comment">//è®¾ç½®Bå¸§æ•°æ®</span><br>    (*enc_ctx)-&gt;max_b_frames = <span class="hljs-number">3</span>; <span class="hljs-comment">//optional</span><br>    (*enc_ctx)-&gt;has_b_frames = <span class="hljs-number">1</span>; <span class="hljs-comment">//optional</span><br>    <br>    <span class="hljs-comment">//å‚è€ƒå¸§çš„æ•°é‡</span><br>    (*enc_ctx)-&gt;refs = <span class="hljs-number">3</span>; <span class="hljs-comment">//optional</span><br>    (*enc_ctx)-&gt;pix_fmt = AV_PIX_FMT_YUV420P;<br>    <br>    <span class="hljs-comment">//è®¾ç½®ç ç‡</span><br>    (*enc_ctx)-&gt;bit_rate = <span class="hljs-number">600000</span>; <span class="hljs-comment">//600kbps</span><br>    <br>    <span class="hljs-comment">//è®¾ç½®å¸§ç‡</span><br>    (*enc_ctx)-&gt;time_base = (AVRational)&#123;<span class="hljs-number">1</span>, <span class="hljs-number">25</span>&#125;; <span class="hljs-comment">//å¸§ä¸å¸§ç›´æ¥çš„é—´éš”æ˜¯time_base</span><br>    (*enc_ctx)-&gt;framerate = (AVRational)&#123;<span class="hljs-number">25</span>, <span class="hljs-number">1</span>&#125;; <span class="hljs-comment">//å¸§ç‡ï¼Œæ¯ç§’ 25 å¸§</span><br>    <br>    ret = avcodec_open2(*enc_ctx, codec, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error avcodec_open2 error \n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">///åˆ›å»ºAVFrame</span><br><span class="hljs-type">static</span> AVFrame* <span class="hljs-title function_">create_frame</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> &#123;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    AVFrame *frame = av_frame_alloc();<br>    <span class="hljs-keyword">if</span> (!frame) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error av_frame_alloc error \n&quot;</span>);<br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br>    <br>    <span class="hljs-comment">//è®¾ç½®å‚æ•°</span><br>    frame-&gt;width = width;<br>    frame-&gt;height = height;<br>    frame-&gt;format = AV_PIX_FMT_YUV420P;<br>    <br>    <span class="hljs-comment">//alloc inner memory</span><br>    ret = av_frame_get_buffer(frame, <span class="hljs-number">32</span>); <span class="hljs-comment">//æŒ‰32ä½å¯¹å…¶ï¼ˆTODOï¼‰</span><br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error av_frame_get_buffer error \n&quot;</span>);<br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br>    <span class="hljs-keyword">return</span> frame;<br>    <br>__ERROR:<br>    <span class="hljs-keyword">if</span> (frame) &#123;<br>        av_frame_free(&amp;frame);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-comment">///h264ç¼–ç </span><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">encode</span><span class="hljs-params">(AVCodecContext *enc_ctx, AVFrame *frame,AVPacket *newpkt,FILE *outfile)</span> &#123;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (!enc_ctx || !newpkt || !outfile) &#123; <span class="hljs-comment">//å‚æ•°æ£€æŸ¥</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error encode å‚æ•°æœ‰è¯¯ \n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (frame) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;send frame to encoder, pts=%lld \n&quot;</span>, frame-&gt;pts);<br>    &#125;<br>    <br>    ret = avcodec_send_frame(enc_ctx, frame);<br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">char</span> strErr[<span class="hljs-number">1024</span>];<br>        av_strerror(ret, strErr, <span class="hljs-number">1024</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error avcodec_send_frame error , %s \n&quot;</span>, strErr);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">while</span> (ret &gt;= <span class="hljs-number">0</span>) &#123;<br>        ret = avcodec_receive_packet(enc_ctx, newpkt);<br>        <span class="hljs-keyword">if</span> (ret == AVERROR(EAGAIN) || ret == AVERROR_EOF) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(ret &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error avcodec_receive_packet error \n&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>        fwrite(newpkt-&gt;data, <span class="hljs-number">1</span>, newpkt-&gt;size, outfile);<br>        fflush(outfile);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">///å½•è§†é¢‘ï¼ˆä¸»å…¥å£ï¼‰</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">record_video</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span> errors[<span class="hljs-number">1024</span>];<br>    <br>    <span class="hljs-comment">//ctx</span><br>    AVFormatContext *fmt_ctx = <span class="hljs-literal">NULL</span>;<br>    AVDictionary *options = <span class="hljs-literal">NULL</span>;<br>    AVCodecContext *enc_ctx = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-comment">//packet</span><br>    <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br>    AVPacket pkt;<br>    <br>    <span class="hljs-comment">// [video device]:[aduio device]</span><br>    <span class="hljs-type">char</span> *devicename = <span class="hljs-string">&quot;0&quot;</span>;<br>    <br>    <span class="hljs-comment">//register audio device</span><br>    avdevice_register_all();<br>    <br>    <span class="hljs-comment">//get format</span><br>    <span class="hljs-type">const</span> AVInputFormat *iformat = av_find_input_format(<span class="hljs-string">&quot;avfoundation&quot;</span>);<br>    <br>    av_dict_set(&amp;options, <span class="hljs-string">&quot;video_size&quot;</span>, <span class="hljs-string">&quot;640x480&quot;</span>, <span class="hljs-number">0</span>);<br>    av_dict_set(&amp;options, <span class="hljs-string">&quot;framerate&quot;</span>, <span class="hljs-string">&quot;30&quot;</span>, <span class="hljs-number">0</span>);<br>    av_dict_set(&amp;options, <span class="hljs-string">&quot;pixel_format&quot;</span>, <span class="hljs-string">&quot;nv12&quot;</span>, <span class="hljs-number">0</span>);<br>    <br>    <span class="hljs-comment">//æ‰“å¼€ç¼–ç å™¨</span><br>    open_encoder(V_WIDTH, V_HEIGHT, &amp;enc_ctx);<br>    <br>    <span class="hljs-comment">//åˆ›å»ºAVFrameã€AVPacket</span><br>    AVFrame *frame = create_frame(V_WIDTH, V_HEIGHT);<br>    AVPacket *newpkt = av_packet_alloc();<br>    <span class="hljs-keyword">if</span> (!newpkt) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error av_packet_alloc&quot;</span>);<br>    &#125;<br>    <span class="hljs-type">int</span> basePts = <span class="hljs-number">1</span>;<br>    <br>    <span class="hljs-comment">//open device</span><br>    ret = avformat_open_input(&amp;fmt_ctx, devicename, iformat, &amp;options);<br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        av_strerror(ret, errors, <span class="hljs-number">1024</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error avformat_open_input error \n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//crate file</span><br>    <span class="hljs-type">char</span> *yuvPath = <span class="hljs-string">&quot;/Users/carrot/Desktop/MyCode/420p.yuv&quot;</span>;<br>    <span class="hljs-type">char</span> *outPath = <span class="hljs-string">&quot;/Users/carrot/Desktop/MyCode/420p.h264&quot;</span>;<br>    FILE *yuvFile = fopen(yuvPath, <span class="hljs-string">&quot;wb+&quot;</span>);<br>    FILE *outFile = fopen(outPath, <span class="hljs-string">&quot;wb+&quot;</span>);<br>    <span class="hljs-keyword">if</span> (yuvFile == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error yuvFile fopen failed \n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (outPath == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error outPath fopen failed \n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//read data from device</span><br>    <span class="hljs-keyword">while</span> ((ret = av_read_frame(fmt_ctx, &amp;pkt)) == <span class="hljs-number">0</span> || rec_status == <span class="hljs-number">1</span>) &#123;<br>        usleep(<span class="hljs-number">100</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret %d&quot;</span>, ret);<br>        <span class="hljs-keyword">if</span> (pkt.size &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// (å®½ * é«˜) * ï¼ˆyuv420=1.5 æˆ– yuv422=2 æˆ– yuv444=3ï¼‰ï¼›nv12å±äºyuv420</span><br>            <span class="hljs-comment">// 640*480*1.5 = 460800</span><br>            <span class="hljs-comment">//fwrite(pkt.data, 460800, 1, yuvFile);</span><br>            <span class="hljs-comment">//fflush(yuvFile);</span><br>            <br>            <span class="hljs-comment">// NV12 è½¬ YUV420p</span><br>            <span class="hljs-comment">//YYYYYYYYYYYUVUVUV NV12</span><br>            <span class="hljs-comment">//YYYYYYYYYYYUUUVVV YUV420P</span><br>            <span class="hljs-type">int</span> YDataSize = V_WIDTH * V_HEIGHT; <span class="hljs-comment">//307200</span><br>            <span class="hljs-built_in">memcpy</span>(frame-&gt;data[<span class="hljs-number">0</span>], pkt.data, YDataSize); <span class="hljs-comment">//copy Y data:</span><br>            <span class="hljs-comment">//307200ä¹‹åæ˜¯UV</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; YDataSize / <span class="hljs-number">4</span>; i++) &#123;<br>                frame-&gt;data[<span class="hljs-number">1</span>][i] = pkt.data[YDataSize + <span class="hljs-number">2</span>*i];<br>                frame-&gt;data[<span class="hljs-number">2</span>][i] = pkt.data[YDataSize + <span class="hljs-number">2</span>*i + <span class="hljs-number">1</span>];<br>            &#125;<br>            fwrite(frame-&gt;data[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>, YDataSize, yuvFile);<br>            fwrite(frame-&gt;data[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>, YDataSize / <span class="hljs-number">4</span>, yuvFile);<br>            fwrite(frame-&gt;data[<span class="hljs-number">2</span>], <span class="hljs-number">1</span>, YDataSize / <span class="hljs-number">4</span>, yuvFile);<br>            fflush(yuvFile);<br>            <br>            <span class="hljs-comment">//h264ç¼–ç </span><br>            frame-&gt;pts = basePts++;<br>            encode(enc_ctx, frame, newpkt, outFile);<br>            <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error packet size is %d(%p), count=%d \n&quot;</span>, pkt.size, pkt.data, count);<br>            av_packet_unref(&amp;pkt);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//å°†ç¼–ç å™¨ç¼“å†²åŒºçš„æ•°æ®åˆ·å‡ºæ¥ï¼Œä¸ç„¶å½•åˆ¶çš„è§†é¢‘ä¼šå°‘æ‰1så·¦å³çš„æ•°æ®ã€‚</span><br>    encode(enc_ctx, <span class="hljs-literal">NULL</span>, newpkt, outFile);<br>    <br>    <span class="hljs-comment">//close device and release ctx</span><br>    avformat_close_input(&amp;fmt_ctx);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;lsp_error è¿è¡Œç»“æŸ\n&quot;</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰è°ƒç”¨ <code>avcodec_open2</code> ä¼šå¯¼è‡´ <code>avcodec_send_frame</code> æŠ¥é”™ï¼š<font color="red"><a href="https://stackoverflow.com/questions/69643784/avcodec-send-frame-returns-invalid-argument">avcodec_send_frame returns â€œinvalid argumentâ€</a></font></li></ul><h2 id="ä¸‰ã€x264å‚æ•°è¯¦è§£ã€å‚è€ƒèµ„æ–™ï¼ˆæš‚æ—¶ä¸çœ‹å§ï¼Œåªåšè®°å½•ï¼‰"><a href="#ä¸‰ã€x264å‚æ•°è¯¦è§£ã€å‚è€ƒèµ„æ–™ï¼ˆæš‚æ—¶ä¸çœ‹å§ï¼Œåªåšè®°å½•ï¼‰" class="headerlink" title="ä¸‰ã€x264å‚æ•°è¯¦è§£ã€å‚è€ƒèµ„æ–™ï¼ˆæš‚æ—¶ä¸çœ‹å§ï¼Œåªåšè®°å½•ï¼‰"></a>ä¸‰ã€x264å‚æ•°è¯¦è§£ã€å‚è€ƒèµ„æ–™ï¼ˆæš‚æ—¶ä¸çœ‹å§ï¼Œåªåšè®°å½•ï¼‰</h2><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605193400253.png" class="" title="image-20220605193400253"><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605193427742.png" class="" title="image-20220605193427742"><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605193433084.png" class="" title="image-20220605193433084"><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605193440303.png" class="" title="image-20220605193440303"><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605193445364.png" class="" title="image-20220605193445364"><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605193450647.png" class="" title="image-20220605193450647"><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605193456071.png" class="" title="image-20220605193456071"><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day11%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%AE%9E%E6%88%98/image-20220605193501269.png" class="" title="image-20220605193501269">]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>ffmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day10-è®¤è¯†H264ã€H264å‹ç¼©æŠ€æœ¯ã€ç æµåˆ†å±‚NALU</title>
    <link href="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day10H264%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"/>
    <url>/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day10H264%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€è®¤è¯†H264"><a href="#ä¸€ã€è®¤è¯†H264" class="headerlink" title="ä¸€ã€è®¤è¯†H264"></a>ä¸€ã€è®¤è¯†H264</h2><h3 id="1ã€H264çš„å‹ç¼©æ¯”æ˜¯å¤šå°‘ï¼Ÿ"><a href="#1ã€H264çš„å‹ç¼©æ¯”æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="1ã€H264çš„å‹ç¼©æ¯”æ˜¯å¤šå°‘ï¼Ÿ"></a>1ã€H264çš„å‹ç¼©æ¯”æ˜¯å¤šå°‘ï¼Ÿ</h3><ul><li><p>çº¦ <font color="red">1&#x2F;100</font></p></li><li><p>æ¯”å¦‚æ ¼å¼ä¸ºYUV420ã€åˆ†è¾¨ç‡ä¸º640x480ã€å¸§ç‡ä¸º15çš„ç æµæ˜¯ <font color="red">55296kbps</font></p></li><li><p>ç»è¿‡H264å‹ç¼©åï¼Œå®é™…ç æµçº¦ï¼š500kbps</p></li></ul><h3 id="2ã€æ¯”å¦‚720pï¼Œå¦‚ä½•ç¡®å®šå®ƒçš„æœ€è¿‘ç æµå¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿ"><a href="#2ã€æ¯”å¦‚720pï¼Œå¦‚ä½•ç¡®å®šå®ƒçš„æœ€è¿‘ç æµå¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="2ã€æ¯”å¦‚720pï¼Œå¦‚ä½•ç¡®å®šå®ƒçš„æœ€è¿‘ç æµå¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿ"></a>2ã€æ¯”å¦‚720pï¼Œå¦‚ä½•ç¡®å®šå®ƒçš„æœ€è¿‘ç æµå¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿ</h3><ul><li>å¯ä»¥å» <font color="red">å£°ç½‘</font> è¿™ç§æ¯”è¾ƒæƒå¨çš„ç½‘ç«™æŸ¥è¯¢ï¼Œè¿™äº›éƒ½æ˜¯ç»éªŒå€¼ï¼Œæ²¡æœ‰æ ‡å‡†å€¼ã€‚</li><li><a href="https://docs.agora.io/cn">https://docs.agora.io/cn</a></li></ul><h3 id="3ã€ä»€ä¹ˆæ˜¯GOPï¼Ÿä¸€ä¸ªGOPä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªIå¸§å—ï¼Ÿ"><a href="#3ã€ä»€ä¹ˆæ˜¯GOPï¼Ÿä¸€ä¸ªGOPä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªIå¸§å—ï¼Ÿ" class="headerlink" title="3ã€ä»€ä¹ˆæ˜¯GOPï¼Ÿä¸€ä¸ªGOPä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªIå¸§å—ï¼Ÿ"></a>3ã€ä»€ä¹ˆæ˜¯GOPï¼Ÿä¸€ä¸ªGOPä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªIå¸§å—ï¼Ÿ</h3><ul><li>GOPï¼šGroup Of Pictureï¼Œå›¾åƒç»„</li><li>åœ¨æœ€æ–°çš„H264æ ‡å‡†ä¸­ï¼Œä¸€ä¸ªGOPå¯ä»¥å­˜åœ¨å¤šä¸ªIå¸§ã€‚</li></ul><h4 id="4ã€ä»€ä¹ˆæ˜¯Iå¸§ï¼Ÿä»€ä¹ˆæ˜¯IDRå¸§ï¼Ÿ"><a href="#4ã€ä»€ä¹ˆæ˜¯Iå¸§ï¼Ÿä»€ä¹ˆæ˜¯IDRå¸§ï¼Ÿ" class="headerlink" title="4ã€ä»€ä¹ˆæ˜¯Iå¸§ï¼Ÿä»€ä¹ˆæ˜¯IDRå¸§ï¼Ÿ"></a>4ã€ä»€ä¹ˆæ˜¯Iå¸§ï¼Ÿä»€ä¹ˆæ˜¯IDRå¸§ï¼Ÿ</h4><ul><li><p>Iå¸§ï¼Œå…³é”®å¸§ï¼Œé‡‡ç”¨å¸§å†…å‹ç¼©æŠ€æœ¯ï¼Œèƒ½ç‹¬ç«‹è§£ç å‡ºå®Œæ•´çš„ä¸€å¸§å›¾ç‰‡ã€‚</p></li><li><p>IDRï¼Œè§£ç å™¨ç«‹å³åˆ·æ–°å¸§ï¼Œæ¸…ç©ºå‚è€ƒå¸§é˜Ÿåˆ—ï¼Œé˜²æ­¢å¸§é”™è¯¯è”“å»¶ã€‚</p></li><li><p><font color="red">IDRå¸§æ˜¯ç‰¹æ®Šçš„Iå¸§</font></p></li><li><p><font color="red">æ¯ä¸ªGOPä¸­çš„ç¬¬ä¸€å¸§å°±æ˜¯IDRå¸§</font></p></li></ul><h3 id="5ã€ä»€ä¹ˆæ˜¯På¸§ï¼Ÿ"><a href="#5ã€ä»€ä¹ˆæ˜¯På¸§ï¼Ÿ" class="headerlink" title="5ã€ä»€ä¹ˆæ˜¯På¸§ï¼Ÿ"></a>5ã€ä»€ä¹ˆæ˜¯På¸§ï¼Ÿ</h3><ul><li>På¸§ï¼ŒForward Predicted Frameï¼Œå‘å‰å‚è€ƒå¸§ï¼Œä¼šå‚è€ƒå‰é¢çš„Iå¸§æˆ–På¸§ã€‚</li><li>é‡‡ç”¨å¸§é—´ç¼–ç å‹ç¼©æŠ€æœ¯ã€‚</li></ul><h3 id="6ã€ä»€ä¹ˆæ˜¯Bå¸§ï¼Ÿ"><a href="#6ã€ä»€ä¹ˆæ˜¯Bå¸§ï¼Ÿ" class="headerlink" title="6ã€ä»€ä¹ˆæ˜¯Bå¸§ï¼Ÿ"></a>6ã€ä»€ä¹ˆæ˜¯Bå¸§ï¼Ÿ</h3><ul><li>Bå¸§ï¼ŒBidirectionally predicted frameï¼ŒåŒå‘å‚è€ƒå¸§ã€‚</li><li>ä¼šåŒæ—¶å‚è€ƒå‰é¢å’Œåé¢çš„Iå¸§æˆ–På¸§ã€‚</li><li>é‡‡ç”¨å¸§é—´ç¼–ç å‹ç¼©æŠ€æœ¯ã€‚</li></ul><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day10H264%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/image-20220604173715150.png" class=""><h2 id="äºŒã€H264å‹ç¼©æŠ€æœ¯"><a href="#äºŒã€H264å‹ç¼©æŠ€æœ¯" class="headerlink" title="äºŒã€H264å‹ç¼©æŠ€æœ¯"></a>äºŒã€H264å‹ç¼©æŠ€æœ¯</h2><h3 id="1ã€H264å‹ç¼©ä¸»è¦å››å¤§æŠ€æœ¯ï¼Œåˆ†åˆ«ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€H264å‹ç¼©ä¸»è¦å››å¤§æŠ€æœ¯ï¼Œåˆ†åˆ«ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€H264å‹ç¼©ä¸»è¦å››å¤§æŠ€æœ¯ï¼Œåˆ†åˆ«ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€H264å‹ç¼©ä¸»è¦å››å¤§æŠ€æœ¯ï¼Œåˆ†åˆ«ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><font color="red">å¸§å†…å‹ç¼©</font>ï¼šè§£å†³çš„æ˜¯ç©ºåŸŸæ•°æ®å†—ä½™é—®é¢˜</li><li><font color="red">å¸§é—´å‹ç¼©</font>ï¼šè§£å†³çš„æ˜¯æ—¶åŸŸæ•°æ®å†—ä½™é—®é¢˜</li><li><font color="red">DCTå˜åŒ–</font>ï¼šæ•´æ•°ç¦»æ•£ä½™å¼¦å˜æ¢ï¼ˆDCTï¼‰ï¼Œå°†ç¦»æ•£æ•°æ®èšåˆï¼Œæ–¹ä¾¿åç»­å‹ç¼©</li><li><font color="red">CABACå‹ç¼©</font>ï¼šç†µç¼–ç ï¼Œå±äºæ— æŸå‹ç¼©</li></ul><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day10H264%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/image-20220604174439133.png" class=""><h3 id="2ã€è§†é¢‘èŠ±å±å’Œå¡é¡¿çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2ã€è§†é¢‘èŠ±å±å’Œå¡é¡¿çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€è§†é¢‘èŠ±å±å’Œå¡é¡¿çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2ã€è§†é¢‘èŠ±å±å’Œå¡é¡¿çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><p><font color="red">èŠ±å±</font>ï¼šå¦‚æœGOPåˆ†ç»„ä¸­æœ‰å¸§ä¸¢å¤±ï¼Œä¼šé€ æˆè§£ç ç«¯çš„å›¾åƒå‘ç”Ÿé”™è¯¯ï¼Œè¿™ä¼šå‡ºç°é©¬èµ›å…‹(èŠ±å±)</p></li><li><p><font color="red">å¡é¡¿</font>ï¼šå¦‚æœGOPè§£æé”™è¯¯ï¼Œè¦ç­‰å¾…ä¸‹ä¸€ä¸ªIå¸§åˆ°æ¥ï¼Œå›¾åƒå°±é™æ­¢äº†ï¼Œè¿™å°±å‡ºç°çš„æ‰€è°“çš„å¡é¡¿</p></li></ul><h3 id="ä¸‰ã€H264ç æµåˆ†å±‚"><a href="#ä¸‰ã€H264ç æµåˆ†å±‚" class="headerlink" title="ä¸‰ã€H264ç æµåˆ†å±‚"></a>ä¸‰ã€H264ç æµåˆ†å±‚</h3><h3 id="1ã€ä¸ºä»€ä¹ˆè¦å‡ºç°NALå±‚ï¼Ÿ"><a href="#1ã€ä¸ºä»€ä¹ˆè¦å‡ºç°NALå±‚ï¼Ÿ" class="headerlink" title="1ã€ä¸ºä»€ä¹ˆè¦å‡ºç°NALå±‚ï¼Ÿ"></a>1ã€ä¸ºä»€ä¹ˆè¦å‡ºç°NALå±‚ï¼Ÿ</h3><ul><li><font color="red">NAL</font>ï¼ŒNetwork Abstract Layerï¼Œè§†é¢‘æ•°æ®ç½‘ç»œæŠ½è±¡å±‚</li><li>æ˜¯ä¸ºäº†è§£å†³ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­çš„<font color="red">ä¸¢åŒ…ã€ä¹±åº</font>ç­‰é—®é¢˜</li></ul><h3 id="2ã€ä»€ä¹ˆVCLå±‚ï¼Ÿ"><a href="#2ã€ä»€ä¹ˆVCLå±‚ï¼Ÿ" class="headerlink" title="2ã€ä»€ä¹ˆVCLå±‚ï¼Ÿ"></a>2ã€ä»€ä¹ˆVCLå±‚ï¼Ÿ</h3><ul><li>VCLï¼ŒVideo Coding Layerï¼Œè§†é¢‘æ•°æ®ç¼–ç å±‚</li><li>å¸§å†…ç¼–ç ã€å¸§é—´ç¼–ç ã€DCTå˜æ¢ã€ç†µç¼–ç æœ€åå‡ºæ¥çš„æ•°æ®ï¼Œå°±æ˜¯VCLå±‚æ•°æ®</li></ul><h3 id="3ã€VCLç»“æ„å…³ç³»ï¼Ÿï¼ˆä»å¸§ã€ç‰‡ã€å®å—ã€å­å—ï¼‰"><a href="#3ã€VCLç»“æ„å…³ç³»ï¼Ÿï¼ˆä»å¸§ã€ç‰‡ã€å®å—ã€å­å—ï¼‰" class="headerlink" title="3ã€VCLç»“æ„å…³ç³»ï¼Ÿï¼ˆä»å¸§ã€ç‰‡ã€å®å—ã€å­å—ï¼‰"></a>3ã€VCLç»“æ„å…³ç³»ï¼Ÿï¼ˆä»å¸§ã€ç‰‡ã€å®å—ã€å­å—ï¼‰</h3><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day10H264%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/image-20220604175228931.png" class=""><h3 id="4ã€SODBã€RBSPã€NALU-ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#4ã€SODBã€RBSPã€NALU-ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="4ã€SODBã€RBSPã€NALU ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>4ã€SODBã€RBSPã€NALU ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><ul><li><p><font color="red">SODB</font>ï¼ŒString Of Data BItsï¼ŒåŸå§‹æ•°æ®<font color="blue">æ¯”ç‰¹æµ</font>ï¼Œé•¿åº¦ä¸ä¸€å®šæ˜¯8çš„å€æ•°ï¼Œæ•…éœ€è¦è¡¥é½</p></li><li><p><font color="red">RBSP</font>ï¼ŒRaw Byte Sequence Payloadï¼Œæ˜¯å¯¹SODBæ•°æ®è¿›è¡Œè¡¥é½åçš„<font color="blue">å­—èŠ‚æµ</font>æ•°æ®ï¼›RBSP &#x3D; SODB + trailing bits</p></li><li><p><font color="red">NALU</font>ï¼ŒNetwork Abstract Layer Unitï¼Œç½‘ç»œæŠ½è±¡å±‚å•å…ƒ &#x3D; NAL header + RBSP</p></li></ul><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day10H264%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/image-20220604175734381.png" class=""><h3 id="5ã€æ•´ä¸ªç æµåˆ†å±‚å›¾ï¼ˆæœ¬èŠ‚æœ€é‡è¦çš„å›¾ï¼Œè¦èƒ½é»˜å†™ï¼‰"><a href="#5ã€æ•´ä¸ªç æµåˆ†å±‚å›¾ï¼ˆæœ¬èŠ‚æœ€é‡è¦çš„å›¾ï¼Œè¦èƒ½é»˜å†™ï¼‰" class="headerlink" title="5ã€æ•´ä¸ªç æµåˆ†å±‚å›¾ï¼ˆæœ¬èŠ‚æœ€é‡è¦çš„å›¾ï¼Œè¦èƒ½é»˜å†™ï¼‰"></a>5ã€æ•´ä¸ªç æµåˆ†å±‚å›¾ï¼ˆæœ¬èŠ‚æœ€é‡è¦çš„å›¾ï¼Œè¦èƒ½é»˜å†™ï¼‰</h3><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day10H264%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/image-20220604180020055.png" class="">]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>ffmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day09-è§†é¢‘åŸºç¡€ã€è®¤è¯†YUVã€é‡‡é›†æ‘„åƒå¤´YUVæ•°æ®</title>
    <link href="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day09%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/"/>
    <url>/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day09%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€è§†é¢‘åŸºç¡€çŸ¥è¯†"><a href="#ä¸€ã€è§†é¢‘åŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸€ã€è§†é¢‘åŸºç¡€çŸ¥è¯†"></a>ä¸€ã€è§†é¢‘åŸºç¡€çŸ¥è¯†</h2><h3 id="1ã€RGB888å’ŒRGBAåˆ†åˆ«å å¤šå°‘å­—èŠ‚ï¼Ÿ"><a href="#1ã€RGB888å’ŒRGBAåˆ†åˆ«å å¤šå°‘å­—èŠ‚ï¼Ÿ" class="headerlink" title="1ã€RGB888å’ŒRGBAåˆ†åˆ«å å¤šå°‘å­—èŠ‚ï¼Ÿ"></a>1ã€RGB888å’ŒRGBAåˆ†åˆ«å å¤šå°‘å­—èŠ‚ï¼Ÿ</h3><ul><li>RGB888 å  3ä¸ªå­—èŠ‚ï¼ˆ24bitï¼‰</li><li>RGBA å  4ä¸ªå­—èŠ‚ï¼ˆ32bitï¼‰</li></ul><h3 id="2ã€RGB-å’Œ-BGR-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2ã€RGB-å’Œ-BGR-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€RGB å’Œ BGR æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2ã€RGB å’Œ BGR æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>RGB ä¸ BGR éƒ½æ˜¯é¢œè‰²æ ¼å¼ï¼Œåªæ˜¯å­˜å‚¨æ˜¯Rä¸Bçš„ä½ç½®ä¸åŒã€‚</li><li>BMP ä½¿ç”¨çš„æ˜¯BGRæ ¼å¼ã€‚</li></ul><h3 id="3ã€PPIæ˜¯ä»€ä¹ˆï¼ŸDPIæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3ã€PPIæ˜¯ä»€ä¹ˆï¼ŸDPIæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3ã€PPIæ˜¯ä»€ä¹ˆï¼ŸDPIæ˜¯ä»€ä¹ˆï¼Ÿ"></a>3ã€PPIæ˜¯ä»€ä¹ˆï¼ŸDPIæ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>PPIï¼šPixels per inchï¼Œæ¯è‹±å¯¸å±•ç¤ºçš„åƒç´ æ•°</li><li>DPIï¼šDots per inchï¼Œæ¯è‹±å¯¸å±•ç¤ºçš„ç‚¹æ•°</li><li><font color="red">PPI &gt; 300 å°±å±äºè§†ç½‘è†œçº§åˆ«</font></li><li><font color="red">åŸºæœ¬ä¸ŠPPIå°±ç­‰äºDPI</font></li></ul><h3 id="4ã€ä»€ä¹ˆæ˜¯åˆ†è¾¨ç‡ï¼Ÿ"><a href="#4ã€ä»€ä¹ˆæ˜¯åˆ†è¾¨ç‡ï¼Ÿ" class="headerlink" title="4ã€ä»€ä¹ˆæ˜¯åˆ†è¾¨ç‡ï¼Ÿ"></a>4ã€ä»€ä¹ˆæ˜¯åˆ†è¾¨ç‡ï¼Ÿ</h3><ul><li>Xè½´çš„åƒç´ ä¸ªæ•°  * Yè½´çš„åƒç´ ä¸ªæ•°</li><li>å¸¸è§çš„å®½é«˜æ¯” 16:9  ã€ 4:3</li><li>360P&#x2F;720&#x2F;1K&#x2F;2K</li></ul><h3 id="5ã€ä»€ä¹ˆæ˜¯å¸§ç‡ï¼Ÿ"><a href="#5ã€ä»€ä¹ˆæ˜¯å¸§ç‡ï¼Ÿ" class="headerlink" title="5ã€ä»€ä¹ˆæ˜¯å¸§ç‡ï¼Ÿ"></a>5ã€ä»€ä¹ˆæ˜¯å¸§ç‡ï¼Ÿ</h3><ul><li><p>æ¯ç§’é’Ÿé‡‡é›†&#x2F;æ’­æ”¾å›¾åƒçš„ä¸ªæ•°</p></li><li><p>åŠ¨ç”»çš„å¸§ç‡æ˜¯ 25 å¸§&#x2F;s</p></li><li><p>å¸¸è§çš„å¸§ç‡æ˜¯: 15å¸§&#x2F;sï¼Œ30å¸§&#x2F;sï¼Œ60å¸§&#x2F;s</p></li><li><p><font color="red">åˆ†è¾¨ç‡å†³å®šè§†é¢‘çš„æ¸…æ™°åº¦ï¼Œå¸§ç‡å†³å®šè§†é¢‘çš„æµç•…åº¦ã€‚</font></p></li></ul><h3 id="6ã€å¸§ç‡25çš„720pè§†é¢‘ï¼ŒRGBç æµæ˜¯å¤šå°‘ï¼Ÿ"><a href="#6ã€å¸§ç‡25çš„720pè§†é¢‘ï¼ŒRGBç æµæ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="6ã€å¸§ç‡25çš„720pè§†é¢‘ï¼ŒRGBç æµæ˜¯å¤šå°‘ï¼Ÿ"></a>6ã€å¸§ç‡25çš„720pè§†é¢‘ï¼ŒRGBç æµæ˜¯å¤šå°‘ï¼Ÿ</h3><ul><li>25 * 720 *1280 * 3 * 8 &#x3D; 552.96Mbps</li></ul><h3 id="7ã€å›¾åƒå¤§å°ä¸æ˜¾ç¤ºåŒºåŸŸå¤§å°æœ‰å“ªä¸‰ç§å…³ç³»ï¼Ÿï¼ˆè§£å†³æ–¹æ¡ˆï¼Ÿï¼‰"><a href="#7ã€å›¾åƒå¤§å°ä¸æ˜¾ç¤ºåŒºåŸŸå¤§å°æœ‰å“ªä¸‰ç§å…³ç³»ï¼Ÿï¼ˆè§£å†³æ–¹æ¡ˆï¼Ÿï¼‰" class="headerlink" title="7ã€å›¾åƒå¤§å°ä¸æ˜¾ç¤ºåŒºåŸŸå¤§å°æœ‰å“ªä¸‰ç§å…³ç³»ï¼Ÿï¼ˆè§£å†³æ–¹æ¡ˆï¼Ÿï¼‰"></a>7ã€å›¾åƒå¤§å°ä¸æ˜¾ç¤ºåŒºåŸŸå¤§å°æœ‰å“ªä¸‰ç§å…³ç³»ï¼Ÿï¼ˆè§£å†³æ–¹æ¡ˆï¼Ÿï¼‰</h3><ul><li>å›¾åƒç­‰äºæ˜¾ç¤ºåŒºåŸŸï¼Œåˆšå¥½å±•ç¤ºã€‚</li><li>å›¾åƒå°äºæ˜¾ç¤ºåŒºåŸŸï¼Œæ‹‰ä¼¸&#x2F;ç•™ç™½ã€‚</li><li>å›¾åƒå¤§äºæ˜¾ç¤ºåŒºåŸŸï¼Œç¼©å°&#x2F;è£å‰ªã€‚</li></ul><h2 id="äºŒã€è®¤è¯†YUV"><a href="#äºŒã€è®¤è¯†YUV" class="headerlink" title="äºŒã€è®¤è¯†YUV"></a>äºŒã€è®¤è¯†YUV</h2><h3 id="1ã€YUVä¸­çš„Yæ˜¯ä»€ä¹ˆï¼ŸUVæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€YUVä¸­çš„Yæ˜¯ä»€ä¹ˆï¼ŸUVæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€YUVä¸­çš„Yæ˜¯ä»€ä¹ˆï¼ŸUVæ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€YUVä¸­çš„Yæ˜¯ä»€ä¹ˆï¼ŸUVæ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>Yï¼šè¡¨ç¤ºæ˜äº®åº¦ã€‚</li><li>UVï¼šæ˜¯æè¿°å½±åƒè‰²å½©é¥±å’Œåº¦ã€‚</li><li>ä¸»è¦çš„é‡‡æ ·æ ¼å¼æœ‰YUV420ã€YUV422ã€YUV444</li></ul><h3 id="2ã€RGBä¸YUVçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2ã€RGBä¸YUVçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€RGBä¸YUVçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2ã€RGBä¸YUVçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><p>RGBå’ŒYUVéƒ½æ˜¯é¢œè‰²çš„å­˜å‚¨æ–¹æ¡ˆï¼Œä½†æ˜¯é€‚ç”¨åœºæ™¯ä¸ç›¸åŒ</p></li><li><p>RGBï¼šç”¨äºå±å¹•å›¾åƒçš„å±•ç¤º</p></li><li><p>YUVï¼šç”¨äºé‡‡é›†ä¸ç¼–ç </p></li></ul><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day09%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/image-20220604103944297.png" class=""><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day09%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/image-20220604103956016.png" class=""><h3 id="3ã€ä¸ºä»€ä¹ˆè¦é‡‡ç”¨YUVè¿™ç§é¢œè‰²æ ¼å¼ï¼Ÿ"><a href="#3ã€ä¸ºä»€ä¹ˆè¦é‡‡ç”¨YUVè¿™ç§é¢œè‰²æ ¼å¼ï¼Ÿ" class="headerlink" title="3ã€ä¸ºä»€ä¹ˆè¦é‡‡ç”¨YUVè¿™ç§é¢œè‰²æ ¼å¼ï¼Ÿ"></a>3ã€ä¸ºä»€ä¹ˆè¦é‡‡ç”¨YUVè¿™ç§é¢œè‰²æ ¼å¼ï¼Ÿ</h3><ul><li><p>â‘ è§†é¢‘çš„å‘å±•å†å²æ˜¯ä»é»‘ç™½è§†é¢‘åˆ°å½©è‰²è§†é¢‘ï¼Œè¿™æ˜¯å†å²åŸå› çš„éƒ¨åˆ†</p></li><li><p>â‘¡YUVç”±äºäººè·Ÿå¯¹Yåˆ†é‡æ•æ„Ÿï¼Œå¯¹UVåˆ†é‡ä¸æ•æ„Ÿï¼Œæ‰€ä»¥YUVæ˜“äºå‹ç¼©ã€‚è¿™æ˜¯æŠ€æœ¯ä¸Šçš„ä¼˜åŠ¿</p></li></ul><h3 id="4ã€YUV420på­˜å‚¨æ ¼å¼ç¤ºæ„å›¾"><a href="#4ã€YUV420på­˜å‚¨æ ¼å¼ç¤ºæ„å›¾" class="headerlink" title="4ã€YUV420på­˜å‚¨æ ¼å¼ç¤ºæ„å›¾"></a>4ã€YUV420på­˜å‚¨æ ¼å¼ç¤ºæ„å›¾</h3><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day09%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/image-20220604105607839.png" class=""><img src="/2022/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day09%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/image-20220604105638912.png" class=""><h3 id="5ã€æˆ‘ä»¬å£å¤´ä¸Šå¸¸è¯´çš„1å…†å¸¦å®½ï¼Œæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ"><a href="#5ã€æˆ‘ä»¬å£å¤´ä¸Šå¸¸è¯´çš„1å…†å¸¦å®½ï¼Œæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ" class="headerlink" title="5ã€æˆ‘ä»¬å£å¤´ä¸Šå¸¸è¯´çš„1å…†å¸¦å®½ï¼Œæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ"></a>5ã€æˆ‘ä»¬å£å¤´ä¸Šå¸¸è¯´çš„1å…†å¸¦å®½ï¼Œæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ</h3><ul><li>è¿™é‡Œçš„è¯´çš„æ˜¯1å…†æ¯”ç‰¹ä½ï¼Œå¹¶éå­—èŠ‚æ•°</li><li>æ¯”å¦‚1å…†çš„å¸¦å®½ï¼Œç†è®ºä¸‹è½½é€Ÿåº¦æ˜¯ 125KB&#x2F;s</li><li>æ‰€ä»¥æˆ‘ä»¬è®¡ç®—ç æµå¤§å°çš„æ—¶å€™ï¼Œé€šå¸¸ä¹Ÿæ˜¯ç”¨æ¯”ç‰¹ä½æ¥è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯ <font color="red">æ¯”ç‰¹ä½ &#x3D; å­—èŠ‚æ•° * 8</font></li></ul><h2 id="ä¸‰ã€æå–-x2F-å½•åˆ¶YUVæ•°æ®"><a href="#ä¸‰ã€æå–-x2F-å½•åˆ¶YUVæ•°æ®" class="headerlink" title="ä¸‰ã€æå–&#x2F;å½•åˆ¶YUVæ•°æ®"></a>ä¸‰ã€æå–&#x2F;å½•åˆ¶YUVæ•°æ®</h2><h3 id="1ã€å¦‚ä½•ä»MP4ä¸­ï¼Œæå–YUVæ•°æ®ï¼Ÿ"><a href="#1ã€å¦‚ä½•ä»MP4ä¸­ï¼Œæå–YUVæ•°æ®ï¼Ÿ" class="headerlink" title="1ã€å¦‚ä½•ä»MP4ä¸­ï¼Œæå–YUVæ•°æ®ï¼Ÿ"></a>1ã€å¦‚ä½•ä»MP4ä¸­ï¼Œæå–YUVæ•°æ®ï¼Ÿ</h3><ul><li>æå–æ•°æ®</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs sh">ffmpeg -i raw.mp4 -an -c:v rawvideo -pix_fmt yuv420p yuv420p.yuv<br></code></pre></td></tr></table></figure><ul><li>æ’­æ”¾yuv</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffplay -video_size 864x486 -pixel_format yuv420p -framerate 25 yuv420p.yuv<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæ ¼å¼é”™è¯¯ï¼Œä¼šäº§ç”Ÿå¾ˆæœ‰è¶£çš„ç°è±¡ï¼Œæ¯”å¦‚æ”¹æˆ<font color="red">nv12</font>æ ¼å¼ï¼Œä¼šäº§ç”Ÿç»¿å±æ•ˆæœï¼›å¦‚æœå°ºå¯¸é”™è¯¯ï¼Œå°±ä¼šå‡ºç°ä»¥å‰ç”µè§†æœºçš„æ»¡å±é©¬èµ›å…‹ï¼Œæˆ–è€…å±å¹•ä¸Šæˆ–ä¸‹ç§»åŠ¨çš„æ•ˆæœã€‚</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffplay -video_size 864x486 -pixel_format nv12 yuv420p.yuv<br></code></pre></td></tr></table></figure><h3 id="2ã€å¦‚ä½•ä»MP4ä¸­ï¼Œæå–åˆ†åˆ«æå–Yã€Uã€Væ•°æ®ï¼Ÿ"><a href="#2ã€å¦‚ä½•ä»MP4ä¸­ï¼Œæå–åˆ†åˆ«æå–Yã€Uã€Væ•°æ®ï¼Ÿ" class="headerlink" title="2ã€å¦‚ä½•ä»MP4ä¸­ï¼Œæå–åˆ†åˆ«æå–Yã€Uã€Væ•°æ®ï¼Ÿ"></a>2ã€å¦‚ä½•ä»MP4ä¸­ï¼Œæå–åˆ†åˆ«æå–Yã€Uã€Væ•°æ®ï¼Ÿ</h3><ul><li>å•ç‹¬æå–</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffmpeg -i raw.mp4 -filter_complex <span class="hljs-string">&#x27;extractplanes=y+u+v[y][u][v]&#x27;</span> -map <span class="hljs-string">&#x27;[y]&#x27;</span> y.yuv -map <span class="hljs-string">&#x27;[u]&#x27;</span> u.yuv -map <span class="hljs-string">&#x27;[v]&#x27;</span> v.yuv<br></code></pre></td></tr></table></figure><ul><li>å•ç‹¬æ’­æ”¾Yæ•°æ®</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffplay -video_size 864x486 -pixel_format gray y.yuv<br></code></pre></td></tr></table></figure><h3 id="3ã€ä»£ç å½•åˆ¶YUVæ•°æ®ï¼ˆå’ŒéŸ³é¢‘å½•åˆ¶å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼‰"><a href="#3ã€ä»£ç å½•åˆ¶YUVæ•°æ®ï¼ˆå’ŒéŸ³é¢‘å½•åˆ¶å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼‰" class="headerlink" title="3ã€ä»£ç å½•åˆ¶YUVæ•°æ®ï¼ˆå’ŒéŸ³é¢‘å½•åˆ¶å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼‰"></a>3ã€ä»£ç å½•åˆ¶YUVæ•°æ®ï¼ˆå’ŒéŸ³é¢‘å½•åˆ¶å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;test.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavdevice/avdevice.h&quot;</span></span><br><br><span class="hljs-comment">//å½•è§†é¢‘</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">record_video</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span> errors[<span class="hljs-number">1024</span>];<br>    <br>    <span class="hljs-comment">//ctx</span><br>    AVFormatContext *fmt_ctx = <span class="hljs-literal">NULL</span>;<br>    AVDictionary *options = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-comment">//packet</span><br>    <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br>    AVPacket pkt;<br>    <br>    <span class="hljs-comment">// [video device]:[aduio device]</span><br>    <span class="hljs-type">char</span> *devicename = <span class="hljs-string">&quot;0&quot;</span>;<br>    <br>    <span class="hljs-comment">//register audio device</span><br>    avdevice_register_all();<br>    <br>    <span class="hljs-comment">//get format</span><br>    <span class="hljs-type">const</span> AVInputFormat *iformat = av_find_input_format(<span class="hljs-string">&quot;avfoundation&quot;</span>);<br>    <br>    av_dict_set(&amp;options, <span class="hljs-string">&quot;video_size&quot;</span>, <span class="hljs-string">&quot;640x480&quot;</span>, <span class="hljs-number">0</span>);<br>    av_dict_set(&amp;options, <span class="hljs-string">&quot;framerate&quot;</span>, <span class="hljs-string">&quot;30&quot;</span>, <span class="hljs-number">0</span>);<br>    av_dict_set(&amp;options, <span class="hljs-string">&quot;pixel_format&quot;</span>, <span class="hljs-string">&quot;nv12&quot;</span>, <span class="hljs-number">0</span>);<br>    <br>    <span class="hljs-comment">//open device</span><br>    ret = avformat_open_input(&amp;fmt_ctx, devicename, iformat, &amp;options);<br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        av_strerror(ret, errors, <span class="hljs-number">1024</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avformat_open_input error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//crate file</span><br>    <span class="hljs-type">char</span> *outPath = <span class="hljs-string">&quot;/Users/carrot/Desktop/MyCode/nv12.yuv&quot;</span>;<br>    FILE *outFile = fopen(outPath, <span class="hljs-string">&quot;wb+&quot;</span>);<br>    <span class="hljs-keyword">if</span> (outFile == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;outFile fopen failed&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//read data from device</span><br>    <span class="hljs-keyword">while</span> ((ret = av_read_frame(fmt_ctx, &amp;pkt)) == <span class="hljs-number">0</span> || count++ &lt; <span class="hljs-number">20000</span>) &#123;<br>        usleep(<span class="hljs-number">100</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret %d&quot;</span>, ret);<br>        <span class="hljs-keyword">if</span> (pkt.size &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// (å®½ * é«˜) * ï¼ˆyuv420=1.5 æˆ– yuv422=2 æˆ– yuv444=3ï¼‰ï¼›nv12å±äºyuv420</span><br>            <span class="hljs-comment">// 640*480*1.5 = 460800</span><br>            fwrite(pkt.data, <span class="hljs-number">460800</span>, <span class="hljs-number">1</span>, outFile);<br>            fflush(outFile);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;packet size is %d(%p), count=%d \n&quot;</span>, pkt.size, pkt.data, count);<br>            av_packet_unref(&amp;pkt);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">//close device and release ctx</span><br>    avformat_close_input(&amp;fmt_ctx);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¿è¡Œç»“æŸ\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ’­æ”¾åˆšåˆšå½•åˆ¶çš„è§†é¢‘</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffplay -video_size 640x480 -pixel_format nv12 nv12.yuv<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>ffmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day08-éŸ³é¢‘AACç¼–ç å®æˆ˜(ä¸‰)</title>
    <link href="/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91AAC%E7%BC%96%E7%A0%81%E5%AE%9E%E6%88%98/"/>
    <url>/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91AAC%E7%BC%96%E7%A0%81%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€AACç¼–ç ä»£ç å®æˆ˜"><a href="#ä¸€ã€AACç¼–ç ä»£ç å®æˆ˜" class="headerlink" title="ä¸€ã€AACç¼–ç ä»£ç å®æˆ˜"></a>ä¸€ã€AACç¼–ç ä»£ç å®æˆ˜</h2><h3 id="1ã€AVPacketã€AVFrameè¿™ä¸¤ä¸ªé‡è¦ç»“æ„ä½“ä¸€èˆ¬å­˜æ”¾ä»€ä¹ˆæ•°æ®ï¼Ÿ"><a href="#1ã€AVPacketã€AVFrameè¿™ä¸¤ä¸ªé‡è¦ç»“æ„ä½“ä¸€èˆ¬å­˜æ”¾ä»€ä¹ˆæ•°æ®ï¼Ÿ" class="headerlink" title="1ã€AVPacketã€AVFrameè¿™ä¸¤ä¸ªé‡è¦ç»“æ„ä½“ä¸€èˆ¬å­˜æ”¾ä»€ä¹ˆæ•°æ®ï¼Ÿ"></a>1ã€AVPacketã€AVFrameè¿™ä¸¤ä¸ªé‡è¦ç»“æ„ä½“ä¸€èˆ¬å­˜æ”¾ä»€ä¹ˆæ•°æ®ï¼Ÿ</h3><ul><li><p><font color="blue">AVFrame</font>ï¼šä¸€èˆ¬å­˜æ”¾ç¼–ç å‰çš„æ•°æ®ï¼Œå¯¹äºéŸ³é¢‘æ•°æ®æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯PCMæ•°æ®ã€‚</p></li><li><p><font color="blue">AVPacket</font>ï¼šä¸€èˆ¬å­˜æ”¾ç¼–ç åçš„æ•°æ®ï¼Œå¯¹äºéŸ³é¢‘æ•°æ®æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µæ˜¯å‹ç¼©æ•°æ®ã€‚</p></li></ul><h3 id="2ã€é‚£ä¸ºä»€ä¹ˆä»éº¦å…‹é£è¯»å–çš„PCMæ•°æ®ï¼Œå´æ˜¯æ”¾åœ¨AVPacketå‘¢ï¼Ÿ"><a href="#2ã€é‚£ä¸ºä»€ä¹ˆä»éº¦å…‹é£è¯»å–çš„PCMæ•°æ®ï¼Œå´æ˜¯æ”¾åœ¨AVPacketå‘¢ï¼Ÿ" class="headerlink" title="2ã€é‚£ä¸ºä»€ä¹ˆä»éº¦å…‹é£è¯»å–çš„PCMæ•°æ®ï¼Œå´æ˜¯æ”¾åœ¨AVPacketå‘¢ï¼Ÿ"></a>2ã€é‚£ä¸ºä»€ä¹ˆä»éº¦å…‹é£è¯»å–çš„PCMæ•°æ®ï¼Œå´æ˜¯æ”¾åœ¨AVPacketå‘¢ï¼Ÿ</h3><ul><li>å› ä¸ºffmpegè®¤ä¸ºéº¦å…‹é£æ˜¯ä¸ªå¤–éƒ¨å¤šåª’ä½“æ–‡ä»¶ï¼ˆç±»ä¼¼mp4ï¼‰ï¼Œffmpegç»Ÿä¸€è®¤ä¸ºæ˜¯ç¼–ç åçš„AVPacketæ•°æ®ã€‚</li></ul><h3 id="3ã€AACç¼–ç çš„å…³é”®æ­¥éª¤"><a href="#3ã€AACç¼–ç çš„å…³é”®æ­¥éª¤" class="headerlink" title="3ã€AACç¼–ç çš„å…³é”®æ­¥éª¤"></a>3ã€AACç¼–ç çš„å…³é”®æ­¥éª¤</h3><ul><li>æ‰¾åˆ°ç¼–ç å™¨ã€åˆ›å»ºä¸Šä¸‹æ–‡ã€æ‰“å¼€ç¼–ç å™¨</li></ul><figure class="highlight c"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><pre><code class="hljs C">    <span class="hljs-comment">//æ‰¾åˆ°libfdkç¼–ç å™¨</span><br>    <span class="hljs-type">const</span> AVCodec *codec = avcodec_find_encoder_by_name(<span class="hljs-string">&quot;libfdk_aac&quot;</span>);<br>    <span class="hljs-keyword">if</span> (codec == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avcodec_find_encoder_by_name error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//åˆ›å»ºç¼–ç ä¸Šä¸‹æ–‡</span><br>    AVCodecContext *codec_ctx = avcodec_alloc_context3(codec);<br>    codec_ctx-&gt;sample_fmt = AV_SAMPLE_FMT_S16;          <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘çš„é‡‡æ ·å¤§å°</span><br>    codec_ctx-&gt;channel_layout = AV_CH_LAYOUT_STEREO;    <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘çš„channel layout</span><br>    codec_ctx-&gt;channels = <span class="hljs-number">2</span>;                            <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘ channel ä¸ªæ•°</span><br>    codec_ctx-&gt;sample_rate = <span class="hljs-number">44100</span>;                     <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘çš„é‡‡æ ·ç‡</span><br><span class="hljs-comment">//    codec_ctx-&gt;bit_rate = 0; //AAC_LC:128K, AAC HE:64K, AAC HE V2:32K</span><br>    codec_ctx-&gt;profile = FF_PROFILE_AAC_HE; <span class="hljs-comment">//é˜…è¯» ffmpeg ä»£ç ï¼Œå¯çŸ¥bit_rate å’Œ profileä¹‹é—´çš„è®¾è®¡å…³ç³»</span><br>    <br>    <span class="hljs-comment">//æ‰“å¼€ç¼–ç å™¨</span><br>    <span class="hljs-keyword">if</span> (avcodec_open2(codec_ctx, codec, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avcodec_open2 error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><ul><li>åˆå§‹åŒ–è¾“å…¥å’Œæ•°æ®æ ¼å¼</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">//åˆå§‹åŒ–AACç¼–ç å‰çš„æ•°æ®è½½ä½“</span><br>AVFrame *aac_frame = av_frame_alloc();<br><span class="hljs-keyword">if</span> (!aac_frame) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;av_frame_alloc å¤±è´¥&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br>aac_frame-&gt;nb_samples           = <span class="hljs-number">512</span>;                  <span class="hljs-comment">//å•é€šé“ä¸€ä¸ªéŸ³é¢‘å¸§çš„é‡‡æ ·æ•°</span><br>aac_frame-&gt;format               = AV_SAMPLE_FMT_S16;    <span class="hljs-comment">//æ¯ä¸ªé‡‡æ ·å¤§å°</span><br>aac_frame-&gt;channel_layout       = AV_CH_LAYOUT_STEREO;  <span class="hljs-comment">//channel layout</span><br>av_frame_get_buffer(aac_frame, <span class="hljs-number">0</span>);                      <span class="hljs-comment">//512 * 2 * 2 = 2048 AVFrameçš„å¤§å°</span><br><span class="hljs-keyword">if</span> (!aac_frame-&gt;buf[<span class="hljs-number">0</span>]) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;av_frame_get_buffer å¤±è´¥&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">//åˆå§‹åŒ–AACç¼–ç åçš„æ•°æ®è½½ä½“</span><br>AVPacket *aac_packet = av_packet_alloc(); <span class="hljs-comment">//åˆ†é…ç¼–ç åçš„æ•°æ®ç©ºé—´</span><br><span class="hljs-keyword">if</span> (!aac_packet) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;av_packet_alloc å¤±è´¥&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åŒé‡å¾ªç¯ï¼Œä»ç¼–ç å™¨ä¸­å»é™¤ç¼–ç åçš„æ•°æ®</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">//read data from device</span><br><span class="hljs-keyword">while</span> ((ret = av_read_frame(fmt_ctx, &amp;pkt)) == <span class="hljs-number">0</span> || count++ &lt; <span class="hljs-number">50000</span>) &#123;<br>    usleep(<span class="hljs-number">100</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret %d&quot;</span>, ret);<br>    <span class="hljs-keyword">if</span> (pkt.size &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">//è¿›è¡Œå†…å­˜æ‹·è´</span><br>        <span class="hljs-built_in">memcpy</span>(src_data[<span class="hljs-number">0</span>], pkt.data, pkt.size);<br>        <br>        <span class="hljs-comment">//é‡é‡‡æ ·</span><br>        swr_convert(swr_ctx, dst_data, <span class="hljs-number">512</span>, (<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> **)src_data, <span class="hljs-number">512</span>);<br>        <br>        <span class="hljs-comment">//å°†é‡é‡‡æ ·çš„æ•°æ®æ‹·è´åˆ°frameä¸­å»</span><br>        <span class="hljs-built_in">memcpy</span>(aac_frame-&gt;data[<span class="hljs-number">0</span>], dst_data[<span class="hljs-number">0</span>], dst_linesize);<br>        <br>        <span class="hljs-comment">//å°†æ•°æ®é€ç¼–ç å™¨</span><br>        ret = avcodec_send_frame(codec_ctx, aac_frame);<br>        <br>        <span class="hljs-comment">//å¦‚æœret &gt;= 0 è¯´æ˜æ•°æ®è®¾ç½®æˆåŠŸ</span><br>        <span class="hljs-keyword">while</span> (ret &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//è·å–ç¼–ç åçš„éŸ³é¢‘æ•°æ®ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™éœ€è¦é‡å¤è·å–ï¼Œç›´åˆ°å¤±è´¥ä¸ºæ­¢</span><br>            ret = avcodec_receive_packet(codec_ctx, aac_packet);<br>            <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">if</span> (ret == AVERROR(EAGAIN) || ret == AVERROR_EOF) &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avcodec_receive_packet error&quot;</span>);<br>                    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>                &#125;<br>            &#125;<br>            <br>            fwrite(aac_packet-&gt;data, aac_packet-&gt;size, <span class="hljs-number">1</span>, outFile);<br>            fflush(outFile);<br>        &#125;<br>        <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;packet size is %d(%p), count=%d \n&quot;</span>, pkt.size, pkt.data, count);<br>        av_packet_unref(&amp;pkt);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ã€AACç¼–ç çš„å®Œæ•´ä»£ç -è¿˜æœ‰bug"><a href="#4ã€AACç¼–ç çš„å®Œæ•´ä»£ç -è¿˜æœ‰bug" class="headerlink" title="4ã€AACç¼–ç çš„å®Œæ•´ä»£ç (è¿˜æœ‰bug)"></a>4ã€AACç¼–ç çš„å®Œæ•´ä»£ç (è¿˜æœ‰bug)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;test.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavutil/avutil.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavdevice/avdevice.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavcodec/avcodec.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libswresample/swresample.h&quot;</span></span><br><br><span class="hljs-comment">//å½•éŸ³</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">record_audio</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span> errors[<span class="hljs-number">1024</span>];<br>    <br>    <span class="hljs-comment">//ctx</span><br>    AVFormatContext *fmt_ctx = <span class="hljs-literal">NULL</span>;<br>    AVDictionary *options = <span class="hljs-literal">NULL</span>;<br>    SwrContext *swr_ctx = <span class="hljs-literal">NULL</span>;<br>    <br>    swr_ctx = swr_alloc_set_opts(<span class="hljs-literal">NULL</span>,<br>                                 AV_CH_LAYOUT_STEREO, AV_SAMPLE_FMT_S16, <span class="hljs-number">44100</span>,  <span class="hljs-comment">// é‡é‡‡æ ·è¾“å‡ºéŸ³é¢‘ä¸‰è¦ç´ </span><br>                                 AV_CH_LAYOUT_STEREO, AV_SAMPLE_FMT_FLT, <span class="hljs-number">44100</span>,  <span class="hljs-comment">// é‡é‡‡æ ·è¾“å…¥éŸ³é¢‘ä¸‰è¦æ•°</span><br>                                 <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span> (swr_ctx == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;swr_alloc_set_opts error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    ret = swr_init(swr_ctx);<br>    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;swr_init error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-type">uint8_t</span> **src_data = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">int</span> src_linesize = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">uint8_t</span> **dst_data = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">int</span> dst_linesize = <span class="hljs-number">0</span>;<br>    <br>    av_samples_alloc_array_and_samples(&amp;src_data, &amp;src_linesize, <span class="hljs-number">2</span>, <span class="hljs-number">512</span>, AV_SAMPLE_FMT_FLT, <span class="hljs-number">0</span>);<br>    av_samples_alloc_array_and_samples(&amp;dst_data, &amp;dst_linesize, <span class="hljs-number">2</span>, <span class="hljs-number">512</span>, AV_SAMPLE_FMT_S16, <span class="hljs-number">0</span>);<br>    <br>    <span class="hljs-comment">//packet</span><br>    <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br>    AVPacket pkt;<br>    <br>    <span class="hljs-comment">// [video device]:[aduio device]</span><br>    <span class="hljs-type">char</span> *devicename = <span class="hljs-string">&quot;:0&quot;</span>;<br>    <br>    <span class="hljs-comment">//register audio device</span><br>    avdevice_register_all();<br>    <br>    <span class="hljs-comment">//get format</span><br>    <span class="hljs-type">const</span> AVInputFormat *iformat = av_find_input_format(<span class="hljs-string">&quot;avfoundation&quot;</span>);<br>    <br>    <span class="hljs-comment">//open device</span><br>    ret = avformat_open_input(&amp;fmt_ctx, devicename, iformat, &amp;options);<br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        av_strerror(ret, errors, <span class="hljs-number">1024</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avformat_open_input error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//crate file</span><br>    <span class="hljs-type">char</span> *outPath = <span class="hljs-string">&quot;/Users/carrot/Desktop/MyCode/he_audio.aac&quot;</span>;<br>    FILE *outFile = fopen(outPath, <span class="hljs-string">&quot;wb+&quot;</span>);<br>    <span class="hljs-keyword">if</span> (outFile == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;outFile fopen failed&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//æ‰¾åˆ°libfdkç¼–ç å™¨</span><br>    <span class="hljs-type">const</span> AVCodec *codec = avcodec_find_encoder_by_name(<span class="hljs-string">&quot;libfdk_aac&quot;</span>);<br>    <span class="hljs-keyword">if</span> (codec == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avcodec_find_encoder_by_name error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//åˆ›å»ºç¼–ç ä¸Šä¸‹æ–‡</span><br>    AVCodecContext *codec_ctx = avcodec_alloc_context3(codec);<br>    codec_ctx-&gt;sample_fmt = AV_SAMPLE_FMT_S16;          <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘çš„é‡‡æ ·å¤§å°</span><br>    codec_ctx-&gt;channel_layout = AV_CH_LAYOUT_STEREO;    <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘çš„channel layout</span><br>    codec_ctx-&gt;channels = <span class="hljs-number">2</span>;                            <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘ channel ä¸ªæ•°</span><br>    codec_ctx-&gt;sample_rate = <span class="hljs-number">44100</span>;                     <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘çš„é‡‡æ ·ç‡</span><br><span class="hljs-comment">//    codec_ctx-&gt;bit_rate = 0; //AAC_LC:128K, AAC HE:64K, AAC HE V2:32K</span><br>    codec_ctx-&gt;profile = FF_PROFILE_AAC_HE; <span class="hljs-comment">//é˜…è¯» ffmpeg ä»£ç ï¼Œå¯çŸ¥bit_rate å’Œ profileä¹‹é—´çš„è®¾è®¡å…³ç³»</span><br>    <br>    <span class="hljs-comment">//æ‰“å¼€ç¼–ç å™¨</span><br>    <span class="hljs-keyword">if</span> (avcodec_open2(codec_ctx, codec, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avcodec_open2 error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//åˆå§‹åŒ–AACç¼–ç å‰çš„æ•°æ®è½½ä½“</span><br>    AVFrame *aac_frame = av_frame_alloc();<br>    <span class="hljs-keyword">if</span> (!aac_frame) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;av_frame_alloc å¤±è´¥&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    aac_frame-&gt;nb_samples           = <span class="hljs-number">512</span>;                  <span class="hljs-comment">//å•é€šé“ä¸€ä¸ªéŸ³é¢‘å¸§çš„é‡‡æ ·æ•°</span><br>    aac_frame-&gt;format               = AV_SAMPLE_FMT_S16;    <span class="hljs-comment">//æ¯ä¸ªé‡‡æ ·å¤§å°</span><br>    aac_frame-&gt;channel_layout       = AV_CH_LAYOUT_STEREO;  <span class="hljs-comment">//channel layout</span><br>    av_frame_get_buffer(aac_frame, <span class="hljs-number">0</span>);                      <span class="hljs-comment">//512 * 2 * 2 = 2048 AVFrameçš„å¤§å°</span><br>    <span class="hljs-keyword">if</span> (!aac_frame-&gt;buf[<span class="hljs-number">0</span>]) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;av_frame_get_buffer å¤±è´¥&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//åˆå§‹åŒ–AACç¼–ç åçš„æ•°æ®è½½ä½“</span><br>    AVPacket *aac_packet = av_packet_alloc(); <span class="hljs-comment">//åˆ†é…ç¼–ç åçš„æ•°æ®ç©ºé—´</span><br>    <span class="hljs-keyword">if</span> (!aac_packet) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;av_packet_alloc å¤±è´¥&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <br>    <span class="hljs-comment">//read data from device</span><br>    <span class="hljs-keyword">while</span> ((ret = av_read_frame(fmt_ctx, &amp;pkt)) == <span class="hljs-number">0</span> || count++ &lt; <span class="hljs-number">50000</span>) &#123;<br>        usleep(<span class="hljs-number">100</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret %d&quot;</span>, ret);<br>        <span class="hljs-keyword">if</span> (pkt.size &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//è¿›è¡Œå†…å­˜æ‹·è´</span><br>            <span class="hljs-built_in">memcpy</span>(src_data[<span class="hljs-number">0</span>], pkt.data, pkt.size);<br>            <br>            <span class="hljs-comment">//é‡é‡‡æ ·</span><br>            swr_convert(swr_ctx, dst_data, <span class="hljs-number">512</span>, (<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> **)src_data, <span class="hljs-number">512</span>);<br>            <br>            <span class="hljs-comment">//å°†é‡é‡‡æ ·çš„æ•°æ®æ‹·è´åˆ°frameä¸­å»</span><br>            <span class="hljs-built_in">memcpy</span>(aac_frame-&gt;data[<span class="hljs-number">0</span>], dst_data[<span class="hljs-number">0</span>], dst_linesize);<br>            <br>            <span class="hljs-comment">//å°†æ•°æ®é€ç¼–ç å™¨</span><br>            ret = avcodec_send_frame(codec_ctx, aac_frame);<br>            <br>            <span class="hljs-comment">//å¦‚æœret &gt;= 0 è¯´æ˜æ•°æ®è®¾ç½®æˆåŠŸ</span><br>            <span class="hljs-keyword">while</span> (ret &gt;= <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-comment">//è·å–ç¼–ç åçš„éŸ³é¢‘æ•°æ®ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™éœ€è¦é‡å¤è·å–ï¼Œç›´åˆ°å¤±è´¥ä¸ºæ­¢</span><br>                ret = avcodec_receive_packet(codec_ctx, aac_packet);<br>                <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (ret == AVERROR(EAGAIN) || ret == AVERROR_EOF) &#123;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avcodec_receive_packet error&quot;</span>);<br>                        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>                    &#125;<br>                &#125;<br>                <br>                fwrite(aac_packet-&gt;data, aac_packet-&gt;size, <span class="hljs-number">1</span>, outFile);<br>                fflush(outFile);<br>            &#125;<br>            <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;packet size is %d(%p), count=%d \n&quot;</span>, pkt.size, pkt.data, count);<br>            av_packet_unref(&amp;pkt);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">//close device and release ctx</span><br>    avformat_close_input(&amp;fmt_ctx);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¿è¡Œç»“æŸ\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5ã€å€ŸåŠ©ffplayæ’­æ”¾ç¼–ç åçš„aacæ–‡ä»¶"><a href="#5ã€å€ŸåŠ©ffplayæ’­æ”¾ç¼–ç åçš„aacæ–‡ä»¶" class="headerlink" title="5ã€å€ŸåŠ©ffplayæ’­æ”¾ç¼–ç åçš„aacæ–‡ä»¶"></a>5ã€å€ŸåŠ©ffplayæ’­æ”¾ç¼–ç åçš„aacæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffplay he_audio.aac<br></code></pre></td></tr></table></figure><h2 id="äºŒã€å½•éŸ³ã€é‡é‡‡æ ·ã€aacç¼–ç ä»£ç æŠ½å–ä¼˜åŒ–ã€å®Œæ•´ä»£ç "><a href="#äºŒã€å½•éŸ³ã€é‡é‡‡æ ·ã€aacç¼–ç ä»£ç æŠ½å–ä¼˜åŒ–ã€å®Œæ•´ä»£ç " class="headerlink" title="äºŒã€å½•éŸ³ã€é‡é‡‡æ ·ã€aacç¼–ç ä»£ç æŠ½å–ä¼˜åŒ–ã€å®Œæ•´ä»£ç "></a>äºŒã€å½•éŸ³ã€é‡é‡‡æ ·ã€aacç¼–ç ä»£ç æŠ½å–ä¼˜åŒ–ã€å®Œæ•´ä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;test.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavutil/avutil.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavdevice/avdevice.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavcodec/avcodec.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libswresample/swresample.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> rec_status = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">set_status</span><span class="hljs-params">(<span class="hljs-type">int</span> status)</span>&#123;<br>    rec_status = status;<br>&#125;<br><br><span class="hljs-comment">//[in]</span><br><span class="hljs-comment">//[out]</span><br><span class="hljs-comment">//ret</span><br><span class="hljs-comment">//@brief encode audio data</span><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">encode</span><span class="hljs-params">(AVCodecContext *ctx,</span><br><span class="hljs-params">            AVFrame *frame,</span><br><span class="hljs-params">            AVPacket *pkt,</span><br><span class="hljs-params">            FILE *output)</span>&#123;<br>    <br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-comment">//å°†æ•°æ®é€ç¼–ç å™¨</span><br>    ret = avcodec_send_frame(ctx, frame);<br>    <br>    <span class="hljs-comment">//å¦‚æœret&gt;=0è¯´æ˜æ•°æ®è®¾ç½®æˆåŠŸ</span><br>    <span class="hljs-keyword">while</span>(ret &gt;= <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-comment">//è·å–ç¼–ç åçš„éŸ³é¢‘æ•°æ®,å¦‚æœæˆåŠŸï¼Œéœ€è¦é‡å¤è·å–ï¼Œç›´åˆ°å¤±è´¥ä¸ºæ­¢</span><br>        ret = avcodec_receive_packet(ctx, pkt);<br>        <br>        <span class="hljs-keyword">if</span>(ret == AVERROR(EAGAIN) || ret == AVERROR_EOF)&#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( ret &lt; <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error, encoding audio frame\n&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>        &#125;<br>        <br>        <span class="hljs-comment">//write file</span><br>        fwrite(pkt-&gt;data, <span class="hljs-number">1</span>, pkt-&gt;size, output);<br>        fflush(output);<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">//[in]</span><br><span class="hljs-comment">//[out]</span><br><span class="hljs-comment">//</span><br><span class="hljs-type">static</span> AVCodecContext* <span class="hljs-title function_">open_coder</span><span class="hljs-params">()</span>&#123;<br>    <br>    <span class="hljs-comment">//æ‰“å¼€ç¼–ç å™¨</span><br>    <span class="hljs-comment">//avcodec_find_encoder(AV_CODEC_ID_AAC);</span><br>    AVCodec *codec = avcodec_find_encoder_by_name(<span class="hljs-string">&quot;libfdk_aac&quot;</span>);<br>    <br>    <span class="hljs-comment">//åˆ›å»º codec ä¸Šä¸‹æ–‡</span><br>    AVCodecContext *codec_ctx = avcodec_alloc_context3(codec);<br>    <br>    codec_ctx-&gt;sample_fmt = AV_SAMPLE_FMT_S16;          <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘çš„é‡‡æ ·å¤§å°</span><br>    codec_ctx-&gt;channel_layout = AV_CH_LAYOUT_STEREO;    <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘çš„channel layout</span><br>    codec_ctx-&gt;channels = <span class="hljs-number">2</span>;                            <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘ channel ä¸ªæ•°</span><br>    codec_ctx-&gt;sample_rate = <span class="hljs-number">44100</span>;                     <span class="hljs-comment">//è¾“å…¥éŸ³é¢‘çš„é‡‡æ ·ç‡</span><br>    codec_ctx-&gt;bit_rate = <span class="hljs-number">0</span>; <span class="hljs-comment">//AAC_LC: 128K, AAC HE: 64K, AAC HE V2: 32K</span><br>    codec_ctx-&gt;profile = FF_PROFILE_AAC_HE; <span class="hljs-comment">//é˜…è¯» ffmpeg ä»£ç </span><br>    <br>    <span class="hljs-comment">//æ‰“å¼€ç¼–ç å™¨</span><br>    <span class="hljs-keyword">if</span>(avcodec_open2(codec_ctx, codec, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-comment">//</span><br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> codec_ctx;<br>&#125;<br><br><span class="hljs-type">static</span><br>SwrContext* <span class="hljs-title function_">init_swr</span><span class="hljs-params">()</span>&#123;<br>    <br>    SwrContext *swr_ctx = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-comment">//channel, number/</span><br>    swr_ctx = swr_alloc_set_opts(<span class="hljs-literal">NULL</span>,                <span class="hljs-comment">//ctx</span><br>                                 AV_CH_LAYOUT_STEREO, <span class="hljs-comment">//è¾“å‡ºchannelå¸ƒå±€</span><br>                                 AV_SAMPLE_FMT_S16,   <span class="hljs-comment">//è¾“å‡ºçš„é‡‡æ ·æ ¼å¼</span><br>                                 <span class="hljs-number">44100</span>,               <span class="hljs-comment">//é‡‡æ ·ç‡</span><br>                                 AV_CH_LAYOUT_STEREO, <span class="hljs-comment">//è¾“å…¥channelå¸ƒå±€</span><br>                                 AV_SAMPLE_FMT_FLT,   <span class="hljs-comment">//è¾“å…¥çš„é‡‡æ ·æ ¼å¼</span><br>                                 <span class="hljs-number">44100</span>,               <span class="hljs-comment">//è¾“å…¥çš„é‡‡æ ·ç‡</span><br>                                 <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);<br>    <br>    <span class="hljs-keyword">if</span>(!swr_ctx)&#123;<br>        <br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span>(swr_init(swr_ctx) &lt; <span class="hljs-number">0</span>)&#123;<br>        <br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> swr_ctx;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief open audio device</span><br><span class="hljs-comment">  * @return succ: AVFormatContext*, fail: NULL</span><br><span class="hljs-comment">  */</span><br><span class="hljs-type">static</span><br>AVFormatContext* <span class="hljs-title function_">open_dev</span><span class="hljs-params">()</span>&#123;<br>    <br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span> errors[<span class="hljs-number">1024</span>] = &#123;<span class="hljs-number">0</span>, &#125;;<br>    <br>    <span class="hljs-comment">//ctx</span><br>    AVFormatContext *fmt_ctx = <span class="hljs-literal">NULL</span>;<br>    AVDictionary *options = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-comment">//[[video device]:[audio device]]</span><br>    <span class="hljs-type">char</span> *devicename = <span class="hljs-string">&quot;:0&quot;</span>;<br>    <br>    <span class="hljs-comment">//get format</span><br>    AVInputFormat *iformat = av_find_input_format(<span class="hljs-string">&quot;avfoundation&quot;</span>);<br>    <br>    <span class="hljs-comment">//open device</span><br>    <span class="hljs-keyword">if</span>((ret = avformat_open_input(&amp;fmt_ctx, devicename, iformat, &amp;options)) &lt; <span class="hljs-number">0</span> )&#123;<br>        av_strerror(ret, errors, <span class="hljs-number">1024</span>);<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Failed to open audio device, [%d]%s\n&quot;</span>, ret, errors);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> fmt_ctx;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @brief xxxx</span><br><span class="hljs-comment"> * @return xxx</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">static</span><br>AVFrame* <span class="hljs-title function_">create_frame</span><span class="hljs-params">()</span>&#123;<br>    <br>    AVFrame *frame = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-comment">//éŸ³é¢‘è¾“å…¥æ•°æ®</span><br>    frame = av_frame_alloc();<br>    <span class="hljs-keyword">if</span>(!frame)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error, No Memory!\n&quot;</span>);<br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br>    <br>    <span class="hljs-comment">//set parameters</span><br>    frame-&gt;nb_samples     = <span class="hljs-number">512</span>;                <span class="hljs-comment">//å•é€šé“ä¸€ä¸ªéŸ³é¢‘å¸§çš„é‡‡æ ·æ•°</span><br>    frame-&gt;format         = AV_SAMPLE_FMT_S16;  <span class="hljs-comment">//æ¯ä¸ªé‡‡æ ·çš„å¤§å°</span><br>    frame-&gt;channel_layout = AV_CH_LAYOUT_STEREO; <span class="hljs-comment">//channel layout</span><br>    <br>    <span class="hljs-comment">//alloc inner memory</span><br>    av_frame_get_buffer(frame, <span class="hljs-number">0</span>); <span class="hljs-comment">// 512 * 2 * = 2048</span><br>    <span class="hljs-keyword">if</span>(!frame-&gt;data[<span class="hljs-number">0</span>])&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error, Failed to alloc buf in frame!\n&quot;</span>);<br>        <span class="hljs-comment">//å†…å­˜æ³„æ¼</span><br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> frame;<br>    <br>__ERROR:<br>    <span class="hljs-keyword">if</span>(frame)&#123;<br>        av_frame_free(&amp;frame);<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-type">static</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">alloc_data_4_resample</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> ***src_data,</span><br><span class="hljs-params">                           <span class="hljs-type">int</span> *src_linesize,</span><br><span class="hljs-params">                           <span class="hljs-type">uint8_t</span> *** dst_data,</span><br><span class="hljs-params">                           <span class="hljs-type">int</span> *dst_linesize)</span>&#123;<br>    <span class="hljs-comment">//4096/4=1024/2=512</span><br>    <span class="hljs-comment">//åˆ›å»ºè¾“å…¥ç¼“å†²åŒº</span><br>    av_samples_alloc_array_and_samples(src_data,         <span class="hljs-comment">//è¾“å‡ºç¼“å†²åŒºåœ°å€</span><br>                                       src_linesize,     <span class="hljs-comment">//ç¼“å†²åŒºçš„å¤§å°</span><br>                                       <span class="hljs-number">2</span>,                 <span class="hljs-comment">//é€šé“ä¸ªæ•°</span><br>                                       <span class="hljs-number">512</span>,               <span class="hljs-comment">//å•é€šé“é‡‡æ ·ä¸ªæ•°</span><br>                                       AV_SAMPLE_FMT_FLT, <span class="hljs-comment">//é‡‡æ ·æ ¼å¼</span><br>                                       <span class="hljs-number">0</span>);<br>    <br>    <span class="hljs-comment">//åˆ›å»ºè¾“å‡ºç¼“å†²åŒº</span><br>    av_samples_alloc_array_and_samples(dst_data,         <span class="hljs-comment">//è¾“å‡ºç¼“å†²åŒºåœ°å€</span><br>                                       dst_linesize,     <span class="hljs-comment">//ç¼“å†²åŒºçš„å¤§å°</span><br>                                       <span class="hljs-number">2</span>,                 <span class="hljs-comment">//é€šé“ä¸ªæ•°</span><br>                                       <span class="hljs-number">512</span>,               <span class="hljs-comment">//å•é€šé“é‡‡æ ·ä¸ªæ•°</span><br>                                       AV_SAMPLE_FMT_S16, <span class="hljs-comment">//é‡‡æ ·æ ¼å¼</span><br>                                       <span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">static</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">free_data_4_resample</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> **src_data, <span class="hljs-type">uint8_t</span> **dst_data)</span>&#123;<br>    <span class="hljs-comment">//é‡Šæ”¾è¾“å…¥è¾“å‡ºç¼“å†²åŒº</span><br>    <span class="hljs-keyword">if</span>(src_data)&#123;<br>        av_freep(&amp;src_data[<span class="hljs-number">0</span>]);<br>    &#125;<br>    av_freep(&amp;src_data);<br>    <br>    <span class="hljs-keyword">if</span>(dst_data)&#123;<br>        av_freep(&amp;dst_data[<span class="hljs-number">0</span>]);<br>    &#125;<br>    av_freep(&amp;dst_data);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">static</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">read_data_and_encode</span><span class="hljs-params">(AVFormatContext *fmt_ctx, <span class="hljs-comment">//</span></span><br><span class="hljs-params">                          AVCodecContext *c_ctx,</span><br><span class="hljs-params">                          SwrContext* swr_ctx,</span><br><span class="hljs-params">                          FILE *outfile)</span>&#123;<br>    <br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-comment">//pakcet</span><br>    AVPacket pkt;<br>    AVFrame *frame = <span class="hljs-literal">NULL</span>;<br>    AVPacket *newpkt = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-comment">//é‡é‡‡æ ·ç¼“å†²åŒº</span><br>    <span class="hljs-type">uint8_t</span> **src_data = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">int</span> src_linesize = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-type">uint8_t</span> **dst_data = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">int</span> dst_linesize = <span class="hljs-number">0</span>;<br><br>    frame = create_frame();<br>    <span class="hljs-keyword">if</span>(!frame)&#123;<br>        <span class="hljs-comment">//printf(...)</span><br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br>    <br>    newpkt = av_packet_alloc(); <span class="hljs-comment">//åˆ†é…ç¼–ç åçš„æ•°æ®ç©ºé—´</span><br>    <span class="hljs-keyword">if</span>(!newpkt)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error, Failed to alloc buf in frame!\n&quot;</span>);<br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br>    <br>    <span class="hljs-comment">//åˆ†é…é‡é‡‡æ ·è¾“å…¥/è¾“å‡ºç¼“å†²åŒº</span><br>    alloc_data_4_resample(&amp;src_data, &amp;src_linesize, &amp;dst_data, &amp;dst_linesize);<br>    <br>    <span class="hljs-comment">//read data from device</span><br>    <span class="hljs-keyword">while</span>(rec_status) &#123;<br>        ret = av_read_frame(fmt_ctx, &amp;pkt);<br>        <br>        <span class="hljs-keyword">if</span> (pkt.size &lt;= <span class="hljs-number">0</span>) &#123;<br>            usleep(<span class="hljs-number">300</span>);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        <span class="hljs-comment">//è¿›è¡Œå†…å­˜æ‹·è´ï¼ŒæŒ‰å­—èŠ‚æ‹·è´çš„</span><br>        <span class="hljs-built_in">memcpy</span>((<span class="hljs-type">void</span>*)src_data[<span class="hljs-number">0</span>], (<span class="hljs-type">void</span>*)pkt.data, pkt.size);<br>        <br>        <span class="hljs-comment">//é‡é‡‡æ ·</span><br>        swr_convert(swr_ctx,                    <span class="hljs-comment">//é‡é‡‡æ ·çš„ä¸Šä¸‹æ–‡</span><br>                    dst_data,                   <span class="hljs-comment">//è¾“å‡ºç»“æœç¼“å†²åŒº</span><br>                    <span class="hljs-number">512</span>,                        <span class="hljs-comment">//æ¯ä¸ªé€šé“çš„é‡‡æ ·æ•°</span><br>                    (<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> **)src_data, <span class="hljs-comment">//è¾“å…¥ç¼“å†²åŒº</span><br>                    <span class="hljs-number">512</span>);                       <span class="hljs-comment">//è¾“å…¥å•ä¸ªé€šé“çš„é‡‡æ ·æ•°</span><br>        <br>        <span class="hljs-comment">//å°†é‡é‡‡æ ·çš„æ•°æ®æ‹·è´åˆ° frame ä¸­</span><br>        <span class="hljs-built_in">memcpy</span>((<span class="hljs-type">void</span> *)frame-&gt;data[<span class="hljs-number">0</span>], dst_data[<span class="hljs-number">0</span>], dst_linesize);<br>        <br>        <span class="hljs-comment">//encode</span><br>        encode(c_ctx, frame, newpkt, outfile);<br>        <br>        <span class="hljs-comment">//</span><br>        av_packet_unref(&amp;pkt); <span class="hljs-comment">//release pkt</span><br>    &#125;<br>    <br>    <span class="hljs-comment">//å¼ºåˆ¶å°†ç¼–ç å™¨ç¼“å†²åŒºä¸­çš„éŸ³é¢‘è¿›è¡Œç¼–ç è¾“å‡º</span><br>    encode(c_ctx, <span class="hljs-literal">NULL</span>, newpkt, outfile);<br><br>__ERROR:<br>    <span class="hljs-comment">//é‡Šæ”¾ AVFrame å’Œ AVPacket</span><br>    <span class="hljs-keyword">if</span>(frame)&#123;<br>        av_frame_free(&amp;frame);<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span>(newpkt)&#123;<br>        av_packet_free(&amp;newpkt);<br>    &#125;<br>    <br>    <span class="hljs-comment">//é‡Šæ”¾é‡é‡‡æ ·ç¼“å†²åŒº</span><br>    free_data_4_resample(src_data, dst_data);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">rec_audio</span><span class="hljs-params">()</span> &#123;<br>  <br>    <span class="hljs-comment">//context</span><br>    AVFormatContext *fmt_ctx = <span class="hljs-literal">NULL</span>;<br>    AVCodecContext *c_ctx = <span class="hljs-literal">NULL</span>;<br>    SwrContext* swr_ctx = <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-comment">//set log level</span><br>    av_log_set_level(AV_LOG_DEBUG);<br>    <br>    <span class="hljs-comment">//register audio device</span><br>    avdevice_register_all();<br>    <br>    <span class="hljs-comment">//start record</span><br>    rec_status = <span class="hljs-number">1</span>;<br>    <br>    <span class="hljs-comment">//create file</span><br>    <span class="hljs-comment">//char *out = &quot;/Users/lichao/Downloads/av_base/audio.pcm&quot;;</span><br>    <span class="hljs-type">char</span> *out = <span class="hljs-string">&quot;/Users/carrot/Desktop/MyCode/audio.aac&quot;</span>;<br>    FILE *outfile = fopen(out, <span class="hljs-string">&quot;wb+&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!outfile)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error, Failed to open file!\n&quot;</span>);<br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br>    <br>    <span class="hljs-comment">//æ‰“å¼€è®¾å¤‡</span><br>    fmt_ctx = open_dev();<br>    <span class="hljs-keyword">if</span>(!fmt_ctx)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error, Failed to open device!\n&quot;</span>);<br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br><br>    <span class="hljs-comment">//æ‰“å¼€ç¼–ç å™¨ä¸Šä¸‹æ–‡</span><br>    c_ctx = open_coder();<br>    <span class="hljs-keyword">if</span>(!c_ctx)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;...&quot;</span>);<br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br><br>    <span class="hljs-comment">//åˆå§‹åŒ–é‡é‡‡æ ·ä¸Šä¸‹æ–‡</span><br>    swr_ctx = init_swr();<br>    <span class="hljs-keyword">if</span>(!swr_ctx)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error, Failed to alloc buf in frame!\n&quot;</span>);<br>        <span class="hljs-keyword">goto</span> __ERROR;<br>    &#125;<br>    <br>    <span class="hljs-comment">//encode</span><br>    read_data_and_encode(fmt_ctx, c_ctx, swr_ctx, outfile);<br><br>__ERROR:<br>    <span class="hljs-comment">//é‡Šæ”¾é‡é‡‡æ ·çš„ä¸Šä¸‹æ–‡</span><br>    <span class="hljs-keyword">if</span>(swr_ctx)&#123;<br>        swr_free(&amp;swr_ctx);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(c_ctx)&#123;<br>        avcodec_free_context(&amp;c_ctx);<br>    &#125;<br>    <br>    <span class="hljs-comment">//close device and release ctx</span><br>    <span class="hljs-keyword">if</span>(fmt_ctx) &#123;<br>        avformat_close_input(&amp;fmt_ctx);<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span>(outfile)&#123;<br>        <span class="hljs-comment">//close file</span><br>        fclose(outfile);<br>    &#125;<br><br>    av_log(<span class="hljs-literal">NULL</span>, AV_LOG_DEBUG, <span class="hljs-string">&quot;finish!\n&quot;</span>);<br>    <br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> 0</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    rec_audio();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><ul><li>æ’­æ”¾ä¸Šè¿°å½•éŸ³</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffplay audio.aac<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>ffmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day08-éŸ³é¢‘AACç¼–ç ç†è®º(äºŒ)</title>
    <link href="/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91AAC%E7%BC%96%E7%A0%81/"/>
    <url>/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91AAC%E7%BC%96%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€éŸ³é¢‘ç¼–ç ç†è®ºåŸºç¡€"><a href="#ä¸€ã€éŸ³é¢‘ç¼–ç ç†è®ºåŸºç¡€" class="headerlink" title="ä¸€ã€éŸ³é¢‘ç¼–ç ç†è®ºåŸºç¡€"></a>ä¸€ã€éŸ³é¢‘ç¼–ç ç†è®ºåŸºç¡€</h2><h3 id="1ã€éŸ³é¢‘æœ‰æŸå‹ç¼©ä¸»è¦ä»å“ªäº›æ–¹é¢è¿›è¡Œå‹ç¼©ï¼Ÿ"><a href="#1ã€éŸ³é¢‘æœ‰æŸå‹ç¼©ä¸»è¦ä»å“ªäº›æ–¹é¢è¿›è¡Œå‹ç¼©ï¼Ÿ" class="headerlink" title="1ã€éŸ³é¢‘æœ‰æŸå‹ç¼©ä¸»è¦ä»å“ªäº›æ–¹é¢è¿›è¡Œå‹ç¼©ï¼Ÿ"></a>1ã€éŸ³é¢‘<code>æœ‰æŸå‹ç¼©</code>ä¸»è¦ä»å“ªäº›æ–¹é¢è¿›è¡Œå‹ç¼©ï¼Ÿ</h3><ul><li>æ—¶åŸŸé®è”½ã€é¢‘åŸŸé®è”½</li></ul><img src="/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91AAC%E7%BC%96%E7%A0%81/image-20220529103700600.png" class=""><h3 id="2ã€éŸ³é¢‘æ— æŸå‹ç¼©æœ‰å“ªäº›æœ‰åçš„ç®—æ³•ï¼Ÿ"><a href="#2ã€éŸ³é¢‘æ— æŸå‹ç¼©æœ‰å“ªäº›æœ‰åçš„ç®—æ³•ï¼Ÿ" class="headerlink" title="2ã€éŸ³é¢‘æ— æŸå‹ç¼©æœ‰å“ªäº›æœ‰åçš„ç®—æ³•ï¼Ÿ"></a>2ã€éŸ³é¢‘<code>æ— æŸå‹ç¼©</code>æœ‰å“ªäº›æœ‰åçš„ç®—æ³•ï¼Ÿ</h3><ul><li>å“ˆå¤«æ›¼ç®—æ³•</li><li>é¦™å†œç®—æ³•</li></ul><h3 id="3ã€å¸¸è§çš„éŸ³é¢‘ç¼–ç å™¨ï¼Ÿï¼ˆä¾‹ä¸¾ä¸‰ä¸ªï¼‰"><a href="#3ã€å¸¸è§çš„éŸ³é¢‘ç¼–ç å™¨ï¼Ÿï¼ˆä¾‹ä¸¾ä¸‰ä¸ªï¼‰" class="headerlink" title="3ã€å¸¸è§çš„éŸ³é¢‘ç¼–ç å™¨ï¼Ÿï¼ˆä¾‹ä¸¾ä¸‰ä¸ªï¼‰"></a>3ã€å¸¸è§çš„éŸ³é¢‘ç¼–ç å™¨ï¼Ÿï¼ˆä¾‹ä¸¾ä¸‰ä¸ªï¼‰</h3><ul><li>AACï¼šåœ¨ç›´æ’­ç³»ç»Ÿä¸­åº”ç”¨æ¯”è¾ƒå¹¿æ³›</li><li>OPUSï¼šæ˜¯è¾ƒæ–°çš„éŸ³é¢‘ç¼–ç å™¨ï¼ŒWebRTCé»˜è®¤ä½¿ç”¨OPUS</li><li>G.711ï¼šä¸€èˆ¬åœ¨å›ºè¯ä¸­ä½¿ç”¨</li></ul><h3 id="4ã€AACæœ‰å“ªä¸‰ç§å¸¸è§è§„æ ¼ï¼Œç®€å•æè¿°ä¸‹ï¼Ÿ"><a href="#4ã€AACæœ‰å“ªä¸‰ç§å¸¸è§è§„æ ¼ï¼Œç®€å•æè¿°ä¸‹ï¼Ÿ" class="headerlink" title="4ã€AACæœ‰å“ªä¸‰ç§å¸¸è§è§„æ ¼ï¼Œç®€å•æè¿°ä¸‹ï¼Ÿ"></a>4ã€AACæœ‰å“ªä¸‰ç§å¸¸è§è§„æ ¼ï¼Œç®€å•æè¿°ä¸‹ï¼Ÿ</h3><ul><li>AAC LCï¼š<font color="red">(Low Complexity)</font> ä½å¤æ‚åº¦è§„æ ¼ï¼Œ<font color="blue">ç æµæ˜¯128kå·¦å³</font>ï¼ŒéŸ³è´¨å¥½ã€‚</li><li>AAC HEï¼š<font color="red">ç­‰äº AAC LC + SBR(Spectral Band Replication)</font>ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯æŒ‰é¢‘è°±ä¿å­˜ã€‚ä½é¢‘ç¼–ç ä¿å­˜ä¸»è¦æˆåˆ†ï¼Œé«˜é¢‘å•ç‹¬æ”¾å¤§ç¼–ç ä¿å­˜éŸ³è´¨ã€‚<font color="blue">ç æµåœ¨64kå·¦å³</font>ã€‚</li><li>AAC HE V2ï¼šç­‰äº<font color="red">AAC LC + SBR + PS(Parametric Stereo)</font>ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯åŒå£°é“ä¸­çš„å£°éŸ³æ‰åœ¨æŸç§ç›¸ä¼¼æ€§ï¼Œåªéœ€è¦å­˜å‚¨ä¸€ä¸ªå£°é“çš„å…¨éƒ¨ä¿¡æ¯ï¼Œç„¶åèŠ±å¾ˆå°‘çš„å­—èŠ‚ç”¨å‚æ•°æè¿°å¦ä¸€ä¸ªå£°é“å’Œå®ƒä¸åŒçš„åœ°æ–¹ã€‚<font color="blue">ç æµåœ¨48kå·¦å³ã€‚</font></li></ul><h3 id="5ã€AACä¿å­˜æ•°æ®æœ‰ä¸¤ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5ã€AACä¿å­˜æ•°æ®æœ‰ä¸¤ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5ã€AACä¿å­˜æ•°æ®æœ‰ä¸¤ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>5ã€AACä¿å­˜æ•°æ®æœ‰ä¸¤ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>ADIF</li><li>ADTS</li></ul><img src="/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91AAC%E7%BC%96%E7%A0%81/image-20220529105427279.png" class=""><h3 id="6ã€ADTSç»“æ„è¯¦è§£ï¼Ÿ"><a href="#6ã€ADTSç»“æ„è¯¦è§£ï¼Ÿ" class="headerlink" title="6ã€ADTSç»“æ„è¯¦è§£ï¼Ÿ"></a>6ã€ADTSç»“æ„è¯¦è§£ï¼Ÿ</h3><img src="/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91AAC%E7%BC%96%E7%A0%81/image-20220529105523745.png" class=""><h3 id="7ã€é€šè¿‡ffmpegå‘½ä»¤ç”Ÿæˆaaæ–‡ä»¶"><a href="#7ã€é€šè¿‡ffmpegå‘½ä»¤ç”Ÿæˆaaæ–‡ä»¶" class="headerlink" title="7ã€é€šè¿‡ffmpegå‘½ä»¤ç”Ÿæˆaaæ–‡ä»¶"></a>7ã€é€šè¿‡ffmpegå‘½ä»¤ç”Ÿæˆaaæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs sh">ffmpeg -i raw_xxx.mp4 -vn -c:a libfdk_aac -ar 44100 -channels 2 -profile:a aac_he dst_xxx.aac<br></code></pre></td></tr></table></figure><h3 id="8ã€å€ŸåŠ©ç½‘ç«™åˆ†æç”Ÿæˆçš„aacæ–‡ä»¶"><a href="#8ã€å€ŸåŠ©ç½‘ç«™åˆ†æç”Ÿæˆçš„aacæ–‡ä»¶" class="headerlink" title="8ã€å€ŸåŠ©ç½‘ç«™åˆ†æç”Ÿæˆçš„aacæ–‡ä»¶"></a>8ã€å€ŸåŠ©ç½‘ç«™åˆ†æç”Ÿæˆçš„aacæ–‡ä»¶</h3><ul><li><a href="https://www.p23.nl/projects/aac-header/">https://www.p23.nl/projects/aac-header/</a></li></ul><img src="/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91AAC%E7%BC%96%E7%A0%81/image-20220529110152214.png" class="">]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>ffmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day08-éŸ³é¢‘é‡é‡‡æ ·(ä¸€)</title>
    <link href="/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91%E9%87%8D%E9%87%87%E6%A0%B7/"/>
    <url>/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91%E9%87%8D%E9%87%87%E6%A0%B7/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€éŸ³é¢‘é‡é‡‡æ ·"><a href="#ä¸€ã€éŸ³é¢‘é‡é‡‡æ ·" class="headerlink" title="ä¸€ã€éŸ³é¢‘é‡é‡‡æ ·"></a>ä¸€ã€éŸ³é¢‘é‡é‡‡æ ·</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯éŸ³é¢‘é‡é‡‡æ ·ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯éŸ³é¢‘é‡é‡‡æ ·ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯éŸ³é¢‘é‡é‡‡æ ·ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯éŸ³é¢‘é‡é‡‡æ ·ï¼Ÿ</h3><img src="/2022/05/29/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day08%E9%9F%B3%E9%A2%91%E9%87%8D%E9%87%87%E6%A0%B7/image-20220529110421107.png" class=""><h3 id="2ã€ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦è¿›è¡ŒéŸ³é¢‘é‡é‡‡æ ·ï¼Ÿ"><a href="#2ã€ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦è¿›è¡ŒéŸ³é¢‘é‡é‡‡æ ·ï¼Ÿ" class="headerlink" title="2ã€ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦è¿›è¡ŒéŸ³é¢‘é‡é‡‡æ ·ï¼Ÿ"></a>2ã€ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦è¿›è¡ŒéŸ³é¢‘é‡é‡‡æ ·ï¼Ÿ</h3><ul><li>æƒ…å†µä¸€ï¼šä»è®¾å¤‡é‡‡é›†çš„éŸ³é¢‘æ•°æ®ä¸ç¼–ç å™¨è¦æ±‚çš„æ•°æ®ä¸ä¸€è‡´</li><li>æƒ…å†µäºŒï¼šæ’­æ”¾å™¨è¦æ±‚çš„éŸ³é¢‘æ•°æ®ä¸è¦æ’­æ”¾çš„éŸ³é¢‘æ•°æ®ä¸ä¸€è‡´</li><li>æƒ…å†µä¸‰ï¼šè¦æ–¹ä¾¿æŸäº›è¿ç®—çš„æ—¶å€™</li></ul><h3 id="3ã€ç®€è¿°éŸ³é¢‘é‡é‡‡æ ·ä¸»è¦ä¸‰ä¸ªæ­¥éª¤ï¼Ÿ"><a href="#3ã€ç®€è¿°éŸ³é¢‘é‡é‡‡æ ·ä¸»è¦ä¸‰ä¸ªæ­¥éª¤ï¼Ÿ" class="headerlink" title="3ã€ç®€è¿°éŸ³é¢‘é‡é‡‡æ ·ä¸»è¦ä¸‰ä¸ªæ­¥éª¤ï¼Ÿ"></a>3ã€ç®€è¿°éŸ³é¢‘é‡é‡‡æ ·ä¸»è¦ä¸‰ä¸ªæ­¥éª¤ï¼Ÿ</h3><ul><li>è®¾ç½®é‡é‡‡æ ·å‚æ•°ï¼Œå¹¶åˆå§‹åŒ–é‡é‡‡æ ·ä¸Šä¸‹æ–‡ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs C">swr_ctx = swr_alloc_set_opts(<span class="hljs-literal">NULL</span>,<br>                             AV_CH_LAYOUT_STEREO, AV_SAMPLE_FMT_S16, <span class="hljs-number">44100</span>,  <span class="hljs-comment">// é‡é‡‡æ ·è¾“å‡ºéŸ³é¢‘ä¸‰è¦ç´ </span><br>                             AV_CH_LAYOUT_STEREO, AV_SAMPLE_FMT_FLT, <span class="hljs-number">44100</span>,  <span class="hljs-comment">// é‡é‡‡æ ·è¾“å…¥éŸ³é¢‘ä¸‰è¦æ•°</span><br>                             <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);<br>ret = swr_init(swr_ctx);<br></code></pre></td></tr></table></figure><ul><li>è®¾ç½®é‡é‡‡æ ·çš„è¾“å…¥å’Œè¾“å‡ºæ•°æ®å­˜æ”¾åŒº</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">uint8_t</span> **src_data = <span class="hljs-literal">NULL</span>;<br><span class="hljs-type">int</span> src_linesize = <span class="hljs-number">0</span>;<br><span class="hljs-type">uint8_t</span> **dst_data = <span class="hljs-literal">NULL</span>;<br><span class="hljs-type">int</span> dst_linesize = <span class="hljs-number">0</span>;<br><br>av_samples_alloc_array_and_samples(&amp;src_data, &amp;src_linesize, <span class="hljs-number">2</span>, <span class="hljs-number">512</span>, AV_SAMPLE_FMT_FLT, <span class="hljs-number">0</span>);<br>av_samples_alloc_array_and_samples(&amp;dst_data, &amp;dst_linesize, <span class="hljs-number">2</span>, <span class="hljs-number">512</span>, AV_SAMPLE_FMT_S16, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><ul><li>è¿›è¡Œé‡é‡‡æ ·</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">// è¿›è¡Œå†…å­˜æ‹·è´</span><br><span class="hljs-built_in">memcpy</span>((<span class="hljs-type">void</span>*)src_data[<span class="hljs-number">0</span>], (<span class="hljs-type">void</span>*)pkt.data, pkt.size);<br><br><span class="hljs-comment">// é‡é‡‡æ ·</span><br>swr_convert(swr_ctx,                    <span class="hljs-comment">//é‡é‡‡æ ·çš„ä¸Šä¸‹æ–‡</span><br>            dst_data,                   <span class="hljs-comment">//è¾“å‡ºç»“æœç¼“å†²åŒº</span><br>            <span class="hljs-number">512</span>,                        <span class="hljs-comment">//è¾“å‡ºå•ä¸ªé€šé“çš„é‡‡æ ·æ•°</span><br>            (<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> **)src_data, <span class="hljs-comment">//è¾“å…¥ç¼“å†²åŒº</span><br>            <span class="hljs-number">512</span>);                       <span class="hljs-comment">//è¾“å…¥å•ä¸ªé€šé“çš„é‡‡æ ·æ•°</span><br><br><br>fwrite(dst_data[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>, dst_linesize, outFile);<br>fflush(outFile);<br></code></pre></td></tr></table></figure><h3 id="4ã€éŸ³é¢‘é‡é‡‡æ ·å®Œæ•´ä»£ç å¦‚ä¸‹"><a href="#4ã€éŸ³é¢‘é‡é‡‡æ ·å®Œæ•´ä»£ç å¦‚ä¸‹" class="headerlink" title="4ã€éŸ³é¢‘é‡é‡‡æ ·å®Œæ•´ä»£ç å¦‚ä¸‹"></a>4ã€éŸ³é¢‘é‡é‡‡æ ·å®Œæ•´ä»£ç å¦‚ä¸‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;test.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavutil/avutil.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavdevice/avdevice.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavcodec/avcodec.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libswresample/swresample.h&quot;</span></span><br><br><span class="hljs-comment">//å½•éŸ³</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">record_audio</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span> errors[<span class="hljs-number">1024</span>];<br>    <br>    <span class="hljs-comment">//ctx</span><br>    AVFormatContext *fmt_ctx = <span class="hljs-literal">NULL</span>;<br>    AVDictionary *options = <span class="hljs-literal">NULL</span>;<br>    SwrContext *swr_ctx = <span class="hljs-literal">NULL</span>;<br>    <br>    swr_ctx = swr_alloc_set_opts(<span class="hljs-literal">NULL</span>,<br>                                 AV_CH_LAYOUT_STEREO, AV_SAMPLE_FMT_S16, <span class="hljs-number">44100</span>,  <span class="hljs-comment">// é‡é‡‡æ ·è¾“å‡ºéŸ³é¢‘ä¸‰è¦ç´ </span><br>                                 AV_CH_LAYOUT_STEREO, AV_SAMPLE_FMT_FLT, <span class="hljs-number">44100</span>,  <span class="hljs-comment">// é‡é‡‡æ ·è¾“å…¥éŸ³é¢‘ä¸‰è¦æ•°</span><br>                                 <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span> (swr_ctx == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;swr_alloc_set_opts error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    ret = swr_init(swr_ctx);<br>    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;swr_init error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-type">uint8_t</span> **src_data = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">int</span> src_linesize = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">uint8_t</span> **dst_data = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">int</span> dst_linesize = <span class="hljs-number">0</span>;<br>    <br>    av_samples_alloc_array_and_samples(&amp;src_data, &amp;src_linesize, <span class="hljs-number">2</span>, <span class="hljs-number">512</span>, AV_SAMPLE_FMT_FLT, <span class="hljs-number">0</span>);<br>    av_samples_alloc_array_and_samples(&amp;dst_data, &amp;dst_linesize, <span class="hljs-number">2</span>, <span class="hljs-number">512</span>, AV_SAMPLE_FMT_S16, <span class="hljs-number">0</span>);<br>    <br>    <span class="hljs-comment">//packet</span><br>    <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br>    AVPacket pkt;<br>    <br>    <span class="hljs-comment">// [video device]:[aduio device]</span><br>    <span class="hljs-type">char</span> *devicename = <span class="hljs-string">&quot;:0&quot;</span>;<br>    <br>    <span class="hljs-comment">//register audio device</span><br>    avdevice_register_all();<br>    <br>    <span class="hljs-comment">//get format</span><br>    <span class="hljs-type">const</span> AVInputFormat *iformat = av_find_input_format(<span class="hljs-string">&quot;avfoundation&quot;</span>);<br>    <br>    <span class="hljs-comment">//open device</span><br>    ret = avformat_open_input(&amp;fmt_ctx, devicename, iformat, &amp;options);<br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        av_strerror(ret, errors, <span class="hljs-number">1024</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avformat_open_input error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//crate file</span><br>    <span class="hljs-type">char</span> *outPath = <span class="hljs-string">&quot;/Users/carrot/Desktop/MyCode/swr_audio.pcm&quot;</span>;<br>    FILE *outFile = fopen(outPath, <span class="hljs-string">&quot;wb+&quot;</span>);<br>    <span class="hljs-keyword">if</span> (outFile == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;outFile fopen failed&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//read data from device</span><br>    <span class="hljs-keyword">while</span> ((ret = av_read_frame(fmt_ctx, &amp;pkt)) == <span class="hljs-number">0</span> || count++ &lt; <span class="hljs-number">50000</span>) &#123;<br>        usleep(<span class="hljs-number">100</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret %d&quot;</span>, ret);<br>        <span class="hljs-keyword">if</span> (pkt.size &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//è¿›è¡Œå†…å­˜æ‹·è´</span><br>            <span class="hljs-built_in">memcpy</span>(src_data[<span class="hljs-number">0</span>], pkt.data, pkt.size);<br>            <br>            <span class="hljs-comment">//é‡é‡‡æ ·</span><br>            swr_convert(swr_ctx, dst_data, <span class="hljs-number">512</span>, (<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> **)src_data, <span class="hljs-number">512</span>);<br>            <br>            fwrite(dst_data[<span class="hljs-number">0</span>], dst_linesize, <span class="hljs-number">1</span>, outFile);<br>            fflush(outFile);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;packet size is %d(%p), count=%d \n&quot;</span>, pkt.size, pkt.data, count);<br>            av_packet_unref(&amp;pkt);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">//close device and release ctx</span><br>    avformat_close_input(&amp;fmt_ctx);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¿è¡Œç»“æŸ\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5ã€å€ŸåŠ©ffplayæ’­æ”¾é‡é‡‡æ ·çš„æ•°æ®"><a href="#5ã€å€ŸåŠ©ffplayæ’­æ”¾é‡é‡‡æ ·çš„æ•°æ®" class="headerlink" title="5ã€å€ŸåŠ©ffplayæ’­æ”¾é‡é‡‡æ ·çš„æ•°æ®"></a>5ã€å€ŸåŠ©ffplayæ’­æ”¾é‡é‡‡æ ·çš„æ•°æ®</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">ffplay -ar 44100 -f s16le -ac 2 swr_audio.pcm <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>ffmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day07-ffmpegé›†æˆã€éŸ³é¢‘é‡‡é›†</title>
    <link href="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day07%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86/"/>
    <url>/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day07%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€é›†æˆFFmpegåˆ°MacAppé¡¹ç›®"><a href="#ä¸€ã€é›†æˆFFmpegåˆ°MacAppé¡¹ç›®" class="headerlink" title="ä¸€ã€é›†æˆFFmpegåˆ°MacAppé¡¹ç›®"></a>ä¸€ã€é›†æˆFFmpegåˆ°MacAppé¡¹ç›®</h2><h3 id="1ã€åˆ›å»ºä¸€ä¸ªmacçš„Appåº”ç”¨ï¼Œè¯­è¨€é€‰æ‹©swiftã€‚"><a href="#1ã€åˆ›å»ºä¸€ä¸ªmacçš„Appåº”ç”¨ï¼Œè¯­è¨€é€‰æ‹©swiftã€‚" class="headerlink" title="1ã€åˆ›å»ºä¸€ä¸ªmacçš„Appåº”ç”¨ï¼Œè¯­è¨€é€‰æ‹©swiftã€‚"></a>1ã€åˆ›å»ºä¸€ä¸ªmacçš„Appåº”ç”¨ï¼Œè¯­è¨€é€‰æ‹©swiftã€‚</h3><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day07%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86/image-20220528190434270.png" class="" title="image-20220528190917242"><h3 id="2ã€å°†ffmpegç›®å½•ä¸‹çš„-lib-å’Œ-include-æ‹·è´åˆ°é¡¹ç›®ä¸­ã€‚"><a href="#2ã€å°†ffmpegç›®å½•ä¸‹çš„-lib-å’Œ-include-æ‹·è´åˆ°é¡¹ç›®ä¸­ã€‚" class="headerlink" title="2ã€å°†ffmpegç›®å½•ä¸‹çš„ lib å’Œ include æ‹·è´åˆ°é¡¹ç›®ä¸­ã€‚"></a>2ã€å°†ffmpegç›®å½•ä¸‹çš„ <code>lib</code> å’Œ <code>include</code> æ‹·è´åˆ°é¡¹ç›®ä¸­ã€‚</h3><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day07%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86/image-20220528190702809.png" class="" title="image-20220528190917242"><h3 id="3ã€å°†ffmpegåº“å¼•å…¥é¡¹ç›®ä¸­"><a href="#3ã€å°†ffmpegåº“å¼•å…¥é¡¹ç›®ä¸­" class="headerlink" title="3ã€å°†ffmpegåº“å¼•å…¥é¡¹ç›®ä¸­"></a>3ã€å°†ffmpegåº“å¼•å…¥é¡¹ç›®ä¸­</h3><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day07%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86/image-20220528190917242.png" class="" title="image-20220528190917242"><h3 id="4ã€å¼•å…¥ffmpegå¤´æ–‡ä»¶"><a href="#4ã€å¼•å…¥ffmpegå¤´æ–‡ä»¶" class="headerlink" title="4ã€å¼•å…¥ffmpegå¤´æ–‡ä»¶"></a>4ã€å¼•å…¥ffmpegå¤´æ–‡ä»¶</h3><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day07%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86/image-20220528192359166.png" class="" title="image-20220528192359166"><h3 id="5ã€åŠ å…¥ä»£ç æµ‹è¯•"><a href="#5ã€åŠ å…¥ä»£ç æµ‹è¯•" class="headerlink" title="5ã€åŠ å…¥ä»£ç æµ‹è¯•"></a>5ã€åŠ å…¥ä»£ç æµ‹è¯•</h3><ul><li>test.h</li></ul><figure class="highlight c"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> test_h</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> test_h</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavutil/avutil.h&quot;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">record_audio</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* test_h */</span></span><br></code></pre></td></tr></table></figure><ul><li>test.c</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;test.h&quot;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">record_audio</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-comment">// set log level</span><br>    av_log_set_level(AV_LOG_DEBUG);<br>    <span class="hljs-comment">// test ffmpeg</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *info = av_version_info();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s \n&quot;</span>, info);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¿è¡Œç»“æŸ\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ViewController.swift</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> Cocoa<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">NSViewController</span> &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() &#123;<br>        <span class="hljs-keyword">super</span>.viewDidLoad()<br><br>        <span class="hljs-comment">// Do any additional setup after loading the view.</span><br>        <span class="hljs-keyword">self</span>.startRecordAudio();<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> representedObject: <span class="hljs-keyword">Any</span><span class="hljs-operator">?</span> &#123;<br>        <span class="hljs-keyword">didSet</span> &#123;<br>        <span class="hljs-comment">// Update the view, if already loaded.</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">startRecordAudio</span>() &#123;<br>        record_audio()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>FFmpegLearn-Bridging-Header.h æ¡¥æ¥cå’Œswiftçš„æ–‡ä»¶</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#import <span class="hljs-string">&quot;test.h&quot;</span></span><br></code></pre></td></tr></table></figure><ul><li>æ‰“å°å‡ºffmpegç‰ˆæœ¬å·</li></ul><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day07%E9%9F%B3%E9%A2%91%E9%87%87%E9%9B%86/image-20220528192952597.png" class="" title="image-20220528192952597"><h2 id="äºŒã€é€šè¿‡ä»£ç é‡‡é›†éŸ³é¢‘"><a href="#äºŒã€é€šè¿‡ä»£ç é‡‡é›†éŸ³é¢‘" class="headerlink" title="äºŒã€é€šè¿‡ä»£ç é‡‡é›†éŸ³é¢‘"></a>äºŒã€é€šè¿‡ä»£ç é‡‡é›†éŸ³é¢‘</h2><h3 id="1ã€å¦‚ä½•é€šè¿‡ffmpegå‘½ä»¤é‡‡é›†éŸ³é¢‘ï¼Ÿ"><a href="#1ã€å¦‚ä½•é€šè¿‡ffmpegå‘½ä»¤é‡‡é›†éŸ³é¢‘ï¼Ÿ" class="headerlink" title="1ã€å¦‚ä½•é€šè¿‡ffmpegå‘½ä»¤é‡‡é›†éŸ³é¢‘ï¼Ÿ"></a>1ã€å¦‚ä½•é€šè¿‡ffmpegå‘½ä»¤é‡‡é›†éŸ³é¢‘ï¼Ÿ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ffmpeg -f avfoundation -i :0 out.wav<br>ffplay out.wav<br></code></pre></td></tr></table></figure><h3 id="2ã€é€šè¿‡ffmpegä»£ç é‡‡é›†éŸ³é¢‘çš„å…³é”®ä¸‰ä¸ªæ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2ã€é€šè¿‡ffmpegä»£ç é‡‡é›†éŸ³é¢‘çš„å…³é”®ä¸‰ä¸ªæ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€é€šè¿‡ffmpegä»£ç é‡‡é›†éŸ³é¢‘çš„å…³é”®ä¸‰ä¸ªæ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2ã€é€šè¿‡ffmpegä»£ç é‡‡é›†éŸ³é¢‘çš„å…³é”®ä¸‰ä¸ªæ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><div class="code-wrapper"><pre><code class="sh"># æ³¨å†Œæ‰€æœ‰è®¾å¤‡avdevice_register_all(); <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs reasonml"><br>- ```sh<br>  # æ‰“å¼€æŒ‡å®šè®¾å¤‡<br>  ret = avformat<span class="hljs-constructor">_open_input(&amp;<span class="hljs-params">fmt_ctx</span>, <span class="hljs-params">devicename</span>, <span class="hljs-params">iformat</span>, &amp;<span class="hljs-params">options</span>)</span>;<br></code></pre></td></tr></table></figure></code></pre></li><li><p>&#96;&#96;&#96;sh</p><h1 id="å¾ªç¯ä»æ‰“å¼€è®¾å¤‡çš„ä¸Šä¸‹æ–‡ä¸­è¯»å–æ•°æ®"><a href="#å¾ªç¯ä»æ‰“å¼€è®¾å¤‡çš„ä¸Šä¸‹æ–‡ä¸­è¯»å–æ•°æ®" class="headerlink" title="å¾ªç¯ä»æ‰“å¼€è®¾å¤‡çš„ä¸Šä¸‹æ–‡ä¸­è¯»å–æ•°æ®"></a>å¾ªç¯ä»æ‰“å¼€è®¾å¤‡çš„ä¸Šä¸‹æ–‡ä¸­è¯»å–æ•°æ®</h1><p>while ((ret &#x3D; av_read_frame(fmt_ctx, &amp;pkt)) &#x3D;&#x3D; 0)</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><br><br><br>### <span class="hljs-number">3</span>ã€åœ¨é€šè¿‡å†™ä»£ç é‡‡é›†éŸ³é¢‘ä¹‹å‰ï¼Œéœ€è¦å¯¹macAppé¡¹ç›®åšå¦‚ä¸‹ä¸¤ä¸ªé…ç½®<br><br>- å…³é—­æ²™ç®±`App Sanbox`åŠŸèƒ½ï¼Œæ‰èƒ½è¯»å–macæœ¬åœ°ç›®å½•<br>- åœ¨ `info.plist` æ–‡ä»¶å¤¹ä¸­ï¼Œé…ç½®éº¦å…‹é£è®¿é—®æƒé™è¯´æ˜ï¼Œæ‰èƒ½æ‰“å¼€éº¦å…‹é£<br><br>&#123;% asset_img image<span class="hljs-number">-20220529095509767.</span>png image<span class="hljs-number">-20220529095509767</span> %&#125;<br><br><br><br>### <span class="hljs-number">4</span>ã€å®Œæ•´ä»£ç <br><br>```c<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;test.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavutil/avutil.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavdevice/avdevice.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;include/libavcodec/avcodec.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">record_audio</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>&#123;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span> errors[<span class="hljs-number">1024</span>];<br>    <br>    <span class="hljs-comment">//ctx</span><br>    AVFormatContext *fmt_ctx = <span class="hljs-literal">NULL</span>;<br>    AVDictionary *options = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-comment">//packet</span><br>    <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br>    AVPacket pkt;<br>    <br>    <span class="hljs-comment">// [video device]:[aduio device]</span><br>    <span class="hljs-type">char</span> *devicename = <span class="hljs-string">&quot;:0&quot;</span>;<br>    <br>    <span class="hljs-comment">//register audio device</span><br>    <span class="hljs-built_in">avdevice_register_all</span>();<br>    <br>    <span class="hljs-comment">//get format</span><br>    <span class="hljs-type">const</span> AVInputFormat *iformat = <span class="hljs-built_in">av_find_input_format</span>(<span class="hljs-string">&quot;avfoundation&quot;</span>);<br>    <br>    <span class="hljs-comment">//open device</span><br>    ret = <span class="hljs-built_in">avformat_open_input</span>(&amp;fmt_ctx, devicename, iformat, &amp;options);<br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">av_strerror</span>(ret, errors, <span class="hljs-number">1024</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;avformat_open_input error&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//crate file</span><br>    <span class="hljs-type">char</span> *outPath = <span class="hljs-string">&quot;/Users/carrot/Desktop/MyCode/audio.pcm&quot;</span>;<br>    FILE *outFile = <span class="hljs-built_in">fopen</span>(outPath, <span class="hljs-string">&quot;wb+&quot;</span>);<br>    <span class="hljs-keyword">if</span> (outFile == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;outFile fopen failed&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//read data from device</span><br>    <span class="hljs-keyword">while</span> ((ret = <span class="hljs-built_in">av_read_frame</span>(fmt_ctx, &amp;pkt)) == <span class="hljs-number">0</span> || count++ &lt; <span class="hljs-number">50000</span>) &#123;<br>        <span class="hljs-built_in">usleep</span>(<span class="hljs-number">100</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret %d&quot;</span>, ret);<br>        <span class="hljs-keyword">if</span> (pkt.size &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">fwrite</span>(pkt.data, pkt.size, <span class="hljs-number">1</span>, outFile);<br>            <span class="hljs-built_in">fflush</span>(outFile);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;packet size is %d(%p), count=%d \n&quot;</span>, pkt.size, pkt.data, count);<br>            <span class="hljs-built_in">av_packet_unref</span>(&amp;pkt);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">//close device and release ctx</span><br>    <span class="hljs-built_in">avformat_close_input</span>(&amp;fmt_ctx);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¿è¡Œç»“æŸ\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="5ã€æ’­æ”¾å½•åˆ¶çš„pcmæ–‡ä»¶-MacBook-Pro-Retina-15-inch-Mid-2015"><a href="#5ã€æ’­æ”¾å½•åˆ¶çš„pcmæ–‡ä»¶-MacBook-Pro-Retina-15-inch-Mid-2015" class="headerlink" title="5ã€æ’­æ”¾å½•åˆ¶çš„pcmæ–‡ä»¶(MacBook Pro (Retina, 15-inch, Mid 2015))"></a>5ã€æ’­æ”¾å½•åˆ¶çš„pcmæ–‡ä»¶(MacBook Pro (Retina, 15-inch, Mid 2015))</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">ffplay -ar <span class="hljs-number">44100</span> -f f32le -ac <span class="hljs-number">2</span> audio.pcm <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>ffmpeg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day06-ffmpegç¼–è¯‘</title>
    <link href="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day06%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91ffmpeg/"/>
    <url>/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day06%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91ffmpeg/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€æ‰‹åŠ¨ç¼–è¯‘ffmpeg"><a href="#ä¸€ã€æ‰‹åŠ¨ç¼–è¯‘ffmpeg" class="headerlink" title="ä¸€ã€æ‰‹åŠ¨ç¼–è¯‘ffmpeg"></a>ä¸€ã€æ‰‹åŠ¨ç¼–è¯‘ffmpeg</h2><h3 id="1ã€ç›®æ ‡"><a href="#1ã€ç›®æ ‡" class="headerlink" title="1ã€ç›®æ ‡"></a>1ã€ç›®æ ‡</h3><p>è¿™é‡Œå…ˆæå‰è¯´æ˜ä¸€ä¸‹ï¼Œæœ€åå¸Œæœ›è¾¾åˆ°çš„æ•ˆæœï¼š</p><ul><li>ç¼–è¯‘å‡ºffmpegã€ffprobeã€ffplayä¸‰ä¸ªå‘½ä»¤è¡Œå·¥å…·</li><li>åªäº§ç”ŸåŠ¨æ€åº“ï¼Œä¸äº§ç”Ÿé™æ€åº“</li><li>å°† fdk-aacã€x264ã€x265é›†æˆåˆ°FFmpegä¸­</li></ul><h3 id="2ã€ä¸‹è½½æºç "><a href="#2ã€ä¸‹è½½æºç " class="headerlink" title="2ã€ä¸‹è½½æºç "></a>2ã€ä¸‹è½½æºç </h3><p>ä¸‹è½½æºç <a href="https://ffmpeg.org/releases/ffmpeg-4.3.2.tar.xz">ffmpeg-4.3.2.tar.xz</a>ï¼Œç„¶åè§£å‹ã€‚</p><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day06%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91ffmpeg/497279-20210410211902005-744008601-20220528181822420.png" class="" title="FFmpegæºç ç»“æ„"><h3 id="3ã€å®‰è£…ä¾èµ–åº“"><a href="#3ã€å®‰è£…ä¾èµ–åº“" class="headerlink" title="3ã€å®‰è£…ä¾èµ–åº“"></a>3ã€å®‰è£…ä¾èµ–åº“</h3><ul><li>brew install yasm<ul><li>ffmpegçš„ç¼–è¯‘è¿‡ç¨‹ä¾èµ–yasm</li><li>è‹¥æœªå®‰è£…yasmä¼šå‡ºç°é”™è¯¯ï¼šnasm&#x2F;yasm not found or too old. Use â€“disable-x86asm for a crippled build.</li></ul></li><li>brew install sdl2<ul><li>ffplayä¾èµ–äºsdl2</li><li>å¦‚æœç¼ºå°‘sdl2ï¼Œå°±æ— æ³•ç¼–è¯‘å‡ºffplay</li></ul></li><li>brew install fdk-aac<ul><li>ä¸ç„¶ä¼šå‡ºç°é”™è¯¯ï¼šERROR: libfdk_aac not found</li></ul></li><li>brew install x264<ul><li>ä¸ç„¶ä¼šå‡ºç°é”™è¯¯ï¼šERROR: libx264 not found</li></ul></li><li>brew install x265<ul><li>ä¸ç„¶ä¼šå‡ºç°é”™è¯¯ï¼šERROR: libx265 not found</li></ul></li></ul><p>å…¶å®x264ã€x265ã€sdl2éƒ½åœ¨æ›¾ç»æ‰§è¡Œ<em>brew install ffmpeg</em>çš„æ—¶å€™å®‰è£…è¿‡äº†ã€‚</p><ul><li>å¯ä»¥é€šè¿‡ brew list çš„ç»“æœæŸ¥çœ‹æ˜¯å¦å®‰è£…è¿‡<ul><li><em>brew list | grep fdk</em></li><li><em>brew list | grep x26</em></li><li><em>brew list | grep -E â€˜fdk|x26â€™</em></li></ul></li><li>å¦‚æœå·²ç»å®‰è£…è¿‡ï¼Œå¯ä»¥ä¸ç”¨å†æ‰§è¡Œ<em>brew install</em></li></ul><h4 id="4ã€configure"><a href="#4ã€configure" class="headerlink" title="4ã€configure"></a>4ã€configure</h4><p>é¦–å…ˆè¿›å…¥æºç ç›®å½•ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs SH"><span class="hljs-comment"># æˆ‘çš„æºç æ”¾åœ¨äº†Downloadsç›®å½•ä¸‹</span><br><span class="hljs-built_in">cd</span> ~/Downloads/ffmpeg-4.3.2<br></code></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œæºç ç›®å½•ä¸‹çš„<code>configure</code>è„šæœ¬ï¼Œè®¾ç½®ä¸€äº›ç¼–è¯‘å‚æ•°ï¼Œåšä¸€äº›ç¼–è¯‘å‰çš„å‡†å¤‡å·¥ä½œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./configure --prefix=/usr/local/ffmpeg --enable-shared --disable-static --enable-gpl  --enable-nonfree --enable-libfdk-aac --enable-libx264 --enable-libx265<br></code></pre></td></tr></table></figure><ul><li><em>â€“prefix</em><ul><li>ç”¨ä»¥æŒ‡å®šç¼–è¯‘å¥½çš„FFmpegå®‰è£…åˆ°å“ªä¸ªç›®å½•</li><li>ä¸€èˆ¬æ”¾åˆ°&#x2F;usr&#x2F;local&#x2F;ffmpegä¸­å³å¯</li></ul></li><li><em>â€“enable-shared</em><ul><li>ç”ŸæˆåŠ¨æ€åº“</li></ul></li><li><em>â€“disable-static</em><ul><li>ä¸ç”Ÿæˆé™æ€åº“</li></ul></li><li><em>â€“enable-libfdk-aac</em><ul><li>å°†fdk-aacå†…ç½®åˆ°FFmpegä¸­</li></ul></li><li><em>â€“enable-libx264</em><ul><li>å°†x264å†…ç½®åˆ°FFmpegä¸­</li></ul></li><li><em>â€“enable-libx265</em><ul><li>å°†x265å†…ç½®åˆ°FFmpegä¸­</li></ul></li><li><em>â€“enable-gpl</em><ul><li>x264ã€x265è¦æ±‚å¼€å¯<a href="https://www.gnu.org/licenses/gpl-3.0.html">GPL License</a></li></ul></li><li><em>â€“enable-nonfree</em><ul><li><a href="https://github.com/FFmpeg/FFmpeg/blob/master/LICENSE.md">fdk-aacä¸GPLä¸å…¼å®¹</a>ï¼Œéœ€è¦é€šè¿‡å¼€å¯nonfreeè¿›è¡Œé…ç½®</li></ul></li></ul><p>ä½ å¯ä»¥é€šè¿‡<em>configure â€“help</em>å‘½ä»¤æŸ¥çœ‹æ¯ä¸€ä¸ªé…ç½®é¡¹çš„ä½œç”¨ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">./configure --<span class="hljs-built_in">help</span> | grep static <br><br><span class="hljs-comment"># ç»“æœå¦‚ä¸‹æ‰€ç¤º</span><br>--disable-static         <span class="hljs-keyword">do</span> not build static libraries [no]<br></code></pre></td></tr></table></figure><h3 id="5ã€ç¼–è¯‘"><a href="#5ã€ç¼–è¯‘" class="headerlink" title="5ã€ç¼–è¯‘"></a>5ã€ç¼–è¯‘</h3><p>æ¥ä¸‹æ¥å¼€å§‹è§£ææºä»£ç ç›®å½•ä¸­çš„Makefileæ–‡ä»¶ï¼Œè¿›è¡Œç¼–è¯‘ã€‚*-j8*è¡¨ç¤ºå…è®¸åŒæ—¶æ‰§è¡Œ8ä¸ªç¼–è¯‘ä»»åŠ¡ã€‚</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-built_in">make</span> -j8<br></code></pre></td></tr></table></figure><p>å¯¹äºç»å¸¸åœ¨ç±»Unixç³»ç»Ÿä¸‹æ¥è§¦C&#x2F;C++å¼€å‘çš„å°ä¼™ä¼´æ¥è¯´ï¼ŒMakefileå¿…ç„¶æ˜¯ä¸é™Œç”Ÿçš„ã€‚è¿™é‡Œç»™ä¸äº†è§£Makefileçš„å°ä¼™ä¼´ç®€å•ç§‘æ™®ä¸€ä¸‹ï¼š</p><ul><li>Makefileæè¿°äº†æ•´ä¸ªé¡¹ç›®çš„ç¼–è¯‘å’Œé“¾æ¥ç­‰è§„åˆ™<ul><li>æ¯”å¦‚å“ªäº›æ–‡ä»¶éœ€è¦ç¼–è¯‘ï¼Ÿå“ªäº›æ–‡ä»¶ä¸éœ€è¦ç¼–è¯‘ï¼Ÿå“ªäº›æ–‡ä»¶éœ€è¦å…ˆç¼–è¯‘ï¼Ÿå“ªäº›æ–‡ä»¶éœ€è¦åç¼–è¯‘ï¼Ÿç­‰ç­‰</li></ul></li><li>Makefileå¯ä»¥ä½¿é¡¹ç›®çš„ç¼–è¯‘å˜å¾—è‡ªåŠ¨åŒ–ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½æ‰‹åŠ¨è¾“å…¥ä¸€å †æºæ–‡ä»¶å’Œå‚æ•°<ul><li>æ¯”å¦‚åŸæ¥éœ€è¦è¿™ä¹ˆå†™ï¼š<em>gcc test1.c test2.c test3.c -o test</em></li></ul></li></ul><h3 id="6ã€å®‰è£…"><a href="#6ã€å®‰è£…" class="headerlink" title="6ã€å®‰è£…"></a>6ã€å®‰è£…</h3><p>å°†ç¼–è¯‘å¥½çš„åº“å®‰è£…åˆ°æŒ‡å®šçš„ä½ç½®ï¼š&#x2F;usr&#x2F;local&#x2F;ffmpegã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">make <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæ¯•åï¼Œ&#x2F;usr&#x2F;local&#x2F;ffmpegçš„ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚</p><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day06%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91ffmpeg/497279-20210410215351652-254888592.png" class="" title="FFmpegç›®å½•ç»“æ„"><h3 id="7ã€é…ç½®PATH"><a href="#7ã€é…ç½®PATH" class="headerlink" title="7ã€é…ç½®PATH"></a>7ã€é…ç½®PATH</h3><p>ä¸ºäº†è®©binç›®å½•ä¸­çš„ffmpegã€ffprobeã€ffplayåœ¨ä»»æ„ä½ç½®éƒ½èƒ½å¤Ÿä½¿ç”¨ï¼Œéœ€è¦å…ˆå°†binç›®å½•é…ç½®åˆ°ç¯å¢ƒå˜é‡PATHä¸­ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ç¼–è¾‘.zprofile</span><br>vim ~/.zprofile <br><br><span class="hljs-comment"># .zprofileæ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹</span><br><span class="hljs-built_in">export</span> PATH=/usr/local/ffmpeg/bin:<span class="hljs-variable">$PATH</span> <br><br><span class="hljs-comment"># è®©.zprofileç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> ~/.zprofile<br></code></pre></td></tr></table></figure><p>å¦‚æœä½ ç”¨çš„æ˜¯bashï¼Œè€Œä¸æ˜¯zshï¼Œåªéœ€è¦å°†ä¸Šé¢çš„.zprofileæ¢æˆ.bash_profileã€‚</p><h3 id="8ã€éªŒè¯"><a href="#8ã€éªŒè¯" class="headerlink" title="8ã€éªŒè¯"></a>8ã€éªŒè¯</h3><p>æ¥ä¸‹æ¥ï¼Œåœ¨å‘½ä»¤è¡Œä¸Šè¿›è¡ŒéªŒè¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">ffmpeg -version <br><br><span class="hljs-comment"># ç»“æœå¦‚ä¸‹æ‰€ç¤º</span><br><br>ffmpeg version 4.3.2 Copyright (c) 2000-2021 the FFmpeg developers<br>built with Apple clang version 12.0.0 (clang-1200.0.32.29)<br>configuration: --prefix=/usr/local/ffmpeg --enable-shared --disable-static --enable-gpl --enable-nonfree --enable-libfdk-aac --enable-libx264 --enable-libx265<br>libavutil      56. 51.100 / 56. 51.100<br>libavcodec     58. 91.100 / 58. 91.100<br>libavformat    58. 45.100 / 58. 45.100<br>libavdevice    58. 10.100 / 58. 10.100<br>libavfilter     7. 85.100 /  7. 85.100<br>libswscale      5.  7.100 /  5.  7.100<br>libswresample   3.  7.100 /  3.  7.100<br>libpostproc    55.  7.100 / 55.  7.100<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œä½ å®Œå…¨å¯ä»¥é€šè¿‡<code>brew uninstall ffmpeg</code>å¸è½½ä»¥å‰å®‰è£…çš„FFmpegã€‚</p>]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day05-éŸ³é¢‘åŸºç¡€ç¯‡</title>
    <link href="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day05%E9%9F%B3%E9%A2%91%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    <url>/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day05%E9%9F%B3%E9%A2%91%E5%9F%BA%E7%A1%80%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€éŸ³é¢‘åŸºç¡€çŸ¥è¯†"><a href="#ä¸€ã€éŸ³é¢‘åŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸€ã€éŸ³é¢‘åŸºç¡€çŸ¥è¯†"></a>ä¸€ã€éŸ³é¢‘åŸºç¡€çŸ¥è¯†</h2><h3 id="1ã€ä»å…±äº«ç«¯å’Œè§‚çœ‹ç«¯æ¥å¤§è‡´åˆ†æç›´æ’­æµç¨‹ï¼Ÿ"><a href="#1ã€ä»å…±äº«ç«¯å’Œè§‚çœ‹ç«¯æ¥å¤§è‡´åˆ†æç›´æ’­æµç¨‹ï¼Ÿ" class="headerlink" title="1ã€ä»å…±äº«ç«¯å’Œè§‚çœ‹ç«¯æ¥å¤§è‡´åˆ†æç›´æ’­æµç¨‹ï¼Ÿ"></a>1ã€ä»å…±äº«ç«¯å’Œè§‚çœ‹ç«¯æ¥å¤§è‡´åˆ†æç›´æ’­æµç¨‹ï¼Ÿ</h3><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day05%E9%9F%B3%E9%A2%91%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220528172645179.png" class=""><h3 id="2ã€ä»€ä¹ˆæ˜¯èµ«å…¹ï¼Ÿäººç±»å¬è§‰èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ"><a href="#2ã€ä»€ä¹ˆæ˜¯èµ«å…¹ï¼Ÿäººç±»å¬è§‰èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="2ã€ä»€ä¹ˆæ˜¯èµ«å…¹ï¼Ÿäººç±»å¬è§‰èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ"></a>2ã€ä»€ä¹ˆæ˜¯èµ«å…¹ï¼Ÿäººç±»å¬è§‰èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ</h3><ul><li>å£°éŸ³ä¸€ç§’æŒ¯åŠ¨çš„æ¬¡æ•°å«åšèµ«å…¹ï¼Œè‹±æ–‡ç®€ç§° <font color="red">Hz</font></li><li>20Hz ~ 20000Hz</li></ul><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day05%E9%9F%B3%E9%A2%91%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220528173322566.png" class=""><h3 id="3ã€åˆ†åˆ«è§£é‡ŠéŸ³è°ƒã€éŸ³é‡ã€éŸ³è‰²åˆ†åˆ«ç”±ä»€ä¹ˆå†³å®šï¼Ÿ"><a href="#3ã€åˆ†åˆ«è§£é‡ŠéŸ³è°ƒã€éŸ³é‡ã€éŸ³è‰²åˆ†åˆ«ç”±ä»€ä¹ˆå†³å®šï¼Ÿ" class="headerlink" title="3ã€åˆ†åˆ«è§£é‡ŠéŸ³è°ƒã€éŸ³é‡ã€éŸ³è‰²åˆ†åˆ«ç”±ä»€ä¹ˆå†³å®šï¼Ÿ"></a>3ã€åˆ†åˆ«è§£é‡ŠéŸ³è°ƒã€éŸ³é‡ã€éŸ³è‰²åˆ†åˆ«ç”±ä»€ä¹ˆå†³å®šï¼Ÿ</h3><ul><li>éŸ³è°ƒï¼šå£°éŸ³é¢‘ç‡çš„é«˜ä½</li><li>éŸ³é‡ï¼šå£°éŸ³æŒ¯å¹…çš„å¤§å°</li><li>éŸ³è‰²ï¼šè°æ³¢ç»„åˆè€Œæˆ</li></ul><h3 id="4ã€éŸ³é¢‘æ’­æ”¾çš„ä¸‰è¦ç´ æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#4ã€éŸ³é¢‘æ’­æ”¾çš„ä¸‰è¦ç´ æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4ã€éŸ³é¢‘æ’­æ”¾çš„ä¸‰è¦ç´ æ˜¯ä»€ä¹ˆï¼Ÿ"></a>4ã€éŸ³é¢‘æ’­æ”¾çš„ä¸‰è¦ç´ æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>é‡‡æ ·ç‡ï¼šé‡‡æ ·é¢‘ç‡8kã€16kã€32kã€44.1kã€48k</li><li>é‡‡æ ·æ ¼å¼ï¼šä¸€ä¸ªé‡‡æ ·ç”¨å¤šå°‘bitå­˜æ”¾ã€‚é€šå¸¸æ˜¯16bit</li><li>å£°é“æ•°ï¼šå•å£°é“ã€åŒå£°é“ã€å¤šå£°é“</li></ul><h3 id="5ã€WAVå¤´éƒ¨ä¿¡æ¯åˆ†æï¼Ÿï¼ˆTODOåé¢æœ‰ç©ºåœ¨å›çœ‹ï¼‰"><a href="#5ã€WAVå¤´éƒ¨ä¿¡æ¯åˆ†æï¼Ÿï¼ˆTODOåé¢æœ‰ç©ºåœ¨å›çœ‹ï¼‰" class="headerlink" title="5ã€WAVå¤´éƒ¨ä¿¡æ¯åˆ†æï¼Ÿï¼ˆTODOåé¢æœ‰ç©ºåœ¨å›çœ‹ï¼‰"></a>5ã€WAVå¤´éƒ¨ä¿¡æ¯åˆ†æï¼Ÿï¼ˆTODOåé¢æœ‰ç©ºåœ¨å›çœ‹ï¼‰</h3><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day05%E9%9F%B3%E9%A2%91%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220528173749399.png" class=""><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day05%E9%9F%B3%E9%A2%91%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220528173803520.png" class="">]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day01-å…¥é—¨åŸºç¡€ç¯‡</title>
    <link href="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    <url>/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€Macç»ˆç«¯å‘½ä»¤"><a href="#ä¸€ã€Macç»ˆç«¯å‘½ä»¤" class="headerlink" title="ä¸€ã€Macç»ˆç«¯å‘½ä»¤"></a>ä¸€ã€Macç»ˆç«¯å‘½ä»¤</h2><h3 id="1ã€å¦‚æœç”µè„‘ä¸Šæœ‰å¤šä¸ªffmpegï¼Œå¦‚ä½•çŸ¥é“å½“å‰æ‰§è¡Œçš„ffmpegå‘½ä»¤æ˜¯å“ªä¸ªå®‰è£…åŒ…ä¸‹çš„ï¼Ÿ"><a href="#1ã€å¦‚æœç”µè„‘ä¸Šæœ‰å¤šä¸ªffmpegï¼Œå¦‚ä½•çŸ¥é“å½“å‰æ‰§è¡Œçš„ffmpegå‘½ä»¤æ˜¯å“ªä¸ªå®‰è£…åŒ…ä¸‹çš„ï¼Ÿ" class="headerlink" title="1ã€å¦‚æœç”µè„‘ä¸Šæœ‰å¤šä¸ªffmpegï¼Œå¦‚ä½•çŸ¥é“å½“å‰æ‰§è¡Œçš„ffmpegå‘½ä»¤æ˜¯å“ªä¸ªå®‰è£…åŒ…ä¸‹çš„ï¼Ÿ"></a>1ã€å¦‚æœç”µè„‘ä¸Šæœ‰å¤šä¸ªffmpegï¼Œå¦‚ä½•çŸ¥é“å½“å‰æ‰§è¡Œçš„ffmpegå‘½ä»¤æ˜¯å“ªä¸ªå®‰è£…åŒ…ä¸‹çš„ï¼Ÿ</h3><ul><li>å€ŸåŠ© <font color="red">which</font> å‘½ä»¤</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">which</span> ffmpeg<br>/usr/local/ffmpeg/bin/ffmpeg<br></code></pre></td></tr></table></figure><h3 id="2ã€å€ŸåŠ©å‘½ä»¤è¡Œå¦‚ä½•çŸ¥é“Cè¯­è¨€çš„å‡½æ•°ï¼Œæ¯”å¦‚-malloc-å‡½æ•°å±äºå“ªä¸ªåº“ï¼Ÿ"><a href="#2ã€å€ŸåŠ©å‘½ä»¤è¡Œå¦‚ä½•çŸ¥é“Cè¯­è¨€çš„å‡½æ•°ï¼Œæ¯”å¦‚-malloc-å‡½æ•°å±äºå“ªä¸ªåº“ï¼Ÿ" class="headerlink" title="2ã€å€ŸåŠ©å‘½ä»¤è¡Œå¦‚ä½•çŸ¥é“Cè¯­è¨€çš„å‡½æ•°ï¼Œæ¯”å¦‚ malloc å‡½æ•°å±äºå“ªä¸ªåº“ï¼Ÿ"></a>2ã€å€ŸåŠ©å‘½ä»¤è¡Œå¦‚ä½•çŸ¥é“Cè¯­è¨€çš„å‡½æ•°ï¼Œæ¯”å¦‚ <font color="red">malloc</font> å‡½æ•°å±äºå“ªä¸ªåº“ï¼Ÿ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ man malloc<br></code></pre></td></tr></table></figure><img src="/2022/05/28/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8%E7%AC%AC%E4%B8%80%E5%AD%A3/day01%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E7%AF%87/image-20220528133251618.png" class="" title="image-20220528133251618"><h3 id="3ã€env-å‘½ä»¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#3ã€env-å‘½ä»¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="3ã€env å‘½ä»¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>3ã€<code>env</code> å‘½ä»¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h3><ul><li>å¯ä»¥æŸ¥çœ‹å½“å‰macç”µè„‘çš„ç¯å¢ƒå˜é‡</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">env</span> | grep PATH<br>MANPATH=/usr/local/share/man:<br>PATH=/usr/local/ffmpeg/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Library/Apple/usr/bin<br>INFOPATH=/usr/local/share/info:<br></code></pre></td></tr></table></figure><h2 id="äºŒã€Cè¯­è¨€å›é¡¾"><a href="#äºŒã€Cè¯­è¨€å›é¡¾" class="headerlink" title="äºŒã€Cè¯­è¨€å›é¡¾"></a>äºŒã€Cè¯­è¨€å›é¡¾</h2><h3 id="1ã€Cè¯­è¨€ä¸­çš„æ•°ç»„é•¿åº¦ä¸å…¶ä»–é«˜çº§è¯­è¨€æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><a href="#1ã€Cè¯­è¨€ä¸­çš„æ•°ç»„é•¿åº¦ä¸å…¶ä»–é«˜çº§è¯­è¨€æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ" class="headerlink" title="1ã€Cè¯­è¨€ä¸­çš„æ•°ç»„é•¿åº¦ä¸å…¶ä»–é«˜çº§è¯­è¨€æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"></a>1ã€Cè¯­è¨€ä¸­çš„<font color="red">æ•°ç»„é•¿åº¦</font>ä¸å…¶ä»–é«˜çº§è¯­è¨€æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3><ul><li>Cè¯­è¨€ä¸­çš„æ•°ç»„é•¿åº¦ï¼Œå¿…é¡»æŒ‡å®šï¼Œæ— æ³•è‡ªåŠ¨æ‰©å®¹ã€‚</li><li>Cè¯­è¨€ä¸­çš„æ•°ç»„å­˜å‚¨æ•°æ®çš„é•¿åº¦ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±ç»´æŠ¤ï¼Œä¸å¯ç›´æ¥å¯¹æ•°ç»„è¿›è¡Œè·å–ã€‚</li></ul><h3 id="2ã€æŒ‡é’ˆçš„å®é™…ä½œç”¨ï¼Ÿ"><a href="#2ã€æŒ‡é’ˆçš„å®é™…ä½œç”¨ï¼Ÿ" class="headerlink" title="2ã€æŒ‡é’ˆçš„å®é™…ä½œç”¨ï¼Ÿ"></a>2ã€æŒ‡é’ˆçš„å®é™…ä½œç”¨ï¼Ÿ</h3><ul><li>â‘ åœ¨å‚æ•°ä¼ é€’æ—¶ï¼Œä¸éœ€è¦çœŸçš„å¸¦ç€ä¸€å¤§å †çš„æ•°æ®ï¼Œå¯ä»¥ä¼ é€’æŒ‡é’ˆï¼Œæé«˜ç¨‹åºæ‰§è¡Œæ•ˆç‡ã€‚</li><li>â‘¡æŒ‡é’ˆå¯ä»¥æŒ‡å‘ä»»ä½•åœ°å€ï¼Œæ‰€ä»¥çµæ´»æ€§å¾ˆé«˜</li></ul><h3 id="3ã€æŒ‡é’ˆçš„å®šä¹‰ï¼Ÿ"><a href="#3ã€æŒ‡é’ˆçš„å®šä¹‰ï¼Ÿ" class="headerlink" title="3ã€æŒ‡é’ˆçš„å®šä¹‰ï¼Ÿ"></a>3ã€æŒ‡é’ˆçš„å®šä¹‰ï¼Ÿ</h3><ul><li>æŒ‡å‘å†…å­˜æ‰€åœ¨åœ°å€çš„å˜é‡ï¼Œå°±æ˜¯æŒ‡é’ˆã€‚</li></ul><h3 id="4ã€å¯¹æŒ‡é’ˆçš„æ“ä½œå¯ä»¥åˆ†ä¸ºå“ªä¸¤å¤§æ–¹å‘ï¼Ÿ"><a href="#4ã€å¯¹æŒ‡é’ˆçš„æ“ä½œå¯ä»¥åˆ†ä¸ºå“ªä¸¤å¤§æ–¹å‘ï¼Ÿ" class="headerlink" title="4ã€å¯¹æŒ‡é’ˆçš„æ“ä½œå¯ä»¥åˆ†ä¸ºå“ªä¸¤å¤§æ–¹å‘ï¼Ÿ"></a>4ã€å¯¹æŒ‡é’ˆçš„æ“ä½œå¯ä»¥åˆ†ä¸ºå“ªä¸¤å¤§æ–¹å‘ï¼Ÿ</h3><ul><li>å¯¹æŒ‡é’ˆæœ¬èº«è¿›è¡Œæ“ä½œ</li><li>å¯¹æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹æ“ä½œ</li></ul><h3 id="5ã€å€ŸåŠ©ä»¥ä¸‹ä»£ç ï¼Œæ€è€ƒä¸ºä»€ä¹ˆè¦å…»æˆæŒ‡é’ˆé‡Šæ”¾åéœ€è¦ç½®ç©ºçš„ç¼–ç å¥½ä¹ æƒ¯ï¼Ÿ"><a href="#5ã€å€ŸåŠ©ä»¥ä¸‹ä»£ç ï¼Œæ€è€ƒä¸ºä»€ä¹ˆè¦å…»æˆæŒ‡é’ˆé‡Šæ”¾åéœ€è¦ç½®ç©ºçš„ç¼–ç å¥½ä¹ æƒ¯ï¼Ÿ" class="headerlink" title="5ã€å€ŸåŠ©ä»¥ä¸‹ä»£ç ï¼Œæ€è€ƒä¸ºä»€ä¹ˆè¦å…»æˆæŒ‡é’ˆé‡Šæ”¾åéœ€è¦ç½®ç©ºçš„ç¼–ç å¥½ä¹ æƒ¯ï¼Ÿ"></a>5ã€å€ŸåŠ©ä»¥ä¸‹ä»£ç ï¼Œæ€è€ƒä¸ºä»€ä¹ˆè¦å…»æˆæŒ‡é’ˆé‡Šæ”¾åéœ€è¦ç½®ç©ºçš„ç¼–ç å¥½ä¹ æƒ¯ï¼Ÿ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * argv[])</span> &#123;<br>    <span class="hljs-comment">// insert code here...</span><br>    <br>    <span class="hljs-type">char</span> *p = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">10</span>);<br>    *p = <span class="hljs-string">&#x27;a&#x27;</span>;<br>    *(p+<span class="hljs-number">1</span>) = <span class="hljs-string">&#x27;b&#x27;</span>;<br>    *(p+<span class="hljs-number">2</span>) = <span class="hljs-string">&#x27;c&#x27;</span>;<br>    <span class="hljs-built_in">free</span>(p);<br><span class="hljs-comment">//    p = NULL; (å¦‚æœæ²¡æœ‰è¿™å¥ä»£ç çš„ä¿æŠ¤ï¼Œæ¥ä¸‹æ¥å¯¹pçš„ä½¿ç”¨å°±æ˜¯é‡æŒ‡é’ˆï¼Œå®¹æ˜“é€ æˆä¸å¯é¢„çŸ¥çš„é”™è¯¯)</span><br>    *p = <span class="hljs-string">&#x27;d&#x27;</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, p);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6ã€ä»€ä¹ˆæ˜¯å‡½æ•°ï¼Ÿä»€ä¹ˆæ˜¯å‡½æ•°æŒ‡é’ˆï¼Ÿæœ€å¥½è‡ªå·±å…ˆä»£ç ç»ƒä¸€ä¸‹ã€‚"><a href="#6ã€ä»€ä¹ˆæ˜¯å‡½æ•°ï¼Ÿä»€ä¹ˆæ˜¯å‡½æ•°æŒ‡é’ˆï¼Ÿæœ€å¥½è‡ªå·±å…ˆä»£ç ç»ƒä¸€ä¸‹ã€‚" class="headerlink" title="6ã€ä»€ä¹ˆæ˜¯å‡½æ•°ï¼Ÿä»€ä¹ˆæ˜¯å‡½æ•°æŒ‡é’ˆï¼Ÿæœ€å¥½è‡ªå·±å…ˆä»£ç ç»ƒä¸€ä¸‹ã€‚"></a>6ã€ä»€ä¹ˆæ˜¯å‡½æ•°ï¼Ÿä»€ä¹ˆæ˜¯å‡½æ•°æŒ‡é’ˆï¼Ÿæœ€å¥½è‡ªå·±å…ˆä»£ç ç»ƒä¸€ä¸‹ã€‚</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * argv[])</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span>;          <span class="hljs-comment">//å‡½æ•°å£°æ˜</span><br>    <span class="hljs-type">int</span> (*func)(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>);      <span class="hljs-comment">//å‡½æ•°æŒ‡é’ˆ</span><br>    func = sum;<br>    <span class="hljs-type">int</span> result = func(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%i\n&quot;</span>, result);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>    <span class="hljs-keyword">return</span> a + b;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7ã€usleepå‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå•ä½æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#7ã€usleepå‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå•ä½æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="7ã€usleepå‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå•ä½æ˜¯ä»€ä¹ˆï¼Ÿ"></a>7ã€<font color="red">usleep</font>å‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå•ä½æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>usleepçš„å‡½æ•°æ˜¯è®©çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´</li><li>usleepçš„å•ä½æ˜¯<font color="red">å¾®ç§’</font></li><li><code>usleep(1000000); </code> å°±æ˜¯é˜»å¡1sé’Ÿ</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * argv[])</span> &#123;<br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (count &lt; <span class="hljs-number">10</span>) &#123;<br>        usleep(<span class="hljs-number">1000000</span>);<br>        count ++;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%i \n&quot;</span>, count);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="8ã€Cè¯­è¨€ä¸­å¦‚ä½•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ä½•è¯»å–æ–‡ä»¶ï¼Œå¦‚ä½•å…³é—­æ–‡ä»¶ï¼Ÿï¼ˆä¸€å®šè¦å¤šä»£ç ç»ƒä¹ ï¼‰"><a href="#8ã€Cè¯­è¨€ä¸­å¦‚ä½•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ä½•è¯»å–æ–‡ä»¶ï¼Œå¦‚ä½•å…³é—­æ–‡ä»¶ï¼Ÿï¼ˆä¸€å®šè¦å¤šä»£ç ç»ƒä¹ ï¼‰" class="headerlink" title="8ã€Cè¯­è¨€ä¸­å¦‚ä½•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ä½•è¯»å–æ–‡ä»¶ï¼Œå¦‚ä½•å…³é—­æ–‡ä»¶ï¼Ÿï¼ˆä¸€å®šè¦å¤šä»£ç ç»ƒä¹ ï¼‰"></a>8ã€Cè¯­è¨€ä¸­å¦‚ä½•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ä½•è¯»å–æ–‡ä»¶ï¼Œå¦‚ä½•å…³é—­æ–‡ä»¶ï¼Ÿï¼ˆä¸€å®šè¦å¤šä»£ç ç»ƒä¹ ï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">writeFile</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* filePath)</span> &#123;<br>    FILE *file = fopen(filePath, <span class="hljs-string">&quot;w&quot;</span>);<br>    <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥(%s)\n&quot;</span>, filePath);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">size_t</span> wLen = fwrite(<span class="hljs-string">&quot;0123456789&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, file);<br>    <span class="hljs-keyword">if</span> (wLen &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;å†™å…¥æ–‡ä»¶å¤±è´¥(%zu)\n&quot;</span>, wLen);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    fclose(file);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;å†™å…¥æˆåŠŸ\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* filePath)</span> &#123;<br>    FILE *file = fopen(filePath, <span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥(%s)\n&quot;</span>, filePath);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">char</span> data[<span class="hljs-number">20</span>];<br>    <span class="hljs-type">size_t</span> rLen = fread(data, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>), <span class="hljs-number">10</span>, file);<br>    <span class="hljs-keyword">if</span> (rLen &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯»å–æ–‡ä»¶å¤±è´¥(%zu)\n&quot;</span>, rLen);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    fclose(file);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯»å–æˆåŠŸï¼ˆ%sï¼‰\n&quot;</span>, data);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * argv[])</span> &#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* filePath = <span class="hljs-string">&quot;/Users/carrot/Documents/Code_Template_iOS/01_éŸ³è§†é¢‘/10_æè¶…/01_ç¬¬ä¸€å­£/CDemo/Data/readFileName.txt&quot;</span>;<br>    writeFile(filePath);<br>    readFile(filePath);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>éŸ³è§†é¢‘å…¥é—¨è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éŸ³è§†é¢‘</tag>
      
      <tag>Macå‘½ä»¤</tag>
      
      <tag>Cè¯­è¨€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GitHubæ­å»ºä¸ªäººåšå®¢</title>
    <link href="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    <url>/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€å¼€å¯GitHubçš„homepageåŠŸèƒ½"><a href="#ä¸€ã€å¼€å¯GitHubçš„homepageåŠŸèƒ½" class="headerlink" title="ä¸€ã€å¼€å¯GitHubçš„homepageåŠŸèƒ½"></a>ä¸€ã€å¼€å¯GitHubçš„homepageåŠŸèƒ½</h2><h3 id="1ã€æ³¨å†ŒGitHubè´¦å·ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¯¹ä»“åº“åå­—æœ‰ä¸¥æ ¼è¦æ±‚ã€‚"><a href="#1ã€æ³¨å†ŒGitHubè´¦å·ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¯¹ä»“åº“åå­—æœ‰ä¸¥æ ¼è¦æ±‚ã€‚" class="headerlink" title="1ã€æ³¨å†ŒGitHubè´¦å·ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¯¹ä»“åº“åå­—æœ‰ä¸¥æ ¼è¦æ±‚ã€‚"></a>1ã€æ³¨å†ŒGitHubè´¦å·ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¯¹ä»“åº“åå­—æœ‰ä¸¥æ ¼è¦æ±‚ã€‚</h3><img src="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/image-20220425074530893.png" class="" title="image-20220425074530893"><h3 id="2ã€åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª-index-html-æ–‡ä»¶ï¼Œå¹¶å¡«å…¥ä»¥ä¸‹å†…å®¹ã€‚"><a href="#2ã€åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª-index-html-æ–‡ä»¶ï¼Œå¹¶å¡«å…¥ä»¥ä¸‹å†…å®¹ã€‚" class="headerlink" title="2ã€åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª index.html æ–‡ä»¶ï¼Œå¹¶å¡«å…¥ä»¥ä¸‹å†…å®¹ã€‚"></a>2ã€åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª <code>index.html</code> æ–‡ä»¶ï¼Œå¹¶å¡«å…¥ä»¥ä¸‹å†…å®¹ã€‚</h3><figure class="highlight html"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    Hello World<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3ã€è®¿é—®é¡µé¢ï¼Œè¡¨ç¤ºè¿™ä¸ªé˜¶æ®µæˆåŠŸäº†ã€‚"><a href="#3ã€è®¿é—®é¡µé¢ï¼Œè¡¨ç¤ºè¿™ä¸ªé˜¶æ®µæˆåŠŸäº†ã€‚" class="headerlink" title="3ã€è®¿é—®é¡µé¢ï¼Œè¡¨ç¤ºè¿™ä¸ªé˜¶æ®µæˆåŠŸäº†ã€‚"></a>3ã€è®¿é—®é¡µé¢ï¼Œè¡¨ç¤ºè¿™ä¸ªé˜¶æ®µæˆåŠŸäº†ã€‚</h3><img src="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/image-20220425075606389.png" class="" title="image-20220425075606389"><h2 id="äºŒã€æœ¬åœ°æ­å»ºhexoåšå®¢"><a href="#äºŒã€æœ¬åœ°æ­å»ºhexoåšå®¢" class="headerlink" title="äºŒã€æœ¬åœ°æ­å»ºhexoåšå®¢"></a>äºŒã€æœ¬åœ°æ­å»ºhexoåšå®¢</h2><h3 id="1ã€å®‰è£…Hexoï¼ˆä¾èµ–nodejsç¯å¢ƒï¼Œè‡ªè¡Œå®‰è£…ï¼‰"><a href="#1ã€å®‰è£…Hexoï¼ˆä¾èµ–nodejsç¯å¢ƒï¼Œè‡ªè¡Œå®‰è£…ï¼‰" class="headerlink" title="1ã€å®‰è£…Hexoï¼ˆä¾èµ–nodejsç¯å¢ƒï¼Œè‡ªè¡Œå®‰è£…ï¼‰"></a>1ã€å®‰è£…Hexoï¼ˆä¾èµ–nodejsç¯å¢ƒï¼Œè‡ªè¡Œå®‰è£…ï¼‰</h3><p> <a href="https://hexo.io/zh-cn/docs/">Hexo å®˜æ–¹å®‰è£…æ–‡æ¡£</a> </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g hexo-cli<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo -v<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ª <code>hexo-blog</code> å¹¶åˆå§‹åŒ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo init hexo-blog<br>cd hexo-blog<br>npm install<br></code></pre></td></tr></table></figure><p>æœ¬åœ°å¯åŠ¨</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">hexo g<br>hexo <span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—® <a href="http://localhost:4000/">http://localhost:4000</a> ï¼Œé¡µé¢é»˜è®¤ä¸»å›¾é£æ ¼å¦‚ä¸‹</p><img src="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lhb3JvbmdrZQ==,size_16,color_FFFFFF,t_70.png" class="" title="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><h3 id="2ã€æ›´æ¢hexoä¸»é¢˜ï¼ˆä¸ªäººæ¯”è¾ƒå–œæ¬¢Fluidï¼‰"><a href="#2ã€æ›´æ¢hexoä¸»é¢˜ï¼ˆä¸ªäººæ¯”è¾ƒå–œæ¬¢Fluidï¼‰" class="headerlink" title="2ã€æ›´æ¢hexoä¸»é¢˜ï¼ˆä¸ªäººæ¯”è¾ƒå–œæ¬¢Fluidï¼‰"></a>2ã€æ›´æ¢hexoä¸»é¢˜ï¼ˆä¸ªäººæ¯”è¾ƒå–œæ¬¢Fluidï¼‰</h3><p><a href="https://github.com/fluid-dev/hexo-theme-fluid">å®˜æ–¹å®‰è£…æ–‡æ¡£</a></p><h3 id="1ã€æ–¹å¼ä¸€ï¼š"><a href="#1ã€æ–¹å¼ä¸€ï¼š" class="headerlink" title="1ã€æ–¹å¼ä¸€ï¼š"></a>1ã€<strong>æ–¹å¼ä¸€ï¼š</strong></h3><p>Hexo 5.0.0 ç‰ˆæœ¬ä»¥ä¸Šï¼Œæ¨èé€šè¿‡ npm ç›´æ¥å®‰è£…ï¼Œè¿›å…¥åšå®¢ç›®å½•æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">npm install <span class="hljs-comment">--save hexo-theme-fluid</span><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨åšå®¢ç›®å½•ä¸‹åˆ›å»º <code>_config.fluid.yml</code>ï¼Œå°†ä¸»é¢˜çš„ <a href="https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml">_config.yml</a> å†…å®¹å¤åˆ¶è¿›å»ã€‚</p><h3 id="2ã€æ–¹å¼äºŒï¼š"><a href="#2ã€æ–¹å¼äºŒï¼š" class="headerlink" title="2ã€æ–¹å¼äºŒï¼š"></a>2ã€<strong>æ–¹å¼äºŒï¼š</strong></h3><p>ä¸‹è½½ <a href="https://github.com/fluid-dev/hexo-theme-fluid/releases">æœ€æ–° release ç‰ˆæœ¬</a> è§£å‹åˆ° themes ç›®å½•ï¼Œå¹¶å°†è§£å‹å‡ºçš„æ–‡ä»¶å¤¹é‡å‘½åä¸º <code>fluid</code>ã€‚</p><p>å¦‚ä¸‹ä¿®æ”¹ Hexo åšå®¢ç›®å½•ä¸­çš„ <code>_config.yml</code>ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">theme:</span> fluid  <span class="hljs-meta"># æŒ‡å®šä¸»é¢˜</span><br><br><span class="hljs-symbol">language:</span> <span class="hljs-built_in">zh</span>-CN  <span class="hljs-meta"># æŒ‡å®šè¯­è¨€ï¼Œä¼šå½±å“ä¸»é¢˜æ˜¾ç¤ºçš„è¯­è¨€ï¼ŒæŒ‰éœ€ä¿®æ”¹</span><br></code></pre></td></tr></table></figure><h3 id="3ã€åˆ›å»ºã€Œå…³äºé¡µã€"><a href="#3ã€åˆ›å»ºã€Œå…³äºé¡µã€" class="headerlink" title="3ã€åˆ›å»ºã€Œå…³äºé¡µã€"></a>3ã€<strong>åˆ›å»ºã€Œå…³äºé¡µã€</strong></h3><p>é¦–æ¬¡ä½¿ç”¨ä¸»é¢˜çš„ã€Œå…³äºé¡µã€éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new page about<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæˆåŠŸåï¼Œç¼–è¾‘åšå®¢ç›®å½•ä¸‹ <code>/source/about/index.md</code>ï¼Œæ·»åŠ  <code>layout</code> å±æ€§ã€‚</p><p>ä¿®æ”¹åçš„æ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">---<br>title: about<br>date: 2020-02-23 19:20:33<br><span class="hljs-section">layout: about</span><br><span class="hljs-section">---</span><br><br>è¿™é‡Œå†™å…³äºé¡µçš„æ­£æ–‡ï¼Œæ”¯æŒ Markdown, HTML<br></code></pre></td></tr></table></figure><h3 id="4ã€å¯åŠ¨æµ‹è¯•"><a href="#4ã€å¯åŠ¨æµ‹è¯•" class="headerlink" title="4ã€å¯åŠ¨æµ‹è¯•"></a>4ã€å¯åŠ¨æµ‹è¯•</h3><p><strong>æœ¬åœ°å¯åŠ¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo g -d<br>hexo s<br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—® <a href="http://localhost:4000ï¼Œ`Fluid`ä¸»é¢˜é£æ ¼é¡µé¢å¦‚ä¸‹">http://localhost:4000ï¼Œ`Fluid`ä¸»é¢˜é£æ ¼é¡µé¢å¦‚ä¸‹</a></p><img src="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lhb3JvbmdrZQ==,size_16,color_FFFFFF,t_70-20220426063940880.png" class="" title="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><h3 id="5ã€åˆ›å»ºæ–‡ç« "><a href="#5ã€åˆ›å»ºæ–‡ç« " class="headerlink" title="5ã€åˆ›å»ºæ–‡ç« "></a>5ã€åˆ›å»ºæ–‡ç« </h3><p>å¦‚ä¸‹ä¿®æ”¹ Hexo åšå®¢ç›®å½•ä¸­çš„ <code>_config.yml</code>ï¼Œæ‰“å¼€è¿™ä¸ªé…ç½®æ˜¯ä¸ºäº†åœ¨ç”Ÿæˆæ–‡ç« çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªåŒåçš„èµ„æºç›®å½•ç”¨äºå­˜æ”¾å›¾ç‰‡æ–‡ä»¶ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">post_asset_folder: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« ï¼Œåä¸ºã€Šæµ‹è¯•æ–‡ç« ã€‹</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">hexo <span class="hljs-built_in">new</span> <span class="hljs-built_in">post</span> <span class="hljs-comment">--path æµ‹è¯•1/æµ‹è¯•æ–‡ç« 1</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæˆååœ¨<code>source\_posts</code>ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªmdæ–‡ä»¶å’Œä¸€ä¸ªåŒåçš„èµ„æºç›®å½•(ç”¨äºå­˜æ”¾å›¾ç‰‡)</p><img src="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/image-20220426064448766-0926693.png" class="" title="image-20220426064448766"><h3 id="6ã€å€ŸåŠ©-Typora-è½¯ä»¶ç¼–å†™æ–‡ç« "><a href="#6ã€å€ŸåŠ©-Typora-è½¯ä»¶ç¼–å†™æ–‡ç« " class="headerlink" title="6ã€å€ŸåŠ© Typora è½¯ä»¶ç¼–å†™æ–‡ç« "></a>6ã€å€ŸåŠ© Typora è½¯ä»¶ç¼–å†™æ–‡ç« </h3><p>å¯¹äºå›¾ç‰‡èµ„æºçš„ç®¡ç†æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œ <a href="https://moeci.com/posts/hexo-typora/">æ¨èæ–¹æ¡ˆ</a></p><p>é…ç½®typoraï¼Œå›¾ç‰‡æ–‡ä»¶ä¿å­˜è·¯å¾„: <code>./$&#123;filename&#125;</code> å³ä¿å­˜åˆ°ä¸ å½“å‰æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶å ç›¸åŒçš„åŒçº§æ–‡ä»¶å¤¹ä¸‹</p><img src="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/image-20201128093318078.png" class="" title="img"><img src="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/image-20201128093433709.png" class="" title="img"><p>é…ç½®ç»™hexo-blogé¡¹ç›®é…ç½®æ’ä»¶</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">npm install hexo-asset-<span class="hljs-selector-tag">img</span> <span class="hljs-attr">--save</span><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å‘å¸ƒåˆ°GitHub-Pages"><a href="#ä¸‰ã€å‘å¸ƒåˆ°GitHub-Pages" class="headerlink" title="ä¸‰ã€å‘å¸ƒåˆ°GitHub Pages"></a>ä¸‰ã€å‘å¸ƒåˆ°GitHub Pages</h2><h3 id="1ã€å®‰è£…-hexo-deployer-git-å‘å¸ƒæ’ä»¶"><a href="#1ã€å®‰è£…-hexo-deployer-git-å‘å¸ƒæ’ä»¶" class="headerlink" title="1ã€å®‰è£…  hexo-deployer-git å‘å¸ƒæ’ä»¶"></a>1ã€å®‰è£…  <code>hexo-deployer-git</code> å‘å¸ƒæ’ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„-config-ymlï¼Œé…ç½®-GitHub-ç›¸å…³ä¿¡æ¯"><a href="#2ã€ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„-config-ymlï¼Œé…ç½®-GitHub-ç›¸å…³ä¿¡æ¯" class="headerlink" title="2ã€ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ _config.ymlï¼Œé…ç½® GitHub ç›¸å…³ä¿¡æ¯"></a>2ã€ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code>ï¼Œé…ç½® <code>GitHub</code> ç›¸å…³ä¿¡æ¯</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"># Deployment<br>## Docs<span class="hljs-punctuation">:</span> https<span class="hljs-punctuation">:</span><span class="hljs-comment">//hexo.io/docs/one-command-deployment</span><br>deploy<span class="hljs-punctuation">:</span><br>  type<span class="hljs-punctuation">:</span> git<br>  repo<span class="hljs-punctuation">:</span> git@github.com<span class="hljs-punctuation">:</span>carrotlsp/carrotlsp.github.io.git<br>  branch<span class="hljs-punctuation">:</span> main<br></code></pre></td></tr></table></figure><h3 id="3ã€é…ç½®å»ºç«‹æœ¬åœ°ç”µè„‘å’ŒGitHubçš„ssh-keyè¿æ¥"><a href="#3ã€é…ç½®å»ºç«‹æœ¬åœ°ç”µè„‘å’ŒGitHubçš„ssh-keyè¿æ¥" class="headerlink" title="3ã€é…ç½®å»ºç«‹æœ¬åœ°ç”µè„‘å’ŒGitHubçš„ssh-keyè¿æ¥"></a>3ã€é…ç½®å»ºç«‹æœ¬åœ°ç”µè„‘å’ŒGitHubçš„ssh-keyè¿æ¥</h3><p>å°±æ˜¯æŠŠè‡ªå·± <code>cd ~/.ssh/ </code> ç›®å½•ä¸‹çš„å…¬é’¥ç»™åˆ°GitHubé…ç½®ä¸­</p><h3 id="4ã€å‘å¸ƒ"><a href="#4ã€å‘å¸ƒ" class="headerlink" title="4ã€å‘å¸ƒ"></a>4ã€å‘å¸ƒ</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo g</span><br><span class="hljs-attribute">hexo d</span><br></code></pre></td></tr></table></figure><p>è®¿é—® <code>https://carrotlsp.github.io/</code> å³å¯çœ‹åˆ°æ•ˆæœ</p><img src="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/image-20220426065418218.png" class="" title="image-20220426065418218"><h2 id="å››ã€ä¸€äº›å°æŠ€å·§"><a href="#å››ã€ä¸€äº›å°æŠ€å·§" class="headerlink" title="å››ã€ä¸€äº›å°æŠ€å·§"></a>å››ã€ä¸€äº›å°æŠ€å·§</h2><h3 id="1ã€å¦‚ä½•æŠŠå…³é”®å­—æ ‡çº¢ï¼Ÿ"><a href="#1ã€å¦‚ä½•æŠŠå…³é”®å­—æ ‡çº¢ï¼Ÿ" class="headerlink" title="1ã€å¦‚ä½•æŠŠå…³é”®å­—æ ‡çº¢ï¼Ÿ"></a>1ã€å¦‚ä½•æŠŠå…³é”®å­—æ ‡çº¢ï¼Ÿ</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;red&quot;</span>&gt;</span></span>çº¢è‰²å­—ä½“<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æ¯æ¬¡æ•²è¿™ä¸ªHTMLè¯­æ³•è¿‡äºç¹æ‚ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© <code>è¾“å…¥æ³•</code> çš„å¿«æ·æŒ‡ä»¤å³å¯ï¼Œå¦‚ä¸‹å›¾</p><img src="/2022/04/25/%E6%9D%82%E8%B0%88/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/image-20220426065638524.png" class="" title="image-20220426065638524"><h3 id="2ã€å¹³æ—¶å†™æ–‡ç« å¸¸ç”¨å‘½ä»¤ï¼Ÿ"><a href="#2ã€å¹³æ—¶å†™æ–‡ç« å¸¸ç”¨å‘½ä»¤ï¼Ÿ" class="headerlink" title="2ã€å¹³æ—¶å†™æ–‡ç« å¸¸ç”¨å‘½ä»¤ï¼Ÿ"></a>2ã€å¹³æ—¶å†™æ–‡ç« å¸¸ç”¨å‘½ä»¤ï¼Ÿ</h3><ul><li>åˆ›å»ºæ–‡ä»¶ç»“æ„</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new post --path æ–‡ç« ç›®å½•/æ–‡ç« åå­—<br></code></pre></td></tr></table></figure><ul><li>ç”Ÿæˆæ–‡ç« </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo g<br></code></pre></td></tr></table></figure><ul><li>å‘å¸ƒæ–‡ç« </li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">hexo d<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åšå®¢æ­å»º</tag>
      
      <tag>hexo</tag>
      
      <tag>GitHub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>day01æŒ‡é’ˆå…³é”®çŸ¥è¯†ç‚¹</title>
    <link href="/2022/04/25/C%E8%AF%AD%E8%A8%80/day01/"/>
    <url>/2022/04/25/C%E8%AF%AD%E8%A8%80/day01/</url>
    
    <content type="html"><![CDATA[<h2 id="day01æŒ‡é’ˆå…³é”®çŸ¥è¯†ç‚¹"><a href="#day01æŒ‡é’ˆå…³é”®çŸ¥è¯†ç‚¹" class="headerlink" title="day01æŒ‡é’ˆå…³é”®çŸ¥è¯†ç‚¹"></a>day01æŒ‡é’ˆå…³é”®çŸ¥è¯†ç‚¹</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯åœ°å€ï¼ˆå¦‚ä½•å®šä¹‰ï¼‰ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯åœ°å€ï¼ˆå¦‚ä½•å®šä¹‰ï¼‰ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯åœ°å€ï¼ˆå¦‚ä½•å®šä¹‰ï¼‰ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯åœ°å€ï¼ˆå¦‚ä½•å®šä¹‰ï¼‰ï¼Ÿ</h3><ul><li>ã€å®šä¹‰ã€‘å†…å­˜ä¸­å­—èŠ‚çš„ç¼–å·ç§°ä¸ºåœ°å€ã€‚</li></ul><h3 id="2ã€å˜é‡åã€å‡½æ•°åã€å­—ç¬¦ä¸²åã€æ•°ç»„åï¼Œå®ƒä»¬éƒ½æ˜¯åœ°å€çš„åŠ©è®°ç¬¦ï¼Œä½†æ˜¯åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œè¿™äº›åå­—çš„å«ä¹‰åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2ã€å˜é‡åã€å‡½æ•°åã€å­—ç¬¦ä¸²åã€æ•°ç»„åï¼Œå®ƒä»¬éƒ½æ˜¯åœ°å€çš„åŠ©è®°ç¬¦ï¼Œä½†æ˜¯åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œè¿™äº›åå­—çš„å«ä¹‰åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€å˜é‡åã€å‡½æ•°åã€å­—ç¬¦ä¸²åã€æ•°ç»„åï¼Œå®ƒä»¬éƒ½æ˜¯åœ°å€çš„åŠ©è®°ç¬¦ï¼Œä½†æ˜¯åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œè¿™äº›åå­—çš„å«ä¹‰åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2ã€å˜é‡åã€å‡½æ•°åã€å­—ç¬¦ä¸²åã€æ•°ç»„åï¼Œå®ƒä»¬éƒ½æ˜¯<font color="red">åœ°å€çš„åŠ©è®°ç¬¦</font>ï¼Œä½†æ˜¯åœ¨<font color="red">ç¼–ç </font>è¿‡ç¨‹ä¸­ï¼Œè¿™äº›åå­—çš„å«ä¹‰åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>ã€å˜é‡åã€‘åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œè¡¨ç¤ºçš„æ˜¯æ•°æ®æœ¬èº«ã€‚</li><li>ã€å‡½æ•°åã€å­—ç¬¦ä¸²åã€æ•°ç»„åã€‘åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œè¡¨ç¤ºçš„æ˜¯ä»£ç å—æˆ–æ•°æ®å—çš„é¦–åœ°å€ã€‚</li></ul><h3 id="3ã€ä»€ä¹ˆæ˜¯æŒ‡é’ˆå˜é‡ï¼Ÿ"><a href="#3ã€ä»€ä¹ˆæ˜¯æŒ‡é’ˆå˜é‡ï¼Ÿ" class="headerlink" title="3ã€ä»€ä¹ˆæ˜¯æŒ‡é’ˆå˜é‡ï¼Ÿ"></a>3ã€ä»€ä¹ˆæ˜¯æŒ‡é’ˆå˜é‡ï¼Ÿ</h3><ul><li>æ•°æ®åœ¨å†…å­˜ä¸­çš„åœ°å€ä¹Ÿç§°ä¸ºæŒ‡é’ˆï¼Œå¦‚æœä¸€ä¸ªå˜é‡å­˜å‚¨äº†ä¸€ä»½æ•°æ®çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬å°±ç§°å®ƒé—®æŒ‡é’ˆå˜é‡ã€‚</li></ul><h3 id="4ã€ä½¿ç”¨æŒ‡é’ˆå˜é‡çš„æ—¶å€™ï¼Œä»€ä¹ˆæ—¶å€™éœ€å¸¦-å·ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸èƒ½å¸¦-å·"><a href="#4ã€ä½¿ç”¨æŒ‡é’ˆå˜é‡çš„æ—¶å€™ï¼Œä»€ä¹ˆæ—¶å€™éœ€å¸¦-å·ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸èƒ½å¸¦-å·" class="headerlink" title="4ã€ä½¿ç”¨æŒ‡é’ˆå˜é‡çš„æ—¶å€™ï¼Œä»€ä¹ˆæ—¶å€™éœ€å¸¦*å·ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸èƒ½å¸¦*å·?"></a>4ã€ä½¿ç”¨æŒ‡é’ˆå˜é‡çš„æ—¶å€™ï¼Œä»€ä¹ˆæ—¶å€™éœ€å¸¦<font color="red">*å·</font>ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸èƒ½å¸¦<font color="red">*å·</font>?</h3><ul><li>ã€éœ€å¸¦<font color="red">*å·</font>ã€‘â‘  åœ¨å®šä¹‰æŒ‡é’ˆå˜é‡æ—¶ï¼Œä¸ºäº†å’Œæ™®é€šå˜é‡åŒºåˆ†å¼€æ¥ï¼Œéœ€è¦ä½¿ç”¨<font color="red">*å·</font> â‘¡è·å–æŒ‡é’ˆå˜é‡æ‰€æŒ‡å‘æ•°æ®æ—¶ï¼Œéœ€è¦ä½¿ç”¨<font color="red">*å·</font> </li><li>ã€ä¸èƒ½å¸¦<font color="red">*å·</font>ã€‘åœ¨éå®šä¹‰è¡¨è¾¾å¼ä¸­ï¼Œå¯¹æŒ‡é’ˆè¿›è¡Œèµ‹å€¼ï¼Œæ”¹å˜å…¶æŒ‡å‘æ—¶ä¸èƒ½ä½¿ç”¨<font color="red">*å·</font> ã€‚</li></ul><h3 id="5ã€-å·åœ¨å®šä¹‰å’Œä½¿ç”¨æŒ‡é’ˆå˜é‡æ—¶ï¼Œå«ä¹‰ä¸€æ ·å—ï¼Ÿ"><a href="#5ã€-å·åœ¨å®šä¹‰å’Œä½¿ç”¨æŒ‡é’ˆå˜é‡æ—¶ï¼Œå«ä¹‰ä¸€æ ·å—ï¼Ÿ" class="headerlink" title="5ã€*å·åœ¨å®šä¹‰å’Œä½¿ç”¨æŒ‡é’ˆå˜é‡æ—¶ï¼Œå«ä¹‰ä¸€æ ·å—ï¼Ÿ"></a>5ã€<font color="red">*å·</font>åœ¨å®šä¹‰å’Œä½¿ç”¨æŒ‡é’ˆå˜é‡æ—¶ï¼Œå«ä¹‰ä¸€æ ·å—ï¼Ÿ</h3><ul><li>ã€<font color="red">*å·</font>å®šä¹‰æ—¶ã€‘*å·å¯ä»¥ç”¨åœ¨æŒ‡é’ˆå˜é‡çš„å®šä¹‰ä¸­ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œä»¥å’Œæ™®é€šå˜é‡åŒºåˆ†å¼€</li><li>ã€<font color="red">*å·</font>ä½¿ç”¨æ—¶ã€‘ä½¿ç”¨æŒ‡é’ˆå˜é‡æ—¶å†å‰é¢åŠ *å·ï¼Œè¡¨ç¤ºè·å–æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ï¼Œæˆ–è€…è¯´è¡¨ç¤ºçš„æ˜¯æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®æœ¬èº«ã€‚</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å®šä¹‰æŒ‡é’ˆå˜é‡æ—¶çš„*å·</strong>å’Œ<strong>ä½¿ç”¨æŒ‡é’ˆå˜é‡æ—¶çš„*å·</strong>æ„ä¹‰å®Œå…¨ä¸åŒ</li></ul><h3 id="6ã€-å·æ€»å…±æœ‰å‡ ç§ç”¨æ³•ï¼Ÿ"><a href="#6ã€-å·æ€»å…±æœ‰å‡ ç§ç”¨æ³•ï¼Ÿ" class="headerlink" title="6ã€*å·æ€»å…±æœ‰å‡ ç§ç”¨æ³•ï¼Ÿ"></a>6ã€<font color="red">*å·</font>æ€»å…±æœ‰å‡ ç§ç”¨æ³•ï¼Ÿ</h3><ul><li>â‘ ç”¨äºä¹˜æ³•è¡¨è¾¾å¼ä¸­</li><li>â‘¡ç”¨äºå®šä¹‰æŒ‡é’ˆå˜é‡</li><li>â‘¢ç”¨äºè·å–æŒ‡é’ˆå˜é‡æ‰€æŒ‡å‘çš„æ•°æ®</li></ul>]]></content>
    
    
    <categories>
      
      <category>Cè¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŒ‡é’ˆ</tag>
      
      <tag>åœ°å€</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
